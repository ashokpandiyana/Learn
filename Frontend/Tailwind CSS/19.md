# Chapter 19: Custom Plugins

## 19.1 Understanding Tailwind Plugins

Plugins extend Tailwind's functionality by adding new utilities, components, base styles, or variants.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PLUGIN CAPABILITIES                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  1. addUtilities()    â†’ Add new utility classes                â”‚
â”‚     .rotate-15 { transform: rotate(15deg); }                   â”‚
â”‚                                                                  â”‚
â”‚  2. addComponents()   â†’ Add component classes                   â”‚
â”‚     .btn { padding: 0.5rem 1rem; ... }                         â”‚
â”‚                                                                  â”‚
â”‚  3. addBase()         â†’ Add base/reset styles                   â”‚
â”‚     html { scroll-behavior: smooth; }                          â”‚
â”‚                                                                  â”‚
â”‚  4. addVariant()      â†’ Add new variants                        â”‚
â”‚     hocus: â†’ :hover, :focus                                    â”‚
â”‚                                                                  â”‚
â”‚  5. matchUtilities()  â†’ Add dynamic utilities with values       â”‚
â”‚     tab-{n} â†’ tab-size based on config values                  â”‚
â”‚                                                                  â”‚
â”‚  6. theme()           â†’ Access theme values                     â”‚
â”‚                                                                  â”‚
â”‚  7. config()          â†’ Access full config                      â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 19.2 Plugin Structure

### Basic Plugin Syntax

```javascript
// tailwind.config.js
const plugin = require('tailwindcss/plugin');

module.exports = {
  plugins: [
    // Inline plugin
    plugin(function({ addUtilities, addComponents, addBase, addVariant, theme, config, e }) {
      // Plugin code here
    }),
    
    // Or with options
    plugin.withOptions(function(options = {}) {
      return function({ addUtilities, theme }) {
        // Plugin code with options
      };
    }),
  ],
};
```

### External Plugin File

```javascript
// plugins/my-plugin.js
const plugin = require('tailwindcss/plugin');

module.exports = plugin(function({ addUtilities, addComponents, theme }) {
  // Plugin code
});

// tailwind.config.js
module.exports = {
  plugins: [
    require('./plugins/my-plugin'),
  ],
};
```

---

## 19.3 Adding Static Utilities

Simple utilities with fixed values.

```javascript
const plugin = require('tailwindcss/plugin');

module.exports = {
  plugins: [
    plugin(function({ addUtilities }) {
      addUtilities({
        // Text shadow utilities
        '.text-shadow': {
          'text-shadow': '2px 2px 4px rgba(0, 0, 0, 0.1)',
        },
        '.text-shadow-md': {
          'text-shadow': '4px 4px 8px rgba(0, 0, 0, 0.12)',
        },
        '.text-shadow-lg': {
          'text-shadow': '8px 8px 16px rgba(0, 0, 0, 0.15)',
        },
        '.text-shadow-none': {
          'text-shadow': 'none',
        },
        
        // Hide scrollbar
        '.scrollbar-hide': {
          '-ms-overflow-style': 'none',
          'scrollbar-width': 'none',
          '&::-webkit-scrollbar': {
            display: 'none',
          },
        },
        
        // Writing modes
        '.writing-vertical': {
          'writing-mode': 'vertical-rl',
        },
        '.writing-horizontal': {
          'writing-mode': 'horizontal-tb',
        },
        
        // Text stroke
        '.text-stroke': {
          '-webkit-text-stroke': '1px currentColor',
        },
        '.text-stroke-2': {
          '-webkit-text-stroke': '2px currentColor',
        },
        
        // Drag prevention
        '.drag-none': {
          '-webkit-user-drag': 'none',
          'user-drag': 'none',
        },
        
        // Flip utilities
        '.flip-x': {
          transform: 'scaleX(-1)',
        },
        '.flip-y': {
          transform: 'scaleY(-1)',
        },
        '.flip-both': {
          transform: 'scale(-1, -1)',
        },
      });
    }),
  ],
};
```

### Usage

```html
<h1 class="text-shadow-lg">Shadowed heading</h1>
<div class="scrollbar-hide overflow-auto">Hidden scrollbar</div>
<p class="writing-vertical">Vertical text</p>
<span class="text-stroke text-transparent">Outlined text</span>
```

---

## 19.4 Adding Dynamic Utilities (matchUtilities)

Utilities that use theme values or accept arbitrary values.

```javascript
const plugin = require('tailwindcss/plugin');

module.exports = {
  theme: {
    extend: {
      // Add theme values for the plugin
      textShadow: {
        sm: '1px 1px 2px var(--tw-shadow-color, rgba(0,0,0,0.1))',
        DEFAULT: '2px 2px 4px var(--tw-shadow-color, rgba(0,0,0,0.1))',
        md: '4px 4px 8px var(--tw-shadow-color, rgba(0,0,0,0.12))',
        lg: '8px 8px 16px var(--tw-shadow-color, rgba(0,0,0,0.15))',
        xl: '12px 12px 24px var(--tw-shadow-color, rgba(0,0,0,0.2))',
        none: 'none',
      },
    },
  },
  plugins: [
    plugin(function({ matchUtilities, theme }) {
      // Dynamic text-shadow utility
      matchUtilities(
        {
          'text-shadow': (value) => ({
            textShadow: value,
          }),
        },
        {
          values: theme('textShadow'),
          // Allow arbitrary values: text-shadow-[0_4px_8px_red]
        }
      );
      
      // Dynamic animation delay utility
      matchUtilities(
        {
          'animation-delay': (value) => ({
            animationDelay: value,
          }),
        },
        {
          values: theme('transitionDelay'), // Reuse existing scale
        }
      );
      
      // Dynamic perspective utility
      matchUtilities(
        {
          'perspective': (value) => ({
            perspective: value,
          }),
        },
        {
          values: {
            none: 'none',
            sm: '250px',
            DEFAULT: '500px',
            md: '750px',
            lg: '1000px',
            xl: '1500px',
          },
        }
      );
      
      // Dynamic tab-size utility
      matchUtilities(
        {
          'tab': (value) => ({
            tabSize: value,
          }),
        },
        {
          values: {
            1: '1',
            2: '2',
            4: '4',
            8: '8',
          },
        }
      );
    }),
  ],
};
```

### Usage

```html
<!-- Uses theme values -->
<h1 class="text-shadow-lg">Large shadow</h1>
<h1 class="text-shadow-md">Medium shadow</h1>

<!-- Arbitrary values -->
<h1 class="text-shadow-[0_4px_8px_rgba(0,0,0,0.3)]">Custom shadow</h1>

<!-- Animation delay -->
<div class="animate-fade-in animation-delay-300">Delayed animation</div>

<!-- Perspective -->
<div class="perspective-lg">3D container</div>

<!-- Tab size -->
<pre class="tab-4">Code with 4-space tabs</pre>
```

---

## 19.5 Adding Components

Reusable component styles.

```javascript
const plugin = require('tailwindcss/plugin');

module.exports = {
  plugins: [
    plugin(function({ addComponents, theme }) {
      addComponents({
        // Button components
        '.btn': {
          display: 'inline-flex',
          alignItems: 'center',
          justifyContent: 'center',
          padding: `${theme('spacing.2')} ${theme('spacing.4')}`,
          fontSize: theme('fontSize.sm'),
          fontWeight: theme('fontWeight.medium'),
          borderRadius: theme('borderRadius.lg'),
          transitionProperty: 'all',
          transitionDuration: '200ms',
          '&:focus': {
            outline: 'none',
            boxShadow: `0 0 0 3px ${theme('colors.blue.500')}33`,
          },
          '&:disabled': {
            opacity: '0.5',
            cursor: 'not-allowed',
          },
        },
        '.btn-primary': {
          backgroundColor: theme('colors.blue.500'),
          color: theme('colors.white'),
          '&:hover': {
            backgroundColor: theme('colors.blue.600'),
          },
        },
        '.btn-secondary': {
          backgroundColor: theme('colors.gray.200'),
          color: theme('colors.gray.900'),
          '&:hover': {
            backgroundColor: theme('colors.gray.300'),
          },
        },
        '.btn-outline': {
          backgroundColor: 'transparent',
          borderWidth: '2px',
          borderColor: theme('colors.gray.300'),
          color: theme('colors.gray.700'),
          '&:hover': {
            backgroundColor: theme('colors.gray.100'),
          },
        },
        
        // Card component
        '.card': {
          backgroundColor: theme('colors.white'),
          borderRadius: theme('borderRadius.xl'),
          boxShadow: theme('boxShadow.lg'),
          overflow: 'hidden',
        },
        '.card-body': {
          padding: theme('spacing.6'),
        },
        '.card-header': {
          padding: theme('spacing.6'),
          borderBottom: `1px solid ${theme('colors.gray.200')}`,
        },
        '.card-footer': {
          padding: theme('spacing.6'),
          borderTop: `1px solid ${theme('colors.gray.200')}`,
          backgroundColor: theme('colors.gray.50'),
        },
        
        // Form input
        '.form-input': {
          width: '100%',
          padding: `${theme('spacing.2')} ${theme('spacing.3')}`,
          fontSize: theme('fontSize.base'),
          lineHeight: theme('lineHeight.normal'),
          color: theme('colors.gray.900'),
          backgroundColor: theme('colors.white'),
          borderWidth: '1px',
          borderColor: theme('colors.gray.300'),
          borderRadius: theme('borderRadius.md'),
          transitionProperty: 'border-color, box-shadow',
          transitionDuration: '200ms',
          '&:focus': {
            outline: 'none',
            borderColor: theme('colors.blue.500'),
            boxShadow: `0 0 0 3px ${theme('colors.blue.500')}20`,
          },
          '&::placeholder': {
            color: theme('colors.gray.400'),
          },
          '&:disabled': {
            backgroundColor: theme('colors.gray.100'),
            cursor: 'not-allowed',
          },
        },
        
        // Badge
        '.badge': {
          display: 'inline-flex',
          alignItems: 'center',
          padding: `${theme('spacing.0.5')} ${theme('spacing.2')}`,
          fontSize: theme('fontSize.xs'),
          fontWeight: theme('fontWeight.medium'),
          borderRadius: theme('borderRadius.full'),
        },
        '.badge-success': {
          backgroundColor: theme('colors.green.100'),
          color: theme('colors.green.800'),
        },
        '.badge-error': {
          backgroundColor: theme('colors.red.100'),
          color: theme('colors.red.800'),
        },
        '.badge-warning': {
          backgroundColor: theme('colors.yellow.100'),
          color: theme('colors.yellow.800'),
        },
      });
    }),
  ],
};
```

---

## 19.6 Adding Base Styles

Global defaults and resets.

```javascript
const plugin = require('tailwindcss/plugin');

module.exports = {
  plugins: [
    plugin(function({ addBase, theme }) {
      addBase({
        // Smooth scrolling
        'html': {
          scrollBehavior: 'smooth',
        },
        
        // Better font rendering
        'body': {
          '-webkit-font-smoothing': 'antialiased',
          '-moz-osx-font-smoothing': 'grayscale',
        },
        
        // Heading defaults
        'h1': {
          fontSize: theme('fontSize.4xl'),
          fontWeight: theme('fontWeight.bold'),
          lineHeight: theme('lineHeight.tight'),
        },
        'h2': {
          fontSize: theme('fontSize.3xl'),
          fontWeight: theme('fontWeight.semibold'),
          lineHeight: theme('lineHeight.tight'),
        },
        'h3': {
          fontSize: theme('fontSize.2xl'),
          fontWeight: theme('fontWeight.semibold'),
          lineHeight: theme('lineHeight.snug'),
        },
        
        // Link defaults
        'a': {
          color: theme('colors.blue.600'),
          textDecoration: 'none',
          '&:hover': {
            color: theme('colors.blue.800'),
            textDecoration: 'underline',
          },
        },
        
        // Image defaults
        'img, video': {
          maxWidth: '100%',
          height: 'auto',
        },
        
        // Better form defaults
        'input, textarea, select': {
          fontFamily: 'inherit',
          fontSize: '100%',
        },
        
        // Focus visible for keyboard users
        ':focus-visible': {
          outline: `2px solid ${theme('colors.blue.500')}`,
          outlineOffset: '2px',
        },
        
        // Remove default focus outline
        ':focus:not(:focus-visible)': {
          outline: 'none',
        },
        
        // Selection color
        '::selection': {
          backgroundColor: theme('colors.blue.200'),
          color: theme('colors.blue.900'),
        },
      });
    }),
  ],
};
```

---

## 19.7 Adding Custom Variants

Create new state variants.

```javascript
const plugin = require('tailwindcss/plugin');

module.exports = {
  plugins: [
    plugin(function({ addVariant, e }) {
      // Combined hover + focus
      addVariant('hocus', ['&:hover', '&:focus']);
      // Usage: hocus:text-blue-500
      
      // Hover on non-touch devices only
      addVariant('hover-none', '@media (hover: none) { &:hover }');
      addVariant('can-hover', '@media (hover: hover) { &:hover }');
      
      // Parent state variants
      addVariant('group-hocus', [
        ':merge(.group):hover &',
        ':merge(.group):focus &',
      ]);
      
      // Child state
      addVariant('child', '& > *');
      addVariant('child-hover', '& > *:hover');
      // Usage: child:border-b child-hover:bg-gray-50
      
      // Not variants
      addVariant('not-first', '&:not(:first-child)');
      addVariant('not-last', '&:not(:last-child)');
      addVariant('not-disabled', '&:not(:disabled)');
      
      // Peer and sibling variants
      addVariant('peer-not-checked', ':merge(.peer):not(:checked) ~ &');
      
      // State-based variants
      addVariant('error', '&[data-error="true"]');
      addVariant('success', '&[data-success="true"]');
      addVariant('loading', '&[data-loading="true"]');
      
      // Supports variants
      addVariant('supports-grid', '@supports (display: grid)');
      addVariant('supports-backdrop', '@supports (backdrop-filter: blur(1px))');
      
      // Print variant
      addVariant('print', '@media print');
      
      // Direction variants
      addVariant('rtl', '[dir="rtl"] &');
      addVariant('ltr', '[dir="ltr"] &');
      
      // Theme variants (for CSS custom properties)
      addVariant('theme-blue', '[data-theme="blue"] &');
      addVariant('theme-green', '[data-theme="green"] &');
      
      // JS-loaded variant (for progressive enhancement)
      addVariant('js', '[data-js] &');
      addVariant('no-js', ':not([data-js]) &');
      
      // High contrast mode
      addVariant('high-contrast', '@media (prefers-contrast: more)');
      
      // Nth-child variants
      addVariant('nth-2', '&:nth-child(2)');
      addVariant('nth-3', '&:nth-child(3)');
      addVariant('every-3', '&:nth-child(3n)');
      
      // State-based body variants
      addVariant('body-scrolled', 'body.scrolled &');
      addVariant('menu-open', 'body.menu-open &');
    }),
  ],
};
```

### Usage

```html
<!-- hocus (hover + focus) -->
<button class="hocus:text-blue-500 hocus:underline">
  Hover or focus me
</button>

<!-- child variant -->
<ul class="child:py-2 child:border-b child-hover:bg-gray-50">
  <li>Item 1</li>
  <li>Item 2</li>
</ul>

<!-- not-last -->
<li class="not-last:border-b">
  Border except on last item
</li>

<!-- data attribute state -->
<div data-error="true" class="error:border-red-500 error:text-red-600">
  Error state
</div>

<!-- supports variant -->
<div class="supports-backdrop:backdrop-blur-lg supports-backdrop:bg-white/50">
  Glassmorphism with fallback
</div>

<!-- print -->
<header class="print:hidden">
  Hidden when printing
</header>
```

---

## 19.8 Plugins with Options

Create configurable plugins.

```javascript
// plugins/typography.js
const plugin = require('tailwindcss/plugin');

module.exports = plugin.withOptions(
  function(options = {}) {
    const {
      className = 'prose',
      baseSize = '1rem',
      colors = {
        body: 'gray-700',
        headings: 'gray-900',
        links: 'blue-600',
      },
    } = options;

    return function({ addComponents, theme }) {
      addComponents({
        [`.${className}`]: {
          fontSize: baseSize,
          lineHeight: '1.75',
          color: theme(`colors.${colors.body}`),
          
          '& h1, & h2, & h3, & h4': {
            color: theme(`colors.${colors.headings}`),
            fontWeight: theme('fontWeight.bold'),
            marginTop: '1.5em',
            marginBottom: '0.5em',
          },
          
          '& h1': { fontSize: '2.25em' },
          '& h2': { fontSize: '1.875em' },
          '& h3': { fontSize: '1.5em' },
          
          '& p': {
            marginTop: '1em',
            marginBottom: '1em',
          },
          
          '& a': {
            color: theme(`colors.${colors.links}`),
            textDecoration: 'underline',
          },
          
          '& ul, & ol': {
            paddingLeft: '1.5em',
            marginTop: '1em',
            marginBottom: '1em',
          },
          
          '& li': {
            marginTop: '0.5em',
            marginBottom: '0.5em',
          },
          
          '& code': {
            backgroundColor: theme('colors.gray.100'),
            padding: '0.125em 0.25em',
            borderRadius: theme('borderRadius.sm'),
            fontSize: '0.875em',
          },
          
          '& pre': {
            backgroundColor: theme('colors.gray.900'),
            color: theme('colors.gray.100'),
            padding: '1em',
            borderRadius: theme('borderRadius.lg'),
            overflow: 'auto',
          },
        },
      });
    };
  },
  function(options = {}) {
    // Return theme extensions if needed
    return {};
  }
);

// tailwind.config.js
module.exports = {
  plugins: [
    // Default options
    require('./plugins/typography'),
    
    // Or with custom options
    require('./plugins/typography')({
      className: 'article',
      baseSize: '1.125rem',
      colors: {
        body: 'slate-700',
        headings: 'slate-900',
        links: 'indigo-600',
      },
    }),
  ],
};
```

---

## 19.9 Official Plugins

### @tailwindcss/typography

```bash
npm install @tailwindcss/typography
```

```javascript
// tailwind.config.js
module.exports = {
  plugins: [
    require('@tailwindcss/typography'),
  ],
};
```

```html
<article class="prose lg:prose-xl dark:prose-invert">
  <h1>Article Title</h1>
  <p>Beautifully styled content...</p>
</article>
```

### @tailwindcss/forms

```bash
npm install @tailwindcss/forms
```

```javascript
module.exports = {
  plugins: [
    require('@tailwindcss/forms'),
    // Or with strategy
    require('@tailwindcss/forms')({
      strategy: 'class', // Only apply to .form-* classes
    }),
  ],
};
```

### @tailwindcss/container-queries

```bash
npm install @tailwindcss/container-queries
```

```javascript
module.exports = {
  plugins: [
    require('@tailwindcss/container-queries'),
  ],
};
```

```html
<div class="@container">
  <div class="@sm:flex @lg:grid @lg:grid-cols-2">
    Container-responsive layout
  </div>
</div>
```

---

## 19.10 Complete Plugin Example

```javascript
// plugins/animations.js
const plugin = require('tailwindcss/plugin');

module.exports = plugin(
  function({ addUtilities, addComponents, matchUtilities, addVariant, theme }) {
    // Static utilities
    addUtilities({
      '.animate-delay-none': { animationDelay: '0ms' },
      '.animation-paused': { animationPlayState: 'paused' },
      '.animation-running': { animationPlayState: 'running' },
      '.animation-fill-none': { animationFillMode: 'none' },
      '.animation-fill-forwards': { animationFillMode: 'forwards' },
      '.animation-fill-backwards': { animationFillMode: 'backwards' },
      '.animation-fill-both': { animationFillMode: 'both' },
    });

    // Dynamic utilities
    matchUtilities(
      {
        'animate-delay': (value) => ({
          animationDelay: value,
        }),
        'animate-duration': (value) => ({
          animationDuration: value,
        }),
      },
      {
        values: theme('transitionDelay'),
      }
    );

    matchUtilities(
      {
        'animate-count': (value) => ({
          animationIterationCount: value,
        }),
      },
      {
        values: {
          1: '1',
          2: '2',
          3: '3',
          infinite: 'infinite',
        },
      }
    );

    // Animation variants
    addVariant('motion-safe', '@media (prefers-reduced-motion: no-preference)');
    addVariant('motion-reduce', '@media (prefers-reduced-motion: reduce)');

    // Component animations
    addComponents({
      '.animate-fade-in': {
        animation: 'fadeIn 0.5s ease-out forwards',
      },
      '.animate-fade-out': {
        animation: 'fadeOut 0.5s ease-out forwards',
      },
      '.animate-slide-up': {
        animation: 'slideUp 0.3s ease-out forwards',
      },
      '.animate-slide-down': {
        animation: 'slideDown 0.3s ease-out forwards',
      },
    });
  },
  {
    // Theme extensions
    theme: {
      extend: {
        keyframes: {
          fadeIn: {
            '0%': { opacity: '0' },
            '100%': { opacity: '1' },
          },
          fadeOut: {
            '0%': { opacity: '1' },
            '100%': { opacity: '0' },
          },
          slideUp: {
            '0%': { transform: 'translateY(20px)', opacity: '0' },
            '100%': { transform: 'translateY(0)', opacity: '1' },
          },
          slideDown: {
            '0%': { transform: 'translateY(-20px)', opacity: '0' },
            '100%': { transform: 'translateY(0)', opacity: '1' },
          },
        },
      },
    },
  }
);
```

---

## ğŸ’¡ Interview Quick Tips

1. **"What can Tailwind plugins add?"**
   - Utilities, components, base styles, variants

2. **"addUtilities vs matchUtilities?"**
   - `addUtilities`: Static, fixed values
   - `matchUtilities`: Dynamic, uses theme values

3. **"How to create custom variants?"**
   - `addVariant('name', 'selector')`
   - Can use arrays for multiple selectors

4. **"How to access theme values in plugins?"**
   - Use `theme('colors.blue.500')` function

5. **"Official Tailwind plugins?"**
   - typography, forms, container-queries
