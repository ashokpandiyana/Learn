# Chapter 18: Reusability Patterns

## 18.1 The Reusability Challenge

As projects grow, you'll need strategies to avoid repeating long class strings.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    REUSABILITY OPTIONS                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  1. Component Extraction (Recommended)                          â”‚
â”‚     â†’ React, Vue, Svelte, etc. components                       â”‚
â”‚     â†’ Best for: UI frameworks, complex components              â”‚
â”‚                                                                  â”‚
â”‚  2. @apply Directive                                            â”‚
â”‚     â†’ Extract utilities to CSS classes                          â”‚
â”‚     â†’ Best for: Simple patterns, no-framework projects         â”‚
â”‚                                                                  â”‚
â”‚  3. Plugin-based Components                                     â”‚
â”‚     â†’ Create utilities via Tailwind plugins                    â”‚
â”‚     â†’ Best for: Design systems, shared libraries               â”‚
â”‚                                                                  â”‚
â”‚  4. Multi-cursor Editing                                        â”‚
â”‚     â†’ Use editor features to edit multiple instances           â”‚
â”‚     â†’ Best for: Quick one-time updates                         â”‚
â”‚                                                                  â”‚
â”‚  âš ï¸ Priority: Components > Plugins > @apply                    â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 18.2 Component Extraction (Best Practice)

### React Components

```jsx
// Button.jsx
function Button({ 
  children, 
  variant = 'primary', 
  size = 'md',
  disabled = false,
  className = '',
  ...props 
}) {
  const baseStyles = `
    inline-flex items-center justify-center font-medium rounded-lg
    transition-colors duration-200
    focus:outline-none focus:ring-2 focus:ring-offset-2
    disabled:opacity-50 disabled:cursor-not-allowed
  `;
  
  const variants = {
    primary: `
      bg-blue-500 text-white 
      hover:bg-blue-600 
      focus:ring-blue-500
    `,
    secondary: `
      bg-gray-200 text-gray-900 
      hover:bg-gray-300 
      focus:ring-gray-500
    `,
    outline: `
      border-2 border-gray-300 text-gray-700 
      hover:bg-gray-50 
      focus:ring-gray-500
    `,
    danger: `
      bg-red-500 text-white 
      hover:bg-red-600 
      focus:ring-red-500
    `,
    ghost: `
      text-gray-600 
      hover:bg-gray-100 hover:text-gray-900 
      focus:ring-gray-500
    `,
  };
  
  const sizes = {
    sm: 'px-3 py-1.5 text-sm',
    md: 'px-4 py-2 text-base',
    lg: 'px-6 py-3 text-lg',
    xl: 'px-8 py-4 text-xl',
  };
  
  return (
    <button
      className={`${baseStyles} ${variants[variant]} ${sizes[size]} ${className}`}
      disabled={disabled}
      {...props}
    >
      {children}
    </button>
  );
}

// Usage
<Button variant="primary" size="lg">Click Me</Button>
<Button variant="outline" size="sm">Cancel</Button>
<Button variant="danger" disabled>Delete</Button>
```

### Card Component

```jsx
// Card.jsx
function Card({ children, className = '', padding = 'md', shadow = 'md' }) {
  const paddings = {
    none: '',
    sm: 'p-4',
    md: 'p-6',
    lg: 'p-8',
  };
  
  const shadows = {
    none: '',
    sm: 'shadow-sm',
    md: 'shadow-md',
    lg: 'shadow-lg',
    xl: 'shadow-xl',
  };
  
  return (
    <div className={`
      bg-white dark:bg-gray-800 
      rounded-xl 
      border border-gray-200 dark:border-gray-700
      ${paddings[padding]}
      ${shadows[shadow]}
      ${className}
    `}>
      {children}
    </div>
  );
}

// Card subcomponents
Card.Header = function CardHeader({ children, className = '' }) {
  return (
    <div className={`border-b border-gray-200 dark:border-gray-700 pb-4 mb-4 ${className}`}>
      {children}
    </div>
  );
};

Card.Title = function CardTitle({ children, className = '' }) {
  return (
    <h3 className={`text-lg font-semibold text-gray-900 dark:text-white ${className}`}>
      {children}
    </h3>
  );
};

Card.Body = function CardBody({ children, className = '' }) {
  return (
    <div className={`text-gray-600 dark:text-gray-400 ${className}`}>
      {children}
    </div>
  );
};

Card.Footer = function CardFooter({ children, className = '' }) {
  return (
    <div className={`border-t border-gray-200 dark:border-gray-700 pt-4 mt-4 ${className}`}>
      {children}
    </div>
  );
};

// Usage
<Card shadow="lg" padding="lg">
  <Card.Header>
    <Card.Title>Card Title</Card.Title>
  </Card.Header>
  <Card.Body>
    Card content goes here...
  </Card.Body>
  <Card.Footer>
    <Button>Action</Button>
  </Card.Footer>
</Card>
```

### Input Component

```jsx
// Input.jsx
import { forwardRef } from 'react';

const Input = forwardRef(function Input({
  label,
  error,
  hint,
  className = '',
  ...props
}, ref) {
  return (
    <div className="space-y-1">
      {label && (
        <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">
          {label}
          {props.required && <span className="text-red-500 ml-1">*</span>}
        </label>
      )}
      <input
        ref={ref}
        className={`
          w-full px-4 py-2 
          bg-white dark:bg-gray-900
          border rounded-lg
          text-gray-900 dark:text-white
          placeholder-gray-400 dark:placeholder-gray-500
          transition-colors duration-200
          ${error 
            ? 'border-red-500 focus:border-red-500 focus:ring-red-500/20' 
            : 'border-gray-300 dark:border-gray-600 focus:border-blue-500 focus:ring-blue-500/20'
          }
          focus:outline-none focus:ring-2
          disabled:bg-gray-100 dark:disabled:bg-gray-800 disabled:cursor-not-allowed
          ${className}
        `}
        {...props}
      />
      {error && (
        <p className="text-sm text-red-500">{error}</p>
      )}
      {hint && !error && (
        <p className="text-sm text-gray-500">{hint}</p>
      )}
    </div>
  );
});

// Usage
<Input 
  label="Email" 
  type="email" 
  placeholder="you@example.com"
  error={errors.email}
  required
/>
```

---

## 18.3 Class Merging with tailwind-merge

When building components, class conflicts can occur. Use `tailwind-merge`:

```bash
npm install tailwind-merge clsx
```

```jsx
// lib/utils.js
import { clsx } from 'clsx';
import { twMerge } from 'tailwind-merge';

export function cn(...inputs) {
  return twMerge(clsx(inputs));
}
```

### Why tailwind-merge?

```jsx
// Without tailwind-merge
const className = `p-4 ${props.className}`; 
// If props.className = "p-8", result is "p-4 p-8" (conflict!)

// With tailwind-merge
const className = cn('p-4', props.className);
// If props.className = "p-8", result is "p-8" (later wins!)
```

### Using cn() in Components

```jsx
import { cn } from '@/lib/utils';

function Button({ className, variant = 'primary', ...props }) {
  return (
    <button
      className={cn(
        // Base styles (can be overridden)
        'px-4 py-2 rounded-lg font-medium transition-colors',
        // Variant styles
        {
          'bg-blue-500 text-white hover:bg-blue-600': variant === 'primary',
          'bg-gray-200 text-gray-900 hover:bg-gray-300': variant === 'secondary',
        },
        // Consumer className (can override anything above)
        className
      )}
      {...props}
    />
  );
}

// Usage - className can override defaults
<Button className="px-8 rounded-full">Wide Pill Button</Button>
// Results in: px-8 py-2 rounded-full font-medium ... (px-4 and rounded-lg removed)
```

### Conditional Classes with cn()

```jsx
function Alert({ variant, className, children }) {
  return (
    <div
      className={cn(
        'p-4 rounded-lg border',
        // Conditional based on variant
        variant === 'success' && 'bg-green-50 border-green-200 text-green-800',
        variant === 'error' && 'bg-red-50 border-red-200 text-red-800',
        variant === 'warning' && 'bg-yellow-50 border-yellow-200 text-yellow-800',
        variant === 'info' && 'bg-blue-50 border-blue-200 text-blue-800',
        className
      )}
    >
      {children}
    </div>
  );
}
```

---

## 18.4 The @apply Directive

Extract utility patterns to CSS classes.

### Basic Usage

```css
/* input.css or globals.css */
@tailwind base;
@tailwind components;
@tailwind utilities;

@layer components {
  .btn {
    @apply px-4 py-2 rounded-lg font-medium transition-colors duration-200;
    @apply focus:outline-none focus:ring-2 focus:ring-offset-2;
  }
  
  .btn-primary {
    @apply btn bg-blue-500 text-white hover:bg-blue-600 focus:ring-blue-500;
  }
  
  .btn-secondary {
    @apply btn bg-gray-200 text-gray-900 hover:bg-gray-300 focus:ring-gray-500;
  }
  
  .card {
    @apply bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6;
    @apply border border-gray-200 dark:border-gray-700;
  }
  
  .input {
    @apply w-full px-4 py-2 rounded-lg border border-gray-300;
    @apply bg-white dark:bg-gray-900;
    @apply text-gray-900 dark:text-white;
    @apply placeholder-gray-400;
    @apply focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500;
    @apply disabled:bg-gray-100 disabled:cursor-not-allowed;
  }
}
```

```html
<!-- Usage -->
<button class="btn-primary">Primary Button</button>
<button class="btn-secondary">Secondary Button</button>
<div class="card">Card content</div>
<input class="input" placeholder="Enter text...">
```

### @apply with Variants

```css
@layer components {
  .link {
    @apply text-blue-600 hover:text-blue-800 hover:underline;
    @apply dark:text-blue-400 dark:hover:text-blue-300;
    @apply transition-colors duration-200;
  }
  
  .badge {
    @apply inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium;
  }
  
  .badge-success {
    @apply badge bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200;
  }
  
  .badge-error {
    @apply badge bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200;
  }
}
```

### @apply Limitations

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    @apply LIMITATIONS                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  âš ï¸ Can't use arbitrary values:                                â”‚
â”‚     âŒ @apply w-[137px];                                       â”‚
â”‚     âœ… Use regular CSS: width: 137px;                          â”‚
â”‚                                                                  â”‚
â”‚  âš ï¸ Can't use !important modifier:                             â”‚
â”‚     âŒ @apply !bg-red-500;                                     â”‚
â”‚     âœ… @apply bg-red-500 !important;                           â”‚
â”‚                                                                  â”‚
â”‚  âš ï¸ Creates larger CSS bundles:                                â”‚
â”‚     Extracts into new rules, doesn't dedupe                    â”‚
â”‚                                                                  â”‚
â”‚  âš ï¸ Harder to debug:                                           â”‚
â”‚     Can't see utilities in browser DevTools                    â”‚
â”‚                                                                  â”‚
â”‚  âš ï¸ Breaks Tailwind's colocation benefit:                      â”‚
â”‚     Styles separate from markup                                 â”‚
â”‚                                                                  â”‚
â”‚  When to use @apply:                                            â”‚
â”‚  â€¢ Very simple, repeated patterns                               â”‚
â”‚  â€¢ No component framework available                             â”‚
â”‚  â€¢ Third-party libraries you can't control                     â”‚
â”‚  â€¢ CMS/markdown content styling                                 â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 18.5 @layer Directive

Control where custom styles are inserted.

### Understanding Layers

```css
@tailwind base;       /* CSS reset, element defaults */
@tailwind components; /* Component classes */
@tailwind utilities;  /* Utility classes */

/* Layer order determines specificity */
/* base < components < utilities */
```

### Using @layer

```css
/* Base layer: Element defaults */
@layer base {
  h1 {
    @apply text-3xl font-bold text-gray-900 dark:text-white;
  }
  
  h2 {
    @apply text-2xl font-semibold text-gray-900 dark:text-white;
  }
  
  a {
    @apply text-blue-600 hover:text-blue-800 dark:text-blue-400;
  }
  
  /* Custom font defaults */
  html {
    @apply font-sans antialiased;
  }
}

/* Components layer: Reusable components */
@layer components {
  .card {
    @apply bg-white rounded-xl shadow-lg p-6;
  }
  
  .btn {
    @apply px-4 py-2 rounded-lg font-medium;
  }
}

/* Utilities layer: Custom utilities */
@layer utilities {
  .text-shadow {
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
  }
  
  .text-shadow-lg {
    text-shadow: 4px 4px 8px rgba(0, 0, 0, 0.2);
  }
  
  .scrollbar-hide {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
  
  .scrollbar-hide::-webkit-scrollbar {
    display: none;
  }
}
```

### Layer Benefits

```html
<!-- Utilities can override components -->
<div class="card p-8">
  <!-- p-8 (utility) overrides p-6 from .card (component) -->
</div>

<!-- Without @layer, this might not work! -->
```

---

## 18.6 Design Token Configuration

Create a centralized design system in your config.

```javascript
// tailwind.config.js
const colors = {
  brand: {
    50: '#eff6ff',
    100: '#dbeafe',
    200: '#bfdbfe',
    300: '#93c5fd',
    400: '#60a5fa',
    500: '#3b82f6',
    600: '#2563eb',
    700: '#1d4ed8',
    800: '#1e40af',
    900: '#1e3a8a',
    950: '#172554',
  },
  success: {
    light: '#dcfce7',
    DEFAULT: '#22c55e',
    dark: '#166534',
  },
  warning: {
    light: '#fef3c7',
    DEFAULT: '#f59e0b',
    dark: '#92400e',
  },
  error: {
    light: '#fee2e2',
    DEFAULT: '#ef4444',
    dark: '#991b1b',
  },
};

const spacing = {
  '4.5': '1.125rem',
  '18': '4.5rem',
  'header': '4rem',
  'sidebar': '16rem',
};

const fontFamily = {
  sans: ['Inter', 'system-ui', 'sans-serif'],
  heading: ['Poppins', 'sans-serif'],
  mono: ['Fira Code', 'monospace'],
};

const fontSize = {
  'xs': ['0.75rem', { lineHeight: '1rem' }],
  'sm': ['0.875rem', { lineHeight: '1.25rem' }],
  'base': ['1rem', { lineHeight: '1.5rem' }],
  'lg': ['1.125rem', { lineHeight: '1.75rem' }],
  'xl': ['1.25rem', { lineHeight: '1.75rem' }],
  '2xl': ['1.5rem', { lineHeight: '2rem' }],
  '3xl': ['1.875rem', { lineHeight: '2.25rem' }],
  '4xl': ['2.25rem', { lineHeight: '2.5rem' }],
  '5xl': ['3rem', { lineHeight: '1.16' }],
  'display': ['4rem', { lineHeight: '1.1', fontWeight: '700' }],
};

const borderRadius = {
  'sm': '0.25rem',
  'DEFAULT': '0.5rem',
  'md': '0.625rem',
  'lg': '0.75rem',
  'xl': '1rem',
  '2xl': '1.5rem',
  'button': '0.5rem',
  'card': '1rem',
  'input': '0.5rem',
};

const boxShadow = {
  'sm': '0 1px 2px rgba(0, 0, 0, 0.05)',
  'DEFAULT': '0 2px 4px rgba(0, 0, 0, 0.1)',
  'md': '0 4px 6px rgba(0, 0, 0, 0.1)',
  'lg': '0 8px 16px rgba(0, 0, 0, 0.1)',
  'xl': '0 16px 32px rgba(0, 0, 0, 0.1)',
  'card': '0 4px 20px rgba(0, 0, 0, 0.08)',
  'button': '0 2px 8px rgba(59, 130, 246, 0.3)',
};

module.exports = {
  theme: {
    extend: {
      colors,
      spacing,
      fontFamily,
      fontSize,
      borderRadius,
      boxShadow,
    },
  },
};
```

---

## 18.7 Component Library Pattern

Structure for a shared component library:

```
ğŸ“ ui-library/
â”œâ”€â”€ ğŸ“ src/
â”‚   â”œâ”€â”€ ğŸ“ components/
â”‚   â”‚   â”œâ”€â”€ Button/
â”‚   â”‚   â”‚   â”œâ”€â”€ Button.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Button.test.tsx
â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ Card/
â”‚   â”‚   â”œâ”€â”€ Input/
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ ğŸ“ styles/
â”‚   â”‚   â””â”€â”€ globals.css
â”‚   â”œâ”€â”€ ğŸ“ utils/
â”‚   â”‚   â””â”€â”€ cn.ts
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ tailwind.config.js
â”œâ”€â”€ package.json
â””â”€â”€ README.md
```

### Exporting Components

```typescript
// src/components/index.ts
export { Button } from './Button';
export { Card } from './Card';
export { Input } from './Input';
export { Badge } from './Badge';

// src/index.ts
export * from './components';
export { cn } from './utils/cn';
```

### Tailwind Preset for Sharing

```javascript
// tailwind.preset.js
module.exports = {
  theme: {
    extend: {
      colors: {
        brand: {
          // Your brand colors
        },
      },
      // Other design tokens
    },
  },
  plugins: [
    // Your custom plugins
  ],
};

// Consumer's tailwind.config.js
module.exports = {
  presets: [
    require('@your-org/ui-library/tailwind.preset'),
  ],
  // Consumer can extend further
};
```

---

## 18.8 Best Practices Summary

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    REUSABILITY BEST PRACTICES                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  DO:                                                            â”‚
â”‚  âœ… Extract repeated patterns into components                  â”‚
â”‚  âœ… Use tailwind-merge for class conflicts                     â”‚
â”‚  âœ… Create a cn() utility function                             â”‚
â”‚  âœ… Configure design tokens in tailwind.config.js              â”‚
â”‚  âœ… Use @layer for custom styles                               â”‚
â”‚  âœ… Build variant props for flexibility                        â”‚
â”‚  âœ… Allow className override in components                     â”‚
â”‚                                                                  â”‚
â”‚  DON'T:                                                         â”‚
â”‚  âŒ Overuse @apply (defeats utility-first purpose)             â”‚
â”‚  âŒ Create .btn-blue-500 classes (just use bg-blue-500)       â”‚
â”‚  âŒ Abstract too early (wait for 3+ repetitions)               â”‚
â”‚  âŒ Make components too rigid (allow customization)            â”‚
â”‚  âŒ Forget dark mode variants in components                    â”‚
â”‚                                                                  â”‚
â”‚  Rule of Three:                                                 â”‚
â”‚  â€¢ Once: Just write it                                          â”‚
â”‚  â€¢ Twice: Note the duplication                                  â”‚
â”‚  â€¢ Three times: Extract to component                            â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¡ Interview Quick Tips

1. **"When to use @apply vs components?"**
   - Components: Complex, with props/logic
   - @apply: Simple patterns, no-framework projects

2. **"What is tailwind-merge for?"**
   - Resolves Tailwind class conflicts
   - Later classes override earlier ones

3. **"What layers does Tailwind have?"**
   - base â†’ components â†’ utilities
   - Later layers have higher specificity

4. **"How to share Tailwind config?"**
   - Use presets in tailwind.config.js
   - Export from npm package

5. **"Best component pattern?"**
   - Variant props + size props
   - cn() for class merging
   - Allow className override
