# Chapter 8: Advanced Selectors - In-Depth Explanation

## Introduction to Advanced Selectors

Advanced selectors give you **precise control** over which elements to style. Mastering these is essential for writing efficient, maintainable CSS.

**Why Advanced Selectors Matter:**
- Reduce the need for extra classes
- Write more semantic HTML
- Create dynamic, context-aware styles
- Critical for interview questions!

---

## 8.1 Combinators

Combinators define **relationships** between selectors.

### Descendant Selector (Space)

Selects all descendants (children, grandchildren, etc.) of an element.

```css
/* Selects ALL <a> elements inside <nav> */
nav a {
    color: blue;
}

/* Selects ALL <p> inside <article> (any depth) */
article p {
    line-height: 1.6;
}
```

**Visual Structure:**
```html
<nav>
    <a href="#">Link 1</a>        <!-- ✓ Selected -->
    <ul>
        <li>
            <a href="#">Link 2</a> <!-- ✓ Selected (nested) -->
        </li>
    </ul>
</nav>
```

**Use Cases:**
```css
/* All links in navigation */
.navigation a {
    text-decoration: none;
}

/* All paragraphs in article */
.article p {
    margin-bottom: 1em;
}

/* All images in gallery */
.gallery img {
    border-radius: 8px;
}
```

**Important:** Selects at ANY depth, not just immediate children!

---

### Child Combinator (>)

Selects only **direct children** (one level deep).

```css
/* Selects ONLY direct <li> children of <ul> */
ul > li {
    list-style: disc;
}

/* Selects ONLY direct <p> children of <div> */
div > p {
    color: blue;
}
```

**Visual Structure:**
```html
<ul>
    <li>Item 1</li>              <!-- ✓ Selected -->
    <li>Item 2</li>              <!-- ✓ Selected -->
    <li>
        <ul>
            <li>Nested</li>       <!-- ✗ NOT selected (grandchild) -->
        </ul>
    </li>
</ul>
```

**Descendant vs Child Comparison:**
```css
/* Descendant: All <p> at any depth */
div p {
    color: blue;
}

/* Child: Only direct <p> children */
div > p {
    color: red;
}
```

```html
<div>
    <p>Direct child - RED</p>           <!-- div > p matches -->
    <section>
        <p>Grandchild - BLUE</p>        <!-- Only div p matches -->
    </section>
</div>
```

**Use Cases:**
```css
/* Style only top-level menu items */
.menu > li {
    display: inline-block;
}

/* Direct children of flex container */
.flex-container > * {
    flex: 1;
}

/* Card direct children */
.card > h2 {
    margin-top: 0;
}
```

---

### Adjacent Sibling Combinator (+)

Selects element **immediately following** another element (same parent).

```css
/* Selects <p> that comes RIGHT AFTER <h2> */
h2 + p {
    font-weight: bold;  /* First paragraph after heading */
}

/* Selects <div> immediately after another <div> */
div + div {
    margin-top: 20px;
}
```

**Visual Structure:**
```html
<article>
    <h2>Heading</h2>
    <p>First paragraph</p>     <!-- ✓ Selected (h2 + p) -->
    <p>Second paragraph</p>    <!-- ✗ NOT selected -->
    <p>Third paragraph</p>     <!-- ✗ NOT selected -->
</article>
```

**Use Cases:**
```css
/* First paragraph after heading (lead paragraph) */
h1 + p,
h2 + p {
    font-size: 1.2em;
    font-weight: 500;
}

/* Add space between stacked elements */
.button + .button {
    margin-left: 10px;
}

/* First item after another */
.alert + .content {
    margin-top: 20px;
}

/* Checkbox label styling */
input[type="checkbox"] + label {
    cursor: pointer;
}
```

**Common Pattern - Spacing:**
```css
/* Owl selector: Add space between stacked elements */
* + * {
    margin-top: 1.5em;
}

/* Better: specific context */
.stack > * + * {
    margin-top: 1em;
}
```

---

### General Sibling Combinator (~)

Selects **all siblings** that follow an element (same parent).

```css
/* Selects ALL <p> elements after <h2> (same level) */
h2 ~ p {
    color: gray;
}

/* All elements after the first */
.first ~ * {
    opacity: 0.8;
}
```

**Visual Structure:**
```html
<article>
    <h2>Heading</h2>
    <p>First paragraph</p>     <!-- ✓ Selected (h2 ~ p) -->
    <div>Some content</div>
    <p>Second paragraph</p>    <!-- ✓ Selected (h2 ~ p) -->
    <p>Third paragraph</p>     <!-- ✓ Selected (h2 ~ p) -->
</article>
```

**Adjacent (+) vs General (~):**
```css
/* Adjacent: Only immediate next sibling */
h2 + p {
    font-weight: bold;
}

/* General: All following siblings */
h2 ~ p {
    color: gray;
}
```

```html
<h2>Title</h2>
<p>Bold and gray</p>        <!-- Both match -->
<div>Something</div>
<p>Only gray</p>            <!-- Only h2 ~ p matches -->
```

**Use Cases:**
```css
/* Checked checkbox changes siblings */
input:checked ~ label {
    color: green;
}

/* Hover affects siblings */
.tab:hover ~ .indicator {
    opacity: 1;
}

/* All items after active item */
.active ~ .item {
    opacity: 0.5;
}
```

---

## 8.2 Pseudo-classes

Pseudo-classes select elements based on **state** or **position**.

### Interactive Pseudo-classes

#### :hover

Triggered when mouse pointer is over element.

```css
/* Basic hover */
a:hover {
    color: blue;
    text-decoration: underline;
}

/* Button hover */
.button:hover {
    background: darkblue;
    transform: scale(1.05);
}

/* Hover with transition */
.card {
    transition: transform 0.3s;
}
.card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0,0,0,0.2);
}
```

**Accessibility Note:**
```css
/* Don't rely on hover alone for mobile */
@media (hover: hover) {
    .button:hover {
        background: blue;
    }
}

/* Touch devices need active/focus too */
.button:hover,
.button:active,
.button:focus {
    background: blue;
}
```

---

#### :active

Triggered when element is being activated (clicked).

```css
/* Button pressed state */
.button:active {
    transform: scale(0.95);
    box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
}

/* Link being clicked */
a:active {
    color: red;
}
```

**Order matters! Remember LVHA:**
```css
/* Correct order: Link, Visited, Hover, Active */
a:link    { color: blue; }
a:visited { color: purple; }
a:hover   { color: darkblue; }
a:active  { color: red; }

/* Wrong order won't work correctly! */
```

---

#### :focus

Triggered when element has keyboard/input focus.

```css
/* Input focus */
input:focus {
    outline: 2px solid blue;
    border-color: blue;
}

/* Remove default outline (but provide alternative!) */
button:focus {
    outline: none;  /* Only if you add custom focus style! */
    box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.5);
}
```

**Accessibility Critical!**
```css
/* ❌ NEVER do this alone */
*:focus {
    outline: none;
}

/* ✅ Always provide alternative */
*:focus {
    outline: none;
    box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.5);
}
```

---

#### :focus-visible (Modern!)

Shows focus only for keyboard navigation, not mouse clicks.

```css
/* Focus ring for keyboard users only */
button:focus-visible {
    outline: 2px solid blue;
}

/* No focus ring for mouse users */
button:focus:not(:focus-visible) {
    outline: none;
}
```

**Best Practice Pattern:**
```css
/* Default: no outline */
button {
    outline: none;
}

/* Keyboard navigation: show outline */
button:focus-visible {
    outline: 2px solid blue;
    outline-offset: 2px;
}
```

---

### Structural Pseudo-classes

#### :first-child / :last-child

```css
/* First child of parent */
li:first-child {
    margin-top: 0;
}

/* Last child of parent */
li:last-child {
    margin-bottom: 0;
}

/* Both */
p:first-child {
    font-weight: bold;
}
p:last-child {
    color: gray;
}
```

**Important:** Must be first/last child of parent!

```html
<div>
    <p>First</p>     <!-- ✓ p:first-child matches -->
    <p>Middle</p>
    <p>Last</p>      <!-- ✓ p:last-child matches -->
</div>

<div>
    <h1>Title</h1>
    <p>First p</p>   <!-- ✗ p:first-child DOESN'T match (not first child) -->
</div>
```

---

#### :first-of-type / :last-of-type

First/last element **of its type** within parent.

```css
/* First <p> in parent (regardless of other elements) */
p:first-of-type {
    font-size: 1.2em;
}

/* Last <img> in parent */
img:last-of-type {
    margin-bottom: 0;
}
```

**Difference from :first-child:**
```html
<article>
    <h1>Title</h1>
    <p>First p</p>     <!-- ✓ p:first-of-type matches! -->
    <p>Second p</p>
</article>
```

```css
p:first-child {
    /* Doesn't match - <p> is not first child */
}

p:first-of-type {
    /* ✓ Matches - first <p> element */
}
```

---

#### :nth-child()

Select elements based on position. **Very powerful!**

```css
/* Specific position */
li:nth-child(3) {
    /* 3rd child */
}

/* Odd/even */
tr:nth-child(odd) {
    background: #f0f0f0;  /* Zebra striping */
}
tr:nth-child(even) {
    background: white;
}

/* Formula: an + b */
li:nth-child(2n) {
    /* Every 2nd: 2, 4, 6, 8... (same as even) */
}

li:nth-child(2n + 1) {
    /* Every 2nd starting from 1: 1, 3, 5, 7... (same as odd) */
}

li:nth-child(3n) {
    /* Every 3rd: 3, 6, 9, 12... */
}

li:nth-child(3n + 1) {
    /* Every 3rd starting from 1: 1, 4, 7, 10... */
}

li:nth-child(3n + 2) {
    /* Every 3rd starting from 2: 2, 5, 8, 11... */
}

/* Negative offsets */
li:nth-child(n + 4) {
    /* 4th and after: 4, 5, 6, 7... */
}

li:nth-child(-n + 3) {
    /* First 3: 1, 2, 3 */
}
```

**Formula Breakdown: an + b**
- `a`: Step (every nth item)
- `n`: Counter (0, 1, 2, 3, ...)
- `b`: Offset

**Examples:**
```
2n:      n=0: 0, n=1: 2, n=2: 4, n=3: 6... → 2, 4, 6, 8...
2n+1:    n=0: 1, n=1: 3, n=2: 5, n=3: 7... → 1, 3, 5, 7...
3n+1:    n=0: 1, n=1: 4, n=2: 7, n=3: 10.. → 1, 4, 7, 10...
n+4:     n=0: 4, n=1: 5, n=2: 6, n=3: 7... → 4, 5, 6, 7...
-n+3:    n=0: 3, n=1: 2, n=2: 1, n=3: 0... → 3, 2, 1 (first 3)
```

**Practical Examples:**
```css
/* First 3 items */
li:nth-child(-n + 3) {
    font-weight: bold;
}

/* Every 3rd item */
.grid-item:nth-child(3n) {
    margin-right: 0;
}

/* All but first 2 */
li:nth-child(n + 3) {
    opacity: 0.7;
}

/* Zebra striping */
tr:nth-child(odd) {
    background: #f9f9f9;
}
```

---

#### :nth-of-type()

Like :nth-child() but counts only elements of the **same type**.

```css
/* Every 2nd <p> element */
p:nth-of-type(2n) {
    color: blue;
}

/* First 3 <div> elements */
div:nth-of-type(-n + 3) {
    border: 1px solid red;
}
```

**Difference:**
```html
<article>
    <h2>Title</h2>       <!-- Child 1 -->
    <p>Para 1</p>        <!-- Child 2, p 1 -->
    <p>Para 2</p>        <!-- Child 3, p 2 -->
</article>
```

```css
p:nth-child(2) {
    /* Matches Para 1 (2nd child overall) */
}

p:nth-of-type(2) {
    /* Matches Para 2 (2nd p element) */
}
```

---

#### :only-child / :only-of-type

```css
/* Element is only child of parent */
li:only-child {
    list-style: none;
}

/* Element is only one of its type in parent */
p:only-of-type {
    text-align: center;
}
```

---

### Negation and Logical Pseudo-classes

#### :not()

Selects elements that DON'T match selector. **Very useful!**

```css
/* All <li> except first */
li:not(:first-child) {
    margin-top: 10px;
}

/* All <p> except class .intro */
p:not(.intro) {
    font-size: 14px;
}

/* All inputs except disabled */
input:not(:disabled) {
    cursor: pointer;
}

/* Multiple conditions (modern syntax) */
button:not(.primary):not(.secondary) {
    background: gray;
}

/* Complex selector */
a:not([href^="http"]) {
    /* Internal links only */
}
```

**Common Patterns:**
```css
/* All except last */
.item:not(:last-child) {
    margin-right: 10px;
}

/* All except active */
.tab:not(.active) {
    opacity: 0.6;
}

/* Spacing except first */
* + *:not(:first-child) {
    margin-top: 1em;
}
```

---

#### :is()

Matches if element matches ANY selector in list. Reduces repetition!

```css
/* Old way (repetitive) */
h1 a,
h2 a,
h3 a {
    color: blue;
}

/* New way (cleaner) */
:is(h1, h2, h3) a {
    color: blue;
}

/* More examples */
:is(.header, .footer) p {
    font-size: 14px;
}

/* Combines well with other selectors */
article :is(h1, h2, h3) {
    margin-bottom: 1em;
}
```

**Specificity:** Takes specificity of most specific selector in list!

```css
:is(#id, .class) {
    /* Specificity: 0,1,0,0 (from #id) */
}
```

---

#### :where()

Like :is() but with **zero specificity**!

```css
/* Same matching as :is() */
:where(h1, h2, h3) {
    margin-bottom: 1em;
}

/* But specificity is 0,0,0,0 */
/* Easy to override! */
```

**:is() vs :where():**
```css
/* :is() has specificity */
:is(#id, .class) a {
    color: blue;  /* Specificity: 0,1,0,1 */
}

/* :where() has no specificity */
:where(#id, .class) a {
    color: blue;  /* Specificity: 0,0,0,1 (only from 'a') */
}

/* Easy to override */
a {
    color: red;  /* Wins over :where() */
}
```

**Use Case:**
```css
/* Utility classes that are easy to override */
:where(.mt-1) { margin-top: 0.25rem; }
:where(.mt-2) { margin-top: 0.5rem; }

/* Can be overridden by simple selector */
.custom { margin-top: 1rem; }  /* Wins! */
```

---

#### :has() (Parent Selector!)

Selects elements that CONTAIN certain descendants. **Game changer!**

```css
/* Article that HAS an image */
article:has(img) {
    display: grid;
    grid-template-columns: 1fr 2fr;
}

/* Article without image */
article:not(:has(img)) {
    max-width: 70ch;
}

/* Card with button */
.card:has(.button) {
    padding-bottom: 20px;
}

/* Form with error */
form:has(.error) {
    border: 2px solid red;
}

/* List item with checked checkbox */
li:has(input:checked) {
    background: lightblue;
}
```

**Relationship Selectors:**
```css
/* Parent has child */
div:has(> p) {
    /* Divs with direct <p> children */
}

/* Following sibling has element */
h2:has(+ img) {
    /* h2 followed by img */
}

/* Contains specific descendant */
article:has(.featured) {
    /* Articles containing .featured */
}
```

**Practical Examples:**
```css
/* Different layouts based on content */
.card:has(img) {
    display: grid;
    grid-template-columns: 200px 1fr;
}

.card:not(:has(img)) {
    display: block;
}

/* Style parent based on child state */
.form-group:has(input:focus) {
    border-color: blue;
}

.form-group:has(input:invalid) {
    border-color: red;
}

/* Navigation with active link */
.nav:has(.active) {
    background: lightblue;
}
```

---

### Other Useful Pseudo-classes

```css
/* Empty elements */
p:empty {
    display: none;
}

/* Elements with specific attributes */
input:required {
    border-left: 3px solid red;
}

input:optional {
    border-left: 3px solid gray;
}

/* Validation states */
input:valid {
    border-color: green;
}

input:invalid {
    border-color: red;
}

/* Disabled/enabled */
button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

/* Checked state */
input:checked + label {
    font-weight: bold;
}

/* Target (from URL hash) */
:target {
    background: yellow;
}
```

---

## 8.3 Pseudo-elements

Pseudo-elements create "virtual" elements for styling. Use **::** (double colon).

### ::before and ::after

Insert content before/after element. **Require `content` property!**

```css
/* Basic usage */
.label::before {
    content: "★ ";
    color: gold;
}

.external-link::after {
    content: " ↗";
    font-size: 0.8em;
}

/* Empty content for decorative elements */
.box::before {
    content: "";
    display: block;
    width: 50px;
    height: 50px;
    background: blue;
}
```

**Content Property Values:**
```css
/* Text */
.item::before {
    content: "Note: ";
}

/* Attribute value */
a[href]::after {
    content: " (" attr(href) ")";
}

/* Unicode */
.quote::before {
    content: "\201C";  /* Opening quote " */
}

/* Empty (for styling only) */
.box::after {
    content: "";
}

/* Counter */
.item::before {
    content: counter(item) ". ";
}
```

**Practical Examples:**
```css
/* Clearfix */
.clearfix::after {
    content: "";
    display: table;
    clear: both;
}

/* Decorative elements */
.heading::before {
    content: "";
    display: inline-block;
    width: 50px;
    height: 3px;
    background: blue;
    margin-right: 10px;
}

/* Icon before text */
.warning::before {
    content: "⚠️ ";
}

/* Overlay */
.image-container::after {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
}

/* Tooltip */
.tooltip::after {
    content: attr(data-tooltip);
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    background: black;
    color: white;
    padding: 5px 10px;
    border-radius: 4px;
    white-space: nowrap;
}
```

---

### ::first-letter

Styles first letter of element (drop caps).

```css
p::first-letter {
    font-size: 3em;
    font-weight: bold;
    float: left;
    line-height: 1;
    margin-right: 0.1em;
}

/* Drop cap */
.article p:first-of-type::first-letter {
    font-size: 4em;
    color: #667eea;
    float: left;
    line-height: 0.8;
    margin: 0.1em 0.1em 0 0;
}
```

**Limited Properties:**
- Font properties
- Color properties
- Background properties
- Text decoration
- Float, margin, padding
- Border

---

### ::first-line

Styles first line of element.

```css
p::first-line {
    font-weight: bold;
    color: blue;
    text-transform: uppercase;
}

.article p:first-of-type::first-line {
    font-variant: small-caps;
    letter-spacing: 0.05em;
}
```

**Limited Properties:**
- Font properties
- Color properties
- Background properties
- Text decoration

---

### ::selection

Styles highlighted/selected text.

```css
::selection {
    background: #667eea;
    color: white;
}

/* Firefox needs prefix */
::-moz-selection {
    background: #667eea;
    color: white;
}

/* Specific element */
p::selection {
    background: yellow;
    color: black;
}
```

**Allowed Properties:**
- `color`
- `background-color`
- `text-shadow`
- `text-decoration`

---

### ::placeholder

Styles placeholder text in inputs.

```css
input::placeholder {
    color: #999;
    font-style: italic;
    opacity: 1;  /* Firefox default is 0.54 */
}

/* Vendor prefixes */
input::-webkit-input-placeholder {
    color: #999;
}
input::-moz-placeholder {
    color: #999;
}
input:-ms-input-placeholder {
    color: #999;
}
```

---

### ::marker

Styles list item markers (bullets, numbers).

```css
li::marker {
    color: blue;
    font-weight: bold;
    font-size: 1.5em;
}

/* Custom markers */
li::marker {
    content: "→ ";
    color: green;
}

/* Emoji markers */
ul li::marker {
    content: "✓ ";
    color: green;
}
```

---

### Single vs Double Colon

**Old syntax:** `:before`, `:after`, `:first-letter`, `:first-line`  
**New syntax:** `::before`, `::after`, `::first-letter`, `::first-line`

```css
/* ✅ Preferred (CSS3) */
p::before { content: "→ "; }
p::after { content: " ←"; }

/* ✓ Still works (CSS2) */
p:before { content: "→ "; }
p:after { content: " ←"; }
```

**Best Practice:** Use `::` (double colon) for pseudo-elements to distinguish from pseudo-classes.

**Pseudo-classes:** `:hover`, `:active`, `:focus`, `:nth-child()`, etc.  
**Pseudo-elements:** `::before`, `::after`, `::first-letter`, etc.

---

## 8.4 Specificity Deep Dive

**Specificity** determines which CSS rule wins when multiple rules target the same element.

### Specificity Calculation (a, b, c, d)

```
a: Inline styles            = 1,0,0,0
b: IDs                      = 0,1,0,0
c: Classes, attributes,     = 0,0,1,0
   pseudo-classes
d: Elements, pseudo-        = 0,0,0,1
   elements
```

**Examples:**
```css
/* 0,0,0,1 - one element */
p { }

/* 0,0,1,0 - one class */
.text { }

/* 0,1,0,0 - one ID */
#unique { }

/* 0,0,1,1 - one class + one element */
p.text { }

/* 0,1,1,0 - one ID + one class */
#unique.text { }

/* 0,0,2,1 - two classes + one element */
p.text.highlight { }

/* 0,1,2,3 - one ID + two classes + three elements */
div#header .nav ul li.active { }

/* 0,0,3,2 - three classes + two elements */
ul.menu li.item a.link { }
```

### Specificity Examples

```css
/* Which rule wins? */

/* 0,0,0,1 */
p {
    color: black;
}

/* 0,0,1,0 - WINS */
.text {
    color: blue;
}

/* 0,1,0,0 - WINS */
#para {
    color: red;
}

/* 1,0,0,0 - WINS (inline style) */
<p style="color: green;">
```

### !important (Use Sparingly!)

Overrides specificity (but creates maintenance problems).

```css
p {
    color: blue !important;  /* Beats everything except... */
}

#unique {
    color: red;  /* Doesn't win - !important beats ID */
}

.override {
    color: green !important;  /* Ties with other !important, specificity matters */
}
```

**When to use !important:**
- Utility classes (that must always apply)
- Overriding third-party CSS
- Quick fixes (but refactor later!)

**When NOT to use:**
- Regular component styling
- When proper specificity management works
- In most situations!

---

## Interview Key Points

**Most Common Questions:**

**1. "Explain the four combinators"**
- Space (descendant): All descendants at any depth
- `>` (child): Direct children only
- `+` (adjacent sibling): Immediately following sibling
- `~` (general sibling): All following siblings

**2. "What's the difference between :nth-child() and :nth-of-type()?"**
- :nth-child(): Position among all children
- :nth-of-type(): Position among same-type siblings

**3. "How do you select every 3rd item starting from the 2nd?"**
```css
:nth-child(3n + 2) { }
/* Results: 2, 5, 8, 11, 14... */
```

**4. "What's :has() and why is it powerful?"**
- Parent selector - selects element containing specific descendants
- Enables conditional styling based on content
- Example: `article:has(img)` selects articles containing images

**5. "Difference between :is() and :where()?"**
- :is(): Takes specificity of most specific selector
- :where(): Always has zero specificity
- Both reduce repetition

**6. "Calculate specificity of: `div#header .nav ul li.active`"**
```
IDs: 1 (#header)
Classes: 2 (.nav, .active)
Elements: 3 (div, ul, li)
= 0,1,2,3
```

**7. "Single vs double colon?"**
- Single (`:`) = pseudo-classes (states: :hover, :focus)
- Double (`::`) = pseudo-elements (virtual elements: ::before, ::after)

---

## Best Practices

```css
/* 1. Use child combinator for direct styling */
.menu > li { }  /* ✅ Clear intent */

/* 2. Use :not() to reduce code */
.item:not(:last-child) { margin-right: 10px; }  /* ✅ Cleaner */

/* 3. Use :has() for conditional layouts */
.card:has(img) { display: grid; }  /* ✅ Powerful */

/* 4. Keep specificity low */
.button { }  /* ✅ Low specificity */
div.container .button { }  /* ❌ Too specific */

/* 5. Use ::before/::after for decoration */
.icon::before { content: "→"; }  /* ✅ Semantic */

/* 6. Remember LVHA order for links */
a:link { }
a:visited { }
a:hover { }
a:active { }
```