# Chapter 15: Next.js Configuration - Deep Dive

## 15.1 next.config.js Deep Dive

### Basic Configuration Structure

```javascript
// next.config.js
/** @type {import('next').NextConfig} */
const nextConfig = {
  // Core settings
  reactStrictMode: true,
  swcMinify: true,
  
  // Production settings
  poweredByHeader: false,
  generateEtags: true,
  compress: true,
  
  // Image configuration
  images: {
    domains: ['example.com'],
    deviceSizes: [640, 750, 828, 1080, 1200, 1920, 2048, 3840],
    imageSizes: [16, 32, 48, 64, 96, 128, 256, 384],
  },
}

module.exports = nextConfig
```

### Environment-Specific Configuration

```javascript
// next.config.js
const { PHASE_DEVELOPMENT_SERVER, PHASE_PRODUCTION_BUILD } = require('next/constants');

module.exports = (phase, { defaultConfig }) => {
  // Development-only config
  if (phase === PHASE_DEVELOPMENT_SERVER) {
    return {
      reactStrictMode: true,
      env: {
        API_URL: 'http://localhost:4000',
      },
    };
  }

  // Production-only config
  if (phase === PHASE_PRODUCTION_BUILD) {
    return {
      reactStrictMode: true,
      env: {
        API_URL: 'https://api.example.com',
      },
      compress: true,
      productionBrowserSourceMaps: false,
    };
  }

  return defaultConfig;
};
```

### Webpack Customization

```javascript
// next.config.js
const nextConfig = {
  webpack: (config, { buildId, dev, isServer, defaultLoaders, webpack }) => {
    // Add custom webpack plugins
    config.plugins.push(
      new webpack.DefinePlugin({
        'process.env.BUILD_ID': JSON.stringify(buildId),
      })
    );

    // Modify resolve aliases
    config.resolve.alias = {
      ...config.resolve.alias,
      '@components': path.resolve(__dirname, 'components'),
      '@utils': path.resolve(__dirname, 'utils'),
    };

    // Add custom loaders
    config.module.rules.push({
      test: /\.svg$/,
      use: ['@svgr/webpack'],
    });

    // Ignore certain files
    config.externals = [...config.externals, { canvas: 'canvas' }];

    // Important: Return the modified config
    return config;
  },
}

module.exports = nextConfig;
```

### Advanced Webpack Example: Bundle Analyzer

```javascript
// next.config.js
const withBundleAnalyzer = require('@next/bundle-analyzer')({
  enabled: process.env.ANALYZE === 'true',
});

const nextConfig = {
  webpack: (config, { isServer }) => {
    // Custom webpack configuration
    if (!isServer) {
      config.optimization = {
        ...config.optimization,
        splitChunks: {
          chunks: 'all',
          cacheGroups: {
            default: false,
            vendors: false,
            // Vendor chunk
            vendor: {
              name: 'vendor',
              chunks: 'all',
              test: /node_modules/,
              priority: 20,
            },
            // Common chunk
            common: {
              name: 'common',
              minChunks: 2,
              chunks: 'all',
              priority: 10,
              reuseExistingChunk: true,
              enforce: true,
            },
          },
        },
      };
    }
    return config;
  },
};

module.exports = withBundleAnalyzer(nextConfig);
```

### Redirects and Rewrites

```javascript
// next.config.js
const nextConfig = {
  async redirects() {
    return [
      // Basic redirect
      {
        source: '/old-blog/:slug',
        destination: '/blog/:slug',
        permanent: true, // 301
      },
      
      // Redirect with regex
      {
        source: '/blog/:year(\\d{4})/:month(\\d{2})/:slug',
        destination: '/blog/:slug',
        permanent: true,
      },
      
      // Conditional redirect
      {
        source: '/admin',
        destination: '/login',
        permanent: false,
        has: [
          {
            type: 'cookie',
            key: 'authorized',
            value: 'false',
          },
        ],
      },
      
      // Wildcard redirect
      {
        source: '/old-site/:path*',
        destination: '/new-site/:path*',
        permanent: true,
      },
    ];
  },

  async rewrites() {
    return {
      beforeFiles: [
        // These run before pages/public files
        {
          source: '/api/v1/:path*',
          destination: 'https://api.example.com/:path*',
        },
      ],
      afterFiles: [
        // These run after pages/public but before dynamic routes
        {
          source: '/blog/:slug',
          destination: '/news/:slug',
        },
      ],
      fallback: [
        // These run after everything else
        {
          source: '/:path*',
          destination: 'https://legacy-site.com/:path*',
        },
      ],
    };
  },
};

module.exports = nextConfig;
```

### Headers Configuration

```javascript
// next.config.js
const nextConfig = {
  async headers() {
    return [
      {
        source: '/:path*',
        headers: [
          // Security headers
          {
            key: 'X-DNS-Prefetch-Control',
            value: 'on',
          },
          {
            key: 'Strict-Transport-Security',
            value: 'max-age=63072000; includeSubDomains; preload',
          },
          {
            key: 'X-Frame-Options',
            value: 'SAMEORIGIN',
          },
          {
            key: 'X-Content-Type-Options',
            value: 'nosniff',
          },
          {
            key: 'X-XSS-Protection',
            value: '1; mode=block',
          },
          {
            key: 'Referrer-Policy',
            value: 'origin-when-cross-origin',
          },
          {
            key: 'Permissions-Policy',
            value: 'camera=(), microphone=(), geolocation=()',
          },
        ],
      },
      
      // CORS headers for API routes
      {
        source: '/api/:path*',
        headers: [
          {
            key: 'Access-Control-Allow-Origin',
            value: 'https://example.com',
          },
          {
            key: 'Access-Control-Allow-Methods',
            value: 'GET, POST, PUT, DELETE, OPTIONS',
          },
          {
            key: 'Access-Control-Allow-Headers',
            value: 'Content-Type, Authorization',
          },
        ],
      },
      
      // Cache control for static assets
      {
        source: '/static/:path*',
        headers: [
          {
            key: 'Cache-Control',
            value: 'public, max-age=31536000, immutable',
          },
        ],
      },
    ];
  },
};

module.exports = nextConfig;
```

### Image Optimization Configuration

```javascript
// next.config.js
const nextConfig = {
  images: {
    // External image sources
    remotePatterns: [
      {
        protocol: 'https',
        hostname: 'cdn.example.com',
        port: '',
        pathname: '/images/**',
      },
      {
        protocol: 'https',
        hostname: 'images.unsplash.com',
      },
    ],
    
    // Legacy domains (deprecated, use remotePatterns)
    domains: ['example.com', 'cdn.example.com'],
    
    // Device sizes for responsive images
    deviceSizes: [640, 750, 828, 1080, 1200, 1920, 2048, 3840],
    
    // Image sizes for different breakpoints
    imageSizes: [16, 32, 48, 64, 96, 128, 256, 384],
    
    // Output format
    formats: ['image/webp', 'image/avif'],
    
    // Minimize layout shift
    minimumCacheTTL: 60,
    
    // Disable static imports optimization
    disableStaticImages: false,
    
    // Custom loader
    loader: 'custom',
    loaderFile: './my-image-loader.js',
  },
};

module.exports = nextConfig;
```

```javascript
// my-image-loader.js (Custom Image Loader)
export default function myImageLoader({ src, width, quality }) {
  return `https://my-cdn.com/${src}?w=${width}&q=${quality || 75}`;
}
```

### Internationalization (i18n) Configuration

```javascript
// next.config.js
const nextConfig = {
  i18n: {
    locales: ['en', 'es', 'fr', 'de', 'ja'],
    defaultLocale: 'en',
    
    // Domain-based routing
    domains: [
      {
        domain: 'example.com',
        defaultLocale: 'en',
      },
      {
        domain: 'example.es',
        defaultLocale: 'es',
      },
      {
        domain: 'example.fr',
        defaultLocale: 'fr',
      },
    ],
    
    // Locale detection
    localeDetection: true,
  },
};

module.exports = nextConfig;
```

### Output Configuration

```javascript
// next.config.js
const nextConfig = {
  // Standalone output for Docker/self-hosting
  output: 'standalone',
  
  // Or static export
  // output: 'export',
  
  // Disable trailing slashes
  trailingSlash: false,
  
  // Custom page extensions
  pageExtensions: ['js', 'jsx', 'ts', 'tsx', 'md', 'mdx'],
  
  // Base path (for subpath deployment)
  basePath: '/docs',
  
  // Asset prefix (CDN)
  assetPrefix: 'https://cdn.example.com',
};

module.exports = nextConfig;
```

### Experimental Features

```javascript
// next.config.js
const nextConfig = {
  experimental: {
    // App Router (stable in Next.js 13.4+)
    appDir: true,
    
    // Server Actions
    serverActions: true,
    
    // Partial Prerendering
    ppr: true,
    
    // Turbopack (Rust-based bundler)
    turbo: {
      rules: {
        '*.svg': {
          loaders: ['@svgr/webpack'],
          as: '*.js',
        },
      },
    },
    
    // Instrumentation hook
    instrumentationHook: true,
    
    // Middleware request optimizations
    optimizeCss: true,
    
    // React 18 features
    scrollRestoration: true,
  },
};

module.exports = nextConfig;
```

### Performance Optimizations

```javascript
// next.config.js
const nextConfig = {
  // Compiler options
  compiler: {
    // Remove console logs in production
    removeConsole: {
      exclude: ['error', 'warn'],
    },
    
    // React optimization
    reactRemoveProperties: true,
    
    // Styled-components support
    styledComponents: true,
    
    // Emotion support
    emotion: true,
  },
  
  // SWC minification (faster than Terser)
  swcMinify: true,
  
  // Production optimizations
  productionBrowserSourceMaps: false,
  
  // Optimize packages
  transpilePackages: ['@acme/ui', '@acme/utils'],
  
  // Disable powered by header
  poweredByHeader: false,
  
  // Generate ETags
  generateEtags: true,
  
  // Compression
  compress: true,
};

module.exports = nextConfig;
```

### Multiple Configuration Plugins

```javascript
// next.config.js
const withPlugins = require('next-compose-plugins');
const withBundleAnalyzer = require('@next/bundle-analyzer')({
  enabled: process.env.ANALYZE === 'true',
});
const withMDX = require('@next/mdx')({
  extension: /\.mdx?$/,
});

const nextConfig = {
  reactStrictMode: true,
  pageExtensions: ['js', 'jsx', 'ts', 'tsx', 'md', 'mdx'],
};

module.exports = withPlugins(
  [
    [withBundleAnalyzer],
    [withMDX],
  ],
  nextConfig
);
```

---

## 15.2 Custom Server

### Why Use a Custom Server?

**Use Cases:**
- Custom routing logic
- WebSocket server
- Integration with existing backend
- Custom authentication flow

**Tradeoffs:**
- ⚠️ Disables Automatic Static Optimization
- ⚠️ Cannot deploy to Vercel serverless
- ⚠️ Increases complexity

### Express Integration

```javascript
// server.js
const express = require('express');
const next = require('next');

const dev = process.env.NODE_ENV !== 'production';
const hostname = 'localhost';
const port = 3000;

const app = next({ dev, hostname, port });
const handle = app.getRequestHandler();

app.prepare().then(() => {
  const server = express();

  // Custom API routes
  server.get('/api/custom', (req, res) => {
    res.json({ message: 'Custom API route' });
  });

  // Custom route with pattern matching
  server.get('/post/:id', (req, res) => {
    const actualPage = '/post';
    const queryParams = { id: req.params.id };
    app.render(req, res, actualPage, queryParams);
  });

  // Proxy to another service
  server.get('/external/:path*', (req, res) => {
    const url = `https://external-api.com${req.path}`;
    // Implement proxy logic here
  });

  // Handle all other routes with Next.js
  server.all('*', (req, res) => {
    return handle(req, res);
  });

  server.listen(port, (err) => {
    if (err) throw err;
    console.log(`> Ready on http://${hostname}:${port}`);
  });
});
```

```json
// package.json
{
  "scripts": {
    "dev": "node server.js",
    "build": "next build",
    "start": "NODE_ENV=production node server.js"
  }
}
```

### WebSocket Server Integration

```javascript
// server.js with WebSocket
const express = require('express');
const next = require('next');
const { createServer } = require('http');
const { WebSocketServer } = require('ws');

const dev = process.env.NODE_ENV !== 'production';
const app = next({ dev });
const handle = app.getRequestHandler();

app.prepare().then(() => {
  const server = express();
  const httpServer = createServer(server);
  
  // WebSocket server
  const wss = new WebSocketServer({ server: httpServer });

  wss.on('connection', (ws) => {
    console.log('Client connected');

    ws.on('message', (message) => {
      console.log('Received:', message);
      
      // Broadcast to all clients
      wss.clients.forEach((client) => {
        if (client.readyState === WebSocket.OPEN) {
          client.send(message);
        }
      });
    });

    ws.on('close', () => {
      console.log('Client disconnected');
    });
  });

  // Express routes
  server.all('*', (req, res) => {
    return handle(req, res);
  });

  const PORT = process.env.PORT || 3000;
  httpServer.listen(PORT, (err) => {
    if (err) throw err;
    console.log(`> Ready on http://localhost:${PORT}`);
  });
});
```

### Advanced Custom Server with Authentication

```javascript
// server.js
const express = require('express');
const next = require('next');
const session = require('express-session');
const passport = require('passport');

const dev = process.env.NODE_ENV !== 'production';
const app = next({ dev });
const handle = app.getRequestHandler();

app.prepare().then(() => {
  const server = express();

  // Session middleware
  server.use(session({
    secret: process.env.SESSION_SECRET,
    resave: false,
    saveUninitialized: false,
    cookie: {
      secure: !dev,
      maxAge: 30 * 24 * 60 * 60 * 1000, // 30 days
    },
  }));

  // Passport initialization
  server.use(passport.initialize());
  server.use(passport.session());

  // Protected route middleware
  const requireAuth = (req, res, next) => {
    if (req.isAuthenticated()) {
      return next();
    }
    res.redirect('/login');
  };

  // Custom authentication routes
  server.post('/api/auth/login', passport.authenticate('local'), (req, res) => {
    res.json({ user: req.user });
  });

  server.post('/api/auth/logout', (req, res) => {
    req.logout();
    res.json({ success: true });
  });

  // Protected page
  server.get('/dashboard', requireAuth, (req, res) => {
    return app.render(req, res, '/dashboard', req.query);
  });

  // Handle all other routes
  server.all('*', (req, res) => {
    return handle(req, res);
  });

  server.listen(3000);
});
```

---

## 15.3 Environment Variables

### Environment Variable Files

```bash
# .env.local (highest priority, local overrides, gitignored)
DATABASE_URL=postgresql://localhost:5432/mydb
API_KEY=secret-key-for-local-dev

# .env.development (development environment)
NEXT_PUBLIC_API_URL=http://localhost:3000
NEXT_PUBLIC_ANALYTICS_ID=dev-analytics-id

# .env.production (production environment)
NEXT_PUBLIC_API_URL=https://api.example.com
NEXT_PUBLIC_ANALYTICS_ID=prod-analytics-id

# .env (all environments)
APP_NAME=My Next.js App
```

### Load Order (Highest to Lowest Priority)

1. `.env.$(NODE_ENV).local` (e.g., `.env.production.local`)
2. `.env.local` (⚠️ Not loaded in test environment)
3. `.env.$(NODE_ENV)` (e.g., `.env.production`)
4. `.env`

### Server-Only vs Client-Side Variables

```javascript
// Server-only (secure)
// Access these only in:
// - Server Components
// - API Routes
// - getServerSideProps
// - getStaticProps

DATABASE_URL=postgresql://...
API_SECRET_KEY=secret123

// Client-side (exposed to browser)
// Must prefix with NEXT_PUBLIC_
NEXT_PUBLIC_API_URL=https://api.example.com
NEXT_PUBLIC_GOOGLE_MAPS_KEY=AIza...
```

### Using Environment Variables

```typescript
// Server Component (app/page.tsx)
export default async function Page() {
  // ✅ Can access both types
  const dbUrl = process.env.DATABASE_URL;
  const apiUrl = process.env.NEXT_PUBLIC_API_URL;
  
  const data = await fetch(`${apiUrl}/data`, {
    headers: {
      'X-API-Key': process.env.API_SECRET_KEY!, // Server-only!
    },
  });
  
  return <div>{/* ... */}</div>;
}
```

```typescript
// Client Component
'use client';

export default function ClientComponent() {
  // ✅ Can only access NEXT_PUBLIC_ variables
  const apiUrl = process.env.NEXT_PUBLIC_API_URL;
  
  // ❌ This will be undefined!
  const dbUrl = process.env.DATABASE_URL;
  
  return <div>{apiUrl}</div>;
}
```

```typescript
// API Route (app/api/users/route.ts)
export async function GET() {
  // ✅ Can access both types
  const dbUrl = process.env.DATABASE_URL;
  const apiKey = process.env.API_SECRET_KEY;
  
  return Response.json({ success: true });
}
```

### Runtime vs Build-Time Variables

```javascript
// next.config.js
module.exports = {
  env: {
    // Build-time only - embedded into JavaScript bundle
    CUSTOM_KEY: 'my-value',
    BUILD_TIME: new Date().toISOString(),
  },
  
  // Runtime configuration (recommended for deployment)
  serverRuntimeConfig: {
    // Server-side only
    mySecret: process.env.SECRET_KEY,
  },
  publicRuntimeConfig: {
    // Available on both server and client
    apiUrl: process.env.NEXT_PUBLIC_API_URL,
  },
}
```

```typescript
// Using runtime config
import getConfig from 'next/config';

const { serverRuntimeConfig, publicRuntimeConfig } = getConfig();

// Server-side
const secret = serverRuntimeConfig.mySecret;

// Both sides
const apiUrl = publicRuntimeConfig.apiUrl;
```

### Type-Safe Environment Variables

```typescript
// env.ts (Type definitions)
declare global {
  namespace NodeJS {
    interface ProcessEnv {
      // Server-only
      DATABASE_URL: string;
      API_SECRET_KEY: string;
      SMTP_HOST: string;
      SMTP_PORT: string;
      
      // Client-accessible
      NEXT_PUBLIC_API_URL: string;
      NEXT_PUBLIC_GOOGLE_MAPS_KEY: string;
      NEXT_PUBLIC_STRIPE_PUBLIC_KEY: string;
      
      // Optional
      REDIS_URL?: string;
    }
  }
}

export {};
```

```typescript
// lib/env.ts (Validation with Zod)
import { z } from 'zod';

const envSchema = z.object({
  // Server
  DATABASE_URL: z.string().url(),
  API_SECRET_KEY: z.string().min(1),
  NODE_ENV: z.enum(['development', 'production', 'test']),
  
  // Client
  NEXT_PUBLIC_API_URL: z.string().url(),
  NEXT_PUBLIC_ANALYTICS_ID: z.string().optional(),
});

export const env = envSchema.parse(process.env);

// Usage with type safety
import { env } from '@/lib/env';

const dbUrl = env.DATABASE_URL; // Type-safe!
```

### Security Best Practices

```typescript
// ❌ NEVER DO THIS - Exposes secrets to client
'use client';

export function BadComponent() {
  // This is undefined in client components, but don't rely on that!
  const apiKey = process.env.API_SECRET_KEY;
  
  return <div>{apiKey}</div>;
}

// ✅ CORRECT - Keep secrets on server
// Server Component
export async function GoodComponent() {
  const data = await fetchDataWithApiKey();
  return <ClientComponent data={data} />;
}

async function fetchDataWithApiKey() {
  return fetch('https://api.example.com/data', {
    headers: {
      'Authorization': `Bearer ${process.env.API_SECRET_KEY}`,
    },
  });
}
```

### .gitignore Configuration

```bash
# .gitignore
.env*.local
.env.production
```

### Example .env.example (Template for team)

```bash
# .env.example
# Copy this to .env.local and fill in values

# Database
DATABASE_URL=postgresql://user:password@localhost:5432/dbname

# APIs
API_SECRET_KEY=your-secret-key-here

# Public (client-side)
NEXT_PUBLIC_API_URL=http://localhost:3000
NEXT_PUBLIC_STRIPE_PUBLIC_KEY=pk_test_...
```

---

## 15.4 TypeScript Configuration

### Strict TypeScript Setup

```json
// tsconfig.json
{
  "compilerOptions": {
    // Type Checking
    "strict": true,
    "noUncheckedIndexedAccess": true,
    "noImplicitOverride": true,
    
    // Module Resolution
    "module": "ESNext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    
    // Emit
    "target": "ES2017",
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "jsx": "preserve",
    "incremental": true,
    "noEmit": true,
    
    // Interop
    "esModuleInterop": true,
    "allowSyntheticDefaultImports": true,
    "isolatedModules": true,
    
    // Quality
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    
    // Path Mapping
    "baseUrl": ".",
    "paths": {
      "@/*": ["./src/*"],
      "@/components/*": ["./src/components/*"],
      "@/lib/*": ["./src/lib/*"],
      "@/styles/*": ["./src/styles/*"]
    },
    
    // Next.js specific
    "plugins": [
      {
        "name": "next"
      }
    ]
  },
  "include": [
    "next-env.d.ts",
    "**/*.ts",
    "**/*.tsx",
    ".next/types/**/*.ts"
  ],
  "exclude": [
    "node_modules"
  ]
}
```

### Path Aliases

```json
// tsconfig.json
{
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "@/*": ["./src/*"],
      "@/components/*": ["./src/components/*"],
      "@/lib/*": ["./src/lib/*"],
      "@/hooks/*": ["./src/hooks/*"],
      "@/types/*": ["./src/types/*"],
      "@/utils/*": ["./src/utils/*"],
      "@/styles/*": ["./src/styles/*"],
      "@/public/*": ["./public/*"]
    }
  }
}
```

```typescript
// Usage
import { Button } from '@/components/ui/button';
import { formatDate } from '@/utils/date';
import { useAuth } from '@/hooks/useAuth';
import type { User } from '@/types/user';
```

### Custom Type Definitions

```typescript
// types/global.d.ts
export {};

declare global {
  // Window extensions
  interface Window {
    gtag: (...args: any[]) => void;
    dataLayer: any[];
  }

  // Process env types
  namespace NodeJS {
    interface ProcessEnv {
      DATABASE_URL: string;
      NEXT_PUBLIC_API_URL: string;
    }
  }
}
```

```typescript
// types/api.d.ts
export interface ApiResponse<T> {
  data: T;
  error?: string;
  status: number;
}

export interface User {
  id: string;
  email: string;
  name: string;
  createdAt: string;
}

export interface Product {
  id: string;
  name: string;
  price: number;
  imageUrl: string;
}
```

### Next.js-Specific Types

```typescript
// app/page.tsx
import type { Metadata } from 'next';

export const metadata: Metadata = {
  title: 'My Page',
  description: 'Description',
};

// Params and SearchParams types
type PageProps = {
  params: { slug: string };
  searchParams: { [key: string]: string | string[] | undefined };
};

export default function Page({ params, searchParams }: PageProps) {
  return <div>{params.slug}</div>;
}
```

```typescript
// API Route types
import type { NextRequest } from 'next/server';

export async function GET(request: NextRequest) {
  const searchParams = request.nextUrl.searchParams;
  const query = searchParams.get('query');
  
  return Response.json({ query });
}
```

### Utility Types

```typescript
// types/utils.ts

// Make all properties optional recursively
export type DeepPartial<T> = {
  [P in keyof T]?: T[P] extends object ? DeepPartial<T[P]> : T[P];
};

// Make specific keys required
export type RequireKeys<T, K extends keyof T> = T & Required<Pick<T, K>>;

// Make specific keys optional
export type PartialKeys<T, K extends keyof T> = Omit<T, K> & Partial<Pick<T, K>>;

// Unwrap Promise type
export type Awaited<T> = T extends PromiseLike<infer U> ? U : T;

// Extract function parameters
export type Parameters<T> = T extends (...args: infer P) => any ? P : never;

// Usage
interface User {
  id: string;
  email: string;
  name?: string;
}

type PartialUser = DeepPartial<User>;
type UserWithName = RequireKeys<User, 'name'>;
```

### tsconfig.json for Different Environments

```json
// tsconfig.server.json (for custom server)
{
  "extends": "./tsconfig.json",
  "compilerOptions": {
    "module": "commonjs",
    "noEmit": false,
    "outDir": "dist"
  },
  "include": ["server.ts"],
  "exclude": ["node_modules", "src"]
}
```

```json
// tsconfig.test.json (for tests)
{
  "extends": "./tsconfig.json",
  "compilerOptions": {
    "jsx": "react-jsx"
  },
  "include": [
    "**/*.test.ts",
    "**/*.test.tsx",
    "**/*.spec.ts",
    "**/*.spec.tsx"
  ]
}
```

This covers the comprehensive configuration aspects of Next.js! Each section provides production-ready patterns and best practices for configuring your Next.js application.