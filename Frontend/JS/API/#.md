# JavaScript DOM & Web APIs Mastery Guide
## From Beginner to Advanced ‚Äî Interview & Production Ready

---

# PART 1: DOM FUNDAMENTALS

## Chapter 1: Understanding the DOM

### 1.1 What is the DOM?
- Document Object Model ‚Äî tree-like representation of HTML
- Browser parses HTML ‚Üí creates DOM tree
- DOM is **not** the HTML source code
- DOM is **not** what you see in DevTools (that's a visual representation)

> ‚ö†Ô∏è **Interview Insight**: DOM is a programming interface for web documents. It represents the page as nodes and objects so programming languages can interact with it.

### 1.2 DOM Tree Structure
- **Document Node** ‚Äî entry point (`document`)
- **Element Nodes** ‚Äî HTML tags
- **Text Nodes** ‚Äî text content inside elements
- **Comment Nodes** ‚Äî HTML comments
- **Attribute Nodes** ‚Äî element attributes (conceptually, not in tree)

### 1.3 Node vs Element
```
Node (base class)
‚îú‚îÄ‚îÄ Element (HTML tags)
‚îú‚îÄ‚îÄ Text (text content)
‚îú‚îÄ‚îÄ Comment (<!-- -->)
‚îú‚îÄ‚îÄ Document (document object)
‚îî‚îÄ‚îÄ DocumentFragment (lightweight container)
```

> üîë **Key Point**: All Elements are Nodes, but not all Nodes are Elements. `childNodes` returns all nodes; `children` returns only element nodes.

### 1.4 The `document` Object
- `document.documentElement` ‚Äî `<html>` element
- `document.head` ‚Äî `<head>` element
- `document.body` ‚Äî `<body>` element
- `document.doctype` ‚Äî DOCTYPE declaration

---

## Chapter 2: DOM Selection & Querying

### 2.1 Single Element Selection
```javascript
document.getElementById('id')           // Returns element or null
document.querySelector('selector')      // Returns first match or null
```

### 2.2 Multiple Element Selection
```javascript
document.getElementsByClassName('class')  // Live HTMLCollection
document.getElementsByTagName('tag')      // Live HTMLCollection
document.getElementsByName('name')        // Live NodeList
document.querySelectorAll('selector')     // Static NodeList
```

> ‚ö†Ô∏è **Critical Difference**:
> - **Live Collections**: Auto-update when DOM changes (`getElementsBy*`)
> - **Static Collections**: Snapshot at query time (`querySelectorAll`)

### 2.3 Advanced Selectors
```javascript
// Attribute selectors
document.querySelectorAll('[data-active="true"]')
document.querySelectorAll('input[type="text"]')

// Pseudo-selectors
document.querySelectorAll(':not(.disabled)')
document.querySelectorAll(':nth-child(odd)')
document.querySelectorAll(':checked')

// Combinators
document.querySelectorAll('div > p')      // Direct children
document.querySelectorAll('div + p')      // Adjacent sibling
document.querySelectorAll('div ~ p')      // General siblings
```

### 2.4 Scoped Selection
```javascript
const parent = document.getElementById('container');
parent.querySelector('.child');           // Search within parent
parent.querySelectorAll('.items');
```

### 2.5 Closest & Matches
```javascript
element.matches('selector')     // Returns boolean
element.closest('selector')     // Finds nearest ancestor (including self)
```

> üîë **Production Tip**: `closest()` is invaluable for event delegation ‚Äî finding the relevant parent from the event target.

---

## Chapter 3: DOM Traversal

### 3.1 Parent Traversal
```javascript
element.parentNode              // Parent node (any type)
element.parentElement           // Parent element (null if parent is not element)
element.closest('selector')     // Nearest matching ancestor
```

### 3.2 Children Traversal
```javascript
element.childNodes              // All child nodes (Live NodeList)
element.children                // Element children only (Live HTMLCollection)
element.firstChild              // First node (includes text/comments)
element.firstElementChild       // First element child
element.lastChild               // Last node
element.lastElementChild        // Last element child
```

### 3.3 Sibling Traversal
```javascript
element.previousSibling         // Previous node
element.previousElementSibling  // Previous element
element.nextSibling             // Next node
element.nextElementSibling      // Next element
```

### 3.4 Node Properties
```javascript
node.nodeName                   // Tag name (uppercase) or node type name
node.nodeType                   // 1=Element, 3=Text, 8=Comment, 9=Document
node.nodeValue                  // Text content for text/comment nodes
node.textContent                // All text content (with descendants)
node.innerText                  // Visible text only (triggers reflow!)
```

> ‚ö†Ô∏è **Performance Warning**: `innerText` triggers a reflow to compute styles. Use `textContent` when you don't need style-aware text.

---

## Chapter 4: DOM Manipulation

### 4.1 Creating Elements
```javascript
document.createElement('div')           // Create element
document.createTextNode('text')         // Create text node
document.createDocumentFragment()       // Create fragment (no reflow)
document.createComment('comment')       // Create comment
element.cloneNode(deep)                 // Clone (deep=true includes children)
```

### 4.2 Modern Insertion Methods
```javascript
// These accept multiple nodes AND strings
parent.append(node1, node2, 'text')     // Add to end of children
parent.prepend(node1, 'text')           // Add to beginning of children
element.before(node1, 'text')           // Insert before element
element.after(node1, 'text')            // Insert after element
element.replaceWith(node1, 'text')      // Replace element
```

### 4.3 Legacy Insertion Methods
```javascript
parent.appendChild(node)                 // Add single node to end
parent.insertBefore(newNode, refNode)    // Insert before reference
parent.replaceChild(newNode, oldNode)    // Replace child
parent.removeChild(node)                 // Remove child
```

### 4.4 Self-Removal
```javascript
element.remove()                         // Remove from DOM (modern)
```

### 4.5 HTML String Insertion
```javascript
element.innerHTML = '<p>HTML</p>'        // Replace inner HTML (parses HTML)
element.outerHTML = '<div>New</div>'     // Replace element itself
element.textContent = 'text'             // Set text (no parsing, safe)

// insertAdjacentHTML - precise positioning
element.insertAdjacentHTML('beforebegin', html)  // Before element
element.insertAdjacentHTML('afterbegin', html)   // First child
element.insertAdjacentHTML('beforeend', html)    // Last child
element.insertAdjacentHTML('afterend', html)     // After element

// Also available:
element.insertAdjacentElement(position, element)
element.insertAdjacentText(position, text)
```

> ‚ö†Ô∏è **Security Warning**: Never use `innerHTML` with user input ‚Äî XSS vulnerability! Sanitize or use `textContent`.

### 4.6 DocumentFragment for Batch Operations
```javascript
const fragment = document.createDocumentFragment();
for (let i = 0; i < 1000; i++) {
    const li = document.createElement('li');
    li.textContent = `Item ${i}`;
    fragment.appendChild(li);
}
ul.appendChild(fragment);  // Single reflow!
```

> üîë **Production Pattern**: Always use `DocumentFragment` for bulk insertions to minimize reflows.

---

## Chapter 5: Attributes & Properties

### 5.1 Attributes vs Properties
| Attributes | Properties |
|------------|------------|
| Defined in HTML | Defined on DOM object |
| Always strings | Can be any type |
| `getAttribute()` | Direct access (`elem.prop`) |
| Reflected in HTML | May not sync with HTML |

### 5.2 Attribute Methods
```javascript
element.getAttribute('name')
element.setAttribute('name', 'value')
element.hasAttribute('name')
element.removeAttribute('name')
element.toggleAttribute('name', force?)
element.attributes                       // NamedNodeMap of all attributes
element.getAttributeNames()              // Array of attribute names
```

### 5.3 Data Attributes
```javascript
// HTML: <div data-user-id="123" data-active="true">

element.dataset.userId                   // "123" (camelCase conversion)
element.dataset.active                   // "true" (always string!)
element.dataset.newProp = 'value'        // Sets data-new-prop

// Alternative
element.getAttribute('data-user-id')
```

> ‚ö†Ô∏è **Gotcha**: `dataset` values are always strings. Parse numbers/booleans manually.

### 5.4 Class Manipulation
```javascript
element.className                        // Full class string
element.classList                        // DOMTokenList

element.classList.add('a', 'b')          // Add classes
element.classList.remove('a', 'b')       // Remove classes
element.classList.toggle('active')       // Toggle (returns new state)
element.classList.toggle('active', force) // Force add/remove
element.classList.contains('active')     // Check existence
element.classList.replace('old', 'new')  // Replace class
element.classList.item(0)                // Get by index
element.classList.length                 // Number of classes
[...element.classList]                   // Convert to array
```

### 5.5 Style Manipulation
```javascript
element.style.backgroundColor = 'red'    // Set inline style (camelCase)
element.style.cssText = 'color: red;'    // Set full style string
element.style.setProperty('--custom', 'value')  // CSS variables
element.style.getPropertyValue('color')
element.style.removeProperty('color')

// Get computed styles (read-only)
const styles = getComputedStyle(element);
styles.getPropertyValue('color')
```

> üîë **Interview Point**: `element.style` only reads/writes inline styles. Use `getComputedStyle()` for actual applied styles.

---

# PART 2: EVENTS & EVENT HANDLING

## Chapter 6: Event Fundamentals

### 6.1 Adding Event Listeners
```javascript
// Modern (recommended)
element.addEventListener('click', handler, options);

// Options object
{
    capture: false,      // Use capture phase
    once: true,          // Remove after first trigger
    passive: true,       // Never call preventDefault()
    signal: controller.signal  // AbortController for removal
}

// Legacy (avoid)
element.onclick = handler;
```

### 6.2 Removing Event Listeners
```javascript
element.removeEventListener('click', handler, options);

// Using AbortController (modern pattern)
const controller = new AbortController();
element.addEventListener('click', handler, { signal: controller.signal });
controller.abort();  // Removes the listener
```

> üîë **Production Pattern**: Use `AbortController` for cleanup in SPAs and component unmounting.

### 6.3 The Event Object
```javascript
function handler(event) {
    event.type              // Event type ('click', 'keydown', etc.)
    event.target            // Element that triggered event
    event.currentTarget     // Element handler is attached to
    event.eventPhase        // 1=Capture, 2=Target, 3=Bubble
    event.bubbles           // Does it bubble?
    event.cancelable        // Can default be prevented?
    event.defaultPrevented  // Was preventDefault called?
    event.isTrusted         // User-initiated vs programmatic
    event.timeStamp         // When event was created
}
```

### 6.4 Event Propagation
```
         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ            CAPTURE PHASE (1)             ‚îÇ
         ‚îÇ                   ‚Üì                      ‚îÇ
         ‚îÇ   window ‚Üí document ‚Üí html ‚Üí body ‚Üí div  ‚îÇ
         ‚îÇ                                          ‚îÇ
         ‚îÇ              TARGET PHASE (2)            ‚îÇ
         ‚îÇ                button                    ‚îÇ
         ‚îÇ                                          ‚îÇ
         ‚îÇ             BUBBLE PHASE (3)             ‚îÇ
         ‚îÇ                   ‚Üë                      ‚îÇ
         ‚îÇ   div ‚Üí body ‚Üí html ‚Üí document ‚Üí window  ‚îÇ
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 6.5 Controlling Propagation
```javascript
event.stopPropagation()         // Stop bubbling/capturing
event.stopImmediatePropagation() // Stop all handlers on current element too
event.preventDefault()          // Prevent default browser action
```

> ‚ö†Ô∏è **Warning**: Overusing `stopPropagation()` breaks event delegation and analytics tracking. Prefer conditional logic in handlers.

### 6.6 Event Delegation
```javascript
// Instead of adding listeners to each item:
document.querySelector('.list').addEventListener('click', (e) => {
    const item = e.target.closest('.item');
    if (!item) return;  // Clicked outside items
    
    // Handle item click
    console.log(item.dataset.id);
});
```

> üîë **Production Pattern**: Event delegation reduces memory usage and handles dynamically added elements automatically.

---

## Chapter 7: Event Types Deep Dive

### 7.1 Mouse Events
```javascript
click           // Click (mousedown + mouseup)
dblclick        // Double click
mousedown       // Button pressed
mouseup         // Button released
mousemove       // Pointer moves
mouseenter      // Enters element (no bubble)
mouseleave      // Leaves element (no bubble)
mouseover       // Enters element (bubbles)
mouseout        // Leaves element (bubbles)
contextmenu     // Right-click menu

// MouseEvent properties
event.clientX/Y     // Viewport coordinates
event.pageX/Y       // Document coordinates (includes scroll)
event.screenX/Y     // Screen coordinates
event.offsetX/Y     // Relative to target element
event.button        // 0=left, 1=middle, 2=right
event.buttons       // Bitmask of pressed buttons
event.altKey        // Alt held?
event.ctrlKey       // Ctrl held?
event.shiftKey      // Shift held?
event.metaKey       // Cmd/Win held?
```

### 7.2 Keyboard Events
```javascript
keydown         // Key pressed (repeats if held)
keyup           // Key released
// keypress    // DEPRECATED

// KeyboardEvent properties
event.key           // 'a', 'Enter', 'ArrowUp' (recommended)
event.code          // 'KeyA', 'Enter' (physical key)
event.keyCode       // DEPRECATED
event.repeat        // Is this a repeat from holding?
event.isComposing   // In IME composition?
```

> üîë **Best Practice**: Use `event.key` for character input, `event.code` for physical key location (games, shortcuts).

### 7.3 Focus Events
```javascript
focus           // Element gains focus (no bubble)
blur            // Element loses focus (no bubble)
focusin         // Element gains focus (bubbles)
focusout        // Element loses focus (bubbles)

// Related element
event.relatedTarget  // Element focus came from / going to
```

### 7.4 Form Events
```javascript
submit          // Form submission
reset           // Form reset
change          // Value changed (on blur for text)
input           // Value changes (immediate, every keystroke)
invalid         // Validation failed

// Form-specific
event.submitter     // Button that triggered submit
```

### 7.5 Scroll Events
```javascript
scroll          // Element scrolled (high frequency!)
scrollend       // Scroll finished (modern browsers)

// Scroll properties
element.scrollTop       // Pixels scrolled from top
element.scrollLeft      // Pixels scrolled from left
element.scrollHeight    // Total scrollable height
element.scrollWidth     // Total scrollable width
```

> ‚ö†Ô∏è **Performance**: Throttle/debounce scroll handlers. Consider `IntersectionObserver` instead.

### 7.6 Touch Events
```javascript
touchstart      // Finger touches screen
touchmove       // Finger moves
touchend        // Finger lifted
touchcancel     // Touch interrupted

// TouchEvent properties
event.touches           // All current touches
event.targetTouches     // Touches on target element
event.changedTouches    // Touches that changed in this event

// Touch object properties
touch.identifier        // Unique ID for this touch
touch.clientX/Y        // Viewport coordinates
touch.pageX/Y          // Document coordinates
touch.target           // Element first touched
```

### 7.7 Pointer Events (Unified)
```javascript
pointerdown, pointerup, pointermove
pointerenter, pointerleave, pointerover, pointerout
pointercancel
gotpointercapture, lostpointercapture

// PointerEvent properties (extends MouseEvent)
event.pointerId        // Unique pointer identifier
event.pointerType      // 'mouse', 'pen', 'touch'
event.pressure         // 0.0 to 1.0
event.tiltX/Y          // Pen angle
event.isPrimary        // Primary pointer of this type?
```

> üîë **Modern Approach**: Use Pointer Events for cross-device compatibility (mouse + touch + pen).

### 7.8 Clipboard Events
```javascript
copy            // Content copied
cut             // Content cut
paste           // Content pasted

event.clipboardData.getData('text/plain')
event.clipboardData.setData('text/plain', 'text')
event.clipboardData.files  // Pasted files
```

### 7.9 Drag Events
```javascript
// On dragged element
dragstart       // Drag begins
drag            // During drag
dragend         // Drag ends

// On drop target
dragenter       // Enters drop zone
dragover        // Over drop zone (must preventDefault to allow drop!)
dragleave       // Leaves drop zone
drop            // Dropped

event.dataTransfer.setData('text/plain', data)
event.dataTransfer.getData('text/plain')
event.dataTransfer.files
event.dataTransfer.dropEffect = 'copy' // 'move', 'link', 'none'
```

### 7.10 Lifecycle Events
```javascript
// Document loading
DOMContentLoaded    // HTML parsed, DOM ready (on document)
load                // Everything loaded (images, styles, etc.)
beforeunload        // About to leave page
unload              // Page unloading

// Element loading
load                // Resource loaded (img, script, etc.)
error               // Resource failed to load

// Visibility
visibilitychange    // Tab visibility changed (on document)
document.visibilityState  // 'visible', 'hidden'
```

---

## Chapter 8: Custom Events

### 8.1 Creating Custom Events
```javascript
// Basic CustomEvent
const event = new CustomEvent('myEvent', {
    detail: { key: 'value' },    // Custom data
    bubbles: true,               // Should bubble?
    cancelable: true,            // Can be cancelled?
    composed: true               // Cross shadow DOM boundary?
});

element.dispatchEvent(event);

// Listening
element.addEventListener('myEvent', (e) => {
    console.log(e.detail.key);  // 'value'
});
```

### 8.2 Built-in Event Constructors
```javascript
new Event('click')
new MouseEvent('click', { clientX: 100 })
new KeyboardEvent('keydown', { key: 'Enter' })
new FocusEvent('focus', { relatedTarget: el })
new InputEvent('input', { data: 'a' })
new TouchEvent('touchstart', { touches: [...] })
```

### 8.3 Event-Driven Architecture Pattern
```javascript
// Simple event bus
const eventBus = {
    events: {},
    on(event, callback) {
        (this.events[event] ||= []).push(callback);
    },
    off(event, callback) {
        this.events[event] = this.events[event]?.filter(cb => cb !== callback);
    },
    emit(event, data) {
        this.events[event]?.forEach(cb => cb(data));
    }
};
```

---

# PART 3: FORMS & VALIDATION

## Chapter 9: Form Handling

### 9.1 Accessing Form Elements
```javascript
document.forms                      // All forms
document.forms['formName']          // By name
document.forms[0]                   // By index

form.elements                       // All form controls
form.elements['fieldName']          // By name
form.elements.namedItem('name')     // By name (explicit)
form.length                         // Number of controls
```

### 9.2 Form Data
```javascript
const formData = new FormData(form);

// Reading
formData.get('field')               // Single value
formData.getAll('field')            // All values (for multi-select)
formData.has('field')               // Exists?
formData.entries()                  // Iterator of [key, value]
formData.keys()                     // Iterator of keys
formData.values()                   // Iterator of values

// Modifying
formData.set('field', 'value')      // Set (replace)
formData.append('field', 'value')   // Append (allow multiple)
formData.delete('field')            // Remove

// Convert to object
const data = Object.fromEntries(formData);

// Convert to URL params
const params = new URLSearchParams(formData);
```

### 9.3 Input Types & Properties
```javascript
// Text inputs
input.value                         // Current value
input.defaultValue                  // Initial value (from HTML)
input.placeholder
input.maxLength / minLength

// Checkboxes & Radio
input.checked                       // Boolean
input.defaultChecked

// Select
select.options                      // HTMLOptionsCollection
select.selectedIndex                // Index of selected option
select.selectedOptions              // Selected option elements
select.value                        // Value of selected option
select.multiple                     // Is multi-select?

// File
input.files                         // FileList
input.accept                        // Accepted types

// Number/Range
input.valueAsNumber                 // Value as number
input.min / max / step

// Date
input.valueAsDate                   // Value as Date object
```

### 9.4 Form Methods
```javascript
form.submit()                       // Submit (no submit event!)
form.requestSubmit(submitter?)      // Submit with event
form.reset()                        // Reset to defaults
form.checkValidity()                // Validate all fields
form.reportValidity()               // Validate and show UI

input.focus()
input.blur()
input.select()                      // Select all text
input.setSelectionRange(start, end) // Select range
input.setRangeText(text)            // Replace selection
input.setCustomValidity(message)    // Set validation message
```

---

## Chapter 10: Form Validation

### 10.1 HTML5 Validation Attributes
```html
required                            <!-- Must have value -->
minlength="3" maxlength="100"       <!-- String length -->
min="0" max="100"                   <!-- Number range -->
pattern="[A-Za-z]+"                 <!-- Regex pattern -->
type="email"                        <!-- Built-in validators -->
```

### 10.2 Validity State API
```javascript
input.validity                      // ValidityState object
input.validity.valid                // Overall validity
input.validity.valueMissing         // Required but empty
input.validity.typeMismatch         // Wrong type (email, url)
input.validity.patternMismatch      // Doesn't match pattern
input.validity.tooLong              // Exceeds maxlength
input.validity.tooShort             // Below minlength
input.validity.rangeUnderflow       // Below min
input.validity.rangeOverflow        // Above max
input.validity.stepMismatch         // Doesn't match step
input.validity.badInput             // Browser can't parse
input.validity.customError          // setCustomValidity used

input.validationMessage             // Current error message
input.willValidate                  // Is this field validated?
```

### 10.3 Custom Validation
```javascript
input.addEventListener('input', () => {
    if (input.value.includes('forbidden')) {
        input.setCustomValidity('Forbidden word detected');
    } else {
        input.setCustomValidity('');  // Clear error
    }
});

form.addEventListener('submit', (e) => {
    if (!form.checkValidity()) {
        e.preventDefault();
        form.reportValidity();  // Show validation UI
    }
});
```

### 10.4 Custom Validation UI
```javascript
form.noValidate = true;  // Disable browser UI

form.addEventListener('submit', (e) => {
    e.preventDefault();
    
    for (const input of form.elements) {
        const error = input.closest('.field')?.querySelector('.error');
        if (!error) continue;
        
        if (!input.validity.valid) {
            error.textContent = input.validationMessage;
            error.hidden = false;
        } else {
            error.hidden = true;
        }
    }
});
```

---

# PART 4: BROWSER STORAGE APIs

## Chapter 11: Web Storage

### 11.1 localStorage
```javascript
localStorage.setItem('key', 'value')
localStorage.getItem('key')         // Returns null if not found
localStorage.removeItem('key')
localStorage.clear()                // Remove all
localStorage.key(index)             // Key at index
localStorage.length                 // Number of items

// Storing objects
localStorage.setItem('user', JSON.stringify({ name: 'John' }));
const user = JSON.parse(localStorage.getItem('user'));
```

> ‚ö†Ô∏è **Limitations**: 
> - ~5MB per origin
> - Strings only (JSON serialize objects)
> - Synchronous (blocks main thread)
> - No expiration

### 11.2 sessionStorage
```javascript
// Same API as localStorage
sessionStorage.setItem('key', 'value')
// ... same methods
```

> üîë **Difference**: `sessionStorage` is cleared when tab closes; `localStorage` persists.

### 11.3 Storage Events
```javascript
// Fires in OTHER tabs/windows of same origin
window.addEventListener('storage', (e) => {
    e.key           // Changed key (null if clear())
    e.oldValue      // Previous value
    e.newValue      // New value
    e.url           // Document URL that made change
    e.storageArea   // localStorage or sessionStorage
});
```

---

## Chapter 12: IndexedDB

### 12.1 Opening Database
```javascript
const request = indexedDB.open('MyDB', 1);

request.onerror = (e) => console.error('Error:', e.target.error);

request.onupgradeneeded = (e) => {
    const db = e.target.result;
    
    // Create object store (table)
    const store = db.createObjectStore('users', { 
        keyPath: 'id',           // Primary key property
        autoIncrement: true      // Auto-generate keys
    });
    
    // Create indexes
    store.createIndex('email', 'email', { unique: true });
    store.createIndex('age', 'age', { unique: false });
};

request.onsuccess = (e) => {
    const db = e.target.result;
    // Use db...
};
```

### 12.2 CRUD Operations
```javascript
// CREATE / UPDATE
const tx = db.transaction('users', 'readwrite');
const store = tx.objectStore('users');
store.put({ id: 1, name: 'John', email: 'john@example.com' });

// READ
const getRequest = store.get(1);
getRequest.onsuccess = () => console.log(getRequest.result);

// READ ALL
const getAllRequest = store.getAll();

// DELETE
store.delete(1);

// CLEAR ALL
store.clear();

// Transaction complete
tx.oncomplete = () => console.log('Done');
```

### 12.3 Using Indexes
```javascript
const tx = db.transaction('users', 'readonly');
const store = tx.objectStore('users');
const index = store.index('email');

index.get('john@example.com').onsuccess = (e) => {
    console.log(e.target.result);
};
```

### 12.4 Cursors
```javascript
const store = tx.objectStore('users');
store.openCursor().onsuccess = (e) => {
    const cursor = e.target.result;
    if (cursor) {
        console.log(cursor.key, cursor.value);
        cursor.continue();  // Move to next
    }
};

// Range queries
const range = IDBKeyRange.bound(18, 65);  // age 18-65
store.index('age').openCursor(range).onsuccess = ...
```

### 12.5 IndexedDB Promise Wrapper
```javascript
function openDB(name, version, upgrade) {
    return new Promise((resolve, reject) => {
        const request = indexedDB.open(name, version);
        request.onerror = () => reject(request.error);
        request.onsuccess = () => resolve(request.result);
        request.onupgradeneeded = (e) => upgrade(e.target.result);
    });
}

// Usage with async/await
const db = await openDB('MyDB', 1, (db) => {
    db.createObjectStore('users', { keyPath: 'id' });
});
```

---

## Chapter 13: Cookies

### 13.1 Reading Cookies
```javascript
document.cookie  // "name=value; other=data"

// Parse cookies
function getCookies() {
    return Object.fromEntries(
        document.cookie.split('; ').map(c => c.split('=').map(decodeURIComponent))
    );
}
```

### 13.2 Setting Cookies
```javascript
document.cookie = "name=value";  // Simple

// With options
document.cookie = `name=${encodeURIComponent(value)}; ` +
    `expires=${new Date(Date.now() + 86400000).toUTCString()}; ` +
    `path=/; ` +
    `domain=.example.com; ` +
    `secure; ` +
    `samesite=strict`;
```

### 13.3 Cookie Attributes
| Attribute | Description |
|-----------|-------------|
| `expires` | Expiration date (GMT string) |
| `max-age` | Seconds until expiration |
| `path` | URL path scope |
| `domain` | Domain scope |
| `secure` | HTTPS only |
| `samesite` | `strict`, `lax`, `none` |
| `httponly` | Not accessible via JS (server-set only) |

### 13.4 Deleting Cookies
```javascript
// Set expired date
document.cookie = "name=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/";
```

---

## Chapter 14: Cache API

### 14.1 Opening Cache
```javascript
const cache = await caches.open('my-cache-v1');
```

### 14.2 Caching Responses
```javascript
// Add single request
await cache.add('/api/data');

// Add multiple
await cache.addAll(['/style.css', '/app.js', '/offline.html']);

// Add with custom response
await cache.put('/api/data', new Response(JSON.stringify(data)));
```

### 14.3 Retrieving from Cache
```javascript
const response = await cache.match('/api/data');
if (response) {
    const data = await response.json();
}

// Match with options
const response = await cache.match(request, {
    ignoreSearch: true,     // Ignore query string
    ignoreMethod: true,     // Match any HTTP method
    ignoreVary: true        // Ignore Vary header
});
```

### 14.4 Cache Management
```javascript
await cache.delete('/api/old');
const keys = await cache.keys();
const hasIt = await cache.match('/api/data') !== undefined;

// Delete entire cache
await caches.delete('my-cache-v1');

// List all caches
const cacheNames = await caches.keys();
```

---

# PART 5: NETWORK APIs

## Chapter 15: Fetch API

### 15.1 Basic Fetch
```javascript
const response = await fetch('/api/data');
const data = await response.json();
```

### 15.2 Request Options
```javascript
const response = await fetch('/api/data', {
    method: 'POST',                          // GET, POST, PUT, DELETE, etc.
    headers: {
        'Content-Type': 'application/json',
        'Authorization': 'Bearer token'
    },
    body: JSON.stringify({ key: 'value' }),  // Request body
    mode: 'cors',                            // cors, no-cors, same-origin
    credentials: 'include',                  // include, same-origin, omit
    cache: 'no-cache',                       // default, no-store, reload, etc.
    redirect: 'follow',                      // follow, error, manual
    signal: controller.signal                // AbortController signal
});
```

### 15.3 Response Object
```javascript
response.ok                 // true if status 200-299
response.status             // HTTP status code
response.statusText         // Status message
response.headers            // Headers object
response.url                // Final URL (after redirects)
response.redirected         // Was redirected?
response.type               // basic, cors, opaque

// Body methods (can only be called once!)
await response.text()       // String
await response.json()       // Parsed JSON
await response.blob()       // Blob
await response.arrayBuffer() // ArrayBuffer
await response.formData()   // FormData
response.body               // ReadableStream
```

### 15.4 Aborting Requests
```javascript
const controller = new AbortController();

fetch('/api/data', { signal: controller.signal })
    .catch(e => {
        if (e.name === 'AbortError') {
            console.log('Request aborted');
        }
    });

// Abort after timeout
setTimeout(() => controller.abort(), 5000);

// Or use AbortSignal.timeout() (modern)
fetch('/api/data', { signal: AbortSignal.timeout(5000) });
```

### 15.5 Upload Progress
```javascript
async function uploadWithProgress(url, file, onProgress) {
    const xhr = new XMLHttpRequest();  // Fetch doesn't support upload progress
    
    return new Promise((resolve, reject) => {
        xhr.upload.addEventListener('progress', (e) => {
            if (e.lengthComputable) {
                onProgress(e.loaded / e.total * 100);
            }
        });
        
        xhr.addEventListener('load', () => resolve(xhr.response));
        xhr.addEventListener('error', () => reject(new Error('Upload failed')));
        
        xhr.open('POST', url);
        xhr.send(file);
    });
}
```

### 15.6 Download Progress
```javascript
async function downloadWithProgress(url, onProgress) {
    const response = await fetch(url);
    const total = +response.headers.get('Content-Length');
    const reader = response.body.getReader();
    let loaded = 0;
    const chunks = [];
    
    while (true) {
        const { done, value } = await reader.read();
        if (done) break;
        
        chunks.push(value);
        loaded += value.length;
        onProgress(loaded / total * 100);
    }
    
    return new Blob(chunks);
}
```

---

## Chapter 16: WebSockets

### 16.1 Creating Connection
```javascript
const ws = new WebSocket('wss://example.com/socket');

ws.onopen = (e) => {
    console.log('Connected');
    ws.send('Hello Server!');
};

ws.onmessage = (e) => {
    console.log('Received:', e.data);
};

ws.onerror = (e) => {
    console.error('Error:', e);
};

ws.onclose = (e) => {
    console.log('Closed:', e.code, e.reason);
};
```

### 16.2 Sending Data
```javascript
ws.send('String message');
ws.send(new Blob(['Binary data']));
ws.send(new ArrayBuffer(8));

// Check if ready
if (ws.readyState === WebSocket.OPEN) {
    ws.send(data);
}
```

### 16.3 Connection States
```javascript
WebSocket.CONNECTING  // 0 - Connection in progress
WebSocket.OPEN        // 1 - Connected
WebSocket.CLOSING     // 2 - Closing in progress
WebSocket.CLOSED      // 3 - Closed
```

### 16.4 Closing Connection
```javascript
ws.close(1000, 'Normal closure');  // code, reason
```

---

## Chapter 17: Server-Sent Events (SSE)

### 17.1 Basic Usage
```javascript
const source = new EventSource('/api/stream');

source.onmessage = (e) => {
    console.log(e.data);
};

source.onerror = (e) => {
    console.error('Error:', e);
};

// Close connection
source.close();
```

### 17.2 Named Events
```javascript
// Server sends: event: userUpdate\ndata: {...}
source.addEventListener('userUpdate', (e) => {
    const user = JSON.parse(e.data);
});
```

### 17.3 EventSource with Credentials
```javascript
const source = new EventSource('/api/stream', {
    withCredentials: true  // Include cookies
});
```

---

## Chapter 18: Beacon API

### 18.1 Sending Data on Page Unload
```javascript
// Guaranteed delivery even if page closes
window.addEventListener('unload', () => {
    navigator.sendBeacon('/api/analytics', JSON.stringify({
        event: 'page_close',
        timeSpent: performance.now()
    }));
});

// With FormData
const data = new FormData();
data.append('event', 'click');
navigator.sendBeacon('/api/track', data);
```

> üîë **Use Case**: Analytics, logging - data sent even if user closes tab immediately.

---

# PART 6: OBSERVERS & ASYNC APIs

## Chapter 19: Intersection Observer

### 19.1 Creating Observer
```javascript
const observer = new IntersectionObserver((entries, observer) => {
    entries.forEach(entry => {
        if (entry.isIntersecting) {
            console.log('Element visible:', entry.target);
            // Lazy load, animate, etc.
        }
    });
}, {
    root: null,              // Viewport (null) or element
    rootMargin: '0px',       // Margin around root
    threshold: [0, 0.5, 1]   // Trigger at 0%, 50%, 100% visibility
});
```

### 19.2 Observing Elements
```javascript
observer.observe(element);
observer.unobserve(element);
observer.disconnect();  // Stop all observations
```

### 19.3 Entry Properties
```javascript
entry.target               // Observed element
entry.isIntersecting       // Currently visible?
entry.intersectionRatio    // 0.0 to 1.0
entry.intersectionRect     // Visible portion bounds
entry.boundingClientRect   // Element bounds
entry.rootBounds           // Root element bounds
entry.time                 // Timestamp
```

### 19.4 Common Use Cases
```javascript
// Lazy loading images
const lazyObserver = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
        if (entry.isIntersecting) {
            const img = entry.target;
            img.src = img.dataset.src;
            lazyObserver.unobserve(img);
        }
    });
});

document.querySelectorAll('img[data-src]').forEach(img => {
    lazyObserver.observe(img);
});

// Infinite scroll
const sentinel = document.querySelector('.sentinel');
const scrollObserver = new IntersectionObserver((entries) => {
    if (entries[0].isIntersecting) {
        loadMoreContent();
    }
});
scrollObserver.observe(sentinel);
```

---

## Chapter 20: Mutation Observer

### 20.1 Creating Observer
```javascript
const observer = new MutationObserver((mutations, observer) => {
    mutations.forEach(mutation => {
        console.log(mutation.type, mutation.target);
    });
});
```

### 20.2 Starting Observation
```javascript
observer.observe(targetElement, {
    childList: true,           // Direct children added/removed
    subtree: true,             // All descendants
    attributes: true,          // Attribute changes
    attributeFilter: ['class', 'style'],  // Only these attributes
    attributeOldValue: true,   // Include previous value
    characterData: true,       // Text content changes
    characterDataOldValue: true
});
```

### 20.3 Mutation Record Properties
```javascript
mutation.type              // 'childList', 'attributes', 'characterData'
mutation.target            // Modified element
mutation.addedNodes        // NodeList of added nodes
mutation.removedNodes      // NodeList of removed nodes
mutation.previousSibling   // Sibling before added/removed nodes
mutation.nextSibling       // Sibling after added/removed nodes
mutation.attributeName     // Changed attribute name
mutation.oldValue          // Previous value (if configured)
```

### 20.4 Stopping & Querying
```javascript
observer.disconnect();                    // Stop observing
const pending = observer.takeRecords();   // Get pending mutations
```

> üîë **Use Case**: Detecting DOM changes from third-party scripts, framework-less reactivity.

---

## Chapter 21: Resize Observer

### 21.1 Creating Observer
```javascript
const observer = new ResizeObserver((entries) => {
    entries.forEach(entry => {
        const { width, height } = entry.contentRect;
        console.log(`${entry.target.id}: ${width}x${height}`);
    });
});

observer.observe(element);
```

### 21.2 Entry Properties
```javascript
entry.target               // Observed element
entry.contentRect          // DOMRectReadOnly { width, height, x, y, ... }
entry.borderBoxSize        // Array of { blockSize, inlineSize }
entry.contentBoxSize       // Array of { blockSize, inlineSize }
entry.devicePixelContentBoxSize  // With device pixel ratio
```

### 21.3 Use Cases
```javascript
// Responsive charts
const chartObserver = new ResizeObserver(entries => {
    const { width, height } = entries[0].contentRect;
    chart.resize(width, height);
});
chartObserver.observe(chartContainer);

// Container queries (before CSS support)
const containerObserver = new ResizeObserver(entries => {
    entries.forEach(entry => {
        entry.target.classList.toggle('narrow', entry.contentRect.width < 400);
    });
});
```

---

## Chapter 22: Performance Observer

### 22.1 Observing Performance Entries
```javascript
const observer = new PerformanceObserver((list) => {
    list.getEntries().forEach(entry => {
        console.log(entry.name, entry.duration);
    });
});

observer.observe({ 
    type: 'measure',        // Entry type
    buffered: true          // Include past entries
});
```

### 22.2 Entry Types
```javascript
'navigation'        // Page load timing
'resource'          // Resource loading (scripts, images)
'mark'              // Custom marks
'measure'           // Custom measures
'paint'             // First Paint, First Contentful Paint
'largest-contentful-paint'
'first-input'       // First Input Delay
'layout-shift'      // Cumulative Layout Shift
'longtask'          // Tasks > 50ms
```

### 22.3 Creating Custom Marks & Measures
```javascript
performance.mark('start-task');
// ... do work ...
performance.mark('end-task');

performance.measure('task-duration', 'start-task', 'end-task');

const measures = performance.getEntriesByType('measure');
console.log(measures[0].duration);  // ms

performance.clearMarks();
performance.clearMeasures();
```

---

# PART 7: BROWSER APIs

## Chapter 23: History API

### 23.1 Navigation
```javascript
history.back()              // Go back
history.forward()           // Go forward
history.go(-2)              // Go back 2 pages
history.go(0)               // Refresh
```

### 23.2 State Management
```javascript
// Add new history entry
history.pushState(
    { page: 2 },            // State object
    '',                     // Title (ignored by most browsers)
    '/page/2'               // URL
);

// Replace current entry
history.replaceState({ page: 2 }, '', '/page/2');

// Current state
history.state               // { page: 2 }
history.length              // Number of entries
```

### 23.3 Popstate Event
```javascript
window.addEventListener('popstate', (e) => {
    console.log('State:', e.state);
    // Update UI based on new state
});
```

> ‚ö†Ô∏è **Note**: `pushState` and `replaceState` do NOT trigger `popstate`. It only fires on back/forward navigation.

---

## Chapter 24: Location API

### 24.1 Location Properties
```javascript
// URL: https://user:pass@example.com:8080/path/page?query=1#hash

location.href           // Full URL
location.protocol       // 'https:'
location.host           // 'example.com:8080'
location.hostname       // 'example.com'
location.port           // '8080'
location.pathname       // '/path/page'
location.search         // '?query=1'
location.hash           // '#hash'
location.origin         // 'https://example.com:8080'
```

### 24.2 Navigation Methods
```javascript
location.assign('/new-page')    // Navigate (adds history)
location.replace('/new-page')   // Navigate (no history)
location.reload()               // Reload page
location.reload(true)           // Reload (bypass cache) - deprecated
```

### 24.3 URL API
```javascript
const url = new URL('https://example.com/path?a=1&b=2');

url.searchParams.get('a')           // '1'
url.searchParams.getAll('a')        // ['1']
url.searchParams.has('a')           // true
url.searchParams.set('a', '3')      // Set/replace
url.searchParams.append('c', '3')   // Add
url.searchParams.delete('a')        // Remove
url.searchParams.sort()             // Sort params

url.toString()                      // Full URL string

// Parse current URL params
const params = new URLSearchParams(location.search);
```

---

## Chapter 25: Geolocation API

### 25.1 Getting Position
```javascript
navigator.geolocation.getCurrentPosition(
    (position) => {
        console.log(position.coords.latitude);
        console.log(position.coords.longitude);
        console.log(position.coords.accuracy);  // meters
    },
    (error) => {
        switch(error.code) {
            case error.PERMISSION_DENIED: break;
            case error.POSITION_UNAVAILABLE: break;
            case error.TIMEOUT: break;
        }
    },
    {
        enableHighAccuracy: true,
        timeout: 5000,           // ms
        maximumAge: 0            // Don't use cached position
    }
);
```

### 25.2 Watching Position
```javascript
const watchId = navigator.geolocation.watchPosition(
    (position) => { /* update UI */ },
    (error) => { /* handle error */ },
    { enableHighAccuracy: true }
);

// Stop watching
navigator.geolocation.clearWatch(watchId);
```

### 25.3 Position Object
```javascript
position.coords.latitude         // Degrees
position.coords.longitude        // Degrees
position.coords.accuracy         // Meters
position.coords.altitude         // Meters (may be null)
position.coords.altitudeAccuracy // Meters (may be null)
position.coords.heading          // Degrees from north (may be null)
position.coords.speed            // m/s (may be null)
position.timestamp               // Time of reading
```

---

## Chapter 26: Notifications API

### 26.1 Requesting Permission
```javascript
const permission = await Notification.requestPermission();
// 'granted', 'denied', or 'default'
```

### 26.2 Creating Notifications
```javascript
if (Notification.permission === 'granted') {
    const notification = new Notification('Title', {
        body: 'Message body',
        icon: '/icon.png',
        badge: '/badge.png',
        image: '/image.png',
        tag: 'unique-tag',      // Replace existing with same tag
        renotify: true,         // Vibrate/sound even if replacing
        requireInteraction: true, // Don't auto-close
        silent: false,
        data: { url: '/page' }  // Custom data
    });
    
    notification.onclick = (e) => {
        window.focus();
        notification.close();
    };
    
    notification.onclose = (e) => {};
    notification.onerror = (e) => {};
}
```

---

## Chapter 27: Clipboard API

### 27.1 Modern Async API
```javascript
// Write text
await navigator.clipboard.writeText('Copied text');

// Read text
const text = await navigator.clipboard.readText();

// Write rich content
const blob = new Blob(['<b>HTML</b>'], { type: 'text/html' });
await navigator.clipboard.write([
    new ClipboardItem({
        'text/html': blob,
        'text/plain': new Blob(['Plain text'], { type: 'text/plain' })
    })
]);

// Read rich content
const items = await navigator.clipboard.read();
for (const item of items) {
    for (const type of item.types) {
        const blob = await item.getType(type);
        console.log(type, await blob.text());
    }
}
```

### 27.2 Legacy API
```javascript
// Copy (requires user gesture)
document.execCommand('copy');

// Paste
document.execCommand('paste');  // Usually blocked
```

---

## Chapter 28: File APIs

### 28.1 File Input
```javascript
const input = document.querySelector('input[type="file"]');

input.addEventListener('change', (e) => {
    const files = e.target.files;  // FileList
    
    for (const file of files) {
        console.log(file.name);
        console.log(file.size);     // Bytes
        console.log(file.type);     // MIME type
        console.log(file.lastModified);  // Timestamp
    }
});
```

### 28.2 FileReader
```javascript
const reader = new FileReader();

reader.onload = (e) => {
    console.log(e.target.result);
};

reader.onerror = (e) => {
    console.error(e.target.error);
};

reader.onprogress = (e) => {
    console.log(e.loaded / e.total * 100 + '%');
};

reader.readAsText(file);            // String
reader.readAsDataURL(file);         // Base64 data URL
reader.readAsArrayBuffer(file);     // ArrayBuffer
reader.readAsBinaryString(file);    // Binary string (deprecated)

reader.abort();                     // Cancel reading
```

### 28.3 Blob API
```javascript
// Create Blob
const blob = new Blob(['Hello World'], { type: 'text/plain' });
const blob2 = new Blob([arrayBuffer], { type: 'image/png' });

// Blob properties
blob.size                   // Bytes
blob.type                   // MIME type

// Read Blob
const text = await blob.text();
const buffer = await blob.arrayBuffer();
const stream = blob.stream();

// Slice Blob
const chunk = blob.slice(0, 100, 'text/plain');

// Create URL
const url = URL.createObjectURL(blob);
URL.revokeObjectURL(url);   // Clean up when done
```

### 28.4 File System Access API (Modern)
```javascript
// Open file picker
const [handle] = await window.showOpenFilePicker({
    types: [{
        description: 'Text files',
        accept: { 'text/plain': ['.txt'] }
    }],
    multiple: false
});

const file = await handle.getFile();
const contents = await file.text();

// Save file picker
const newHandle = await window.showSaveFilePicker({
    suggestedName: 'document.txt'
});
const writable = await newHandle.createWritable();
await writable.write('Content');
await writable.close();
```

---

## Chapter 29: Drag and Drop API

### 29.1 Making Elements Draggable
```html
<div draggable="true">Drag me</div>
```

### 29.2 Drag Events
```javascript
// On draggable element
element.addEventListener('dragstart', (e) => {
    e.dataTransfer.setData('text/plain', e.target.id);
    e.dataTransfer.effectAllowed = 'move';
});

element.addEventListener('dragend', (e) => {
    // Drag operation ended
});

// On drop zone
dropZone.addEventListener('dragenter', (e) => {
    dropZone.classList.add('drag-over');
});

dropZone.addEventListener('dragover', (e) => {
    e.preventDefault();  // REQUIRED to allow drop
    e.dataTransfer.dropEffect = 'move';
});

dropZone.addEventListener('dragleave', (e) => {
    dropZone.classList.remove('drag-over');
});

dropZone.addEventListener('drop', (e) => {
    e.preventDefault();
    const id = e.dataTransfer.getData('text/plain');
    const element = document.getElementById(id);
    dropZone.appendChild(element);
});
```

### 29.3 DataTransfer Object
```javascript
e.dataTransfer.setData(format, data)    // Set data
e.dataTransfer.getData(format)          // Get data
e.dataTransfer.clearData(format?)       // Clear data
e.dataTransfer.types                    // Available formats
e.dataTransfer.files                    // Dropped files
e.dataTransfer.items                    // DataTransferItemList
e.dataTransfer.effectAllowed            // 'none', 'copy', 'move', 'link', 'all'
e.dataTransfer.dropEffect               // Visual feedback type
e.dataTransfer.setDragImage(img, x, y)  // Custom drag image
```

---

## Chapter 30: Canvas API

### 30.1 Getting Context
```javascript
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

// Resize canvas
canvas.width = 800;
canvas.height = 600;
```

### 30.2 Drawing Shapes
```javascript
// Rectangle
ctx.fillRect(x, y, width, height);
ctx.strokeRect(x, y, width, height);
ctx.clearRect(x, y, width, height);

// Path
ctx.beginPath();
ctx.moveTo(x, y);
ctx.lineTo(x, y);
ctx.arc(x, y, radius, startAngle, endAngle, counterclockwise?);
ctx.arcTo(x1, y1, x2, y2, radius);
ctx.quadraticCurveTo(cpx, cpy, x, y);
ctx.bezierCurveTo(cp1x, cp1y, cp2x, cp2y, x, y);
ctx.closePath();
ctx.fill();
ctx.stroke();
```

### 30.3 Styling
```javascript
ctx.fillStyle = 'red';              // Color, gradient, or pattern
ctx.strokeStyle = '#00ff00';
ctx.lineWidth = 5;
ctx.lineCap = 'round';              // butt, round, square
ctx.lineJoin = 'round';             // miter, round, bevel
ctx.setLineDash([5, 10]);           // Dashed line
ctx.globalAlpha = 0.5;              // Transparency
ctx.globalCompositeOperation = 'multiply';  // Blend mode
```

### 30.4 Text
```javascript
ctx.font = '48px serif';
ctx.textAlign = 'center';           // left, right, center, start, end
ctx.textBaseline = 'middle';        // top, hanging, middle, alphabetic, bottom
ctx.fillText('Hello', x, y, maxWidth?);
ctx.strokeText('Hello', x, y, maxWidth?);
const metrics = ctx.measureText('Hello');
```

### 30.5 Images
```javascript
ctx.drawImage(image, dx, dy);
ctx.drawImage(image, dx, dy, dWidth, dHeight);
ctx.drawImage(image, sx, sy, sWidth, sHeight, dx, dy, dWidth, dHeight);

// Image data
const imageData = ctx.getImageData(x, y, width, height);
imageData.data  // Uint8ClampedArray [r, g, b, a, r, g, b, a, ...]
ctx.putImageData(imageData, x, y);
ctx.createImageData(width, height);
```

### 30.6 Transformations
```javascript
ctx.translate(x, y);
ctx.rotate(angle);                  // Radians
ctx.scale(x, y);
ctx.transform(a, b, c, d, e, f);    // Matrix
ctx.setTransform(a, b, c, d, e, f); // Reset then transform
ctx.resetTransform();

// Save/restore state
ctx.save();
// ... transformations ...
ctx.restore();
```

### 30.7 Export
```javascript
canvas.toDataURL('image/png');
canvas.toDataURL('image/jpeg', quality);
canvas.toBlob(callback, type, quality);
```

---

## Chapter 31: Web Workers

### 31.1 Creating Worker
```javascript
// main.js
const worker = new Worker('worker.js');

worker.postMessage({ type: 'start', data: [1, 2, 3] });

worker.onmessage = (e) => {
    console.log('Result:', e.data);
};

worker.onerror = (e) => {
    console.error('Error:', e.message);
};

worker.terminate();  // Stop worker
```

```javascript
// worker.js
self.onmessage = (e) => {
    const { type, data } = e.data;
    
    if (type === 'start') {
        const result = heavyComputation(data);
        self.postMessage(result);
    }
};

self.close();  // Self-terminate
```

### 31.2 Transferable Objects
```javascript
// Transfer ownership (faster, but original becomes unusable)
const buffer = new ArrayBuffer(1024);
worker.postMessage({ buffer }, [buffer]);
// buffer.byteLength === 0 now!
```

### 31.3 Shared Workers
```javascript
// Shared across tabs/frames
const shared = new SharedWorker('shared-worker.js');
shared.port.start();
shared.port.postMessage('Hello');
shared.port.onmessage = (e) => console.log(e.data);
```

### 31.4 Inline Workers
```javascript
const code = `
    self.onmessage = (e) => {
        self.postMessage(e.data * 2);
    };
`;
const blob = new Blob([code], { type: 'application/javascript' });
const worker = new Worker(URL.createObjectURL(blob));
```

---

## Chapter 32: Service Workers

### 32.1 Registration
```javascript
if ('serviceWorker' in navigator) {
    const registration = await navigator.serviceWorker.register('/sw.js', {
        scope: '/'
    });
    
    console.log('Scope:', registration.scope);
}
```

### 32.2 Service Worker Lifecycle
```javascript
// sw.js
const CACHE_NAME = 'v1';

// Install - cache assets
self.addEventListener('install', (e) => {
    e.waitUntil(
        caches.open(CACHE_NAME).then(cache => 
            cache.addAll(['/index.html', '/app.js', '/style.css'])
        )
    );
    self.skipWaiting();  // Activate immediately
});

// Activate - cleanup old caches
self.addEventListener('activate', (e) => {
    e.waitUntil(
        caches.keys().then(names => 
            Promise.all(
                names.filter(n => n !== CACHE_NAME).map(n => caches.delete(n))
            )
        )
    );
    self.clients.claim();  // Take control immediately
});

// Fetch - serve from cache
self.addEventListener('fetch', (e) => {
    e.respondWith(
        caches.match(e.request).then(cached => 
            cached || fetch(e.request)
        )
    );
});
```

### 32.3 Cache Strategies
```javascript
// Cache First
caches.match(request).then(r => r || fetch(request));

// Network First
fetch(request).catch(() => caches.match(request));

// Stale While Revalidate
caches.match(request).then(cached => {
    const fresh = fetch(request).then(response => {
        caches.open(CACHE_NAME).then(cache => cache.put(request, response.clone()));
        return response;
    });
    return cached || fresh;
});
```

### 32.4 Push Notifications
```javascript
// main.js
const subscription = await registration.pushManager.subscribe({
    userVisibleOnly: true,
    applicationServerKey: urlBase64ToUint8Array(VAPID_PUBLIC_KEY)
});

// sw.js
self.addEventListener('push', (e) => {
    const data = e.data.json();
    e.waitUntil(
        self.registration.showNotification(data.title, {
            body: data.body,
            icon: '/icon.png'
        })
    );
});

self.addEventListener('notificationclick', (e) => {
    e.notification.close();
    e.waitUntil(clients.openWindow('/'));
});
```

---

## Chapter 33: Web Animations API

### 33.1 Basic Animation
```javascript
const animation = element.animate([
    { transform: 'translateX(0)', opacity: 1 },
    { transform: 'translateX(100px)', opacity: 0 }
], {
    duration: 1000,
    easing: 'ease-in-out',
    iterations: Infinity,       // or number
    direction: 'alternate',     // normal, reverse, alternate, alternate-reverse
    fill: 'forwards',           // none, forwards, backwards, both
    delay: 100
});
```

### 33.2 Animation Control
```javascript
animation.play();
animation.pause();
animation.reverse();
animation.finish();
animation.cancel();

animation.playbackRate = 2;     // Speed multiplier
animation.currentTime = 500;    // Seek to 500ms

animation.onfinish = () => {};
animation.oncancel = () => {};

await animation.finished;       // Promise
```

### 33.3 KeyframeEffect
```javascript
const effect = new KeyframeEffect(element, [
    { opacity: 0 },
    { opacity: 1 }
], { duration: 500 });

const animation = new Animation(effect, document.timeline);
animation.play();
```

---

# PART 8: ADVANCED TOPICS

## Chapter 34: Shadow DOM

### 34.1 Creating Shadow DOM
```javascript
const shadow = element.attachShadow({ 
    mode: 'open'    // or 'closed'
});

shadow.innerHTML = `
    <style>
        :host { display: block; }
        ::slotted(p) { color: red; }
    </style>
    <slot></slot>
`;
```

### 34.2 Shadow DOM Concepts
- **Encapsulation**: Styles and DOM isolated
- **Slots**: Placeholders for light DOM content
- `:host` - Shadow host selector
- `::slotted()` - Slotted content selector
- `::part()` - Exposed part selector

### 34.3 Event Retargeting
```javascript
// Events from shadow DOM appear to come from host
element.addEventListener('click', (e) => {
    e.target          // Host element (retargeted)
    e.composedPath()  // Full path including shadow DOM
});
```

---

## Chapter 35: Custom Elements

### 35.1 Defining Custom Element
```javascript
class MyElement extends HTMLElement {
    static observedAttributes = ['disabled', 'value'];
    
    constructor() {
        super();
        this.attachShadow({ mode: 'open' });
    }
    
    connectedCallback() {
        // Added to DOM
        this.render();
    }
    
    disconnectedCallback() {
        // Removed from DOM
    }
    
    adoptedCallback() {
        // Moved to new document
    }
    
    attributeChangedCallback(name, oldValue, newValue) {
        // Observed attribute changed
        this.render();
    }
    
    render() {
        this.shadowRoot.innerHTML = `<slot></slot>`;
    }
}

customElements.define('my-element', MyElement);
```

### 35.2 Extending Built-in Elements
```javascript
class FancyButton extends HTMLButtonElement {
    connectedCallback() {
        this.classList.add('fancy');
    }
}

customElements.define('fancy-button', FancyButton, { extends: 'button' });

// Usage: <button is="fancy-button">Click</button>
```

### 35.3 Custom Element Lifecycle
1. `constructor()` - Created (avoid DOM here)
2. `connectedCallback()` - Added to document
3. `attributeChangedCallback()` - Attribute changed
4. `disconnectedCallback()` - Removed from document
5. `adoptedCallback()` - Moved to new document

---

## Chapter 36: Template & Content Elements

### 36.1 Template Element
```javascript
const template = document.getElementById('my-template');
const clone = template.content.cloneNode(true);

// Modify clone
clone.querySelector('.title').textContent = 'Hello';

// Insert
container.appendChild(clone);
```

### 36.2 Slot Element
```html
<!-- Custom element with slots -->
<template id="card-template">
    <style>/* scoped styles */</style>
    <header>
        <slot name="title">Default Title</slot>
    </header>
    <main>
        <slot>Default content</slot>
    </main>
</template>

<!-- Usage -->
<my-card>
    <span slot="title">Card Title</span>
    <p>Card content goes here</p>
</my-card>
```

---

## Chapter 37: Ranges & Selections

### 37.1 Selection API
```javascript
const selection = window.getSelection();

selection.toString()             // Selected text
selection.rangeCount             // Number of ranges
selection.getRangeAt(0)          // Get Range object
selection.collapse(node, offset) // Collapse to point
selection.extend(node, offset)   // Extend selection
selection.selectAllChildren(node)
selection.removeAllRanges()
selection.addRange(range)
```

### 37.2 Range API
```javascript
const range = document.createRange();

range.setStart(node, offset);
range.setEnd(node, offset);
range.selectNode(node);
range.selectNodeContents(node);
range.collapse(toStart?);

range.commonAncestorContainer    // Common parent
range.startContainer / endContainer
range.startOffset / endOffset
range.collapsed                  // Is it collapsed?

const fragment = range.extractContents();  // Remove & return
range.deleteContents();
range.insertNode(node);
range.surroundContents(wrapper);           // Wrap selection
const clone = range.cloneContents();
```

---

## Chapter 38: Fullscreen API

### 38.1 Entering Fullscreen
```javascript
await element.requestFullscreen({
    navigationUI: 'hide'  // or 'show'
});

// With vendor prefixes (legacy)
element.webkitRequestFullscreen?.();
element.mozRequestFullScreen?.();
```

### 38.2 Exiting Fullscreen
```javascript
await document.exitFullscreen();
```

### 38.3 Fullscreen State
```javascript
document.fullscreenElement      // Currently fullscreen element
document.fullscreenEnabled      // Fullscreen available?

document.addEventListener('fullscreenchange', () => {
    if (document.fullscreenElement) {
        console.log('Entered fullscreen');
    } else {
        console.log('Exited fullscreen');
    }
});

document.addEventListener('fullscreenerror', () => {
    console.error('Fullscreen failed');
});
```

---

## Chapter 39: Page Visibility API

### 39.1 Checking Visibility
```javascript
document.visibilityState    // 'visible', 'hidden'
document.hidden             // Boolean

document.addEventListener('visibilitychange', () => {
    if (document.hidden) {
        // Pause videos, animations, polling
    } else {
        // Resume
    }
});
```

---

## Chapter 40: Performance APIs

### 40.1 Navigation Timing
```javascript
const timing = performance.getEntriesByType('navigation')[0];

timing.domContentLoadedEventEnd - timing.startTime  // DOMContentLoaded
timing.loadEventEnd - timing.startTime              // Load complete
timing.domInteractive - timing.startTime            // DOM ready
timing.responseEnd - timing.requestStart            // Server response time
timing.domComplete - timing.domInteractive          // DOM processing time
```

### 40.2 Resource Timing
```javascript
const resources = performance.getEntriesByType('resource');

resources.forEach(r => {
    console.log(r.name, r.duration, r.transferSize);
});
```

### 40.3 Core Web Vitals
```javascript
// Largest Contentful Paint
new PerformanceObserver((list) => {
    const entries = list.getEntries();
    const lcp = entries[entries.length - 1];
    console.log('LCP:', lcp.startTime);
}).observe({ type: 'largest-contentful-paint', buffered: true });

// First Input Delay
new PerformanceObserver((list) => {
    const entry = list.getEntries()[0];
    console.log('FID:', entry.processingStart - entry.startTime);
}).observe({ type: 'first-input', buffered: true });

// Cumulative Layout Shift
let cls = 0;
new PerformanceObserver((list) => {
    for (const entry of list.getEntries()) {
        if (!entry.hadRecentInput) {
            cls += entry.value;
        }
    }
    console.log('CLS:', cls);
}).observe({ type: 'layout-shift', buffered: true });
```

### 40.4 Memory API
```javascript
if (performance.memory) {
    performance.memory.usedJSHeapSize     // Current usage
    performance.memory.totalJSHeapSize    // Allocated
    performance.memory.jsHeapSizeLimit    // Maximum
}
```

---

## Chapter 41: Device APIs

### 41.1 Device Orientation
```javascript
window.addEventListener('deviceorientation', (e) => {
    e.alpha     // Z-axis rotation (0-360)
    e.beta      // X-axis rotation (-180 to 180)
    e.gamma     // Y-axis rotation (-90 to 90)
    e.absolute  // Absolute orientation?
});
```

### 41.2 Device Motion
```javascript
window.addEventListener('devicemotion', (e) => {
    e.acceleration              // { x, y, z } m/s¬≤
    e.accelerationIncludingGravity
    e.rotationRate              // { alpha, beta, gamma } deg/s
    e.interval                  // ms between events
});
```

### 41.3 Battery Status
```javascript
const battery = await navigator.getBattery();

battery.level               // 0.0 to 1.0
battery.charging            // Boolean
battery.chargingTime        // Seconds (or Infinity)
battery.dischargingTime     // Seconds (or Infinity)

battery.addEventListener('levelchange', () => {});
battery.addEventListener('chargingchange', () => {});
```

### 41.4 Network Information
```javascript
const connection = navigator.connection;

connection.effectiveType    // '4g', '3g', '2g', 'slow-2g'
connection.downlink         // Mbps estimate
connection.rtt              // Round-trip time ms
connection.saveData         // Data saver enabled?

connection.addEventListener('change', () => {});
```

### 41.5 Vibration API
```javascript
navigator.vibrate(200);                  // 200ms vibration
navigator.vibrate([200, 100, 200]);      // Pattern: vibrate, pause, vibrate
navigator.vibrate(0);                    // Stop
```

---

# PART 9: INTERVIEW ESSENTIALS

## Chapter 42: Critical Concepts Summary

### 42.1 DOM Reflow vs Repaint

| Reflow (Layout) | Repaint |
|-----------------|---------|
| Recalculates geometry | Redraws pixels |
| More expensive | Less expensive |
| Triggered by size/position changes | Triggered by visual changes |

**Triggers Reflow:**
- Adding/removing elements
- Changing size, position, margin, padding
- Changing font, text
- Reading layout properties (`offsetWidth`, `scrollTop`, etc.)
- Window resize

**Minimize Reflows:**
- Batch DOM changes
- Use `DocumentFragment`
- Avoid layout thrashing (read then write)
- Use `transform` instead of `top/left`
- Use `will-change` for animations

### 42.2 Event Loop & DOM

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         Call Stack              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ       Microtask Queue           ‚îÇ  ‚Üê Promises, queueMicrotask
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         Render Steps            ‚îÇ  ‚Üê RAF, Style, Layout, Paint
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ        Task Queue               ‚îÇ  ‚Üê setTimeout, events
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 42.3 requestAnimationFrame
```javascript
function animate() {
    // Update animation
    element.style.transform = `translateX(${x}px)`;
    
    requestAnimationFrame(animate);
}

requestAnimationFrame(animate);  // Start

// Cancel
const id = requestAnimationFrame(callback);
cancelAnimationFrame(id);
```

> üîë **Always use RAF for animations** ‚Äî syncs with display refresh rate, pauses when tab hidden.

### 42.4 Debounce vs Throttle
```javascript
// Debounce - execute after delay with no calls
function debounce(fn, delay) {
    let timeout;
    return (...args) => {
        clearTimeout(timeout);
        timeout = setTimeout(() => fn(...args), delay);
    };
}

// Throttle - execute at most once per interval
function throttle(fn, interval) {
    let last = 0;
    return (...args) => {
        const now = Date.now();
        if (now - last >= interval) {
            last = now;
            fn(...args);
        }
    };
}
```

### 42.5 Virtual DOM Concept
```javascript
// Simplified virtual DOM diff
function diff(oldVNode, newVNode) {
    if (oldVNode.tag !== newVNode.tag) {
        return { type: 'REPLACE', node: newVNode };
    }
    
    if (oldVNode.text !== newVNode.text) {
        return { type: 'TEXT', text: newVNode.text };
    }
    
    const patches = [];
    // Compare attributes, children...
    return patches;
}
```

---

## Chapter 43: Common Interview Questions

### 43.1 Event Delegation
Q: How would you handle clicks on 1000 list items?

```javascript
// DON'T: Add 1000 listeners
items.forEach(item => item.addEventListener('click', handler));

// DO: Single delegated listener
list.addEventListener('click', (e) => {
    const item = e.target.closest('.item');
    if (item && list.contains(item)) {
        handleItemClick(item);
    }
});
```

### 43.2 Detect Element in Viewport
```javascript
// Using IntersectionObserver (recommended)
const observer = new IntersectionObserver((entries) => {
    entries.forEach(e => console.log(e.target, e.isIntersecting));
});

// Using getBoundingClientRect
function isInViewport(el) {
    const rect = el.getBoundingClientRect();
    return (
        rect.top >= 0 &&
        rect.left >= 0 &&
        rect.bottom <= window.innerHeight &&
        rect.right <= window.innerWidth
    );
}
```

### 43.3 Implement Infinite Scroll
```javascript
const sentinel = document.querySelector('.sentinel');

const observer = new IntersectionObserver(async (entries) => {
    if (entries[0].isIntersecting) {
        await loadMoreItems();
    }
}, { rootMargin: '100px' });

observer.observe(sentinel);
```

### 43.4 Copy to Clipboard
```javascript
async function copyToClipboard(text) {
    try {
        await navigator.clipboard.writeText(text);
    } catch {
        // Fallback
        const textarea = document.createElement('textarea');
        textarea.value = text;
        textarea.style.position = 'fixed';
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
    }
}
```

### 43.5 Smooth Scroll
```javascript
// To element
element.scrollIntoView({ behavior: 'smooth', block: 'center' });

// To position
window.scrollTo({ top: 0, behavior: 'smooth' });

// Scroll container
container.scrollTo({ top: 100, behavior: 'smooth' });
```

### 43.6 Get Absolute Position
```javascript
function getAbsolutePosition(element) {
    const rect = element.getBoundingClientRect();
    return {
        top: rect.top + window.scrollY,
        left: rect.left + window.scrollX,
        bottom: rect.bottom + window.scrollY,
        right: rect.right + window.scrollX
    };
}
```

### 43.7 Check if Element is Hidden
```javascript
function isHidden(element) {
    return (
        element.offsetParent === null ||
        getComputedStyle(element).display === 'none' ||
        getComputedStyle(element).visibility === 'hidden' ||
        element.hidden
    );
}
```

### 43.8 Wait for Element to Exist
```javascript
function waitForElement(selector, timeout = 5000) {
    return new Promise((resolve, reject) => {
        const element = document.querySelector(selector);
        if (element) return resolve(element);
        
        const observer = new MutationObserver((_, obs) => {
            const el = document.querySelector(selector);
            if (el) {
                obs.disconnect();
                resolve(el);
            }
        });
        
        observer.observe(document.body, { childList: true, subtree: true });
        
        setTimeout(() => {
            observer.disconnect();
            reject(new Error('Timeout'));
        }, timeout);
    });
}
```

---

## Chapter 44: Security Best Practices

### 44.1 XSS Prevention
```javascript
// NEVER do this
element.innerHTML = userInput;  // XSS vulnerability!

// DO this instead
element.textContent = userInput;  // Safe

// Or sanitize
function sanitize(html) {
    const div = document.createElement('div');
    div.textContent = html;
    return div.innerHTML;
}
```

### 44.2 Content Security Policy
```html
<meta http-equiv="Content-Security-Policy" 
      content="default-src 'self'; script-src 'self' 'nonce-random123'">
```

### 44.3 Safe HTML Parsing
```javascript
// Using DOMParser (doesn't execute scripts)
const parser = new DOMParser();
const doc = parser.parseFromString(html, 'text/html');

// Using sanitization library
import DOMPurify from 'dompurify';
element.innerHTML = DOMPurify.sanitize(userInput);
```

---

## Chapter 45: Production Patterns

### 45.1 DOM Ready Patterns
```javascript
// Modern
document.addEventListener('DOMContentLoaded', init);

// Or check if already loaded
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
} else {
    init();
}
```

### 45.2 Lazy Loading Pattern
```javascript
// Native lazy loading
<img src="image.jpg" loading="lazy">

// Intersection Observer
const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
        if (entry.isIntersecting) {
            const img = entry.target;
            img.src = img.dataset.src;
            observer.unobserve(img);
        }
    });
}, { rootMargin: '50px' });

document.querySelectorAll('img[data-src]').forEach(img => observer.observe(img));
```

### 45.3 Cleanup Pattern
```javascript
class Component {
    constructor() {
        this.controller = new AbortController();
        this.init();
    }
    
    init() {
        document.addEventListener('click', this.handleClick, {
            signal: this.controller.signal
        });
    }
    
    destroy() {
        this.controller.abort();  // Removes all listeners
    }
}
```

### 45.4 Delegation Pattern
```javascript
class DataTable {
    constructor(element) {
        this.element = element;
        this.element.addEventListener('click', this.handleClick.bind(this));
    }
    
    handleClick(e) {
        const action = e.target.closest('[data-action]');
        if (!action) return;
        
        const method = action.dataset.action;
        const row = action.closest('tr');
        const id = row?.dataset.id;
        
        this[method]?.(id);
    }
    
    edit(id) { /* ... */ }
    delete(id) { /* ... */ }
}
```

---

# Quick Reference Card

## Essential Methods
```javascript
// Selection
document.querySelector(sel)
document.querySelectorAll(sel)
element.closest(sel)
element.matches(sel)

// Manipulation
element.append/prepend/before/after/remove()
element.cloneNode(deep)
element.insertAdjacentHTML(position, html)

// Attributes
element.getAttribute/setAttribute/removeAttribute/toggleAttribute()
element.dataset.key
element.classList.add/remove/toggle/contains()

// Events
element.addEventListener(type, handler, options)
element.removeEventListener(type, handler)
event.preventDefault/stopPropagation()

// Traversal
element.parentElement/children/firstElementChild/lastElementChild
element.previousElementSibling/nextElementSibling

// Dimensions
element.getBoundingClientRect()
element.offsetWidth/offsetHeight/offsetTop/offsetLeft
element.scrollWidth/scrollHeight/scrollTop/scrollLeft
window.innerWidth/innerHeight
```

## Must-Know APIs
- Intersection Observer ‚Äî visibility detection
- Mutation Observer ‚Äî DOM change detection
- Resize Observer ‚Äî element size changes
- Performance Observer ‚Äî performance metrics
- Fetch API ‚Äî network requests
- Web Storage ‚Äî localStorage/sessionStorage
- IndexedDB ‚Äî client-side database
- Service Workers ‚Äî offline/caching
- Web Workers ‚Äî background threads
- History API ‚Äî SPA navigation
- Clipboard API ‚Äî copy/paste

---

*This guide covers 95%+ of what you'll encounter in DOM-related interviews and production code.*
