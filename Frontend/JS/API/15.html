<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chapter 15: Fetch API</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.95;
        }
        
        .content {
            padding: 40px;
        }
        
        .section {
            margin-bottom: 40px;
        }
        
        h2 {
            color: #38f9d7;
            font-size: 2em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #38f9d7;
        }
        
        h3 {
            color: #43e97b;
            font-size: 1.5em;
            margin: 30px 0 15px 0;
        }
        
        .concept-box {
            background: #f8f9fa;
            border-left: 4px solid #38f9d7;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }
        
        .key-point {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        
        .warning-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        
        .info-box {
            background: #cfe2ff;
            border-left: 4px solid #0d6efd;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        
        .code-block {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .code-block .comment {
            color: #6272a4;
        }
        
        .code-block .keyword {
            color: #ff79c6;
        }
        
        .code-block .string {
            color: #f1fa8c;
        }
        
        .code-block .function {
            color: #50fa7b;
        }
        
        .code-block .number {
            color: #bd93f9;
        }
        
        .visual-diagram {
            background: #f8f9fa;
            border: 2px solid #38f9d7;
            border-radius: 10px;
            padding: 30px;
            margin: 30px 0;
        }
        
        .fetch-flow {
            display: flex;
            justify-content: space-around;
            align-items: center;
            flex-wrap: wrap;
            margin: 20px 0;
        }
        
        .flow-box {
            background: white;
            border: 2px solid #38f9d7;
            border-radius: 10px;
            padding: 20px;
            margin: 10px;
            min-width: 150px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .flow-arrow {
            font-size: 30px;
            color: #38f9d7;
        }
        
        .method-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .method-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #38f9d7;
            transition: transform 0.3s;
        }
        
        .method-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .method-card h4 {
            color: #38f9d7;
            margin-bottom: 10px;
            font-size: 1.3em;
        }
        
        .demo-section {
            background: #e0f9f4;
            padding: 30px;
            border-radius: 10px;
            margin: 30px 0;
        }
        
        .demo-controls {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        button {
            background: #38f9d7;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
            font-weight: 600;
        }
        
        button:hover {
            background: #43e97b;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        input, select, textarea {
            padding: 10px;
            border: 2px solid #38f9d7;
            border-radius: 5px;
            font-size: 16px;
            flex: 1;
            min-width: 150px;
        }
        
        textarea {
            min-height: 80px;
            font-family: 'Courier New', monospace;
        }
        
        .output {
            background: white;
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
            min-height: 50px;
            border: 2px solid #38f9d7;
            max-height: 400px;
            overflow-y: auto;
        }
        
        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            color: #d63384;
        }
        
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .comparison-table th {
            background: #38f9d7;
            color: white;
            padding: 15px;
            text-align: left;
        }
        
        .comparison-table td {
            padding: 15px;
            border-bottom: 1px solid #ddd;
        }
        
        .comparison-table tr:hover {
            background: #f8f9fa;
        }
        
        .option-card {
            background: white;
            border: 2px solid #38f9d7;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
        }
        
        .option-card h4 {
            color: #38f9d7;
            margin-bottom: 10px;
        }
        
        .property-list {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .property-list dt {
            font-weight: bold;
            color: #38f9d7;
            margin-top: 10px;
        }
        
        .property-list dd {
            margin-left: 20px;
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåê Chapter 15: Fetch API</h1>
            <p>Modern HTTP Requests in JavaScript</p>
        </div>
        
        <div class="content">
            
            <!-- Introduction -->
            <div class="section">
                <h2>üéØ What is the Fetch API?</h2>
                
                <div class="concept-box">
                    <p><strong>Fetch API</strong> is the modern, Promise-based interface for making HTTP requests in JavaScript. It replaces the older XMLHttpRequest with a cleaner, more powerful API.</p>
                    
                    <p style="margin-top: 15px;"><strong>Key Features:</strong></p>
                    <ul style="margin-left: 25px; margin-top: 10px;">
                        <li>üéØ <strong>Promise-Based:</strong> Clean async/await syntax</li>
                        <li>üîß <strong>Flexible:</strong> Supports all HTTP methods</li>
                        <li>üì¶ <strong>Streaming:</strong> Can process response progressively</li>
                        <li>üåê <strong>CORS-Aware:</strong> Built-in cross-origin support</li>
                        <li>‚ö° <strong>Modern:</strong> Works with Service Workers</li>
                        <li>üé® <strong>Intuitive:</strong> Simple, consistent API</li>
                    </ul>
                </div>
                
                <div class="visual-diagram">
                    <h3>Fetch Request-Response Flow</h3>
                    <div class="fetch-flow">
                        <div class="flow-box">
                            <h4>1. üì§ Request</h4>
                            <p>fetch(url, options)</p>
                        </div>
                        <div class="flow-arrow">‚Üí</div>
                        <div class="flow-box">
                            <h4>2. üåê Network</h4>
                            <p>HTTP Request</p>
                        </div>
                        <div class="flow-arrow">‚Üí</div>
                        <div class="flow-box">
                            <h4>3. üì• Response</h4>
                            <p>Promise resolves</p>
                        </div>
                        <div class="flow-arrow">‚Üí</div>
                        <div class="flow-box">
                            <h4>4. üìä Parse</h4>
                            <p>.json() .text() .blob()</p>
                        </div>
                    </div>
                </div>
                
                <div class="info-box">
                    <strong>üí° Why Use Fetch?</strong>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li>Cleaner syntax than XMLHttpRequest</li>
                        <li>Better error handling</li>
                        <li>Native Promise support</li>
                        <li>Works in Service Workers</li>
                        <li>Streaming response bodies</li>
                        <li>Modern standard supported everywhere</li>
                    </ul>
                </div>
            </div>
            
            <!-- Basic Fetch -->
            <div class="section">
                <h2>üöÄ Basic Fetch Requests</h2>
                
                <h3>Simple GET Request</h3>
                <div class="code-block">
<span class="comment">// Basic GET request</span>
<span class="keyword">const</span> response = <span class="keyword">await</span> <span class="function">fetch</span>(<span class="string">'https://api.example.com/users'</span>);
<span class="keyword">const</span> data = <span class="keyword">await</span> response.<span class="function">json</span>();
console.<span class="function">log</span>(data);

<span class="comment">// With then/catch (Promise style)</span>
<span class="function">fetch</span>(<span class="string">'https://api.example.com/users'</span>)
    .<span class="function">then</span>(response => response.<span class="function">json</span>())
    .<span class="function">then</span>(data => console.<span class="function">log</span>(data))
    .<span class="function">catch</span>(error => console.<span class="function">error</span>(<span class="string">'Error:'</span>, error));

<span class="comment">// With error handling</span>
<span class="keyword">try</span> {
    <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="function">fetch</span>(<span class="string">'https://api.example.com/users'</span>);
    
    <span class="keyword">if</span> (!response.ok) {
        <span class="keyword">throw new</span> <span class="function">Error</span>(<span class="string">`HTTP error! status: ${response.status}`</span>);
    }
    
    <span class="keyword">const</span> data = <span class="keyword">await</span> response.<span class="function">json</span>();
    console.<span class="function">log</span>(data);
} <span class="keyword">catch</span> (error) {
    console.<span class="function">error</span>(<span class="string">'Fetch error:'</span>, error);
}
                </div>
                
                <div class="warning-box">
                    <strong>‚ö†Ô∏è Critical:</strong> Fetch only rejects on <strong>network errors</strong>. HTTP errors (404, 500, etc.) do NOT reject the promise! Always check <code>response.ok</code> or <code>response.status</code>.
                </div>
                
                <h3>Response Parsing Methods</h3>
                <div class="code-block">
<span class="comment">// JSON data</span>
<span class="keyword">const</span> data = <span class="keyword">await</span> response.<span class="function">json</span>();

<span class="comment">// Plain text</span>
<span class="keyword">const</span> text = <span class="keyword">await</span> response.<span class="function">text</span>();

<span class="comment">// Binary data (images, files)</span>
<span class="keyword">const</span> blob = <span class="keyword">await</span> response.<span class="function">blob</span>();

<span class="comment">// ArrayBuffer (for binary processing)</span>
<span class="keyword">const</span> buffer = <span class="keyword">await</span> response.<span class="function">arrayBuffer</span>();

<span class="comment">// FormData</span>
<span class="keyword">const</span> formData = <span class="keyword">await</span> response.<span class="function">formData</span>();

<span class="comment">// WARNING: Can only parse body ONCE!</span>
<span class="keyword">const</span> response = <span class="keyword">await</span> <span class="function">fetch</span>(url);
<span class="keyword">const</span> data1 = <span class="keyword">await</span> response.<span class="function">json</span>(); <span class="comment">// ‚úì Works</span>
<span class="keyword">const</span> data2 = <span class="keyword">await</span> response.<span class="function">json</span>(); <span class="comment">// ‚úó Error! Body already read</span>
                </div>
            </div>
            
            <!-- Request Options -->
            <div class="section">
                <h2>‚öôÔ∏è Request Options</h2>
                
                <div class="concept-box">
                    <p>The second parameter to <code>fetch()</code> is an options object that configures the request.</p>
                </div>
                
                <h3>HTTP Methods</h3>
                <div class="code-block">
<span class="comment">// POST request</span>
<span class="keyword">const</span> response = <span class="keyword">await</span> <span class="function">fetch</span>(<span class="string">'https://api.example.com/users'</span>, {
    method: <span class="string">'POST'</span>,
    headers: {
        <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span>
    },
    body: JSON.<span class="function">stringify</span>({
        name: <span class="string">'John Doe'</span>,
        email: <span class="string">'john@example.com'</span>
    })
});

<span class="comment">// PUT request (update)</span>
<span class="keyword">const</span> response = <span class="keyword">await</span> <span class="function">fetch</span>(<span class="string">'https://api.example.com/users/123'</span>, {
    method: <span class="string">'PUT'</span>,
    headers: {
        <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span>
    },
    body: JSON.<span class="function">stringify</span>({ name: <span class="string">'Jane Doe'</span> })
});

<span class="comment">// DELETE request</span>
<span class="keyword">const</span> response = <span class="keyword">await</span> <span class="function">fetch</span>(<span class="string">'https://api.example.com/users/123'</span>, {
    method: <span class="string">'DELETE'</span>
});

<span class="comment">// PATCH request (partial update)</span>
<span class="keyword">const</span> response = <span class="keyword">await</span> <span class="function">fetch</span>(<span class="string">'https://api.example.com/users/123'</span>, {
    method: <span class="string">'PATCH'</span>,
    headers: {
        <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span>
    },
    body: JSON.<span class="function">stringify</span>({ email: <span class="string">'newemail@example.com'</span> })
});
                </div>
                
                <h3>Headers</h3>
                <div class="code-block">
<span class="comment">// Setting headers</span>
<span class="keyword">const</span> response = <span class="keyword">await</span> <span class="function">fetch</span>(url, {
    headers: {
        <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span>,
        <span class="string">'Authorization'</span>: <span class="string">'Bearer token123'</span>,
        <span class="string">'X-Custom-Header'</span>: <span class="string">'value'</span>
    }
});

<span class="comment">// Using Headers object</span>
<span class="keyword">const</span> headers = <span class="keyword">new</span> <span class="function">Headers</span>();
headers.<span class="function">append</span>(<span class="string">'Content-Type'</span>, <span class="string">'application/json'</span>);
headers.<span class="function">append</span>(<span class="string">'Authorization'</span>, <span class="string">'Bearer token123'</span>);

<span class="keyword">const</span> response = <span class="keyword">await</span> <span class="function">fetch</span>(url, { headers });

<span class="comment">// Common headers</span>
<span class="keyword">const</span> response = <span class="keyword">await</span> <span class="function">fetch</span>(url, {
    headers: {
        <span class="string">'Accept'</span>: <span class="string">'application/json'</span>,
        <span class="string">'Accept-Language'</span>: <span class="string">'en-US'</span>,
        <span class="string">'User-Agent'</span>: <span class="string">'MyApp/1.0'</span>,
        <span class="string">'X-Requested-With'</span>: <span class="string">'XMLHttpRequest'</span>
    }
});
                </div>
                
                <h3>Request Body</h3>
                <div class="code-block">
<span class="comment">// JSON body</span>
<span class="keyword">const</span> response = <span class="keyword">await</span> <span class="function">fetch</span>(url, {
    method: <span class="string">'POST'</span>,
    headers: { <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span> },
    body: JSON.<span class="function">stringify</span>({ key: <span class="string">'value'</span> })
});

<span class="comment">// Form data</span>
<span class="keyword">const</span> formData = <span class="keyword">new</span> <span class="function">FormData</span>();
formData.<span class="function">append</span>(<span class="string">'name'</span>, <span class="string">'John'</span>);
formData.<span class="function">append</span>(<span class="string">'email'</span>, <span class="string">'john@example.com'</span>);
formData.<span class="function">append</span>(<span class="string">'file'</span>, fileInput.files[<span class="number">0</span>]);

<span class="keyword">const</span> response = <span class="keyword">await</span> <span class="function">fetch</span>(url, {
    method: <span class="string">'POST'</span>,
    body: formData <span class="comment">// Don't set Content-Type header!</span>
});

<span class="comment">// URL-encoded form</span>
<span class="keyword">const</span> params = <span class="keyword">new</span> <span class="function">URLSearchParams</span>();
params.<span class="function">append</span>(<span class="string">'name'</span>, <span class="string">'John'</span>);
params.<span class="function">append</span>(<span class="string">'email'</span>, <span class="string">'john@example.com'</span>);

<span class="keyword">const</span> response = <span class="keyword">await</span> <span class="function">fetch</span>(url, {
    method: <span class="string">'POST'</span>,
    headers: { <span class="string">'Content-Type'</span>: <span class="string">'application/x-www-form-urlencoded'</span> },
    body: params
});

<span class="comment">// Blob/File upload</span>
<span class="keyword">const</span> blob = <span class="keyword">new</span> <span class="function">Blob</span>([<span class="string">'Hello World'</span>], { type: <span class="string">'text/plain'</span> });
<span class="keyword">const</span> response = <span class="keyword">await</span> <span class="function">fetch</span>(url, {
    method: <span class="string">'POST'</span>,
    body: blob
});

<span class="comment">// ArrayBuffer</span>
<span class="keyword">const</span> buffer = <span class="keyword">new</span> <span class="function">Uint8Array</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]).<span class="function">buffer</span>;
<span class="keyword">const</span> response = <span class="keyword">await</span> <span class="function">fetch</span>(url, {
    method: <span class="string">'POST'</span>,
    body: buffer
});
                </div>
                
                <h3>All Request Options</h3>
                <div class="option-card">
                    <div class="code-block">
<span class="keyword">const</span> response = <span class="keyword">await</span> <span class="function">fetch</span>(url, {
    <span class="comment">// HTTP method</span>
    method: <span class="string">'GET'</span>, <span class="comment">// GET, POST, PUT, DELETE, PATCH, HEAD, OPTIONS</span>
    
    <span class="comment">// Request headers</span>
    headers: {
        <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span>,
        <span class="string">'Authorization'</span>: <span class="string">'Bearer token'</span>
    },
    
    <span class="comment">// Request body (not for GET/HEAD)</span>
    body: JSON.<span class="function">stringify</span>(data), <span class="comment">// or FormData, Blob, etc.</span>
    
    <span class="comment">// CORS mode</span>
    mode: <span class="string">'cors'</span>, <span class="comment">// 'cors', 'no-cors', 'same-origin'</span>
    
    <span class="comment">// Credentials (cookies)</span>
    credentials: <span class="string">'include'</span>, <span class="comment">// 'include', 'same-origin', 'omit'</span>
    
    <span class="comment">// Cache control</span>
    cache: <span class="string">'default'</span>, <span class="comment">// 'default', 'no-cache', 'reload', 'force-cache', 'only-if-cached'</span>
    
    <span class="comment">// Redirect handling</span>
    redirect: <span class="string">'follow'</span>, <span class="comment">// 'follow', 'error', 'manual'</span>
    
    <span class="comment">// Referrer</span>
    referrer: <span class="string">'about:client'</span>, <span class="comment">// URL or 'about:client', 'no-referrer'</span>
    
    <span class="comment">// Referrer policy</span>
    referrerPolicy: <span class="string">'no-referrer-when-downgrade'</span>,
    
    <span class="comment">// Integrity (Subresource Integrity)</span>
    integrity: <span class="string">'sha256-...'</span>,
    
    <span class="comment">// Keep connection alive</span>
    keepalive: <span class="keyword">true</span>,
    
    <span class="comment">// Abort signal</span>
    signal: controller.signal
});
                    </div>
                </div>
            </div>
            
            <!-- Response Object -->
            <div class="section">
                <h2>üì¶ Response Object</h2>
                
                <div class="concept-box">
                    <p>The <code>Response</code> object represents the HTTP response and contains useful properties and methods.</p>
                </div>
                
                <h3>Response Properties</h3>
                <div class="property-list">
                    <dl>
                        <dt>response.ok</dt>
                        <dd>Boolean - true if status 200-299</dd>
                        
                        <dt>response.status</dt>
                        <dd>Number - HTTP status code (200, 404, 500, etc.)</dd>
                        
                        <dt>response.statusText</dt>
                        <dd>String - Status message ('OK', 'Not Found', etc.)</dd>
                        
                        <dt>response.headers</dt>
                        <dd>Headers object - Response headers</dd>
                        
                        <dt>response.url</dt>
                        <dd>String - Final URL (after redirects)</dd>
                        
                        <dt>response.redirected</dt>
                        <dd>Boolean - true if redirected</dd>
                        
                        <dt>response.type</dt>
                        <dd>String - 'basic', 'cors', 'opaque', 'error'</dd>
                        
                        <dt>response.body</dt>
                        <dd>ReadableStream - Response body stream</dd>
                        
                        <dt>response.bodyUsed</dt>
                        <dd>Boolean - true if body has been read</dd>
                    </dl>
                </div>
                
                <div class="code-block">
<span class="keyword">const</span> response = <span class="keyword">await</span> <span class="function">fetch</span>(<span class="string">'https://api.example.com/users'</span>);

console.<span class="function">log</span>(<span class="string">'Status:'</span>, response.status);       <span class="comment">// 200</span>
console.<span class="function">log</span>(<span class="string">'OK:'</span>, response.ok);                <span class="comment">// true</span>
console.<span class="function">log</span>(<span class="string">'Status Text:'</span>, response.statusText); <span class="comment">// "OK"</span>
console.<span class="function">log</span>(<span class="string">'URL:'</span>, response.url);              <span class="comment">// Final URL</span>
console.<span class="function">log</span>(<span class="string">'Redirected:'</span>, response.redirected); <span class="comment">// false</span>
console.<span class="function">log</span>(<span class="string">'Type:'</span>, response.type);            <span class="comment">// "cors"</span>

<span class="comment">// Check if successful</span>
<span class="keyword">if</span> (response.ok) {
    <span class="keyword">const</span> data = <span class="keyword">await</span> response.<span class="function">json</span>();
} <span class="keyword">else</span> {
    console.<span class="function">error</span>(<span class="string">`Error: ${response.status} ${response.statusText}`</span>);
}

<span class="comment">// Handle different status codes</span>
<span class="keyword">switch</span> (response.status) {
    <span class="keyword">case</span> <span class="number">200</span>:
        console.<span class="function">log</span>(<span class="string">'Success!'</span>);
        <span class="keyword">break</span>;
    <span class="keyword">case</span> <span class="number">404</span>:
        console.<span class="function">log</span>(<span class="string">'Not found'</span>);
        <span class="keyword">break</span>;
    <span class="keyword">case</span> <span class="number">401</span>:
        console.<span class="function">log</span>(<span class="string">'Unauthorized'</span>);
        <span class="keyword">break</span>;
    <span class="keyword">case</span> <span class="number">500</span>:
        console.<span class="function">log</span>(<span class="string">'Server error'</span>);
        <span class="keyword">break</span>;
}
                </div>
                
                <h3>Response Headers</h3>
                <div class="code-block">
<span class="keyword">const</span> response = <span class="keyword">await</span> <span class="function">fetch</span>(url);

<span class="comment">// Get specific header</span>
<span class="keyword">const</span> contentType = response.headers.<span class="function">get</span>(<span class="string">'Content-Type'</span>);
console.<span class="function">log</span>(contentType); <span class="comment">// "application/json; charset=utf-8"</span>

<span class="comment">// Check if header exists</span>
<span class="keyword">const</span> hasAuth = response.headers.<span class="function">has</span>(<span class="string">'Authorization'</span>);

<span class="comment">// Iterate all headers</span>
<span class="keyword">for</span> (<span class="keyword">const</span> [key, value] <span class="keyword">of</span> response.headers) {
    console.<span class="function">log</span>(<span class="string">`${key}: ${value}`</span>);
}

<span class="comment">// Common headers to read</span>
<span class="keyword">const</span> contentLength = response.headers.<span class="function">get</span>(<span class="string">'Content-Length'</span>);
<span class="keyword">const</span> lastModified = response.headers.<span class="function">get</span>(<span class="string">'Last-Modified'</span>);
<span class="keyword">const</span> etag = response.headers.<span class="function">get</span>(<span class="string">'ETag'</span>);
<span class="keyword">const</span> cacheControl = response.headers.<span class="function">get</span>(<span class="string">'Cache-Control'</span>);
                </div>
            </div>
            
            <!-- Aborting Requests -->
            <div class="section">
                <h2>‚èπÔ∏è Aborting Requests</h2>
                
                <div class="concept-box">
                    <p>Use <code>AbortController</code> to cancel fetch requests. Essential for preventing memory leaks and improving performance.</p>
                </div>
                
                <div class="code-block">
<span class="comment">// Create abort controller</span>
<span class="keyword">const</span> controller = <span class="keyword">new</span> <span class="function">AbortController</span>();

<span class="comment">// Pass signal to fetch</span>
<span class="keyword">const</span> response = <span class="keyword">await</span> <span class="function">fetch</span>(url, {
    signal: controller.signal
});

<span class="comment">// Abort the request</span>
controller.<span class="function">abort</span>();

<span class="comment">// Handle abort</span>
<span class="keyword">try</span> {
    <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="function">fetch</span>(url, { signal: controller.signal });
    <span class="keyword">const</span> data = <span class="keyword">await</span> response.<span class="function">json</span>();
} <span class="keyword">catch</span> (error) {
    <span class="keyword">if</span> (error.name === <span class="string">'AbortError'</span>) {
        console.<span class="function">log</span>(<span class="string">'Request aborted'</span>);
    } <span class="keyword">else</span> {
        console.<span class="function">error</span>(<span class="string">'Fetch error:'</span>, error);
    }
}

<span class="comment">// Abort after timeout</span>
<span class="keyword">const</span> controller = <span class="keyword">new</span> <span class="function">AbortController</span>();
setTimeout(() => controller.<span class="function">abort</span>(), <span class="number">5000</span>); <span class="comment">// 5 seconds</span>

<span class="keyword">try</span> {
    <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="function">fetch</span>(url, { signal: controller.signal });
} <span class="keyword">catch</span> (error) {
    <span class="keyword">if</span> (error.name === <span class="string">'AbortError'</span>) {
        console.<span class="function">log</span>(<span class="string">'Request timed out'</span>);
    }
}

<span class="comment">// Modern: AbortSignal.timeout()</span>
<span class="keyword">try</span> {
    <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="function">fetch</span>(url, {
        signal: AbortSignal.<span class="function">timeout</span>(<span class="number">5000</span>) <span class="comment">// 5 seconds</span>
    });
} <span class="keyword">catch</span> (error) {
    <span class="keyword">if</span> (error.name === <span class="string">'TimeoutError'</span>) {
        console.<span class="function">log</span>(<span class="string">'Request timed out'</span>);
    }
}
                </div>
                
                <div class="key-point">
                    <strong>üí° Use Cases for Aborting:</strong>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li>User navigates away from page</li>
                        <li>Search input changes (cancel previous search)</li>
                        <li>Component unmounts in React/Vue</li>
                        <li>Request takes too long (timeout)</li>
                        <li>User clicks "Cancel" button</li>
                    </ul>
                </div>
            </div>
            
            <!-- Progress Tracking -->
            <div class="section">
                <h2>üìä Progress Tracking</h2>
                
                <div class="warning-box">
                    <strong>‚ö†Ô∏è Note:</strong> Fetch API doesn't natively support upload progress. For upload progress, use XMLHttpRequest. Download progress can be tracked using ReadableStream.
                </div>
                
                <h3>Download Progress</h3>
                <div class="code-block">
<span class="keyword">async function</span> <span class="function">downloadWithProgress</span>(url, onProgress) {
    <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="function">fetch</span>(url);
    
    <span class="comment">// Get total size</span>
    <span class="keyword">const</span> total = <span class="function">parseInt</span>(response.headers.<span class="function">get</span>(<span class="string">'Content-Length'</span>), <span class="number">10</span>);
    <span class="keyword">let</span> loaded = <span class="number">0</span>;
    
    <span class="comment">// Get readable stream</span>
    <span class="keyword">const</span> reader = response.body.<span class="function">getReader</span>();
    <span class="keyword">const</span> chunks = [];
    
    <span class="keyword">while</span> (<span class="keyword">true</span>) {
        <span class="keyword">const</span> { done, value } = <span class="keyword">await</span> reader.<span class="function">read</span>();
        
        <span class="keyword">if</span> (done) <span class="keyword">break</span>;
        
        chunks.<span class="function">push</span>(value);
        loaded += value.length;
        
        <span class="comment">// Report progress</span>
        <span class="keyword">const</span> progress = (loaded / total) * <span class="number">100</span>;
        <span class="function">onProgress</span>(progress, loaded, total);
    }
    
    <span class="comment">// Combine chunks</span>
    <span class="keyword">const</span> blob = <span class="keyword">new</span> <span class="function">Blob</span>(chunks);
    <span class="keyword">return</span> blob;
}

<span class="comment">// Usage</span>
<span class="keyword">const</span> blob = <span class="keyword">await</span> <span class="function">downloadWithProgress</span>(
    <span class="string">'https://example.com/large-file.zip'</span>,
    (progress, loaded, total) => {
        console.<span class="function">log</span>(<span class="string">`${progress.toFixed(2)}% (${loaded}/${total} bytes)`</span>);
    }
);
                </div>
                
                <h3>Upload Progress (XMLHttpRequest)</h3>
                <div class="code-block">
<span class="comment">// For upload progress, use XMLHttpRequest</span>
<span class="keyword">function</span> <span class="function">uploadWithProgress</span>(url, file, onProgress) {
    <span class="keyword">return new Promise</span>((resolve, reject) => {
        <span class="keyword">const</span> xhr = <span class="keyword">new</span> <span class="function">XMLHttpRequest</span>();
        
        <span class="comment">// Upload progress</span>
        xhr.upload.<span class="function">addEventListener</span>(<span class="string">'progress'</span>, (e) => {
            <span class="keyword">if</span> (e.lengthComputable) {
                <span class="keyword">const</span> progress = (e.loaded / e.total) * <span class="number">100</span>;
                <span class="function">onProgress</span>(progress, e.loaded, e.total);
            }
        });
        
        xhr.<span class="function">addEventListener</span>(<span class="string">'load'</span>, () => {
            <span class="keyword">if</span> (xhr.status >= <span class="number">200</span> && xhr.status < <span class="number">300</span>) {
                <span class="function">resolve</span>(xhr.response);
            } <span class="keyword">else</span> {
                <span class="function">reject</span>(<span class="keyword">new</span> <span class="function">Error</span>(<span class="string">`HTTP ${xhr.status}`</span>));
            }
        });
        
        xhr.<span class="function">addEventListener</span>(<span class="string">'error'</span>, () => {
            <span class="function">reject</span>(<span class="keyword">new</span> <span class="function">Error</span>(<span class="string">'Upload failed'</span>));
        });
        
        <span class="comment">// Send file</span>
        <span class="keyword">const</span> formData = <span class="keyword">new</span> <span class="function">FormData</span>();
        formData.<span class="function">append</span>(<span class="string">'file'</span>, file);
        
        xhr.<span class="function">open</span>(<span class="string">'POST'</span>, url);
        xhr.<span class="function">send</span>(formData);
    });
}

<span class="comment">// Usage</span>
<span class="keyword">await</span> <span class="function">uploadWithProgress</span>(
    <span class="string">'/upload'</span>,
    file,
    (progress, loaded, total) => {
        console.<span class="function">log</span>(<span class="string">`Uploading: ${progress.toFixed(2)}%`</span>);
    }
);
                </div>
            </div>
            
            <!-- Practical Patterns -->
            <div class="section">
                <h2>üéØ Practical Patterns</h2>
                
                <h3>Pattern 1: Fetch Wrapper with Error Handling</h3>
                <div class="code-block">
<span class="keyword">async function</span> <span class="function">fetchJSON</span>(url, options = {}) {
    <span class="keyword">try</span> {
        <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="function">fetch</span>(url, {
            headers: {
                <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span>,
                ...options.headers
            },
            ...options
        });
        
        <span class="keyword">if</span> (!response.ok) {
            <span class="keyword">const</span> error = <span class="keyword">await</span> response.<span class="function">json</span>().<span class="function">catch</span>(() => ({}));
            <span class="keyword">throw new</span> <span class="function">Error</span>(error.message || <span class="string">`HTTP ${response.status}`</span>);
        }
        
        <span class="keyword">return await</span> response.<span class="function">json</span>();
    } <span class="keyword">catch</span> (error) {
        <span class="keyword">if</span> (error.name === <span class="string">'AbortError'</span>) {
            <span class="keyword">throw new</span> <span class="function">Error</span>(<span class="string">'Request cancelled'</span>);
        }
        <span class="keyword">throw</span> error;
    }
}

<span class="comment">// Usage</span>
<span class="keyword">const</span> users = <span class="keyword">await</span> <span class="function">fetchJSON</span>(<span class="string">'/api/users'</span>);
                </div>
                
                <h3>Pattern 2: Retry Logic</h3>
                <div class="code-block">
<span class="keyword">async function</span> <span class="function">fetchWithRetry</span>(url, options = {}, retries = <span class="number">3</span>) {
    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i < retries; i++) {
        <span class="keyword">try</span> {
            <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="function">fetch</span>(url, options);
            
            <span class="keyword">if</span> (!response.ok) {
                <span class="keyword">throw new</span> <span class="function">Error</span>(<span class="string">`HTTP ${response.status}`</span>);
            }
            
            <span class="keyword">return</span> response;
        } <span class="keyword">catch</span> (error) {
            <span class="keyword">const</span> isLastAttempt = i === retries - <span class="number">1</span>;
            
            <span class="keyword">if</span> (isLastAttempt) {
                <span class="keyword">throw</span> error;
            }
            
            <span class="comment">// Wait before retry (exponential backoff)</span>
            <span class="keyword">const</span> delay = Math.<span class="function">pow</span>(<span class="number">2</span>, i) * <span class="number">1000</span>;
            <span class="keyword">await new Promise</span>(resolve => <span class="function">setTimeout</span>(resolve, delay));
            
            console.<span class="function">log</span>(<span class="string">`Retry ${i + 1}/${retries}...`</span>);
        }
    }
}
                </div>
                
                <h3>Pattern 3: Parallel Requests</h3>
                <div class="code-block">
<span class="comment">// Fetch multiple resources in parallel</span>
<span class="keyword">const</span> [users, posts, comments] = <span class="keyword">await</span> Promise.<span class="function">all</span>([
    <span class="function">fetch</span>(<span class="string">'/api/users'</span>).<span class="function">then</span>(r => r.<span class="function">json</span>()),
    <span class="function">fetch</span>(<span class="string">'/api/posts'</span>).<span class="function">then</span>(r => r.<span class="function">json</span>()),
    <span class="function">fetch</span>(<span class="string">'/api/comments'</span>).<span class="function">then</span>(r => r.<span class="function">json</span>())
]);

<span class="comment">// With error handling for each</span>
<span class="keyword">const</span> results = <span class="keyword">await</span> Promise.<span class="function">allSettled</span>([
    <span class="function">fetch</span>(<span class="string">'/api/users'</span>).<span class="function">then</span>(r => r.<span class="function">json</span>()),
    <span class="function">fetch</span>(<span class="string">'/api/posts'</span>).<span class="function">then</span>(r => r.<span class="function">json</span>()),
    <span class="function">fetch</span>(<span class="string">'/api/comments'</span>).<span class="function">then</span>(r => r.<span class="function">json</span>())
]);

results.<span class="function">forEach</span>((result, index) => {
    <span class="keyword">if</span> (result.status === <span class="string">'fulfilled'</span>) {
        console.<span class="function">log</span>(<span class="string">`Request ${index} succeeded:`,</span> result.value);
    } <span class="keyword">else</span> {
        console.<span class="function">error</span>(<span class="string">`Request ${index} failed:`,</span> result.reason);
    }
});
                </div>
                
                <h3>Pattern 4: Debounced Search</h3>
                <div class="code-block">
<span class="keyword">let</span> currentController = <span class="keyword">null</span>;

<span class="keyword">async function</span> <span class="function">searchWithDebounce</span>(query) {
    <span class="comment">// Cancel previous request</span>
    <span class="keyword">if</span> (currentController) {
        currentController.<span class="function">abort</span>();
    }
    
    <span class="comment">// Create new controller</span>
    currentController = <span class="keyword">new</span> <span class="function">AbortController</span>();
    
    <span class="keyword">try</span> {
        <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="function">fetch</span>(<span class="string">`/api/search?q=${query}`</span>, {
            signal: currentController.signal
        });
        
        <span class="keyword">const</span> results = <span class="keyword">await</span> response.<span class="function">json</span>();
        <span class="keyword">return</span> results;
    } <span class="keyword">catch</span> (error) {
        <span class="keyword">if</span> (error.name === <span class="string">'AbortError'</span>) {
            console.<span class="function">log</span>(<span class="string">'Search cancelled'</span>);
        } <span class="keyword">else</span> {
            <span class="keyword">throw</span> error;
        }
    }
}
                </div>
            </div>
            
            <!-- Comparison -->
            <div class="section">
                <h2>‚öñÔ∏è Fetch vs XMLHttpRequest</h2>
                
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>Feature</th>
                            <th>Fetch API</th>
                            <th>XMLHttpRequest</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>API Style</strong></td>
                            <td>Promise-based, modern</td>
                            <td>Callback-based, legacy</td>
                        </tr>
                        <tr>
                            <td><strong>Syntax</strong></td>
                            <td>Clean, simple</td>
                            <td>Verbose, complex</td>
                        </tr>
                        <tr>
                            <td><strong>Upload Progress</strong></td>
                            <td>‚ùå No</td>
                            <td>‚úì Yes</td>
                        </tr>
                        <tr>
                            <td><strong>Download Progress</strong></td>
                            <td>‚úì Yes (with streams)</td>
                            <td>‚úì Yes</td>
                        </tr>
                        <tr>
                            <td><strong>Timeout</strong></td>
                            <td>AbortController</td>
                            <td>Built-in timeout property</td>
                        </tr>
                        <tr>
                            <td><strong>Service Workers</strong></td>
                            <td>‚úì Yes</td>
                            <td>‚ùå No</td>
                        </tr>
                        <tr>
                            <td><strong>Browser Support</strong></td>
                            <td>Modern browsers</td>
                            <td>All browsers</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- Interactive Demo -->
            <div class="section">
                <h2>üéÆ Interactive Demo</h2>
                
                <div class="demo-section">
                    <h3>Try Fetch API Now!</h3>
                    
                    <h4 style="margin-top: 20px;">GET Request</h4>
                    <div class="demo-controls">
                        <input type="text" id="getUrl" placeholder="URL" value="https://jsonplaceholder.typicode.com/users/1">
                        <button onclick="makeGetRequest()">Fetch</button>
                    </div>
                    
                    <h4 style="margin-top: 20px;">POST Request</h4>
                    <div class="demo-controls">
                        <input type="text" id="postUrl" placeholder="URL" value="https://jsonplaceholder.typicode.com/posts">
                    </div>
                    <div class="demo-controls">
                        <textarea id="postData" placeholder="JSON data">{"title": "Test Post", "body": "This is a test", "userId": 1}</textarea>
                    </div>
                    <div class="demo-controls">
                        <button onclick="makePostRequest()">Send POST</button>
                    </div>
                    
                    <h4 style="margin-top: 20px;">With Abort</h4>
                    <div class="demo-controls">
                        <button onclick="startSlowRequest()" id="startBtn">Start Slow Request (5s)</button>
                        <button onclick="abortRequest()" id="abortBtn" disabled>Abort</button>
                    </div>
                    
                    <div class="output" id="output">Output will appear here...</div>
                </div>
            </div>
            
            <!-- Best Practices -->
            <div class="section">
                <h2>‚úÖ Best Practices</h2>
                
                <div class="key-point">
                    <h3 style="margin-top: 0;">DO ‚úì</h3>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li>Always check <code>response.ok</code> before parsing</li>
                        <li>Use <code>AbortController</code> for cancelable requests</li>
                        <li>Handle both network and HTTP errors</li>
                        <li>Set appropriate headers (<code>Content-Type</code>, etc.)</li>
                        <li>Use async/await for cleaner code</li>
                        <li>Clone responses if reading body multiple times</li>
                        <li>Implement retry logic for flaky networks</li>
                        <li>Use timeout for long-running requests</li>
                    </ul>
                </div>
                
                <div class="warning-box">
                    <h3 style="margin-top: 0;">DON'T ‚úó</h3>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li>Assume fetch rejects on HTTP errors (it doesn't!)</li>
                        <li>Read response body multiple times</li>
                        <li>Forget to handle AbortError</li>
                        <li>Send sensitive data in GET requests</li>
                        <li>Forget credentials for cross-origin requests</li>
                        <li>Ignore CORS errors without understanding them</li>
                        <li>Make synchronous requests (use async)</li>
                    </ul>
                </div>
            </div>
            
        </div>
    </div>
    
    <script>
        let currentController = null;
        
        function log(message, type = 'info') {
            const output = document.getElementById('output');
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                info: 'color: #0d6efd;',
                success: 'color: #28a745;',
                error: 'color: #dc3545;',
                warning: 'color: #ffc107;'
            };
            output.innerHTML += `<div style="${colors[type]}">[${timestamp}] ${message}</div>`;
            output.scrollTop = output.scrollHeight;
        }
        
        async function makeGetRequest() {
            const url = document.getElementById('getUrl').value;
            if (!url) {
                log('‚ùå Please enter a URL', 'error');
                return;
            }
            
            log(`Fetching ${url}...`, 'info');
            
            try {
                const start = performance.now();
                const response = await fetch(url);
                const time = (performance.now() - start).toFixed(2);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                log(`‚úì Success (${time}ms)`, 'success');
                log(`Status: ${response.status} ${response.statusText}`, 'info');
                log(`Data: ${JSON.stringify(data, null, 2)}`, 'info');
            } catch (error) {
                log(`‚ùå Error: ${error.message}`, 'error');
            }
        }
        
        async function makePostRequest() {
            const url = document.getElementById('postUrl').value;
            const dataStr = document.getElementById('postData').value;
            
            if (!url || !dataStr) {
                log('‚ùå Please enter URL and data', 'error');
                return;
            }
            
            try {
                const data = JSON.parse(dataStr);
                log(`Sending POST to ${url}...`, 'info');
                
                const start = performance.now();
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                const time = (performance.now() - start).toFixed(2);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                
                log(`‚úì Success (${time}ms)`, 'success');
                log(`Status: ${response.status} ${response.statusText}`, 'info');
                log(`Response: ${JSON.stringify(result, null, 2)}`, 'info');
            } catch (error) {
                log(`‚ùå Error: ${error.message}`, 'error');
            }
        }
        
        async function startSlowRequest() {
            document.getElementById('startBtn').disabled = true;
            document.getElementById('abortBtn').disabled = false;
            
            currentController = new AbortController();
            log('Starting slow request (5 seconds)...', 'info');
            
            try {
                // Simulate slow endpoint
                const response = await fetch('https://httpbin.org/delay/5', {
                    signal: currentController.signal
                });
                
                const data = await response.json();
                log('‚úì Request completed!', 'success');
                log(`Data: ${JSON.stringify(data).substring(0, 100)}...`, 'info');
            } catch (error) {
                if (error.name === 'AbortError') {
                    log('‚ö†Ô∏è Request aborted by user', 'warning');
                } else {
                    log(`‚ùå Error: ${error.message}`, 'error');
                }
            } finally {
                document.getElementById('startBtn').disabled = false;
                document.getElementById('abortBtn').disabled = true;
                currentController = null;
            }
        }
        
        function abortRequest() {
            if (currentController) {
                currentController.abort();
                log('Aborting request...', 'warning');
            }
        }
        
        // Initialize
        window.addEventListener('load', () => {
            log('üëã Welcome to Fetch API Demo!', 'success');
            log('Try making GET and POST requests above.', 'info');
        });
    </script>
</body>
</html>