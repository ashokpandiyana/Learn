<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chapter 28: File APIs</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.2); }
        .header p { font-size: 1.2em; opacity: 0.95; }
        .content { padding: 40px; }
        .section { margin-bottom: 40px; }
        h2 { color: #fa709a; font-size: 2em; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 3px solid #fa709a; }
        h3 { color: #fee140; font-size: 1.5em; margin: 30px 0 15px 0; text-shadow: 1px 1px 2px rgba(0,0,0,0.1); }
        .concept-box { background: #f8f9fa; border-left: 4px solid #fa709a; padding: 20px; margin: 20px 0; border-radius: 5px; }
        .key-point { background: #d4edda; border-left: 4px solid #28a745; padding: 15px; margin: 20px 0; border-radius: 5px; }
        .warning-box { background: #fff3cd; border-left: 4px solid #ffc107; padding: 15px; margin: 20px 0; border-radius: 5px; }
        .info-box { background: #cfe2ff; border-left: 4px solid #0d6efd; padding: 15px; margin: 20px 0; border-radius: 5px; }
        .code-block {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
        }
        .code-block .comment { color: #6272a4; }
        .code-block .keyword { color: #ff79c6; }
        .code-block .string { color: #f1fa8c; }
        .code-block .function { color: #50fa7b; }
        .code-block .number { color: #bd93f9; }
        .demo-section { background: #fff5e6; padding: 30px; border-radius: 10px; margin: 30px 0; }
        .demo-controls { display: flex; gap: 10px; margin: 20px 0; flex-wrap: wrap; }
        button {
            background: #fa709a;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
            font-weight: 600;
        }
        button:hover { background: #fee140; color: #333; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        button:disabled { background: #ccc; cursor: not-allowed; transform: none; }
        input[type="file"] {
            padding: 10px;
            border: 2px solid #fa709a;
            border-radius: 5px;
            font-size: 16px;
            flex: 1;
        }
        .output { background: white; padding: 15px; border-radius: 5px; margin-top: 15px; min-height: 100px; border: 2px solid #fa709a; max-height: 400px; overflow-y: auto; }
        code { background: #f4f4f4; padding: 2px 6px; border-radius: 3px; font-family: 'Courier New', monospace; color: #d63384; }
        .property-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .property-card { background: #f8f9fa; padding: 20px; border-radius: 10px; border: 2px solid #fa709a; }
        .property-card h4 { color: #fa709a; margin-bottom: 10px; }
        .property-card .type { color: #fee140; font-size: 0.9em; margin-bottom: 5px; text-shadow: 1px 1px 2px rgba(0,0,0,0.1); }
        .preview-area {
            background: white;
            border: 2px dashed #fa709a;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .preview-area img {
            max-width: 100%;
            max-height: 400px;
            border-radius: 10px;
        }
        .file-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #fa709a;
        }
        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e9ecef;
            border-radius: 15px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            width: 0%;
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìÅ Chapter 28: File APIs</h1>
            <p>Working with Files in the Browser</p>
        </div>
        
        <div class="content">
            
            <div class="section">
                <h2>üéØ File API Overview</h2>
                
                <div class="concept-box">
                    <p><strong>File APIs</strong> enable web applications to read, process, and interact with files on the user's device. This includes:</p>
                    <ul style="margin-left: 25px; margin-top: 10px;">
                        <li><strong>File:</strong> Represents a file</li>
                        <li><strong>FileList:</strong> Collection of files</li>
                        <li><strong>FileReader:</strong> Read file contents</li>
                        <li><strong>Blob:</strong> Raw binary data</li>
                        <li><strong>File System Access API:</strong> Modern file system access</li>
                    </ul>
                </div>
            </div>
            
            <div class="section">
                <h2>üìÇ File Input & FileList</h2>
                
                <h3>Basic File Input</h3>
                <div class="code-block">
<span class="comment">// HTML: &lt;input type="file" id="fileInput"&gt;</span>

<span class="keyword">const</span> input = document.<span class="function">getElementById</span>(<span class="string">'fileInput'</span>);

input.<span class="function">addEventListener</span>(<span class="string">'change'</span>, (event) => {
    <span class="keyword">const</span> files = event.target.files; <span class="comment">// FileList object</span>
    
    console.<span class="function">log</span>(<span class="string">'Number of files:'</span>, files.length);
    
    <span class="comment">// Access first file</span>
    <span class="keyword">const</span> file = files[<span class="number">0</span>];
    
    <span class="keyword">if</span> (file) {
        console.<span class="function">log</span>(<span class="string">'Name:'</span>, file.name);
        console.<span class="function">log</span>(<span class="string">'Size:'</span>, file.size, <span class="string">'bytes'</span>);
        console.<span class="function">log</span>(<span class="string">'Type:'</span>, file.type);
        console.<span class="function">log</span>(<span class="string">'Last Modified:'</span>, <span class="keyword">new</span> <span class="function">Date</span>(file.lastModified));
    }
});

<span class="comment">// Multiple files</span>
<span class="comment">// &lt;input type="file" multiple&gt;</span>
input.<span class="function">addEventListener</span>(<span class="string">'change'</span>, (e) => {
    <span class="keyword">const</span> files = Array.<span class="function">from</span>(e.target.files);
    
    files.<span class="function">forEach</span>((file, index) => {
        console.<span class="function">log</span>(<span class="string">`File ${index + 1}:`</span>, file.name);
    });
});
                </div>
                
                <h3>File Properties</h3>
                <div class="property-grid">
                    <div class="property-card">
                        <h4>name</h4>
                        <div class="type">String</div>
                        <p>File name (e.g., "document.pdf")</p>
                    </div>
                    <div class="property-card">
                        <h4>size</h4>
                        <div class="type">Number (bytes)</div>
                        <p>File size in bytes</p>
                    </div>
                    <div class="property-card">
                        <h4>type</h4>
                        <div class="type">String (MIME)</div>
                        <p>MIME type (e.g., "image/png")</p>
                    </div>
                    <div class="property-card">
                        <h4>lastModified</h4>
                        <div class="type">Number (timestamp)</div>
                        <p>Last modified time in milliseconds</p>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h2>üìñ FileReader API</h2>
                
                <div class="concept-box">
                    <p><strong>FileReader</strong> provides methods to read file contents asynchronously.</p>
                </div>
                
                <h3>Reading Methods</h3>
                <div class="code-block">
<span class="keyword">const</span> reader = <span class="keyword">new</span> <span class="function">FileReader</span>();

<span class="comment">// 1. Read as text</span>
reader.<span class="function">readAsText</span>(file);
reader.<span class="function">readAsText</span>(file, <span class="string">'UTF-8'</span>); <span class="comment">// With encoding</span>

<span class="comment">// 2. Read as Data URL (base64)</span>
reader.<span class="function">readAsDataURL</span>(file); <span class="comment">// For images, display in &lt;img&gt;</span>

<span class="comment">// 3. Read as ArrayBuffer (binary)</span>
reader.<span class="function">readAsArrayBuffer</span>(file);

<span class="comment">// 4. Read as binary string (deprecated)</span>
reader.<span class="function">readAsBinaryString</span>(file);
                </div>
                
                <h3>FileReader Events</h3>
                <div class="code-block">
<span class="keyword">const</span> reader = <span class="keyword">new</span> <span class="function">FileReader</span>();

<span class="comment">// Load complete</span>
reader.<span class="keyword">onload</span> = (event) => {
    console.<span class="function">log</span>(<span class="string">'File loaded!'</span>);
    console.<span class="function">log</span>(<span class="string">'Result:'</span>, event.target.result);
};

<span class="comment">// Error occurred</span>
reader.<span class="keyword">onerror</span> = (event) => {
    console.<span class="function">error</span>(<span class="string">'Error reading file:'</span>, event.target.error);
};

<span class="comment">// Progress updates</span>
reader.<span class="keyword">onprogress</span> = (event) => {
    <span class="keyword">if</span> (event.lengthComputable) {
        <span class="keyword">const</span> percent = (event.loaded / event.total) * <span class="number">100</span>;
        console.<span class="function">log</span>(<span class="string">`Progress: ${percent.toFixed(2)}%`</span>);
    }
};

<span class="comment">// Load started</span>
reader.<span class="keyword">onloadstart</span> = () => {
    console.<span class="function">log</span>(<span class="string">'Reading started...'</span>);
};

<span class="comment">// Load ended (success or fail)</span>
reader.<span class="keyword">onloadend</span> = () => {
    console.<span class="function">log</span>(<span class="string">'Reading finished'</span>);
};

<span class="comment">// Abort</span>
reader.<span class="keyword">onabort</span> = () => {
    console.<span class="function">log</span>(<span class="string">'Reading aborted'</span>);
};

<span class="comment">// Start reading</span>
reader.<span class="function">readAsText</span>(file);

<span class="comment">// Abort reading</span>
reader.<span class="function">abort</span>();
                </div>
                
                <h3>Example: Read Text File</h3>
                <div class="code-block">
<span class="keyword">function</span> <span class="function">readTextFile</span>(file) {
    <span class="keyword">return new Promise</span>((resolve, reject) => {
        <span class="keyword">const</span> reader = <span class="keyword">new</span> <span class="function">FileReader</span>();
        
        reader.<span class="keyword">onload</span> = (e) => <span class="function">resolve</span>(e.target.result);
        reader.<span class="keyword">onerror</span> = (e) => <span class="function">reject</span>(e.target.error);
        
        reader.<span class="function">readAsText</span>(file);
    });
}

<span class="comment">// Usage with async/await</span>
input.<span class="function">addEventListener</span>(<span class="string">'change'</span>, <span class="keyword">async</span> (e) => {
    <span class="keyword">const</span> file = e.target.files[<span class="number">0</span>];
    <span class="keyword">const</span> content = <span class="keyword">await</span> <span class="function">readTextFile</span>(file);
    console.<span class="function">log</span>(content);
});
                </div>
                
                <h3>Example: Display Image</h3>
                <div class="code-block">
<span class="keyword">function</span> <span class="function">displayImage</span>(file) {
    <span class="keyword">const</span> reader = <span class="keyword">new</span> <span class="function">FileReader</span>();
    
    reader.<span class="keyword">onload</span> = (e) => {
        <span class="keyword">const</span> img = document.<span class="function">createElement</span>(<span class="string">'img'</span>);
        img.src = e.target.result; <span class="comment">// Data URL</span>
        document.body.<span class="function">appendChild</span>(img);
    };
    
    reader.<span class="function">readAsDataURL</span>(file);
}

<span class="comment">// Usage</span>
input.<span class="function">addEventListener</span>(<span class="string">'change'</span>, (e) => {
    <span class="keyword">const</span> file = e.target.files[<span class="number">0</span>];
    <span class="keyword">if</span> (file && file.type.<span class="function">startsWith</span>(<span class="string">'image/'</span>)) {
        <span class="function">displayImage</span>(file);
    }
});
                </div>
                
                <h3>Example: Read with Progress</h3>
                <div class="code-block">
<span class="keyword">function</span> <span class="function">readFileWithProgress</span>(file, onProgress) {
    <span class="keyword">return new Promise</span>((resolve, reject) => {
        <span class="keyword">const</span> reader = <span class="keyword">new</span> <span class="function">FileReader</span>();
        
        reader.<span class="keyword">onprogress</span> = (e) => {
            <span class="keyword">if</span> (e.lengthComputable) {
                <span class="keyword">const</span> percent = (e.loaded / e.total) * <span class="number">100</span>;
                <span class="function">onProgress</span>(percent, e.loaded, e.total);
            }
        };
        
        reader.<span class="keyword">onload</span> = (e) => <span class="function">resolve</span>(e.target.result);
        reader.<span class="keyword">onerror</span> = (e) => <span class="function">reject</span>(e.target.error);
        
        reader.<span class="function">readAsArrayBuffer</span>(file);
    });
}

<span class="comment">// Usage</span>
<span class="keyword">const</span> data = <span class="keyword">await</span> <span class="function">readFileWithProgress</span>(
    file,
    (percent, loaded, total) => {
        console.<span class="function">log</span>(<span class="string">`${percent.toFixed(2)}% (${loaded}/${total} bytes)`</span>);
    }
);
                </div>
            </div>
            
            <div class="section">
                <h2>üóÇÔ∏è Blob API</h2>
                
                <div class="concept-box">
                    <p><strong>Blob</strong> (Binary Large Object) represents raw binary data. Files extend Blob with a name and lastModified.</p>
                </div>
                
                <div class="code-block">
<span class="comment">// Create Blob from string</span>
<span class="keyword">const</span> blob = <span class="keyword">new</span> <span class="function">Blob</span>([<span class="string">'Hello World'</span>], { type: <span class="string">'text/plain'</span> });

<span class="comment">// Create Blob from array</span>
<span class="keyword">const</span> data = <span class="keyword">new</span> <span class="function">Uint8Array</span>([<span class="number">72</span>, <span class="number">101</span>, <span class="number">108</span>, <span class="number">108</span>, <span class="number">111</span>]); <span class="comment">// "Hello"</span>
<span class="keyword">const</span> blob2 = <span class="keyword">new</span> <span class="function">Blob</span>([data], { type: <span class="string">'text/plain'</span> });

<span class="comment">// Blob properties</span>
console.<span class="function">log</span>(blob.size);      <span class="comment">// 11 bytes</span>
console.<span class="function">log</span>(blob.type);      <span class="comment">// "text/plain"</span>

<span class="comment">// Read Blob contents</span>
<span class="keyword">const</span> text = <span class="keyword">await</span> blob.<span class="function">text</span>();
<span class="keyword">const</span> buffer = <span class="keyword">await</span> blob.<span class="function">arrayBuffer</span>();
<span class="keyword">const</span> stream = blob.<span class="function">stream</span>();

<span class="comment">// Slice Blob (like array.slice)</span>
<span class="keyword">const</span> chunk = blob.<span class="function">slice</span>(<span class="number">0</span>, <span class="number">5</span>); <span class="comment">// First 5 bytes</span>
<span class="keyword">const</span> chunk2 = blob.<span class="function">slice</span>(<span class="number">0</span>, <span class="number">5</span>, <span class="string">'text/plain'</span>);
                </div>
                
                <h3>Blob URLs</h3>
                <div class="code-block">
<span class="comment">// Create object URL from Blob</span>
<span class="keyword">const</span> blob = <span class="keyword">new</span> <span class="function">Blob</span>([<span class="string">'&lt;h1&gt;Hello&lt;/h1&gt;'</span>], { type: <span class="string">'text/html'</span> });
<span class="keyword">const</span> url = URL.<span class="function">createObjectURL</span>(blob);

<span class="comment">// Use URL (e.g., in iframe, link)</span>
<span class="keyword">const</span> iframe = document.<span class="function">createElement</span>(<span class="string">'iframe'</span>);
iframe.src = url;

<span class="comment">// IMPORTANT: Revoke when done to free memory!</span>
URL.<span class="function">revokeObjectURL</span>(url);

<span class="comment">// Download Blob as file</span>
<span class="keyword">function</span> <span class="function">downloadBlob</span>(blob, filename) {
    <span class="keyword">const</span> url = URL.<span class="function">createObjectURL</span>(blob);
    <span class="keyword">const</span> a = document.<span class="function">createElement</span>(<span class="string">'a'</span>);
    a.href = url;
    a.download = filename;
    a.<span class="function">click</span>();
    URL.<span class="function">revokeObjectURL</span>(url);
}

<span class="comment">// Usage: Export data as file</span>
<span class="keyword">const</span> data = JSON.<span class="function">stringify</span>({ users: [...] });
<span class="keyword">const</span> blob = <span class="keyword">new</span> <span class="function">Blob</span>([data], { type: <span class="string">'application/json'</span> });
<span class="function">downloadBlob</span>(blob, <span class="string">'data.json'</span>);
                </div>
            </div>
            
            <div class="section">
                <h2>üíº Practical Examples</h2>
                
                <h3>1. Image Preview</h3>
                <div class="code-block">
<span class="keyword">function</span> <span class="function">previewImage</span>(file) {
    <span class="keyword">if</span> (!file.type.<span class="function">startsWith</span>(<span class="string">'image/'</span>)) {
        console.<span class="function">error</span>(<span class="string">'Not an image file'</span>);
        <span class="keyword">return</span>;
    }
    
    <span class="keyword">const</span> reader = <span class="keyword">new</span> <span class="function">FileReader</span>();
    
    reader.<span class="keyword">onload</span> = (e) => {
        <span class="keyword">const</span> img = document.<span class="function">createElement</span>(<span class="string">'img'</span>);
        img.src = e.target.result;
        img.style.maxWidth = <span class="string">'300px'</span>;
        
        <span class="keyword">const</span> preview = document.<span class="function">getElementById</span>(<span class="string">'preview'</span>);
        preview.innerHTML = <span class="string">''</span>;
        preview.<span class="function">appendChild</span>(img);
    };
    
    reader.<span class="function">readAsDataURL</span>(file);
}
                </div>
                
                <h3>2. CSV Parser</h3>
                <div class="code-block">
<span class="keyword">async function</span> <span class="function">parseCSV</span>(file) {
    <span class="keyword">const</span> text = <span class="keyword">await</span> file.<span class="function">text</span>();
    <span class="keyword">const</span> lines = text.<span class="function">split</span>(<span class="string">'\n'</span>);
    <span class="keyword">const</span> headers = lines[<span class="number">0</span>].<span class="function">split</span>(<span class="string">','</span>);
    
    <span class="keyword">const</span> data = lines.<span class="function">slice</span>(<span class="number">1</span>).<span class="function">map</span>(line => {
        <span class="keyword">const</span> values = line.<span class="function">split</span>(<span class="string">','</span>);
        <span class="keyword">return</span> headers.<span class="function">reduce</span>((obj, header, index) => {
            obj[header.<span class="function">trim</span>()] = values[index]?.<span class="function">trim</span>();
            <span class="keyword">return</span> obj;
        }, {});
    });
    
    <span class="keyword">return</span> data;
}
                </div>
                
                <h3>3. File Upload with Preview</h3>
                <div class="code-block">
<span class="keyword">class</span> <span class="function">FileUploader</span> {
    <span class="keyword">constructor</span>(inputElement) {
        <span class="keyword">this</span>.input = inputElement;
        <span class="keyword">this</span>.files = [];
        <span class="keyword">this</span>.<span class="function">setupListeners</span>();
    }
    
    <span class="function">setupListeners</span>() {
        <span class="keyword">this</span>.input.<span class="function">addEventListener</span>(<span class="string">'change'</span>, (e) => {
            <span class="keyword">this</span>.files = Array.<span class="function">from</span>(e.target.files);
            <span class="keyword">this</span>.<span class="function">showPreviews</span>();
        });
    }
    
    <span class="keyword">async</span> <span class="function">showPreviews</span>() {
        <span class="keyword">for</span> (<span class="keyword">const</span> file <span class="keyword">of</span> <span class="keyword">this</span>.files) {
            <span class="keyword">if</span> (file.type.<span class="function">startsWith</span>(<span class="string">'image/'</span>)) {
                <span class="keyword">await</span> <span class="keyword">this</span>.<span class="function">previewImage</span>(file);
            } <span class="keyword">else</span> {
                <span class="keyword">this</span>.<span class="function">showFileInfo</span>(file);
            }
        }
    }
    
    <span class="function">previewImage</span>(file) {
        <span class="keyword">return new Promise</span>((resolve) => {
            <span class="keyword">const</span> reader = <span class="keyword">new</span> <span class="function">FileReader</span>();
            reader.<span class="keyword">onload</span> = (e) => {
                <span class="keyword">const</span> img = document.<span class="function">createElement</span>(<span class="string">'img'</span>);
                img.src = e.target.result;
                <span class="comment">// Add to preview container...</span>
                <span class="function">resolve</span>();
            };
            reader.<span class="function">readAsDataURL</span>(file);
        });
    }
    
    <span class="keyword">async</span> <span class="function">upload</span>() {
        <span class="keyword">const</span> formData = <span class="keyword">new</span> <span class="function">FormData</span>();
        <span class="keyword">this</span>.files.<span class="function">forEach</span>((file, index) => {
            formData.<span class="function">append</span>(<span class="string">`file${index}`</span>, file);
        });
        
        <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="function">fetch</span>(<span class="string">'/upload'</span>, {
            method: <span class="string">'POST'</span>,
            body: formData
        });
        
        <span class="keyword">return await</span> response.<span class="function">json</span>();
    }
}
                </div>
            </div>
            
            <div class="section">
                <h2>üÜï File System Access API</h2>
                
                <div class="concept-box">
                    <p><strong>File System Access API</strong> (modern) provides more powerful file system access with native file pickers.</p>
                </div>
                
                <h3>Open File</h3>
                <div class="code-block">
<span class="comment">// Show file picker</span>
<span class="keyword">const</span> [fileHandle] = <span class="keyword">await</span> window.<span class="function">showOpenFilePicker</span>({
    types: [
        {
            description: <span class="string">'Text Files'</span>,
            accept: { <span class="string">'text/plain'</span>: [<span class="string">'.txt'</span>] }
        },
        {
            description: <span class="string">'Images'</span>,
            accept: { <span class="string">'image/*'</span>: [<span class="string">'.png'</span>, <span class="string">'.jpg'</span>, <span class="string">'.jpeg'</span>] }
        }
    ],
    multiple: <span class="keyword">false</span>
});

<span class="keyword">const</span> file = <span class="keyword">await</span> fileHandle.<span class="function">getFile</span>();
<span class="keyword">const</span> contents = <span class="keyword">await</span> file.<span class="function">text</span>();
console.<span class="function">log</span>(contents);
                </div>
                
                <h3>Save File</h3>
                <div class="code-block">
<span class="comment">// Show save picker</span>
<span class="keyword">const</span> fileHandle = <span class="keyword">await</span> window.<span class="function">showSaveFilePicker</span>({
    suggestedName: <span class="string">'document.txt'</span>,
    types: [{
        description: <span class="string">'Text Files'</span>,
        accept: { <span class="string">'text/plain'</span>: [<span class="string">'.txt'</span>] }
    }]
});

<span class="comment">// Write to file</span>
<span class="keyword">const</span> writable = <span class="keyword">await</span> fileHandle.<span class="function">createWritable</span>();
<span class="keyword">await</span> writable.<span class="function">write</span>(<span class="string">'File contents here'</span>);
<span class="keyword">await</span> writable.<span class="function">close</span>();

console.<span class="function">log</span>(<span class="string">'File saved!'</span>);
                </div>
                
                <div class="warning-box">
                    <strong>‚ö†Ô∏è Browser Support:</strong> File System Access API is only supported in Chrome/Edge. Check support before using!
                </div>
            </div>
            
            <div class="section">
                <h2>üéÆ Interactive Demo</h2>
                
                <div class="demo-section">
                    <h3>File Reader Demo</h3>
                    
                    <h4 style="margin-top: 20px;">Select File</h4>
                    <div class="demo-controls">
                        <input type="file" id="fileInput" accept="image/*,text/*">
                    </div>
                    
                    <div class="file-info" id="fileInfo" style="display: none;"></div>
                    
                    <h4 style="margin-top: 20px;">Preview</h4>
                    <div class="preview-area" id="preview">
                        Select a file to preview...
                    </div>
                    
                    <div class="progress-bar" id="progressBar" style="display: none;">
                        <div class="progress-fill" id="progressFill">0%</div>
                    </div>
                    
                    <div class="output" id="output">Select a file above...</div>
                </div>
            </div>
            
            <div class="section">
                <h2>‚úÖ Best Practices</h2>
                
                <div class="key-point">
                    <h3 style="margin-top: 0;">DO ‚úì</h3>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li>Validate file types and sizes</li>
                        <li>Show progress for large files</li>
                        <li>Handle errors gracefully</li>
                        <li>Revoke object URLs when done</li>
                        <li>Use async/await for cleaner code</li>
                        <li>Provide user feedback</li>
                    </ul>
                </div>
            </div>
            
        </div>
    </div>
    
    <script>
        function log(message, type = 'info') {
            const output = document.getElementById('output');
            const colors = { info: '#0d6efd', success: '#28a745', error: '#dc3545' };
            output.innerHTML += `<div style="color: ${colors[type]};">${message}</div>`;
        }
        
        document.getElementById('fileInput').addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;
            
            // Show file info
            const info = document.getElementById('fileInfo');
            info.style.display = 'block';
            info.innerHTML = `
                <strong>File Name:</strong> ${file.name}<br>
                <strong>Size:</strong> ${(file.size / 1024).toFixed(2)} KB<br>
                <strong>Type:</strong> ${file.type || 'Unknown'}<br>
                <strong>Modified:</strong> ${new Date(file.lastModified).toLocaleString()}
            `;
            
            log(`üìÅ Selected: ${file.name}`, 'info');
            
            // Show progress bar
            const progressBar = document.getElementById('progressBar');
            const progressFill = document.getElementById('progressFill');
            progressBar.style.display = 'block';
            
            // Read file
            const reader = new FileReader();
            
            reader.onprogress = (e) => {
                if (e.lengthComputable) {
                    const percent = (e.loaded / e.total) * 100;
                    progressFill.style.width = percent + '%';
                    progressFill.textContent = percent.toFixed(0) + '%';
                }
            };
            
            reader.onload = (e) => {
                const preview = document.getElementById('preview');
                
                if (file.type.startsWith('image/')) {
                    preview.innerHTML = `<img src="${e.target.result}" style="max-width: 100%; max-height: 400px;">`;
                    log('‚úì Image loaded', 'success');
                } else if (file.type.startsWith('text/')) {
                    const content = e.target.result.substring(0, 500);
                    preview.innerHTML = `<pre style="text-align: left; white-space: pre-wrap;">${content}${e.target.result.length > 500 ? '...' : ''}</pre>`;
                    log('‚úì Text loaded', 'success');
                } else {
                    preview.textContent = 'Preview not available for this file type';
                    log('‚ö†Ô∏è Preview not available', 'info');
                }
                
                progressBar.style.display = 'none';
            };
            
            reader.onerror = () => {
                log('‚ùå Failed to read file', 'error');
                progressBar.style.display = 'none';
            };
            
            if (file.type.startsWith('image/') || file.type.startsWith('text/')) {
                reader.readAsDataURL(file.type.startsWith('image/') ? file : null);
                if (file.type.startsWith('text/')) reader.readAsText(file);
            }
        });
        
        window.addEventListener('load', () => {
            log('üëã Welcome to File APIs Demo!', 'success');
            log('Select a file to see its properties and preview', 'info');
        });
    </script>
</body>
</html>