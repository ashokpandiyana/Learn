<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chapter 16: WebSockets</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.95;
        }
        
        .content {
            padding: 40px;
        }
        
        .section {
            margin-bottom: 40px;
        }
        
        h2 {
            color: #667eea;
            font-size: 2em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }
        
        h3 {
            color: #764ba2;
            font-size: 1.5em;
            margin: 30px 0 15px 0;
        }
        
        .concept-box {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }
        
        .key-point {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        
        .warning-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        
        .info-box {
            background: #cfe2ff;
            border-left: 4px solid #0d6efd;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        
        .code-block {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .code-block .comment {
            color: #6272a4;
        }
        
        .code-block .keyword {
            color: #ff79c6;
        }
        
        .code-block .string {
            color: #f1fa8c;
        }
        
        .code-block .function {
            color: #50fa7b;
        }
        
        .code-block .number {
            color: #bd93f9;
        }
        
        .visual-diagram {
            background: #f8f9fa;
            border: 2px solid #667eea;
            border-radius: 10px;
            padding: 30px;
            margin: 30px 0;
        }
        
        .ws-flow {
            display: flex;
            justify-content: space-around;
            align-items: center;
            flex-wrap: wrap;
            margin: 20px 0;
        }
        
        .flow-box {
            background: white;
            border: 2px solid #667eea;
            border-radius: 10px;
            padding: 20px;
            margin: 10px;
            min-width: 150px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .flow-arrow {
            font-size: 30px;
            color: #667eea;
        }
        
        .state-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .state-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #667eea;
            text-align: center;
        }
        
        .state-card h4 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.3em;
        }
        
        .state-value {
            font-size: 2em;
            font-weight: bold;
            color: #764ba2;
        }
        
        .demo-section {
            background: #e7f3ff;
            padding: 30px;
            border-radius: 10px;
            margin: 30px 0;
        }
        
        .demo-controls {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
            font-weight: 600;
        }
        
        button:hover {
            background: #764ba2;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        input, select, textarea {
            padding: 10px;
            border: 2px solid #667eea;
            border-radius: 5px;
            font-size: 16px;
            flex: 1;
            min-width: 150px;
        }
        
        textarea {
            min-height: 60px;
            font-family: 'Courier New', monospace;
        }
        
        .output {
            background: white;
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
            min-height: 100px;
            border: 2px solid #667eea;
            max-height: 400px;
            overflow-y: auto;
        }
        
        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            color: #d63384;
        }
        
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .comparison-table th {
            background: #667eea;
            color: white;
            padding: 15px;
            text-align: left;
        }
        
        .comparison-table td {
            padding: 15px;
            border-bottom: 1px solid #ddd;
        }
        
        .comparison-table tr:hover {
            background: #f8f9fa;
        }
        
        .event-card {
            background: white;
            border: 2px solid #667eea;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
        }
        
        .event-card h4 {
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-connecting { background: #ffc107; }
        .status-open { background: #28a745; }
        .status-closing { background: #fd7e14; }
        .status-closed { background: #dc3545; }
        
        .use-case-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .use-case-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #667eea;
            transition: transform 0.3s;
        }
        
        .use-case-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .use-case-card h4 {
            color: #667eea;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîå Chapter 16: WebSockets</h1>
            <p>Real-Time Bidirectional Communication</p>
        </div>
        
        <div class="content">
            
            <!-- Introduction -->
            <div class="section">
                <h2>üéØ What are WebSockets?</h2>
                
                <div class="concept-box">
                    <p><strong>WebSockets</strong> provide full-duplex (two-way) communication channels over a single TCP connection. Unlike HTTP, which is request-response based, WebSockets allow the server to push data to the client at any time.</p>
                    
                    <p style="margin-top: 15px;"><strong>Key Characteristics:</strong></p>
                    <ul style="margin-left: 25px; margin-top: 10px;">
                        <li>üîÑ <strong>Bidirectional:</strong> Client ‚ÜîÔ∏è Server communication</li>
                        <li>‚ö° <strong>Real-Time:</strong> Instant message delivery</li>
                        <li>üéØ <strong>Persistent:</strong> Single long-lived connection</li>
                        <li>üì¶ <strong>Low Overhead:</strong> Minimal protocol overhead</li>
                        <li>üåê <strong>Event-Driven:</strong> Message-based communication</li>
                        <li>üîå <strong>Full-Duplex:</strong> Simultaneous two-way data flow</li>
                    </ul>
                </div>
                
                <div class="visual-diagram">
                    <h3>HTTP vs WebSocket</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
                        <div style="text-align: center;">
                            <h4>HTTP (Request-Response)</h4>
                            <div style="margin-top: 15px;">
                                <div>Client ‚Üí Request ‚Üí Server</div>
                                <div style="margin-top: 10px;">Server ‚Üí Response ‚Üí Client</div>
                                <div style="margin-top: 10px;">‚ùå Connection closes</div>
                                <div style="margin-top: 10px;">üîÅ Repeat for each request</div>
                            </div>
                        </div>
                        <div style="text-align: center;">
                            <h4>WebSocket (Full-Duplex)</h4>
                            <div style="margin-top: 15px;">
                                <div>Client ‚ÜîÔ∏è Persistent Connection ‚ÜîÔ∏è Server</div>
                                <div style="margin-top: 10px;">‚úì Always connected</div>
                                <div style="margin-top: 10px;">‚ö° Instant messaging</div>
                                <div style="margin-top: 10px;">üì® Both can send anytime</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="info-box">
                    <strong>üí° Perfect For:</strong>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li>Chat applications</li>
                        <li>Live notifications</li>
                        <li>Real-time games</li>
                        <li>Collaborative editing (Google Docs-style)</li>
                        <li>Live sports scores</li>
                        <li>Stock tickers</li>
                        <li>IoT device communication</li>
                        <li>Live streaming data</li>
                    </ul>
                </div>
            </div>
            
            <!-- Creating Connection -->
            <div class="section">
                <h2>üîå Creating WebSocket Connection</h2>
                
                <h3>Basic Connection</h3>
                <div class="code-block">
<span class="comment">// Create WebSocket connection</span>
<span class="keyword">const</span> ws = <span class="keyword">new</span> <span class="function">WebSocket</span>(<span class="string">'wss://echo.websocket.org'</span>);
<span class="comment">//                           ‚Üë wss = secure WebSocket (like HTTPS)</span>
<span class="comment">//                           ws = unencrypted (like HTTP)</span>

<span class="comment">// Connection opened</span>
ws.<span class="keyword">onopen</span> = (event) => {
    console.<span class="function">log</span>(<span class="string">'Connected to WebSocket server'</span>);
    ws.<span class="function">send</span>(<span class="string">'Hello Server!'</span>);
};

<span class="comment">// Message received from server</span>
ws.<span class="keyword">onmessage</span> = (event) => {
    console.<span class="function">log</span>(<span class="string">'Received:'</span>, event.data);
};

<span class="comment">// Error occurred</span>
ws.<span class="keyword">onerror</span> = (event) => {
    console.<span class="function">error</span>(<span class="string">'WebSocket error:'</span>, event);
};

<span class="comment">// Connection closed</span>
ws.<span class="keyword">onclose</span> = (event) => {
    console.<span class="function">log</span>(<span class="string">'Disconnected. Code:'</span>, event.code, <span class="string">'Reason:'</span>, event.reason);
};
                </div>
                
                <div class="warning-box">
                    <strong>‚ö†Ô∏è Important:</strong> Always use <code>wss://</code> (secure) in production, not <code>ws://</code>. Browsers may block unencrypted WebSocket connections on HTTPS pages.
                </div>
                
                <h3>With Subprotocols</h3>
                <div class="code-block">
<span class="comment">// Specify subprotocols (optional)</span>
<span class="keyword">const</span> ws = <span class="keyword">new</span> <span class="function">WebSocket</span>(
    <span class="string">'wss://example.com/socket'</span>,
    [<span class="string">'soap'</span>, <span class="string">'wamp'</span>] <span class="comment">// Subprotocol options</span>
);

<span class="comment">// Check which protocol was selected</span>
ws.<span class="keyword">onopen</span> = () => {
    console.<span class="function">log</span>(<span class="string">'Protocol:'</span>, ws.protocol);
};
                </div>
            </div>
            
            <!-- Connection States -->
            <div class="section">
                <h2>üìä Connection States</h2>
                
                <div class="concept-box">
                    <p>WebSocket has 4 ready states that indicate the connection status.</p>
                </div>
                
                <div class="state-grid">
                    <div class="state-card">
                        <h4>CONNECTING</h4>
                        <div class="state-value">0</div>
                        <p style="margin-top: 10px;">Connection is being established</p>
                    </div>
                    <div class="state-card">
                        <h4>OPEN</h4>
                        <div class="state-value">1</div>
                        <p style="margin-top: 10px;">Connection is open and ready</p>
                    </div>
                    <div class="state-card">
                        <h4>CLOSING</h4>
                        <div class="state-value">2</div>
                        <p style="margin-top: 10px;">Connection is closing</p>
                    </div>
                    <div class="state-card">
                        <h4>CLOSED</h4>
                        <div class="state-value">3</div>
                        <p style="margin-top: 10px;">Connection is closed</p>
                    </div>
                </div>
                
                <div class="code-block">
<span class="comment">// Check connection state</span>
console.<span class="function">log</span>(ws.readyState);

<span class="keyword">if</span> (ws.readyState === WebSocket.CONNECTING) {
    console.<span class="function">log</span>(<span class="string">'Connecting...'</span>);
}

<span class="keyword">if</span> (ws.readyState === WebSocket.OPEN) {
    console.<span class="function">log</span>(<span class="string">'Connected and ready to send'</span>);
    ws.<span class="function">send</span>(<span class="string">'Hello!'</span>);
}

<span class="keyword">if</span> (ws.readyState === WebSocket.CLOSING) {
    console.<span class="function">log</span>(<span class="string">'Closing connection...'</span>);
}

<span class="keyword">if</span> (ws.readyState === WebSocket.CLOSED) {
    console.<span class="function">log</span>(<span class="string">'Connection closed'</span>);
}

<span class="comment">// Constants</span>
WebSocket.CONNECTING <span class="comment">// 0</span>
WebSocket.OPEN       <span class="comment">// 1</span>
WebSocket.CLOSING    <span class="comment">// 2</span>
WebSocket.CLOSED     <span class="comment">// 3</span>
                </div>
            </div>
            
            <!-- Sending Data -->
            <div class="section">
                <h2>üì§ Sending Data</h2>
                
                <h3>Text Messages</h3>
                <div class="code-block">
<span class="comment">// Send string</span>
ws.<span class="function">send</span>(<span class="string">'Hello Server!'</span>);

<span class="comment">// Send JSON</span>
<span class="keyword">const</span> data = { type: <span class="string">'chat'</span>, message: <span class="string">'Hello!'</span>, user: <span class="string">'John'</span> };
ws.<span class="function">send</span>(JSON.<span class="function">stringify</span>(data));

<span class="comment">// Check if ready before sending</span>
<span class="keyword">if</span> (ws.readyState === WebSocket.OPEN) {
    ws.<span class="function">send</span>(<span class="string">'Message'</span>);
} <span class="keyword">else</span> {
    console.<span class="function">error</span>(<span class="string">'WebSocket not open'</span>);
}

<span class="comment">// Wait for connection before sending</span>
<span class="keyword">const</span> ws = <span class="keyword">new</span> <span class="function">WebSocket</span>(url);
ws.<span class="keyword">onopen</span> = () => {
    ws.<span class="function">send</span>(<span class="string">'Ready!'</span>); <span class="comment">// Safe to send now</span>
};
                </div>
                
                <h3>Binary Data</h3>
                <div class="code-block">
<span class="comment">// Send Blob</span>
<span class="keyword">const</span> blob = <span class="keyword">new</span> <span class="function">Blob</span>([<span class="string">'Binary data'</span>], { type: <span class="string">'text/plain'</span> });
ws.<span class="function">send</span>(blob);

<span class="comment">// Send ArrayBuffer</span>
<span class="keyword">const</span> buffer = <span class="keyword">new</span> <span class="function">ArrayBuffer</span>(<span class="number">8</span>);
<span class="keyword">const</span> view = <span class="keyword">new</span> <span class="function">Uint8Array</span>(buffer);
view[<span class="number">0</span>] = <span class="number">1</span>;
view[<span class="number">1</span>] = <span class="number">2</span>;
ws.<span class="function">send</span>(buffer);

<span class="comment">// Send TypedArray</span>
<span class="keyword">const</span> array = <span class="keyword">new</span> <span class="function">Uint8Array</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]);
ws.<span class="function">send</span>(array);
                </div>
            </div>
            
            <!-- Receiving Data -->
            <div class="section">
                <h2>üì• Receiving Data</h2>
                
                <h3>Message Event</h3>
                <div class="code-block">
<span class="comment">// Receive text message</span>
ws.<span class="keyword">onmessage</span> = (event) => {
    console.<span class="function">log</span>(<span class="string">'Received:'</span>, event.data);
    
    <span class="comment">// Parse JSON if needed</span>
    <span class="keyword">try</span> {
        <span class="keyword">const</span> data = JSON.<span class="function">parse</span>(event.data);
        console.<span class="function">log</span>(<span class="string">'Parsed:'</span>, data);
    } <span class="keyword">catch</span> (e) {
        console.<span class="function">log</span>(<span class="string">'Not JSON'</span>);
    }
};

<span class="comment">// Message event properties</span>
ws.<span class="keyword">onmessage</span> = (event) => {
    event.data      <span class="comment">// Message data (string, Blob, or ArrayBuffer)</span>
    event.origin    <span class="comment">// Origin of message sender</span>
    event.timeStamp <span class="comment">// Time message was created</span>
};
                </div>
                
                <h3>Handling Binary Data</h3>
                <div class="code-block">
<span class="comment">// Set binary type (default is 'blob')</span>
ws.binaryType = <span class="string">'arraybuffer'</span>; <span class="comment">// or 'blob'</span>

<span class="comment">// Receive binary as ArrayBuffer</span>
ws.<span class="keyword">onmessage</span> = (event) => {
    <span class="keyword">if</span> (event.data <span class="keyword">instanceof</span> ArrayBuffer) {
        <span class="keyword">const</span> view = <span class="keyword">new</span> <span class="function">Uint8Array</span>(event.data);
        console.<span class="function">log</span>(<span class="string">'Binary data:'</span>, view);
    } <span class="keyword">else</span> {
        console.<span class="function">log</span>(<span class="string">'Text data:'</span>, event.data);
    }
};

<span class="comment">// Receive as Blob</span>
ws.binaryType = <span class="string">'blob'</span>;
ws.<span class="keyword">onmessage</span> = <span class="keyword">async</span> (event) => {
    <span class="keyword">if</span> (event.data <span class="keyword">instanceof</span> Blob) {
        <span class="keyword">const</span> text = <span class="keyword">await</span> event.data.<span class="function">text</span>();
        console.<span class="function">log</span>(<span class="string">'Blob as text:'</span>, text);
    }
};
                </div>
            </div>
            
            <!-- Closing Connection -->
            <div class="section">
                <h2>üîå Closing Connection</h2>
                
                <div class="code-block">
<span class="comment">// Close connection</span>
ws.<span class="function">close</span>();

<span class="comment">// Close with code and reason</span>
ws.<span class="function">close</span>(<span class="number">1000</span>, <span class="string">'Normal closure'</span>);
<span class="comment">//        ‚Üë code   ‚Üë reason (optional)</span>

<span class="comment">// Handle close event</span>
ws.<span class="keyword">onclose</span> = (event) => {
    console.<span class="function">log</span>(<span class="string">'Connection closed'</span>);
    console.<span class="function">log</span>(<span class="string">'Code:'</span>, event.code);
    console.<span class="function">log</span>(<span class="string">'Reason:'</span>, event.reason);
    console.<span class="function">log</span>(<span class="string">'Clean close?'</span>, event.wasClean);
};

<span class="comment">// Common close codes</span>
<span class="number">1000</span> <span class="comment">// Normal closure</span>
<span class="number">1001</span> <span class="comment">// Going away (page unload)</span>
<span class="number">1002</span> <span class="comment">// Protocol error</span>
<span class="number">1003</span> <span class="comment">// Unsupported data</span>
<span class="number">1006</span> <span class="comment">// Abnormal closure (no close frame)</span>
<span class="number">1007</span> <span class="comment">// Invalid frame payload</span>
<span class="number">1008</span> <span class="comment">// Policy violation</span>
<span class="number">1009</span> <span class="comment">// Message too big</span>
<span class="number">1011</span> <span class="comment">// Server error</span>
<span class="number">1015</span> <span class="comment">// TLS handshake failure</span>
                </div>
            </div>
            
            <!-- Practical Patterns -->
            <div class="section">
                <h2>üéØ Practical Patterns</h2>
                
                <h3>Pattern 1: Reconnection Logic</h3>
                <div class="code-block">
<span class="keyword">class</span> <span class="function">ReconnectingWebSocket</span> {
    <span class="keyword">constructor</span>(url, options = {}) {
        <span class="keyword">this</span>.url = url;
        <span class="keyword">this</span>.reconnectDelay = options.reconnectDelay || <span class="number">1000</span>;
        <span class="keyword">this</span>.maxReconnectDelay = options.maxReconnectDelay || <span class="number">30000</span>;
        <span class="keyword">this</span>.reconnectAttempts = <span class="number">0</span>;
        <span class="keyword">this</span>.shouldReconnect = <span class="keyword">true</span>;
        
        <span class="keyword">this</span>.<span class="function">connect</span>();
    }
    
    <span class="function">connect</span>() {
        <span class="keyword">this</span>.ws = <span class="keyword">new</span> <span class="function">WebSocket</span>(<span class="keyword">this</span>.url);
        
        <span class="keyword">this</span>.ws.<span class="keyword">onopen</span> = (e) => {
            console.<span class="function">log</span>(<span class="string">'Connected'</span>);
            <span class="keyword">this</span>.reconnectAttempts = <span class="number">0</span>;
            <span class="keyword">this</span>.<span class="function">onopen</span>?.(e);
        };
        
        <span class="keyword">this</span>.ws.<span class="keyword">onmessage</span> = (e) => {
            <span class="keyword">this</span>.<span class="function">onmessage</span>?.(e);
        };
        
        <span class="keyword">this</span>.ws.<span class="keyword">onerror</span> = (e) => {
            console.<span class="function">error</span>(<span class="string">'WebSocket error'</span>);
            <span class="keyword">this</span>.<span class="function">onerror</span>?.(e);
        };
        
        <span class="keyword">this</span>.ws.<span class="keyword">onclose</span> = (e) => {
            console.<span class="function">log</span>(<span class="string">'Disconnected'</span>);
            <span class="keyword">this</span>.<span class="function">onclose</span>?.(e);
            
            <span class="keyword">if</span> (<span class="keyword">this</span>.shouldReconnect) {
                <span class="keyword">this</span>.<span class="function">scheduleReconnect</span>();
            }
        };
    }
    
    <span class="function">scheduleReconnect</span>() {
        <span class="keyword">this</span>.reconnectAttempts++;
        
        <span class="comment">// Exponential backoff</span>
        <span class="keyword">const</span> delay = Math.<span class="function">min</span>(
            <span class="keyword">this</span>.reconnectDelay * Math.<span class="function">pow</span>(<span class="number">2</span>, <span class="keyword">this</span>.reconnectAttempts),
            <span class="keyword">this</span>.maxReconnectDelay
        );
        
        console.<span class="function">log</span>(<span class="string">`Reconnecting in ${delay}ms...`</span>);
        
        <span class="function">setTimeout</span>(() => <span class="keyword">this</span>.<span class="function">connect</span>(), delay);
    }
    
    <span class="function">send</span>(data) {
        <span class="keyword">if</span> (<span class="keyword">this</span>.ws.readyState === WebSocket.OPEN) {
            <span class="keyword">this</span>.ws.<span class="function">send</span>(data);
        } <span class="keyword">else</span> {
            console.<span class="function">error</span>(<span class="string">'WebSocket not open'</span>);
        }
    }
    
    <span class="function">close</span>() {
        <span class="keyword">this</span>.shouldReconnect = <span class="keyword">false</span>;
        <span class="keyword">this</span>.ws.<span class="function">close</span>();
    }
}

<span class="comment">// Usage</span>
<span class="keyword">const</span> ws = <span class="keyword">new</span> <span class="function">ReconnectingWebSocket</span>(<span class="string">'wss://example.com/socket'</span>);
ws.onmessage = (e) => console.<span class="function">log</span>(e.data);
ws.<span class="function">send</span>(<span class="string">'Hello!'</span>);
                </code>
                </div>
                
                <h3>Pattern 2: Message Queue</h3>
                <div class="code-block">
<span class="keyword">class</span> <span class="function">QueuedWebSocket</span> {
    <span class="keyword">constructor</span>(url) {
        <span class="keyword">this</span>.url = url;
        <span class="keyword">this</span>.queue = [];
        <span class="keyword">this</span>.<span class="function">connect</span>();
    }
    
    <span class="function">connect</span>() {
        <span class="keyword">this</span>.ws = <span class="keyword">new</span> <span class="function">WebSocket</span>(<span class="keyword">this</span>.url);
        
        <span class="keyword">this</span>.ws.<span class="keyword">onopen</span> = () => {
            console.<span class="function">log</span>(<span class="string">'Connected - processing queue'</span>);
            <span class="keyword">this</span>.<span class="function">processQueue</span>();
        };
    }
    
    <span class="function">send</span>(data) {
        <span class="keyword">if</span> (<span class="keyword">this</span>.ws.readyState === WebSocket.OPEN) {
            <span class="keyword">this</span>.ws.<span class="function">send</span>(data);
        } <span class="keyword">else</span> {
            <span class="comment">// Queue message if not connected</span>
            console.<span class="function">log</span>(<span class="string">'Queueing message'</span>);
            <span class="keyword">this</span>.queue.<span class="function">push</span>(data);
        }
    }
    
    <span class="function">processQueue</span>() {
        <span class="keyword">while</span> (<span class="keyword">this</span>.queue.length > <span class="number">0</span>) {
            <span class="keyword">const</span> data = <span class="keyword">this</span>.queue.<span class="function">shift</span>();
            <span class="keyword">this</span>.ws.<span class="function">send</span>(data);
        }
    }
}
                </div>
                
                <h3>Pattern 3: Heartbeat/Ping-Pong</h3>
                <div class="code-block">
<span class="keyword">class</span> <span class="function">HeartbeatWebSocket</span> {
    <span class="keyword">constructor</span>(url, heartbeatInterval = <span class="number">30000</span>) {
        <span class="keyword">this</span>.url = url;
        <span class="keyword">this</span>.heartbeatInterval = heartbeatInterval;
        <span class="keyword">this</span>.<span class="function">connect</span>();
    }
    
    <span class="function">connect</span>() {
        <span class="keyword">this</span>.ws = <span class="keyword">new</span> <span class="function">WebSocket</span>(<span class="keyword">this</span>.url);
        
        <span class="keyword">this</span>.ws.<span class="keyword">onopen</span> = () => {
            console.<span class="function">log</span>(<span class="string">'Connected - starting heartbeat'</span>);
            <span class="keyword">this</span>.<span class="function">startHeartbeat</span>();
        };
        
        <span class="keyword">this</span>.ws.<span class="keyword">onmessage</span> = (e) => {
            <span class="keyword">if</span> (e.data === <span class="string">'pong'</span>) {
                console.<span class="function">log</span>(<span class="string">'Received pong'</span>);
                <span class="keyword">this</span>.lastPong = Date.<span class="function">now</span>();
            } <span class="keyword">else</span> {
                <span class="keyword">this</span>.<span class="function">onmessage</span>?.(e);
            }
        };
        
        <span class="keyword">this</span>.ws.<span class="keyword">onclose</span> = () => {
            <span class="keyword">this</span>.<span class="function">stopHeartbeat</span>();
        };
    }
    
    <span class="function">startHeartbeat</span>() {
        <span class="keyword">this</span>.heartbeatTimer = <span class="function">setInterval</span>(() => {
            <span class="keyword">if</span> (<span class="keyword">this</span>.ws.readyState === WebSocket.OPEN) {
                console.<span class="function">log</span>(<span class="string">'Sending ping'</span>);
                <span class="keyword">this</span>.ws.<span class="function">send</span>(<span class="string">'ping'</span>);
                
                <span class="comment">// Check if last pong was too long ago</span>
                <span class="keyword">const</span> timeout = <span class="keyword">this</span>.heartbeatInterval * <span class="number">2</span>;
                <span class="keyword">if</span> (Date.<span class="function">now</span>() - <span class="keyword">this</span>.lastPong > timeout) {
                    console.<span class="function">error</span>(<span class="string">'Connection seems dead'</span>);
                    <span class="keyword">this</span>.ws.<span class="function">close</span>();
                }
            }
        }, <span class="keyword">this</span>.heartbeatInterval);
    }
    
    <span class="function">stopHeartbeat</span>() {
        <span class="function">clearInterval</span>(<span class="keyword">this</span>.heartbeatTimer);
    }
    
    <span class="function">send</span>(data) {
        <span class="keyword">if</span> (<span class="keyword">this</span>.ws.readyState === WebSocket.OPEN) {
            <span class="keyword">this</span>.ws.<span class="function">send</span>(data);
        }
    }
}
                </div>
            </div>
            
            <!-- Use Cases -->
            <div class="section">
                <h2>üíº Real-World Use Cases</h2>
                
                <div class="use-case-grid">
                    <div class="use-case-card">
                        <h4>üí¨ Chat Application</h4>
                        <p>Instant message delivery between users with typing indicators and presence status.</p>
                    </div>
                    
                    <div class="use-case-card">
                        <h4>üìä Live Dashboard</h4>
                        <p>Real-time data updates for analytics, metrics, and monitoring systems.</p>
                    </div>
                    
                    <div class="use-case-card">
                        <h4>üéÆ Multiplayer Games</h4>
                        <p>Low-latency player position and action synchronization.</p>
                    </div>
                    
                    <div class="use-case-card">
                        <h4>üìù Collaborative Editing</h4>
                        <p>Google Docs-style real-time collaborative document editing.</p>
                    </div>
                    
                    <div class="use-case-card">
                        <h4>üìà Stock Ticker</h4>
                        <p>Live stock prices and trading data updates.</p>
                    </div>
                    
                    <div class="use-case-card">
                        <h4>üîî Notifications</h4>
                        <p>Push notifications for events, alerts, and updates.</p>
                    </div>
                </div>
            </div>
            
            <!-- Comparison -->
            <div class="section">
                <h2>‚öñÔ∏è WebSockets vs Alternatives</h2>
                
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>Feature</th>
                            <th>WebSockets</th>
                            <th>HTTP Polling</th>
                            <th>Server-Sent Events</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Direction</strong></td>
                            <td>Bidirectional (‚ÜîÔ∏è)</td>
                            <td>Client ‚Üí Server only</td>
                            <td>Server ‚Üí Client only</td>
                        </tr>
                        <tr>
                            <td><strong>Connection</strong></td>
                            <td>Persistent</td>
                            <td>Multiple short connections</td>
                            <td>Persistent (HTTP)</td>
                        </tr>
                        <tr>
                            <td><strong>Overhead</strong></td>
                            <td>Low</td>
                            <td>High (headers each request)</td>
                            <td>Medium</td>
                        </tr>
                        <tr>
                            <td><strong>Latency</strong></td>
                            <td>Very low</td>
                            <td>High (polling interval)</td>
                            <td>Low</td>
                        </tr>
                        <tr>
                            <td><strong>Browser Support</strong></td>
                            <td>All modern browsers</td>
                            <td>All browsers</td>
                            <td>All modern browsers</td>
                        </tr>
                        <tr>
                            <td><strong>Use Case</strong></td>
                            <td>Real-time bidirectional</td>
                            <td>Simple updates</td>
                            <td>Server push only</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- Interactive Demo -->
            <div class="section">
                <h2>üéÆ Interactive Demo</h2>
                
                <div class="demo-section">
                    <h3>Try WebSocket Now!</h3>
                    <p style="margin-bottom: 15px;">Connect to a public WebSocket echo server</p>
                    
                    <div class="demo-controls">
                        <input type="text" id="wsUrl" value="wss://echo.websocket.org" readonly>
                        <button onclick="connectWS()" id="connectBtn">Connect</button>
                        <button onclick="disconnectWS()" id="disconnectBtn" disabled>Disconnect</button>
                    </div>
                    
                    <div style="display: flex; align-items: center; margin: 15px 0;">
                        <span style="font-weight: bold; margin-right: 10px;">Status:</span>
                        <span class="status-indicator status-closed" id="statusIndicator"></span>
                        <span id="statusText">Disconnected</span>
                    </div>
                    
                    <h4 style="margin-top: 20px;">Send Message</h4>
                    <div class="demo-controls">
                        <textarea id="messageInput" placeholder="Type message...">Hello WebSocket!</textarea>
                        <button onclick="sendMessage()" id="sendBtn" disabled>Send</button>
                    </div>
                    
                    <h4 style="margin-top: 20px;">Messages</h4>
                    <div class="output" id="output">Connect to start receiving messages...</div>
                </div>
            </div>
            
            <!-- Best Practices -->
            <div class="section">
                <h2>‚úÖ Best Practices</h2>
                
                <div class="key-point">
                    <h3 style="margin-top: 0;">DO ‚úì</h3>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li>Use <code>wss://</code> (secure) in production</li>
                        <li>Implement reconnection logic</li>
                        <li>Add heartbeat/ping-pong mechanism</li>
                        <li>Check <code>readyState</code> before sending</li>
                        <li>Queue messages when disconnected</li>
                        <li>Handle all event types (open, message, error, close)</li>
                        <li>Clean up on page unload</li>
                        <li>Use exponential backoff for reconnection</li>
                    </ul>
                </div>
                
                <div class="warning-box">
                    <h3 style="margin-top: 0;">DON'T ‚úó</h3>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li>Use <code>ws://</code> in production</li>
                        <li>Send messages before connection is open</li>
                        <li>Forget error handling</li>
                        <li>Ignore reconnection scenarios</li>
                        <li>Send large messages (split if needed)</li>
                        <li>Assume connection is always alive</li>
                        <li>Create multiple connections unnecessarily</li>
                    </ul>
                </div>
            </div>
            
        </div>
    </div>
    
    <script>
        let ws = null;
        
        function updateStatus(state, text) {
            const indicator = document.getElementById('statusIndicator');
            const statusText = document.getElementById('statusText');
            
            indicator.className = 'status-indicator';
            indicator.classList.add(`status-${state}`);
            statusText.textContent = text;
        }
        
        function log(message, type = 'info') {
            const output = document.getElementById('output');
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                info: 'color: #0d6efd;',
                success: 'color: #28a745;',
                error: 'color: #dc3545;',
                sent: 'color: #764ba2;',
                received: 'color: #667eea;'
            };
            output.innerHTML += `<div style="${colors[type]}">[${timestamp}] ${message}</div>`;
            output.scrollTop = output.scrollHeight;
        }
        
        function connectWS() {
            const url = document.getElementById('wsUrl').value;
            
            if (ws && ws.readyState === WebSocket.OPEN) {
                log('‚ö†Ô∏è Already connected', 'error');
                return;
            }
            
            log(`Connecting to ${url}...`, 'info');
            updateStatus('connecting', 'Connecting...');
            
            ws = new WebSocket(url);
            
            ws.onopen = () => {
                log('‚úì Connected successfully!', 'success');
                updateStatus('open', 'Connected');
                
                document.getElementById('connectBtn').disabled = true;
                document.getElementById('disconnectBtn').disabled = false;
                document.getElementById('sendBtn').disabled = false;
            };
            
            ws.onmessage = (event) => {
                log(`‚óÄ Received: ${event.data}`, 'received');
            };
            
            ws.onerror = (event) => {
                log('‚ùå WebSocket error occurred', 'error');
            };
            
            ws.onclose = (event) => {
                log(`Connection closed. Code: ${event.code}, Reason: ${event.reason || 'None'}`, 'info');
                updateStatus('closed', 'Disconnected');
                
                document.getElementById('connectBtn').disabled = false;
                document.getElementById('disconnectBtn').disabled = true;
                document.getElementById('sendBtn').disabled = true;
            };
        }
        
        function disconnectWS() {
            if (ws) {
                log('Disconnecting...', 'info');
                ws.close(1000, 'User disconnected');
            }
        }
        
        function sendMessage() {
            const message = document.getElementById('messageInput').value;
            
            if (!message.trim()) {
                log('‚ùå Cannot send empty message', 'error');
                return;
            }
            
            if (ws && ws.readyState === WebSocket.OPEN) {
                ws.send(message);
                log(`‚ñ∂ Sent: ${message}`, 'sent');
            } else {
                log('‚ùå WebSocket not connected', 'error');
            }
        }
        
        // Initialize
        window.addEventListener('load', () => {
            log('üëã Welcome to WebSocket Demo!', 'success');
            log('Click Connect to start.', 'info');
        });
        
        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            if (ws && ws.readyState === WebSocket.OPEN) {
                ws.close();
            }
        });
    </script>
</body>
</html>