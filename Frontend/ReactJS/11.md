# Chapter 11: React Router - In-Depth Explanation

## What is React Router?

**React Router** is the standard routing library for React, enabling navigation between different views/pages in a single-page application (SPA).

**Installation:**
```bash
npm install react-router-dom
```

---

## 11.1 Router Basics

### BrowserRouter vs HashRouter

**BrowserRouter** (recommended):
```javascript
import { BrowserRouter } from 'react-router-dom';

function App() {
  return (
    <BrowserRouter>
      {/* Routes */}
    </BrowserRouter>
  );
}

// URLs: /about, /contact, /products/123
// Uses HTML5 History API
// Requires server configuration for production
```

**HashRouter:**
```javascript
import { HashRouter } from 'react-router-dom';

function App() {
  return (
    <HashRouter>
      {/* Routes */}
    </HashRouter>
  );
}

// URLs: /#/about, /#/contact, /#/products/123
// Works without server configuration
// Use when you can't configure server
```

### Basic Routing (v6)

```javascript
import { BrowserRouter, Routes, Route, Link } from 'react-router-dom';

function App() {
  return (
    <BrowserRouter>
      {/* Navigation */}
      <nav>
        <Link to="/">Home</Link>
        <Link to="/about">About</Link>
        <Link to="/contact">Contact</Link>
      </nav>
      
      {/* Routes */}
      <Routes>
        <Route path="/" element={<Home />} />
        <Route path="/about" element={<About />} />
        <Route path="/contact" element={<Contact />} />
        <Route path="*" element={<NotFound />} />  {/* 404 */}
      </Routes>
    </BrowserRouter>
  );
}

function Home() {
  return <h1>Home Page</h1>;
}

function About() {
  return <h1>About Page</h1>;
}

function Contact() {
  return <h1>Contact Page</h1>;
}

function NotFound() {
  return <h1>404 - Page Not Found</h1>;
}
```

### Link vs NavLink

```javascript
import { Link, NavLink } from 'react-router-dom';

function Navigation() {
  return (
    <nav>
      {/* Regular link */}
      <Link to="/about">About</Link>
      
      {/* NavLink - knows if active */}
      <NavLink 
        to="/about"
        className={({ isActive }) => 
          isActive ? 'nav-link active' : 'nav-link'
        }
      >
        About
      </NavLink>
      
      {/* With style */}
      <NavLink
        to="/about"
        style={({ isActive }) => ({
          color: isActive ? 'red' : 'black'
        })}
      >
        About
      </NavLink>
    </nav>
  );
}
```

---

## 11.2 Advanced Routing

### Nested Routes

```javascript
import { Routes, Route, Outlet, Link } from 'react-router-dom';

function App() {
  return (
    <Routes>
      <Route path="/" element={<Home />} />
      <Route path="/dashboard" element={<DashboardLayout />}>
        {/* Nested routes */}
        <Route index element={<DashboardHome />} />
        <Route path="profile" element={<Profile />} />
        <Route path="settings" element={<Settings />} />
      </Route>
    </Routes>
  );
}

function DashboardLayout() {
  return (
    <div className="dashboard">
      <nav>
        <Link to="/dashboard">Dashboard Home</Link>
        <Link to="/dashboard/profile">Profile</Link>
        <Link to="/dashboard/settings">Settings</Link>
      </nav>
      
      {/* Child routes render here */}
      <Outlet />
    </div>
  );
}

function DashboardHome() {
  return <h2>Dashboard Overview</h2>;
}

// URLs:
// /dashboard → Shows DashboardHome
// /dashboard/profile → Shows Profile
// /dashboard/settings → Shows Settings
```

### Dynamic Routes (URL Parameters)

```javascript
import { useParams } from 'react-router-dom';

function App() {
  return (
    <Routes>
      <Route path="/users/:userId" element={<UserProfile />} />
      <Route path="/posts/:postId/comments/:commentId" element={<Comment />} />
    </Routes>
  );
}

function UserProfile() {
  const { userId } = useParams();  // Get URL parameter
  
  return <h1>User Profile: {userId}</h1>;
}

// /users/123 → userId = "123"
// /users/abc → userId = "abc"

// TypeScript
interface Params {
  userId: string;
}

function UserProfile() {
  const { userId } = useParams<Params>();
  
  return <h1>User Profile: {userId}</h1>;
}
```

### Query Parameters

```javascript
import { useSearchParams } from 'react-router-dom';

function SearchPage() {
  const [searchParams, setSearchParams] = useSearchParams();
  
  const query = searchParams.get('q');
  const page = searchParams.get('page') || '1';
  
  const handleSearch = (value: string) => {
    setSearchParams({ q: value, page: '1' });
  };
  
  return (
    <div>
      <p>Searching for: {query}</p>
      <p>Page: {page}</p>
      
      <input 
        onChange={(e) => handleSearch(e.target.value)}
        placeholder="Search..."
      />
      
      <button onClick={() => setSearchParams({ q: query, page: '2' })}>
        Next Page
      </button>
    </div>
  );
}

// URL: /search?q=react&page=2
```

### Protected Routes

```javascript
import { Navigate } from 'react-router-dom';

function ProtectedRoute({ children }) {
  const { user } = useAuth();
  
  if (!user) {
    return <Navigate to="/login" replace />;
  }
  
  return children;
}

// Usage
function App() {
  return (
    <Routes>
      <Route path="/login" element={<Login />} />
      
      <Route 
        path="/dashboard" 
        element={
          <ProtectedRoute>
            <Dashboard />
          </ProtectedRoute>
        } 
      />
      
      <Route 
        path="/profile" 
        element={
          <ProtectedRoute>
            <Profile />
          </ProtectedRoute>
        } 
      />
    </Routes>
  );
}

// Role-based protection
function AdminRoute({ children }) {
  const { user } = useAuth();
  
  if (!user) {
    return <Navigate to="/login" />;
  }
  
  if (user.role !== 'admin') {
    return <Navigate to="/unauthorized" />;
  }
  
  return children;
}
```

---

## 11.3 Programmatic Navigation

### useNavigate Hook

```javascript
import { useNavigate } from 'react-router-dom';

function LoginForm() {
  const navigate = useNavigate();
  
  const handleSubmit = async (e) => {
    e.preventDefault();
    
    const success = await loginUser(credentials);
    
    if (success) {
      navigate('/dashboard');  // Navigate after login
    }
  };
  
  return <form onSubmit={handleSubmit}>{/* form */}</form>;
}

// Navigate with options
function Component() {
  const navigate = useNavigate();
  
  // Navigate and replace history
  navigate('/dashboard', { replace: true });
  
  // Navigate with state
  navigate('/profile', { state: { from: 'login' } });
  
  // Go back
  navigate(-1);
  
  // Go forward
  navigate(1);
}

// Access passed state
import { useLocation } from 'react-router-dom';

function Profile() {
  const location = useLocation();
  const from = location.state?.from;
  
  return <div>Navigated from: {from}</div>;
}
```

### Navigate Component

```javascript
import { Navigate } from 'react-router-dom';

function OldPage() {
  return <Navigate to="/new-page" replace />;
}

// Conditional navigation
function Dashboard() {
  const { user } = useAuth();
  
  if (!user) {
    return <Navigate to="/login" />;
  }
  
  return <div>Dashboard</div>;
}
```

---

## 11.4 Code Splitting with Routes

### Lazy Loading Routes

```javascript
import { lazy, Suspense } from 'react';
import { Routes, Route } from 'react-router-dom';

// Lazy load route components
const Home = lazy(() => import('./pages/Home'));
const About = lazy(() => import('./pages/About'));
const Dashboard = lazy(() => import('./pages/Dashboard'));

function App() {
  return (
    <Suspense fallback={<LoadingSpinner />}>
      <Routes>
        <Route path="/" element={<Home />} />
        <Route path="/about" element={<About />} />
        <Route path="/dashboard" element={<Dashboard />} />
      </Routes>
    </Suspense>
  );
}

// Each route is a separate bundle chunk
// Loaded only when user navigates to that route
```

**With Error Boundary:**
```javascript
import { lazy, Suspense } from 'react';
import { ErrorBoundary } from 'react-error-boundary';

const Dashboard = lazy(() => import('./pages/Dashboard'));

function App() {
  return (
    <ErrorBoundary fallback={<ErrorPage />}>
      <Suspense fallback={<Loading />}>
        <Routes>
          <Route path="/dashboard" element={<Dashboard />} />
        </Routes>
      </Suspense>
    </ErrorBoundary>
  );
}
```

---

## Summary of Chapter 11

**Key Concepts:**

1. **BrowserRouter** - Use HTML5 History API (recommended)
2. **Routes & Route** - Define app routes
3. **Link & NavLink** - Navigation components
4. **useParams** - Access URL parameters
5. **useSearchParams** - Access query strings
6. **useNavigate** - Programmatic navigation
7. **Nested Routes** - Routes within routes
8. **Protected Routes** - Auth-based routing
9. **Code Splitting** - Lazy load routes

**Common Patterns:**

```javascript
// Basic routing
<Routes>
  <Route path="/" element={<Home />} />
  <Route path="/about" element={<About />} />
</Routes>

// Dynamic routes
<Route path="/users/:id" element={<User />} />

// Nested routes
<Route path="/dashboard" element={<Layout />}>
  <Route path="profile" element={<Profile />} />
</Route>

// Protected routes
<Route path="/admin" element={<Protected><Admin /></Protected>} />

// 404
<Route path="*" element={<NotFound />} />
```

**Best Practices:**

- Use BrowserRouter for production
- Lazy load routes for better performance
- Protect routes that require authentication
- Use nested routes for layouts
- Handle 404 with catch-all route (*)