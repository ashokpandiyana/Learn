# Chapter 21: Build & Deployment

## 21.1 Build Optimization

### Overview
Build optimization is the process of preparing your React application for production by creating efficient, minified bundles that load quickly and perform well. This involves removing development-only code, minifying JavaScript and CSS, and optimizing assets.

### Production Builds

#### What Happens in Production Build?
1. **Code Minification**: Removes whitespace, shortens variable names
2. **Dead Code Elimination**: Removes unused code
3. **Development Warnings Removed**: All PropTypes and warnings stripped
4. **Source Maps Generated**: For debugging production issues
5. **Assets Optimization**: Images, fonts optimized
6. **Bundle Splitting**: Code split into smaller chunks

#### Build Commands

**Create React App:**
```bash
npm run build
# Creates optimized build in /build folder
```

**Vite:**
```bash
npm run build
# Creates optimized build in /dist folder
npm run preview  # Preview production build locally
```

**Next.js:**
```bash
npm run build
npm start  # Runs production server
```

#### Build Output Analysis
```bash
# Vite with Bundle Analyzer
npm install --save-dev rollup-plugin-visualizer

# vite.config.js
import { visualizer } from 'rollup-plugin-visualizer';

export default {
  plugins: [
    visualizer({
      open: true,
      gzipSize: true,
      brotliSize: true
    })
  ]
}

# Create React App
npm install --save-dev webpack-bundle-analyzer
npm run build -- --stats
npx webpack-bundle-analyzer build/bundle-stats.json
```

### Environment Variables

Environment variables allow you to configure your app differently across environments (development, staging, production) without changing code.

#### Setting Up Environment Variables

**Vite Projects:**
```bash
# .env.development
VITE_API_URL=http://localhost:3001/api
VITE_API_KEY=dev_key_12345
VITE_ENABLE_ANALYTICS=false
VITE_DEBUG_MODE=true

# .env.production
VITE_API_URL=https://api.production.com/api
VITE_API_KEY=prod_key_67890
VITE_ENABLE_ANALYTICS=true
VITE_DEBUG_MODE=false

# .env.staging
VITE_API_URL=https://api.staging.com/api
VITE_API_KEY=staging_key_54321
VITE_ENABLE_ANALYTICS=true
VITE_DEBUG_MODE=true
```

**Create React App:**
```bash
# .env.development
REACT_APP_API_URL=http://localhost:3001/api
REACT_APP_API_KEY=dev_key_12345

# .env.production
REACT_APP_API_URL=https://api.production.com/api
REACT_APP_API_KEY=prod_key_67890
```

#### Using Environment Variables

**Vite:**
```javascript
// Access environment variables
const apiUrl = import.meta.env.VITE_API_URL;
const apiKey = import.meta.env.VITE_API_KEY;
const isDev = import.meta.env.DEV;  // boolean
const isProd = import.meta.env.PROD; // boolean

// config.js - Centralized configuration
export const config = {
  apiUrl: import.meta.env.VITE_API_URL,
  apiKey: import.meta.env.VITE_API_KEY,
  enableAnalytics: import.meta.env.VITE_ENABLE_ANALYTICS === 'true',
  debugMode: import.meta.env.VITE_DEBUG_MODE === 'true'
};

// Usage in components
import { config } from './config';

fetch(`${config.apiUrl}/users`, {
  headers: {
    'Authorization': `Bearer ${config.apiKey}`
  }
});
```

**Create React App:**
```javascript
const apiUrl = process.env.REACT_APP_API_URL;
const apiKey = process.env.REACT_APP_API_KEY;
```

#### Security Best Practices
```bash
# ❌ Never commit sensitive data
# .env
DATABASE_PASSWORD=super_secret_password
STRIPE_SECRET_KEY=sk_live_xxxxx

# ✅ Use .gitignore
.env
.env.local
.env.*.local

# ✅ Use secrets management for production
# - Vercel: Environment Variables in dashboard
# - Netlify: Build environment variables
# - AWS: Secrets Manager
# - GitHub Actions: Secrets
```

### Tree Shaking

Tree shaking is a term for dead code elimination. It removes unused exports from your final bundle.

#### How Tree Shaking Works

```javascript
// utils.js - Multiple exports
export const add = (a, b) => a + b;
export const subtract = (a, b) => a - b;
export const multiply = (a, b) => a * b;
export const divide = (a, b) => a / b;
export const power = (a, b) => Math.pow(a, b);

// App.js - Only import what you need
import { add, multiply } from './utils';

// Final bundle only includes add and multiply
// subtract, divide, and power are removed automatically
```

#### Tree Shaking with Libraries

```javascript
// ❌ Bad - Imports entire library (100KB+)
import _ from 'lodash';
const result = _.debounce(fn, 300);

// ✅ Good - Imports only debounce (~5KB)
import debounce from 'lodash/debounce';
const result = debounce(fn, 300);

// ✅ Even Better - Use lodash-es (ES modules)
import { debounce } from 'lodash-es';

// ❌ Bad - Imports all icons
import * as Icons from 'react-icons/fa';

// ✅ Good - Imports specific icon
import { FaHome } from 'react-icons/fa';
```

#### Making Code Tree-Shakeable

```javascript
// ❌ Bad - Side effects prevent tree shaking
const utils = {
  add: (a, b) => a + b,
  subtract: (a, b) => a - b
};

console.log('Utils loaded!'); // Side effect!

export default utils;

// ✅ Good - Pure exports, no side effects
export const add = (a, b) => a + b;
export const subtract = (a, b) => a - b;

// package.json - Mark as side-effect free
{
  "sideEffects": false
}

// Or specify files with side effects
{
  "sideEffects": ["*.css", "*.scss"]
}
```

### Code Splitting

Code splitting breaks your bundle into smaller chunks that can be loaded on demand, reducing initial load time.

#### Route-Based Code Splitting

```javascript
import { lazy, Suspense } from 'react';
import { BrowserRouter, Routes, Route } from 'react-router-dom';

// Lazy load route components
const Home = lazy(() => import('./pages/Home'));
const Dashboard = lazy(() => import('./pages/Dashboard'));
const Profile = lazy(() => import('./pages/Profile'));
const Settings = lazy(() => import('./pages/Settings'));
const Analytics = lazy(() => import('./pages/Analytics'));

// Loading component
const PageLoader = () => (
  <div className="loader">
    <div className="spinner"></div>
    <p>Loading page...</p>
  </div>
);

function App() {
  return (
    <BrowserRouter>
      <Suspense fallback={<PageLoader />}>
        <Routes>
          <Route path="/" element={<Home />} />
          <Route path="/dashboard" element={<Dashboard />} />
          <Route path="/profile" element={<Profile />} />
          <Route path="/settings" element={<Settings />} />
          <Route path="/analytics" element={<Analytics />} />
        </Routes>
      </Suspense>
    </BrowserRouter>
  );
}
```

#### Component-Based Code Splitting

```javascript
import { lazy, Suspense, useState } from 'react';

// Lazy load heavy components
const HeavyChart = lazy(() => import('./components/HeavyChart'));
const VideoPlayer = lazy(() => import('./components/VideoPlayer'));
const RichTextEditor = lazy(() => import('./components/RichTextEditor'));

function Dashboard() {
  const [showChart, setShowChart] = useState(false);
  const [showVideo, setShowVideo] = useState(false);

  return (
    <div>
      <h1>Dashboard</h1>
      
      {/* Load chart only when needed */}
      <button onClick={() => setShowChart(true)}>
        Show Analytics Chart
      </button>
      
      {showChart && (
        <Suspense fallback={<div>Loading chart...</div>}>
          <HeavyChart data={analyticsData} />
        </Suspense>
      )}

      {/* Load video player only when needed */}
      <button onClick={() => setShowVideo(true)}>
        Play Video
      </button>
      
      {showVideo && (
        <Suspense fallback={<div>Loading player...</div>}>
          <VideoPlayer url="/video.mp4" />
        </Suspense>
      )}
    </div>
  );
}
```

#### Advanced Code Splitting with Prefetching

```javascript
import { lazy, Suspense, useEffect } from 'react';

// Lazy load with prefetching
const Settings = lazy(() => import('./pages/Settings'));

// Prefetch component on hover
const prefetchSettings = () => {
  const component = import('./pages/Settings');
  return component;
};

function Navigation() {
  return (
    <nav>
      <Link 
        to="/settings"
        onMouseEnter={prefetchSettings}
        onTouchStart={prefetchSettings}
      >
        Settings
      </Link>
    </nav>
  );
}

// Prefetch on idle
function App() {
  useEffect(() => {
    // Prefetch after initial load
    if ('requestIdleCallback' in window) {
      requestIdleCallback(() => {
        import('./pages/Settings');
        import('./pages/Profile');
      });
    }
  }, []);

  return <Routes>...</Routes>;
}
```

---

## 21.2 Deployment Strategies

### Vercel Deployment

Vercel is optimized for Next.js but works great with any React app.

#### Setup and Configuration

```bash
# Install Vercel CLI
npm i -g vercel

# Deploy
vercel

# Deploy to production
vercel --prod

# Set environment variables
vercel env add VITE_API_URL production
```

**vercel.json Configuration:**
```json
{
  "buildCommand": "npm run build",
  "outputDirectory": "dist",
  "devCommand": "npm run dev",
  "installCommand": "npm install",
  "framework": "vite",
  "rewrites": [
    {
      "source": "/(.*)",
      "destination": "/index.html"
    }
  ],
  "headers": [
    {
      "source": "/(.*)",
      "headers": [
        {
          "key": "X-Content-Type-Options",
          "value": "nosniff"
        },
        {
          "key": "X-Frame-Options",
          "value": "DENY"
        },
        {
          "key": "X-XSS-Protection",
          "value": "1; mode=block"
        }
      ]
    },
    {
      "source": "/static/(.*)",
      "headers": [
        {
          "key": "Cache-Control",
          "value": "public, max-age=31536000, immutable"
        }
      ]
    }
  ],
  "redirects": [
    {
      "source": "/old-page",
      "destination": "/new-page",
      "permanent": true
    }
  ]
}
```

### Netlify Deployment

#### Configuration

```toml
# netlify.toml
[build]
  command = "npm run build"
  publish = "dist"
  
[build.environment]
  NODE_VERSION = "18"
  NPM_VERSION = "9"

# SPA redirect - important for client-side routing
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200

# Headers for security and caching
[[headers]]
  for = "/*"
  [headers.values]
    X-Frame-Options = "DENY"
    X-XSS-Protection = "1; mode=block"
    X-Content-Type-Options = "nosniff"
    Referrer-Policy = "strict-origin-when-cross-origin"

[[headers]]
  for = "/static/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "*.js"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "*.css"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

# Redirects
[[redirects]]
  from = "/old-blog/*"
  to = "/blog/:splat"
  status = 301

# Environment-specific builds
[context.production]
  command = "npm run build:production"

[context.staging]
  command = "npm run build:staging"

[context.branch-deploy]
  command = "npm run build:preview"
```

### AWS Amplify

```yaml
# amplify.yml
version: 1
frontend:
  phases:
    preBuild:
      commands:
        - npm ci
    build:
      commands:
        - npm run build
  artifacts:
    baseDirectory: dist
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
customHeaders:
  - pattern: '**/*'
    headers:
      - key: 'X-Frame-Options'
        value: 'DENY'
      - key: 'X-XSS-Protection'
        value: '1; mode=block'
  - pattern: '/static/*'
    headers:
      - key: 'Cache-Control'
        value: 'public, max-age=31536000, immutable'
```

### Docker Deployment

#### Multi-Stage Dockerfile

```dockerfile
# Build stage
FROM node:18-alpine AS builder

WORKDIR /app

# Copy package files
COPY package*.json ./

# Install dependencies
RUN npm ci --only=production

# Copy source code
COPY . .

# Build application
RUN npm run build

# Production stage
FROM nginx:alpine

# Copy custom nginx config
COPY nginx.conf /etc/nginx/conf.d/default.conf

# Copy built assets from builder
COPY --from=builder /app/dist /usr/share/nginx/html

# Expose port
EXPOSE 80

# Start nginx
CMD ["nginx", "-g", "daemon off;"]
```

**nginx.conf:**
```nginx
server {
    listen 80;
    server_name localhost;
    root /usr/share/nginx/html;
    index index.html;

    # Gzip compression
    gzip on;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;

    # SPA routing - serve index.html for all routes
    location / {
        try_files $uri $uri/ /index.html;
    }

    # Cache static assets
    location /static/ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }

    # Security headers
    add_header X-Frame-Options "DENY" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
}
```

**docker-compose.yml:**
```yaml
version: '3.8'

services:
  react-app:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "80:80"
    environment:
      - NODE_ENV=production
    restart: unless-stopped
```

**Build and Run:**
```bash
# Build image
docker build -t my-react-app .

# Run container
docker run -p 80:80 my-react-app

# Using docker-compose
docker-compose up -d
```

---

## 21.3 CI/CD (Continuous Integration/Continuous Deployment)

### GitHub Actions

**Complete CI/CD Workflow:**

```.github/workflows/ci-cd.yml
name: CI/CD Pipeline

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]

jobs:
  # Job 1: Lint and Test
  test:
    runs-on: ubuntu-latest
    
    strategy:
      matrix:
        node-version: [16.x, 18.x, 20.x]
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
      
      - name: Setup Node.js ${{ matrix.node-version }}
        uses: actions/setup-node@v3
        with:
          node-version: ${{ matrix.node-version }}
          cache: 'npm'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Run linter
        run: npm run lint
      
      - name: Run type check
        run: npm run type-check
      
      - name: Run tests
        run: npm run test:ci
      
      - name: Upload coverage
        uses: codecov/codecov-action@v3
        with:
          file: ./coverage/coverage-final.json

  # Job 2: Build
  build:
    needs: test
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18.x'
          cache: 'npm'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Build application
        run: npm run build
        env:
          VITE_API_URL: ${{ secrets.API_URL }}
          VITE_API_KEY: ${{ secrets.API_KEY }}
      
      - name: Upload build artifacts
        uses: actions/upload-artifact@v3
        with:
          name: dist
          path: dist/

  # Job 3: Deploy to Staging
  deploy-staging:
    needs: build
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/develop'
    
    steps:
      - name: Download build artifacts
        uses: actions/download-artifact@v3
        with:
          name: dist
          path: dist/
      
      - name: Deploy to Netlify Staging
        uses: netlify/actions/cli@master
        env:
          NETLIFY_AUTH_TOKEN: ${{ secrets.NETLIFY_AUTH_TOKEN }}
          NETLIFY_SITE_ID: ${{ secrets.NETLIFY_STAGING_SITE_ID }}
        with:
          args: deploy --dir=dist --prod

  # Job 4: Deploy to Production
  deploy-production:
    needs: build
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    
    environment:
      name: production
      url: https://myapp.com
    
    steps:
      - name: Download build artifacts
        uses: actions/download-artifact@v3
        with:
          name: dist
          path: dist/
      
      - name: Deploy to Vercel
        uses: amondnet/vercel-action@v20
        with:
          vercel-token: ${{ secrets.VERCEL_TOKEN }}
          vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}
          vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}
          vercel-args: '--prod'
          working-directory: ./
```

### Jenkins Pipeline

```groovy
// Jenkinsfile
pipeline {
    agent any
    
    environment {
        NODE_VERSION = '18.x'
        DOCKER_IMAGE = 'my-react-app'
    }
    
    stages {
        stage('Checkout') {
            steps {
                git branch: 'main',
                    url: 'https://github.com/user/repo.git'
            }
        }
        
        stage('Install Dependencies') {
            steps {
                sh 'npm ci'
            }
        }
        
        stage('Lint') {
            steps {
                sh 'npm run lint'
            }
        }
        
        stage('Test') {
            steps {
                sh 'npm run test:ci'
            }
            post {
                always {
                    junit 'coverage/junit.xml'
                    publishHTML([
                        reportDir: 'coverage',
                        reportFiles: 'index.html',
                        reportName: 'Coverage Report'
                    ])
                }
            }
        }
        
        stage('Build') {
            steps {
                sh 'npm run build'
            }
        }
        
        stage('Docker Build') {
            steps {
                sh 'docker build -t ${DOCKER_IMAGE}:${BUILD_NUMBER} .'
                sh 'docker tag ${DOCKER_IMAGE}:${BUILD_NUMBER} ${DOCKER_IMAGE}:latest'
            }
        }
        
        stage('Deploy') {
            when {
                branch 'main'
            }
            steps {
                sh 'docker-compose up -d'
            }
        }
    }
    
    post {
        success {
            echo 'Pipeline succeeded!'
        }
        failure {
            echo 'Pipeline failed!'
        }
    }
}
```

---

## 21.4 Monitoring

### Performance Monitoring

#### Web Vitals Monitoring

```javascript
// reportWebVitals.js
import { getCLS, getFID, getFCP, getLCP, getTTFB } from 'web-vitals';

function sendToAnalytics({ name, value, id }) {
  // Send to your analytics service
  if (window.gtag) {
    window.gtag('event', name, {
      event_category: 'Web Vitals',
      value: Math.round(name === 'CLS' ? value * 1000 : value),
      event_label: id,
      non_interaction: true,
    });
  }
  
  // Or send to custom endpoint
  fetch('/api/analytics', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ name, value, id })
  });
}

// Measure all vitals
getCLS(sendToAnalytics);
getFID(sendToAnalytics);
getFCP(sendToAnalytics);
getLCP(sendToAnalytics);
getTTFB(sendToAnalytics);

export default sendToAnalytics;
```

**Usage in App:**
```javascript
// main.jsx
import React from 'react';
import ReactDOM from 'react-dom/client';
import App from './App';
import reportWebVitals from './reportWebVitals';

ReactDOM.createRoot(document.getElementById('root')).render(
  <React.StrictMode>
    <App />
  </React.StrictMode>
);

reportWebVitals();
```

### Error Tracking with Sentry

```javascript
// sentry.config.js
import * as Sentry from "@sentry/react";
import { BrowserTracing } from "@sentry/tracing";

Sentry.init({
  dsn: import.meta.env.VITE_SENTRY_DSN,
  integrations: [
    new BrowserTracing(),
    new Sentry.Replay({
      maskAllText: false,
      blockAllMedia: false,
    }),
  ],
  
  // Performance Monitoring
  tracesSampleRate: 1.0, // 100% in dev, lower in production
  
  // Session Replay
  replaysSessionSampleRate: 0.1, // 10% of sessions
  replaysOnErrorSampleRate: 1.0, // 100% of sessions with errors
  
  // Environment
  environment: import.meta.env.MODE,
  
  // Release tracking
  release: `my-app@${import.meta.env.VITE_APP_VERSION}`,
  
  beforeSend(event, hint) {
    // Filter out certain errors
    if (event.exception) {
      const error = hint.originalException;
      if (error && error.message.match(/ResizeObserver loop/i)) {
        return null; // Don't send this error
      }
    }
    return event;
  },
});

// Error Boundary with Sentry
export const SentryErrorBoundary = Sentry.ErrorBoundary;
```

**Usage:**
```javascript
// App.jsx
import { SentryErrorBoundary } from './sentry.config';

function App() {
  return (
    <SentryErrorBoundary fallback={<ErrorFallback />}>
      <Routes>
        {/* Your routes */}
      </Routes>
    </SentryErrorBoundary>
  );
}

// Manual error reporting
import * as Sentry from "@sentry/react";

try {
  riskyOperation();
} catch (error) {
  Sentry.captureException(error, {
    tags: {
      section: 'payment',
      userId: currentUser.id
    },
    level: 'error'
  });
}
```

### Application Analytics

```javascript
// analytics.js
class Analytics {
  constructor() {
    this.initialized = false;
  }

  init() {
    if (this.initialized) return;
    
    // Google Analytics 4
    if (import.meta.env.VITE_GA_ID) {
      const script = document.createElement('script');
      script.src = `https://www.googletagmanager.com/gtag/js?id=${import.meta.env.VITE_GA_ID}`;
      script.async = true;
      document.head.appendChild(script);

      window.dataLayer = window.dataLayer || [];
      window.gtag = function() { window.dataLayer.push(arguments); }
      window.gtag('js', new Date());
      window.gtag('config', import.meta.env.VITE_GA_ID);
      
      this.initialized = true;
    }
  }

  pageView(path) {
    if (window.gtag) {
      window.gtag('config', import.meta.env.VITE_GA_ID, {
        page_path: path
      });
    }
  }

  event(eventName, params = {}) {
    if (window.gtag) {
      window.gtag('event', eventName, params);
    }
  }

  setUser(userId) {
    if (window.gtag) {
      window.gtag('config', import.meta.env.VITE_GA_ID, {
        user_id: userId
      });
    }
  }
}

export default new Analytics();
```

**Track Page Views with React Router:**
```javascript
import { useEffect } from 'react';
import { useLocation } from 'react-router-dom';
import analytics from './analytics';

function App() {
  const location = useLocation();

  useEffect(() => {
    analytics.init();
  }, []);

  useEffect(() => {
    analytics.pageView(location.pathname + location.search);
  }, [location]);

  return <Routes>...</Routes>;
}
```

**Track Custom Events:**
```javascript
import analytics from './analytics';

function ProductCard({ product }) {
  const handleAddToCart = () => {
    addToCart(product);
    
    // Track event
    analytics.event('add_to_cart', {
      currency: 'USD',
      value: product.price,
      items: [{
        item_id: product.id,
        item_name: product.name,
        item_category: product.category,
        price: product.price,
        quantity: 1
      }]
    });
  };

  return (
    <button onClick={handleAddToCart}>
      Add to Cart
    </button>
  );
}
```

### Real User Monitoring (RUM)

```javascript
// rum.js - Custom Real User Monitoring
class RUM {
  constructor() {
    this.metrics = [];
    this.observe();
  }

  observe() {
    // Performance Observer for navigation timing
    if ('PerformanceObserver' in window) {
      const observer = new PerformanceObserver((list) => {
        for (const entry of list.getEntries()) {
          this.trackMetric(entry);
        }
      });

      observer.observe({ entryTypes: ['navigation', 'resource', 'paint'] });
    }

    // Track Long Tasks (>50ms)
    if ('PerformanceObserver' in window) {
      const longTaskObserver = new PerformanceObserver((list) => {
        for (const entry of list.getEntries()) {
          if (entry.duration > 50) {
            this.sendToServer({
              type: 'long-task',
              duration: entry.duration,
              startTime: entry.startTime
            });
          }
        }
      });

      longTaskObserver.observe({ entryTypes: ['longtask'] });
    }
  }

  trackMetric(entry) {
    this.metrics.push({
      name: entry.name,
      type: entry.entryType,
      startTime: entry.startTime,
      duration: entry.duration
    });
  }

  sendToServer(data) {
    // Use sendBeacon for reliable sending
    if (navigator.sendBeacon) {
      navigator.sendBeacon('/api/metrics', JSON.stringify(data));
    }
  }

  getMetrics() {
    return this.metrics;
  }
}

export default new RUM();
```

---

## Best Practices Checklist

### Build Optimization
- ✅ Use production builds for deployment
- ✅ Implement code splitting for routes
- ✅ Lazy load heavy components
- ✅ Analyze and optimize bundle size regularly
- ✅ Use environment variables properly
- ✅ Never commit secrets to version control
- ✅ Enable tree shaking
- ✅ Minify and compress assets

### Deployment
- ✅ Use HTTPS in production
- ✅ Set up proper security headers
- ✅ Configure caching strategies
- ✅ Implement SPA routing redirects
- ✅ Use CDN for static assets
- ✅ Set up staging environment
- ✅ Enable gzip/brotli compression

### CI/CD
- ✅ Automate testing in pipeline
- ✅ Lint and type-check before deployment
- ✅ Use environment-specific builds
- ✅ Implement rollback strategy
- ✅ Set up deployment previews
- ✅ Run security scans
- ✅ Track deployment metrics

### Monitoring
- ✅ Track Web Vitals (LCP, FID, CLS)
- ✅ Set up error tracking (Sentry)
- ✅ Monitor application performance
- ✅ Track user analytics
- ✅ Set up alerts for critical issues
- ✅ Log important user actions
- ✅ Monitor API response times

---

## Common Issues and Solutions

### Issue: Bundle Size Too Large
**Solution:**
1. Analyze bundle with webpack-bundle-analyzer
2. Implement code splitting
3. Use dynamic imports
4. Remove unused dependencies
5. Use smaller alternatives (date-fns instead of moment.js)

### Issue: Environment Variables Not Working
**Solution:**
1. Check variable prefix (VITE_ or REACT_APP_)
2. Restart development server
3. Ensure .env file is in root directory
4. Don't quote values in .env files

### Issue: 404 on Refresh in SPA
**Solution:**
Configure server to serve index.html for all routes:
- Vercel: Add rewrites in vercel.json
- Netlify: Add redirects in netlify.toml
- Nginx: Configure try_files
- Apache: Use .htaccess with mod_rewrite

### Issue: CORS Errors in Production
**Solution:**
1. Configure backend to allow your domain
2. Use environment-specific API URLs
3. Set up proxy in development
4. Check preflight requests

This completes Chapter 21 on Build & Deployment!