<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chapter 2: Apollo Client Setup & Architecture</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 100%);
      color: #e4e4e7;
      line-height: 1.7;
      padding: 40px 20px;
      min-height: 100vh;
    }
    .container { max-width: 900px; margin: 0 auto; }
    h1 {
      font-size: 2.5rem;
      background: linear-gradient(90deg, #38bdf8, #818cf8);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 10px;
    }
    .subtitle { color: #a1a1aa; font-size: 1.1rem; margin-bottom: 40px; }
    h2 {
      color: #38bdf8;
      font-size: 1.6rem;
      margin: 40px 0 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid #3f3f46;
    }
    h3 { color: #7dd3fc; font-size: 1.2rem; margin: 25px 0 15px; }
    h4 { color: #a5b4fc; font-size: 1rem; margin: 20px 0 10px; }
    p { margin-bottom: 15px; color: #d4d4d8; }
    .highlight-box {
      background: linear-gradient(135deg, #1e3a5f 0%, #0c1929 100%);
      border-left: 4px solid #38bdf8;
      padding: 20px;
      border-radius: 0 12px 12px 0;
      margin: 20px 0;
    }
    .warning-box {
      background: linear-gradient(135deg, #78350f 0%, #451a03 100%);
      border-left: 4px solid #f59e0b;
      padding: 20px;
      border-radius: 0 12px 12px 0;
      margin: 20px 0;
    }
    .warning-box::before { content: "‚ö†Ô∏è INTERVIEW HIGHLIGHT: "; font-weight: bold; color: #fbbf24; }
    .tip-box {
      background: linear-gradient(135deg, #064e3b 0%, #022c22 100%);
      border-left: 4px solid #10b981;
      padding: 20px;
      border-radius: 0 12px 12px 0;
      margin: 20px 0;
    }
    .tip-box::before { content: "üìù PRODUCTION TIP: "; font-weight: bold; color: #34d399; }
    .concept-box {
      background: linear-gradient(135deg, #4c1d95 0%, #2e1065 100%);
      border-left: 4px solid #a78bfa;
      padding: 20px;
      border-radius: 0 12px 12px 0;
      margin: 20px 0;
    }
    .concept-box::before { content: "üí° DEEP DIVE: "; font-weight: bold; color: #c4b5fd; }
    pre {
      background: #0a0a1a;
      border: 1px solid #3f3f46;
      border-radius: 12px;
      padding: 20px;
      overflow-x: auto;
      margin: 15px 0;
    }
    code {
      font-family: 'Fira Code', 'Consolas', monospace;
      font-size: 0.9rem;
    }
    .inline-code {
      background: #3f3f46;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 0.85rem;
    }
    .keyword { color: #c084fc; }
    .type { color: #38bdf8; }
    .string { color: #4ade80; }
    .comment { color: #6b7280; font-style: italic; }
    .field { color: #fbbf24; }
    .function { color: #f472b6; }
    .const { color: #fb923c; }
    .diagram {
      background: #0a0a1a;
      border-radius: 12px;
      padding: 30px;
      margin: 20px 0;
      text-align: center;
      overflow-x: auto;
    }
    .diagram svg { max-width: 100%; height: auto; }
    .feature-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
      margin: 20px 0;
    }
    .feature-card {
      background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
      border: 1px solid #334155;
      border-radius: 12px;
      padding: 20px;
    }
    .feature-card h5 {
      color: #38bdf8;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .feature-card p { font-size: 0.9rem; color: #94a3b8; margin: 0; }
    .step-container {
      position: relative;
      padding-left: 40px;
      margin: 20px 0;
    }
    .step-number {
      position: absolute;
      left: 0;
      top: 0;
      width: 28px;
      height: 28px;
      background: linear-gradient(135deg, #3b82f6, #8b5cf6);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 0.9rem;
    }
    .step-content h4 { margin-top: 0; }
    ul { margin: 15px 0 15px 25px; }
    li { margin: 8px 0; color: #d4d4d8; }
    .comparison-table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
      background: #1e293b;
      border-radius: 12px;
      overflow: hidden;
    }
    .comparison-table th {
      background: linear-gradient(90deg, #1e40af, #4c1d95);
      padding: 15px;
      text-align: left;
      font-weight: 600;
    }
    .comparison-table td {
      padding: 12px 15px;
      border-bottom: 1px solid #334155;
    }
    .comparison-table tr:last-child td { border-bottom: none; }
    .chapter-nav {
      display: flex;
      justify-content: space-between;
      margin-top: 50px;
      padding-top: 30px;
      border-top: 1px solid #3f3f46;
    }
    .nav-btn {
      padding: 12px 24px;
      background: linear-gradient(90deg, #1e40af, #3b82f6);
      border: none;
      border-radius: 8px;
      color: white;
      font-weight: 600;
      cursor: pointer;
    }
    .architecture-layer {
      background: linear-gradient(90deg, #1e293b, #0f172a);
      border: 1px solid #334155;
      border-radius: 8px;
      padding: 15px 20px;
      margin: 10px 0;
      display: flex;
      align-items: center;
      gap: 15px;
    }
    .layer-icon {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, #3b82f6, #8b5cf6);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
    }
    .layer-content h5 { color: #38bdf8; margin-bottom: 5px; }
    .layer-content p { color: #94a3b8; font-size: 0.85rem; margin: 0; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Chapter 2</h1>
    <p class="subtitle">Apollo Client Setup & Architecture ‚Äî Building the Foundation</p>

    <!-- Section 2.1 -->
    <h2>2.1 Why Apollo Client?</h2>
    
    <p>Apollo Client is the most popular and comprehensive GraphQL client for JavaScript applications. It provides a complete solution for managing local and remote data with GraphQL.</p>

    <div class="feature-grid">
      <div class="feature-card">
        <h5>üöÄ Declarative Data Fetching</h5>
        <p>Describe what data you need, Apollo handles the how. No manual fetch calls or state management.</p>
      </div>
      <div class="feature-card">
        <h5>üíæ Intelligent Caching</h5>
        <p>Normalized cache with automatic updates. Change data once, update everywhere instantly.</p>
      </div>
      <div class="feature-card">
        <h5>üîÑ Optimistic UI</h5>
        <p>Show expected results immediately while operations complete in the background.</p>
      </div>
      <div class="feature-card">
        <h5>üì° Real-time Subscriptions</h5>
        <p>Built-in WebSocket support for live data updates with subscriptions.</p>
      </div>
      <div class="feature-card">
        <h5>üõ†Ô∏è Excellent DevTools</h5>
        <p>Browser extension to inspect queries, cache, and debug GraphQL operations.</p>
      </div>
      <div class="feature-card">
        <h5>üéØ TypeScript Ready</h5>
        <p>Full TypeScript support with generated types from your schema.</p>
      </div>
    </div>

    <div class="highlight-box">
      <strong>Alternatives to Apollo:</strong> While Apollo is the most popular, other options include Relay (Facebook's client), urql (lightweight), and React Query + graphql-request (minimal approach). Apollo offers the best balance of features and developer experience for most projects.
    </div>

    <!-- Section 2.2 -->
    <h2>2.2 Installation</h2>

    <div class="step-container">
      <div class="step-number">1</div>
      <div class="step-content">
        <h4>Install Required Packages</h4>
        <pre><code><span class="comment"># Using npm</span>
npm install @apollo/client graphql

<span class="comment"># Using yarn</span>
yarn add @apollo/client graphql

<span class="comment"># Using pnpm</span>
pnpm add @apollo/client graphql</code></pre>
      </div>
    </div>

    <div class="highlight-box">
      <strong>Package Breakdown:</strong>
      <ul>
        <li><code class="inline-code">@apollo/client</code> ‚Äî The main Apollo Client library with React hooks</li>
        <li><code class="inline-code">graphql</code> ‚Äî The JavaScript reference implementation of GraphQL (peer dependency)</li>
      </ul>
    </div>

    <!-- Section 2.3 -->
    <h2>2.3 Basic Setup ‚Äî Step by Step</h2>

    <div class="step-container">
      <div class="step-number">1</div>
      <div class="step-content">
        <h4>Create the Apollo Client Instance</h4>
        <pre><code><span class="comment">// src/lib/apollo-client.js</span>
<span class="keyword">import</span> { 
  <span class="type">ApolloClient</span>, 
  <span class="type">InMemoryCache</span>, 
  <span class="type">HttpLink</span> 
} <span class="keyword">from</span> <span class="string">'@apollo/client'</span>;

<span class="comment">// Create the HTTP connection to your GraphQL API</span>
<span class="keyword">const</span> <span class="const">httpLink</span> = <span class="keyword">new</span> <span class="function">HttpLink</span>({
  <span class="field">uri</span>: <span class="string">'https://your-api.com/graphql'</span>,  <span class="comment">// Your GraphQL endpoint</span>
  <span class="field">credentials</span>: <span class="string">'include'</span>,  <span class="comment">// Send cookies for auth</span>
});

<span class="comment">// Create the Apollo Client</span>
<span class="keyword">export const</span> <span class="const">client</span> = <span class="keyword">new</span> <span class="function">ApolloClient</span>({
  <span class="field">link</span>: httpLink,
  <span class="field">cache</span>: <span class="keyword">new</span> <span class="function">InMemoryCache</span>(),
  <span class="field">defaultOptions</span>: {
    <span class="field">watchQuery</span>: {
      <span class="field">fetchPolicy</span>: <span class="string">'cache-and-network'</span>,
    },
  },
});</code></pre>
      </div>
    </div>

    <div class="step-container">
      <div class="step-number">2</div>
      <div class="step-content">
        <h4>Wrap Your App with ApolloProvider</h4>
        <pre><code><span class="comment">// src/main.jsx (or index.jsx)</span>
<span class="keyword">import</span> <span class="type">React</span> <span class="keyword">from</span> <span class="string">'react'</span>;
<span class="keyword">import</span> <span class="type">ReactDOM</span> <span class="keyword">from</span> <span class="string">'react-dom/client'</span>;
<span class="keyword">import</span> { <span class="type">ApolloProvider</span> } <span class="keyword">from</span> <span class="string">'@apollo/client'</span>;
<span class="keyword">import</span> { <span class="const">client</span> } <span class="keyword">from</span> <span class="string">'./lib/apollo-client'</span>;
<span class="keyword">import</span> <span class="type">App</span> <span class="keyword">from</span> <span class="string">'./App'</span>;

<span class="type">ReactDOM</span>.<span class="function">createRoot</span>(document.<span class="function">getElementById</span>(<span class="string">'root'</span>)).<span class="function">render</span>(
  <span class="keyword">&lt;</span><span class="type">React.StrictMode</span><span class="keyword">&gt;</span>
    <span class="keyword">&lt;</span><span class="type">ApolloProvider</span> <span class="field">client</span>={client}<span class="keyword">&gt;</span>
      <span class="keyword">&lt;</span><span class="type">App</span> <span class="keyword">/&gt;</span>
    <span class="keyword">&lt;/</span><span class="type">ApolloProvider</span><span class="keyword">&gt;</span>
  <span class="keyword">&lt;/</span><span class="type">React.StrictMode</span><span class="keyword">&gt;</span>
);</code></pre>
      </div>
    </div>

    <div class="step-container">
      <div class="step-number">3</div>
      <div class="step-content">
        <h4>Use GraphQL in Your Components</h4>
        <pre><code><span class="comment">// src/components/UserList.jsx</span>
<span class="keyword">import</span> { <span class="type">useQuery</span>, <span class="type">gql</span> } <span class="keyword">from</span> <span class="string">'@apollo/client'</span>;

<span class="comment">// Define your query</span>
<span class="keyword">const</span> <span class="const">GET_USERS</span> = <span class="function">gql</span><span class="string">`
  query GetUsers {
    users {
      id
      name
      email
      avatar
    }
  }
`</span>;

<span class="keyword">function</span> <span class="function">UserList</span>() {
  <span class="comment">// Execute the query</span>
  <span class="keyword">const</span> { <span class="field">loading</span>, <span class="field">error</span>, <span class="field">data</span> } = <span class="function">useQuery</span>(<span class="const">GET_USERS</span>);

  <span class="keyword">if</span> (loading) <span class="keyword">return</span> <span class="keyword">&lt;</span>p<span class="keyword">&gt;</span>Loading...<span class="keyword">&lt;/</span>p<span class="keyword">&gt;</span>;
  <span class="keyword">if</span> (error) <span class="keyword">return</span> <span class="keyword">&lt;</span>p<span class="keyword">&gt;</span>Error: {error.message}<span class="keyword">&lt;/</span>p<span class="keyword">&gt;</span>;

  <span class="keyword">return</span> (
    <span class="keyword">&lt;</span>ul<span class="keyword">&gt;</span>
      {data.users.<span class="function">map</span>(user => (
        <span class="keyword">&lt;</span>li <span class="field">key</span>={user.id}<span class="keyword">&gt;</span>
          <span class="keyword">&lt;</span>img <span class="field">src</span>={user.avatar} <span class="field">alt</span>={user.name} <span class="keyword">/&gt;</span>
          <span class="keyword">&lt;</span>span<span class="keyword">&gt;</span>{user.name}<span class="keyword">&lt;/</span>span<span class="keyword">&gt;</span>
          <span class="keyword">&lt;</span>span<span class="keyword">&gt;</span>{user.email}<span class="keyword">&lt;/</span>span<span class="keyword">&gt;</span>
        <span class="keyword">&lt;/</span>li<span class="keyword">&gt;</span>
      ))}
    <span class="keyword">&lt;/</span>ul<span class="keyword">&gt;</span>
  );
}

<span class="keyword">export default</span> <span class="type">UserList</span>;</code></pre>
      </div>
    </div>

    <div class="tip-box">
      Always define queries outside your component (as constants) to prevent recreating the query object on every render. This also makes queries reusable across components.
    </div>

    <!-- Section 2.4 -->
    <h2>2.4 Apollo Client Architecture ‚Äî Deep Dive</h2>

    <p>Understanding Apollo's architecture is crucial for interviews and building production apps. Let's break down each layer:</p>

    <div class="diagram">
      <svg viewBox="0 0 700 450" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <linearGradient id="grad1" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%" style="stop-color:#3b82f6;stop-opacity:1" />
            <stop offset="100%" style="stop-color:#8b5cf6;stop-opacity:1" />
          </linearGradient>
          <linearGradient id="grad2" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%" style="stop-color:#06b6d4;stop-opacity:1" />
            <stop offset="100%" style="stop-color:#3b82f6;stop-opacity:1" />
          </linearGradient>
          <linearGradient id="grad3" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%" style="stop-color:#10b981;stop-opacity:1" />
            <stop offset="100%" style="stop-color:#06b6d4;stop-opacity:1" />
          </linearGradient>
          <linearGradient id="grad4" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%" style="stop-color:#f59e0b;stop-opacity:1" />
            <stop offset="100%" style="stop-color:#ef4444;stop-opacity:1" />
          </linearGradient>
        </defs>
        
        <!-- Title -->
        <text x="350" y="30" fill="#e4e4e7" font-size="18" font-weight="bold" text-anchor="middle">Apollo Client Architecture</text>
        
        <!-- Layer 1: React Components -->
        <rect x="100" y="60" width="500" height="60" rx="10" fill="url(#grad1)"/>
        <text x="350" y="85" fill="white" font-size="14" font-weight="bold" text-anchor="middle">React Components</text>
        <text x="350" y="105" fill="rgba(255,255,255,0.8)" font-size="11" text-anchor="middle">Your UI components that consume GraphQL data</text>
        
        <!-- Arrow -->
        <path d="M350 120 L350 145" stroke="#6b7280" stroke-width="2" marker-end="url(#arrowhead)"/>
        <path d="M350 145 L350 120" stroke="#6b7280" stroke-width="2" marker-end="url(#arrowhead)"/>
        
        <!-- Layer 2: Hooks -->
        <rect x="100" y="150" width="500" height="60" rx="10" fill="url(#grad2)"/>
        <text x="350" y="175" fill="white" font-size="14" font-weight="bold" text-anchor="middle">Apollo Hooks Layer</text>
        <text x="350" y="195" fill="rgba(255,255,255,0.8)" font-size="11" text-anchor="middle">useQuery ‚Ä¢ useMutation ‚Ä¢ useSubscription ‚Ä¢ useLazyQuery</text>
        
        <!-- Arrow -->
        <path d="M350 210 L350 235" stroke="#6b7280" stroke-width="2"/>
        <path d="M350 235 L350 210" stroke="#6b7280" stroke-width="2"/>
        
        <!-- Layer 3: Link Chain -->
        <rect x="100" y="240" width="500" height="60" rx="10" fill="url(#grad3)"/>
        <text x="350" y="265" fill="white" font-size="14" font-weight="bold" text-anchor="middle">Apollo Link Chain (Middleware)</text>
        <text x="350" y="285" fill="rgba(255,255,255,0.8)" font-size="11" text-anchor="middle">ErrorLink ‚Üí AuthLink ‚Üí RetryLink ‚Üí HttpLink/WebSocketLink</text>
        
        <!-- Arrow -->
        <path d="M350 300 L350 325" stroke="#6b7280" stroke-width="2"/>
        <path d="M350 325 L350 300" stroke="#6b7280" stroke-width="2"/>
        
        <!-- Layer 4: Cache -->
        <rect x="100" y="330" width="500" height="60" rx="10" fill="url(#grad4)"/>
        <text x="350" y="355" fill="white" font-size="14" font-weight="bold" text-anchor="middle">InMemoryCache (Normalized Store)</text>
        <text x="350" y="375" fill="rgba(255,255,255,0.8)" font-size="11" text-anchor="middle">Stores data by __typename:id ‚Ä¢ Automatic updates ‚Ä¢ Field policies</text>
        
        <!-- Side labels -->
        <text x="80" y="95" fill="#94a3b8" font-size="10" text-anchor="end">VIEW</text>
        <text x="80" y="185" fill="#94a3b8" font-size="10" text-anchor="end">DATA LAYER</text>
        <text x="80" y="275" fill="#94a3b8" font-size="10" text-anchor="end">NETWORK</text>
        <text x="80" y="365" fill="#94a3b8" font-size="10" text-anchor="end">STORAGE</text>
        
        <!-- Network/Server -->
        <rect x="250" y="410" width="200" height="35" rx="5" fill="#374151" stroke="#6b7280"/>
        <text x="350" y="432" fill="#9ca3af" font-size="12" text-anchor="middle">GraphQL Server</text>
        
        <defs>
          <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
            <polygon points="0 0, 10 3.5, 0 7" fill="#6b7280"/>
          </marker>
        </defs>
      </svg>
    </div>

    <h3>Layer-by-Layer Breakdown</h3>

    <div class="architecture-layer">
      <div class="layer-icon">‚öõÔ∏è</div>
      <div class="layer-content">
        <h5>React Components</h5>
        <p>Your UI components that use hooks to fetch and display data. They don't know about HTTP or caching ‚Äî they just declare what data they need.</p>
      </div>
    </div>

    <div class="architecture-layer">
      <div class="layer-icon">ü™ù</div>
      <div class="layer-content">
        <h5>Apollo Hooks Layer</h5>
        <p>React hooks that connect components to Apollo Client. They manage loading states, errors, and re-renders automatically when data changes.</p>
      </div>
    </div>

    <div class="architecture-layer">
      <div class="layer-icon">üîó</div>
      <div class="layer-content">
        <h5>Apollo Link Chain</h5>
        <p>Middleware pipeline for GraphQL operations. Each link can modify requests/responses. Used for auth, error handling, retries, logging, etc.</p>
      </div>
    </div>

    <div class="architecture-layer">
      <div class="layer-icon">üíæ</div>
      <div class="layer-content">
        <h5>InMemoryCache</h5>
        <p>Normalized cache that stores all fetched data. Objects are stored by unique identifier, enabling automatic UI updates when data changes anywhere.</p>
      </div>
    </div>

    <div class="warning-box">
      Apollo Client uses a <strong>normalized cache</strong> where each object is stored by its <code class="inline-code">__typename</code> and <code class="inline-code">id</code>. This means if you update a User in one place, ALL components displaying that User automatically re-render with the new data.
    </div>

    <!-- Cache Deep Dive -->
    <h3>Understanding the Normalized Cache</h3>

    <p>The cache is the heart of Apollo Client. Understanding how it works is essential for interviews.</p>

    <pre><code><span class="comment">// When you execute this query:</span>
<span class="keyword">query</span> {
  <span class="field">user</span>(id: <span class="string">"1"</span>) {
    <span class="field">id</span>
    <span class="field">name</span>
    <span class="field">email</span>
    <span class="field">posts</span> {
      <span class="field">id</span>
      <span class="field">title</span>
    }
  }
}

<span class="comment">// Apollo stores it like this in the cache:</span>
{
  <span class="string">"ROOT_QUERY"</span>: {
    <span class="string">"__typename"</span>: <span class="string">"Query"</span>,
    <span class="string">"user({\"id\":\"1\"})"</span>: {
      <span class="string">"__ref"</span>: <span class="string">"User:1"</span>  <span class="comment">// Reference to normalized object</span>
    }
  },
  <span class="string">"User:1"</span>: {
    <span class="string">"__typename"</span>: <span class="string">"User"</span>,
    <span class="string">"id"</span>: <span class="string">"1"</span>,
    <span class="string">"name"</span>: <span class="string">"John Doe"</span>,
    <span class="string">"email"</span>: <span class="string">"john@example.com"</span>,
    <span class="string">"posts"</span>: [
      { <span class="string">"__ref"</span>: <span class="string">"Post:101"</span> },
      { <span class="string">"__ref"</span>: <span class="string">"Post:102"</span> }
    ]
  },
  <span class="string">"Post:101"</span>: {
    <span class="string">"__typename"</span>: <span class="string">"Post"</span>,
    <span class="string">"id"</span>: <span class="string">"101"</span>,
    <span class="string">"title"</span>: <span class="string">"Introduction to GraphQL"</span>
  },
  <span class="string">"Post:102"</span>: {
    <span class="string">"__typename"</span>: <span class="string">"Post"</span>,
    <span class="string">"id"</span>: <span class="string">"102"</span>,
    <span class="string">"title"</span>: <span class="string">"Advanced Apollo Client"</span>
  }
}</code></pre>

    <div class="concept-box">
      <strong>Why Normalization Matters:</strong><br><br>
      1. <strong>Deduplication:</strong> If the same User appears in multiple queries, they share the same cached object.<br>
      2. <strong>Automatic Updates:</strong> Update User:1's name once ‚Üí every component showing User:1 updates.<br>
      3. <strong>Memory Efficiency:</strong> No duplicate data storage.<br>
      4. <strong>Cache Reads:</strong> Subsequent queries for the same data are instant (cache hit).
    </div>

    <!-- Section 2.5 -->
    <h2>2.5 Apollo DevTools</h2>

    <p>Apollo DevTools is an essential browser extension for debugging GraphQL applications.</p>

    <div class="step-container">
      <div class="step-number">1</div>
      <div class="step-content">
        <h4>Installation</h4>
        <p>Install from Chrome Web Store or Firefox Add-ons:</p>
        <ul>
          <li><a href="#" style="color: #38bdf8;">Chrome: Apollo Client Devtools</a></li>
          <li><a href="#" style="color: #38bdf8;">Firefox: Apollo Client Developer Tools</a></li>
        </ul>
      </div>
    </div>

    <div class="step-container">
      <div class="step-number">2</div>
      <div class="step-content">
        <h4>Features</h4>
        <div class="feature-grid">
          <div class="feature-card">
            <h5>üìä Query Inspector</h5>
            <p>View all active queries, their variables, and loading states in real-time.</p>
          </div>
          <div class="feature-card">
            <h5>üíæ Cache Inspector</h5>
            <p>Browse the normalized cache, see all stored objects, and their relationships.</p>
          </div>
          <div class="feature-card">
            <h5>üî¨ GraphiQL</h5>
            <p>Test queries directly against your API without leaving the browser.</p>
          </div>
          <div class="feature-card">
            <h5>üìú Mutation Log</h5>
            <p>Track all mutations, their variables, and responses.</p>
          </div>
        </div>
      </div>
    </div>

    <div class="step-container">
      <div class="step-number">3</div>
      <div class="step-content">
        <h4>Enable DevTools in Production</h4>
        <pre><code><span class="keyword">const</span> <span class="const">client</span> = <span class="keyword">new</span> <span class="function">ApolloClient</span>({
  <span class="field">uri</span>: <span class="string">'/graphql'</span>,
  <span class="field">cache</span>: <span class="keyword">new</span> <span class="function">InMemoryCache</span>(),
  <span class="comment">// Enable DevTools in development only</span>
  <span class="field">connectToDevTools</span>: process.env.NODE_ENV === <span class="string">'development'</span>,
});</code></pre>
      </div>
    </div>

    <div class="tip-box">
      Keep DevTools disabled in production to prevent users from inspecting your GraphQL operations and cache. This is both a performance and security consideration.
    </div>

    <!-- Complete Setup Example -->
    <h2>2.6 Complete Production-Ready Setup</h2>

    <p>Here's a comprehensive setup that you'd use in a real production application:</p>

    <pre><code><span class="comment">// src/lib/apollo-client.js</span>
<span class="keyword">import</span> {
  <span class="type">ApolloClient</span>,
  <span class="type">InMemoryCache</span>,
  <span class="type">HttpLink</span>,
  <span class="type">from</span>,
  <span class="type">ApolloLink</span>,
} <span class="keyword">from</span> <span class="string">'@apollo/client'</span>;
<span class="keyword">import</span> { <span class="type">onError</span> } <span class="keyword">from</span> <span class="string">'@apollo/client/link/error'</span>;
<span class="keyword">import</span> { <span class="type">setContext</span> } <span class="keyword">from</span> <span class="string">'@apollo/client/link/context'</span>;

<span class="comment">// API URL from environment</span>
<span class="keyword">const</span> <span class="const">API_URL</span> = process.env.REACT_APP_GRAPHQL_URL || <span class="string">'/graphql'</span>;

<span class="comment">// HTTP Connection</span>
<span class="keyword">const</span> <span class="const">httpLink</span> = <span class="keyword">new</span> <span class="function">HttpLink</span>({
  <span class="field">uri</span>: <span class="const">API_URL</span>,
  <span class="field">credentials</span>: <span class="string">'include'</span>,
});

<span class="comment">// Authentication Link - adds token to every request</span>
<span class="keyword">const</span> <span class="const">authLink</span> = <span class="function">setContext</span>((_, { headers }) => {
  <span class="keyword">const</span> <span class="const">token</span> = localStorage.<span class="function">getItem</span>(<span class="string">'authToken'</span>);
  
  <span class="keyword">return</span> {
    <span class="field">headers</span>: {
      ...headers,
      <span class="field">authorization</span>: token ? <span class="string">`Bearer </span>${token}<span class="string">`</span> : <span class="string">''</span>,
    },
  };
});

<span class="comment">// Error Handling Link</span>
<span class="keyword">const</span> <span class="const">errorLink</span> = <span class="function">onError</span>(({ graphQLErrors, networkError }) => {
  <span class="keyword">if</span> (graphQLErrors) {
    graphQLErrors.<span class="function">forEach</span>(({ message, locations, path, extensions }) => {
      console.<span class="function">error</span>(
        <span class="string">`[GraphQL Error]: Message: </span>${message}<span class="string">, Path: </span>${path}<span class="string">`</span>
      );
      
      <span class="comment">// Handle authentication errors</span>
      <span class="keyword">if</span> (extensions?.code === <span class="string">'UNAUTHENTICATED'</span>) {
        localStorage.<span class="function">removeItem</span>(<span class="string">'authToken'</span>);
        window.location.href = <span class="string">'/login'</span>;
      }
    });
  }

  <span class="keyword">if</span> (networkError) {
    console.<span class="function">error</span>(<span class="string">`[Network Error]: </span>${networkError}<span class="string">`</span>);
  }
});

<span class="comment">// Logging Link (development only)</span>
<span class="keyword">const</span> <span class="const">loggingLink</span> = <span class="keyword">new</span> <span class="function">ApolloLink</span>((operation, forward) => {
  <span class="keyword">if</span> (process.env.NODE_ENV === <span class="string">'development'</span>) {
    console.<span class="function">log</span>(<span class="string">`[GraphQL Request]: </span>${operation.operationName}<span class="string">`</span>);
  }
  <span class="keyword">return</span> <span class="function">forward</span>(operation);
});

<span class="comment">// Cache Configuration</span>
<span class="keyword">const</span> <span class="const">cache</span> = <span class="keyword">new</span> <span class="function">InMemoryCache</span>({
  <span class="field">typePolicies</span>: {
    <span class="field">Query</span>: {
      <span class="field">fields</span>: {
        <span class="comment">// Pagination merge policy</span>
        <span class="field">posts</span>: {
          <span class="function">keyArgs</span>: [<span class="string">'category'</span>],
          <span class="function">merge</span>(existing = [], incoming) {
            <span class="keyword">return</span> [...existing, ...incoming];
          },
        },
      },
    },
    <span class="field">User</span>: {
      <span class="field">keyFields</span>: [<span class="string">'id'</span>],
    },
  },
});

<span class="comment">// Create the Client</span>
<span class="keyword">export const</span> <span class="const">client</span> = <span class="keyword">new</span> <span class="function">ApolloClient</span>({
  <span class="field">link</span>: <span class="function">from</span>([
    loggingLink,
    errorLink,
    authLink,
    httpLink,
  ]),
  <span class="field">cache</span>,
  <span class="field">connectToDevTools</span>: process.env.NODE_ENV === <span class="string">'development'</span>,
  <span class="field">defaultOptions</span>: {
    <span class="field">watchQuery</span>: {
      <span class="field">fetchPolicy</span>: <span class="string">'cache-and-network'</span>,
      <span class="field">errorPolicy</span>: <span class="string">'all'</span>,
    },
    <span class="field">query</span>: {
      <span class="field">fetchPolicy</span>: <span class="string">'network-only'</span>,
      <span class="field">errorPolicy</span>: <span class="string">'all'</span>,
    },
    <span class="field">mutate</span>: {
      <span class="field">errorPolicy</span>: <span class="string">'all'</span>,
    },
  },
});</code></pre>

    <div class="warning-box">
      The order of links matters! Links are executed in order for requests (left to right) and in reverse for responses. Always put <code class="inline-code">errorLink</code> near the beginning to catch all errors, and <code class="inline-code">httpLink</code> at the end since it's the terminating link.
    </div>

    <div class="chapter-nav">
      <button class="nav-btn">‚Üê Chapter 1: GraphQL Core</button>
      <button class="nav-btn">Next: Chapter 3 ‚Äî Link Chain ‚Üí</button>
    </div>
  </div>
</body>
</html>
