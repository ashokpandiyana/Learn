<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chapter 18: Quick Reference Cheat Sheet</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      background: linear-gradient(135deg, #0a0a0f 0%, #1a1025 50%, #0f1a25 100%);
      color: #e4e4e7;
      line-height: 1.7;
      padding: 40px 20px;
      min-height: 100vh;
    }
    .container { max-width: 950px; margin: 0 auto; }
    h1 {
      font-size: 2.5rem;
      background: linear-gradient(90deg, #06b6d4, #8b5cf6, #ec4899);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 10px;
      text-align: center;
    }
    .subtitle { color: #a1a1aa; font-size: 1.1rem; margin-bottom: 40px; text-align: center; }
    .section {
      background: rgba(255,255,255,0.03);
      border-radius: 20px;
      padding: 30px;
      margin-bottom: 30px;
      border: 1px solid rgba(255,255,255,0.08);
      backdrop-filter: blur(10px);
    }
    h2 {
      font-size: 1.6rem;
      margin-bottom: 25px;
      display: flex;
      align-items: center;
      gap: 12px;
      padding-bottom: 15px;
      border-bottom: 2px solid rgba(255,255,255,0.1);
    }
    h2 .icon { font-size: 1.8rem; }
    h2 .text {
      background: linear-gradient(90deg, #06b6d4, #8b5cf6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    h3 { color: #f472b6; margin: 25px 0 15px; font-size: 1.2rem; }
    p { margin-bottom: 15px; color: #d4d4d8; }
    
    /* Hook Cards */
    .hooks-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin: 20px 0;
    }
    .hook-card {
      background: linear-gradient(135deg, rgba(6,182,212,0.1), rgba(139,92,246,0.05));
      border: 1px solid rgba(6,182,212,0.2);
      border-radius: 16px;
      padding: 20px;
      transition: transform 0.3s, box-shadow 0.3s;
    }
    .hook-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 40px rgba(6,182,212,0.2);
    }
    .hook-name {
      font-family: 'Fira Code', monospace;
      font-size: 1.1rem;
      color: #06b6d4;
      font-weight: 600;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .hook-name::before {
      content: "âš¡";
    }
    .hook-desc {
      color: #a1a1aa;
      font-size: 0.95rem;
      margin-bottom: 12px;
    }
    .hook-usage {
      background: rgba(0,0,0,0.3);
      border-radius: 8px;
      padding: 12px;
      font-family: 'Fira Code', monospace;
      font-size: 0.8rem;
      color: #86efac;
      overflow-x: auto;
    }
    .hook-when {
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid rgba(255,255,255,0.1);
      font-size: 0.85rem;
    }
    .hook-when strong { color: #fbbf24; }

    /* Policy Tables */
    .policy-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 15px;
      margin: 20px 0;
    }
    .policy-card {
      background: rgba(0,0,0,0.2);
      border-radius: 12px;
      padding: 18px;
      border-left: 4px solid;
      transition: transform 0.2s;
    }
    .policy-card:hover {
      transform: translateX(5px);
    }
    .policy-card.green { border-color: #22c55e; }
    .policy-card.blue { border-color: #3b82f6; }
    .policy-card.purple { border-color: #8b5cf6; }
    .policy-card.yellow { border-color: #fbbf24; }
    .policy-card.red { border-color: #ef4444; }
    .policy-card.cyan { border-color: #06b6d4; }
    .policy-name {
      font-family: 'Fira Code', monospace;
      font-weight: 600;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .policy-card.green .policy-name { color: #22c55e; }
    .policy-card.blue .policy-name { color: #3b82f6; }
    .policy-card.purple .policy-name { color: #8b5cf6; }
    .policy-card.yellow .policy-name { color: #fbbf24; }
    .policy-card.red .policy-name { color: #ef4444; }
    .policy-card.cyan .policy-name { color: #06b6d4; }
    .policy-behavior {
      color: #d4d4d8;
      font-size: 0.9rem;
      margin-bottom: 8px;
    }
    .policy-usecase {
      color: #a1a1aa;
      font-size: 0.85rem;
      font-style: italic;
    }

    /* Cache Methods */
    .cache-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin: 20px 0;
    }
    .cache-card {
      background: linear-gradient(135deg, rgba(139,92,246,0.1), rgba(236,72,153,0.05));
      border: 1px solid rgba(139,92,246,0.2);
      border-radius: 12px;
      padding: 18px;
      text-align: center;
    }
    .cache-method {
      font-family: 'Fira Code', monospace;
      color: #8b5cf6;
      font-weight: 600;
      font-size: 1rem;
      margin-bottom: 8px;
    }
    .cache-action {
      color: #d4d4d8;
      font-size: 0.9rem;
    }
    .cache-icon {
      font-size: 1.5rem;
      margin-bottom: 10px;
    }

    /* Link Chain */
    .link-chain {
      display: flex;
      align-items: center;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
      padding: 30px 20px;
      background: rgba(0,0,0,0.2);
      border-radius: 16px;
      margin: 20px 0;
    }
    .link-box {
      background: linear-gradient(135deg, #3b82f6, #1d4ed8);
      padding: 12px 20px;
      border-radius: 10px;
      font-weight: 600;
      font-size: 0.9rem;
      text-align: center;
      min-width: 100px;
      box-shadow: 0 4px 15px rgba(59,130,246,0.3);
    }
    .link-box.error { background: linear-gradient(135deg, #ef4444, #dc2626); }
    .link-box.auth { background: linear-gradient(135deg, #fbbf24, #d97706); color: #000; }
    .link-box.retry { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }
    .link-box.batch { background: linear-gradient(135deg, #06b6d4, #0891b2); }
    .link-box.http { background: linear-gradient(135deg, #22c55e, #16a34a); }
    .link-box.ws { background: linear-gradient(135deg, #ec4899, #db2777); }
    .link-arrow {
      color: #6b7280;
      font-size: 1.5rem;
    }

    /* Code Block */
    .code-block {
      background: #0a0a12;
      border-radius: 12px;
      padding: 20px;
      margin: 20px 0;
      overflow-x: auto;
      border: 1px solid rgba(255,255,255,0.1);
    }
    .code-block code {
      font-family: 'Fira Code', 'Consolas', monospace;
      font-size: 0.85rem;
      color: #a5f3fc;
      white-space: pre;
    }
    .comment { color: #6b7280; }
    .keyword { color: #f472b6; }
    .string { color: #86efac; }
    .function { color: #fbbf24; }

    /* Visual Diagram */
    .diagram {
      background: linear-gradient(135deg, rgba(0,0,0,0.3), rgba(0,0,0,0.1));
      border-radius: 16px;
      padding: 30px;
      margin: 25px 0;
    }
    .diagram-title {
      text-align: center;
      color: #8b5cf6;
      font-size: 1.1rem;
      margin-bottom: 20px;
    }

    /* Comparison Visual */
    .comparison-visual {
      display: flex;
      justify-content: center;
      align-items: stretch;
      gap: 30px;
      flex-wrap: wrap;
      margin: 20px 0;
    }
    .comparison-box {
      flex: 1;
      min-width: 200px;
      max-width: 280px;
      background: rgba(255,255,255,0.03);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
    }
    .comparison-box h4 {
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid;
    }
    .read-box h4 { color: #22c55e; border-color: #22c55e; }
    .write-box h4 { color: #3b82f6; border-color: #3b82f6; }
    .modify-box h4 { color: #fbbf24; border-color: #fbbf24; }
    .delete-box h4 { color: #ef4444; border-color: #ef4444; }

    /* Tips Section */
    .tips-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin: 25px 0;
    }
    .tip-card {
      background: linear-gradient(135deg, rgba(251,191,36,0.1), rgba(245,158,11,0.05));
      border: 1px solid rgba(251,191,36,0.2);
      border-radius: 12px;
      padding: 20px;
    }
    .tip-icon {
      font-size: 1.5rem;
      margin-bottom: 10px;
    }
    .tip-title {
      color: #fbbf24;
      font-weight: 600;
      margin-bottom: 8px;
    }
    .tip-text {
      color: #a1a1aa;
      font-size: 0.9rem;
    }

    /* Quick Reference Table */
    .quick-table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
      font-size: 0.9rem;
    }
    .quick-table th {
      background: rgba(139,92,246,0.2);
      color: #8b5cf6;
      padding: 12px 15px;
      text-align: left;
      font-weight: 600;
    }
    .quick-table td {
      padding: 12px 15px;
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }
    .quick-table tr:hover {
      background: rgba(255,255,255,0.02);
    }
    .quick-table code {
      background: rgba(0,0,0,0.3);
      padding: 2px 8px;
      border-radius: 4px;
      font-family: 'Fira Code', monospace;
      color: #06b6d4;
    }

    .highlight { color: #fbbf24; font-weight: 600; }
    .badge {
      display: inline-block;
      padding: 3px 10px;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: 600;
    }
    .badge.default { background: #22c55e; color: white; }
    .badge.common { background: #3b82f6; color: white; }
    .badge.advanced { background: #8b5cf6; color: white; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ“š Chapter 18: Quick Reference Cheat Sheet</h1>
    <p class="subtitle">Your Complete Apollo Client & GraphQL Reference Guide</p>

    <!-- Section 1: Hooks -->
    <div class="section">
      <h2><span class="icon">ğŸª</span><span class="text">Apollo Client Hooks</span></h2>
      
      <p>Apollo Client provides a set of React hooks that make it easy to execute GraphQL operations. Each hook is optimized for specific use cases.</p>

      <div class="hooks-grid">
        <div class="hook-card">
          <div class="hook-name">useQuery</div>
          <div class="hook-desc">Fetch data automatically when component mounts. Returns loading, error, and data states.</div>
          <div class="hook-usage">const { data, loading, error } = useQuery(QUERY);</div>
          <div class="hook-when"><strong>When to use:</strong> Default choice for fetching data on page load</div>
        </div>

        <div class="hook-card">
          <div class="hook-name">useLazyQuery</div>
          <div class="hook-desc">Fetch data on demand (user action). Does NOT execute on mount.</div>
          <div class="hook-usage">const [getData, { data }] = useLazyQuery(QUERY);</div>
          <div class="hook-when"><strong>When to use:</strong> Search, filters, button clicks, form submissions</div>
        </div>

        <div class="hook-card">
          <div class="hook-name">useMutation</div>
          <div class="hook-desc">Execute mutations (create, update, delete). Returns a mutate function.</div>
          <div class="hook-usage">const [mutate, { data }] = useMutation(MUTATION);</div>
          <div class="hook-when"><strong>When to use:</strong> Any data modification operation</div>
        </div>

        <div class="hook-card">
          <div class="hook-name">useSubscription</div>
          <div class="hook-desc">Subscribe to real-time data via WebSocket. Auto-updates on new data.</div>
          <div class="hook-usage">const { data } = useSubscription(SUBSCRIPTION);</div>
          <div class="hook-when"><strong>When to use:</strong> Chat, notifications, live updates</div>
        </div>

        <div class="hook-card">
          <div class="hook-name">useApolloClient</div>
          <div class="hook-desc">Direct access to Apollo Client instance for imperative operations.</div>
          <div class="hook-usage">const client = useApolloClient();</div>
          <div class="hook-when"><strong>When to use:</strong> Prefetching, direct cache access, logout</div>
        </div>

        <div class="hook-card">
          <div class="hook-name">useFragment</div>
          <div class="hook-desc">Read a fragment from cache. Enables fine-grained component updates.</div>
          <div class="hook-usage">const { data } = useFragment({ fragment, from });</div>
          <div class="hook-when"><strong>When to use:</strong> Performance optimization, avoid prop drilling</div>
        </div>
      </div>

      <h3>Hooks Comparison Table</h3>
      <table class="quick-table">
        <tr>
          <th>Hook</th>
          <th>Executes On</th>
          <th>Returns</th>
          <th>Common Options</th>
        </tr>
        <tr>
          <td><code>useQuery</code></td>
          <td>Mount (automatic)</td>
          <td>{ data, loading, error, refetch, fetchMore }</td>
          <td>variables, fetchPolicy, pollInterval, skip</td>
        </tr>
        <tr>
          <td><code>useLazyQuery</code></td>
          <td>Function call (manual)</td>
          <td>[execute, { data, loading, error }]</td>
          <td>Same as useQuery</td>
        </tr>
        <tr>
          <td><code>useMutation</code></td>
          <td>Function call (manual)</td>
          <td>[mutate, { data, loading, error, reset }]</td>
          <td>variables, optimisticResponse, update, refetchQueries</td>
        </tr>
        <tr>
          <td><code>useSubscription</code></td>
          <td>Mount (WebSocket)</td>
          <td>{ data, loading, error }</td>
          <td>variables, onData, shouldResubscribe</td>
        </tr>
      </table>
    </div>

    <!-- Section 2: Fetch Policies -->
    <div class="section">
      <h2><span class="icon">ğŸ”„</span><span class="text">Fetch Policies</span></h2>
      
      <p>Fetch policies control how Apollo Client interacts with the cache and network. Choosing the right policy is crucial for both performance and user experience.</p>

      <div class="diagram">
        <div class="diagram-title">Fetch Policy Decision Flow</div>
        <div style="display: flex; justify-content: center; align-items: center; gap: 20px; flex-wrap: wrap;">
          <div style="text-align: center;">
            <div style="font-size: 2rem;">ğŸ“¦</div>
            <div style="color: #22c55e;">Cache</div>
          </div>
          <div style="font-size: 2rem; color: #6b7280;">âŸ·</div>
          <div style="text-align: center;">
            <div style="font-size: 2rem;">ğŸŒ</div>
            <div style="color: #3b82f6;">Network</div>
          </div>
        </div>
      </div>

      <div class="policy-grid">
        <div class="policy-card green">
          <div class="policy-name">ğŸ“¦ cache-first <span class="badge default">DEFAULT</span></div>
          <div class="policy-behavior">Read from cache â†’ If cache miss, fetch from network</div>
          <div class="policy-usecase">Best for: Static data, user profiles, settings</div>
        </div>

        <div class="policy-card blue">
          <div class="policy-name">ğŸ“¦ğŸŒ cache-and-network <span class="badge common">POPULAR</span></div>
          <div class="policy-behavior">Show cached data immediately â†’ Fetch fresh data in background â†’ Update UI</div>
          <div class="policy-usecase">Best for: Dashboards, feeds, frequently updated data</div>
        </div>

        <div class="policy-card purple">
          <div class="policy-name">ğŸŒ network-only</div>
          <div class="policy-behavior">Always fetch from network â†’ Update cache with response</div>
          <div class="policy-usecase">Best for: After mutations, critical fresh data</div>
        </div>

        <div class="policy-card cyan">
          <div class="policy-name">ğŸ“¦ cache-only</div>
          <div class="policy-behavior">Read only from cache â†’ Never make network request</div>
          <div class="policy-usecase">Best for: Offline mode, reading already-fetched data</div>
        </div>

        <div class="policy-card red">
          <div class="policy-name">ğŸŒ no-cache</div>
          <div class="policy-behavior">Always fetch from network â†’ Don't store in cache</div>
          <div class="policy-usecase">Best for: Sensitive data, one-time lookups</div>
        </div>

        <div class="policy-card yellow">
          <div class="policy-name">â¸ï¸ standby</div>
          <div class="policy-behavior">Like cache-first but doesn't automatically update</div>
          <div class="policy-usecase">Best for: Queries you want to control manually</div>
        </div>
      </div>

      <h3>Code Examples</h3>
      <div class="code-block">
        <code><span class="comment">// cache-and-network: Great for dashboards</span>
<span class="keyword">const</span> { data, loading } = <span class="function">useQuery</span>(GET_DASHBOARD, {
  fetchPolicy: <span class="string">'cache-and-network'</span>,
  <span class="comment">// User sees cached data instantly</span>
  <span class="comment">// Fresh data loads in background</span>
  <span class="comment">// UI updates when new data arrives</span>
});

<span class="comment">// network-only: After a mutation</span>
<span class="keyword">const</span> [createPost] = <span class="function">useMutation</span>(CREATE_POST, {
  <span class="function">onCompleted</span>: () => {
    <span class="function">refetch</span>(); <span class="comment">// This uses network-only by default</span>
  }
});

<span class="comment">// cache-only: Offline support</span>
<span class="keyword">const</span> { data } = <span class="function">useQuery</span>(GET_SAVED_POSTS, {
  fetchPolicy: <span class="string">'cache-only'</span>,
  <span class="comment">// Only reads from local cache</span>
  <span class="comment">// Great for offline-first apps</span>
});</code>
      </div>
    </div>

    <!-- Section 3: Error Policies -->
    <div class="section">
      <h2><span class="icon">âš ï¸</span><span class="text">Error Policies</span></h2>
      
      <p>Error policies determine how Apollo handles GraphQL errors and partial data. Understanding these is crucial for building resilient applications.</p>

      <div class="policy-grid">
        <div class="policy-card red">
          <div class="policy-name">ğŸš« none <span class="badge default">DEFAULT</span></div>
          <div class="policy-behavior">Any GraphQL error â†’ data becomes undefined</div>
          <div class="policy-usecase">Strict mode: Treat all errors as failures</div>
        </div>

        <div class="policy-card yellow">
          <div class="policy-name">ğŸ™ˆ ignore</div>
          <div class="policy-behavior">Return partial data â†’ Errors are silently ignored</div>
          <div class="policy-usecase">When you can work with incomplete data</div>
        </div>

        <div class="policy-card green">
          <div class="policy-name">âœ… all <span class="badge common">RECOMMENDED</span></div>
          <div class="policy-behavior">Return partial data + all errors in error object</div>
          <div class="policy-usecase">Best for graceful degradation & detailed error handling</div>
        </div>
      </div>

      <div class="code-block">
        <code><span class="comment">// errorPolicy: 'all' - Best practice</span>
<span class="keyword">const</span> { data, error } = <span class="function">useQuery</span>(GET_USER_WITH_POSTS, {
  errorPolicy: <span class="string">'all'</span>,
});

<span class="comment">// Now you can handle partial success!</span>
<span class="keyword">if</span> (data?.user) {
  <span class="comment">// User loaded successfully</span>
  <span class="function">renderUser</span>(data.user);
}

<span class="keyword">if</span> (error?.graphQLErrors) {
  <span class="comment">// Some fields failed - show warning but don't break UI</span>
  error.graphQLErrors.<span class="function">forEach</span>(err => {
    <span class="keyword">if</span> (err.path?.<span class="function">includes</span>(<span class="string">'posts'</span>)) {
      <span class="function">showWarning</span>(<span class="string">'Could not load posts'</span>);
    }
  });
}</code>
      </div>

      <div class="comparison-visual">
        <div class="comparison-box">
          <h4 style="color: #ef4444; border-color: #ef4444;">errorPolicy: 'none'</h4>
          <p style="font-size: 0.9rem; color: #a1a1aa;">
            Query: user + posts<br>
            Posts fail â†’ <strong style="color: #ef4444;">data = undefined</strong><br>
            User data lost too!
          </p>
        </div>
        <div class="comparison-box">
          <h4 style="color: #22c55e; border-color: #22c55e;">errorPolicy: 'all'</h4>
          <p style="font-size: 0.9rem; color: #a1a1aa;">
            Query: user + posts<br>
            Posts fail â†’ <strong style="color: #22c55e;">data.user âœ“</strong><br>
            + error.graphQLErrors
          </p>
        </div>
      </div>
    </div>

    <!-- Section 4: Cache Methods -->
    <div class="section">
      <h2><span class="icon">ğŸ’¾</span><span class="text">Cache Methods</span></h2>
      
      <p>Apollo's InMemoryCache provides powerful methods for reading, writing, and manipulating cached data directly.</p>

      <div class="comparison-visual">
        <div class="comparison-box read-box">
          <h4>ğŸ“– READ</h4>
          <div style="font-family: 'Fira Code', monospace; font-size: 0.85rem; color: #22c55e;">
            readQuery()<br>
            readFragment()
          </div>
          <p style="font-size: 0.8rem; color: #a1a1aa; margin-top: 10px;">Get data from cache without network request</p>
        </div>
        <div class="comparison-box write-box">
          <h4>âœï¸ WRITE</h4>
          <div style="font-family: 'Fira Code', monospace; font-size: 0.85rem; color: #3b82f6;">
            writeQuery()<br>
            writeFragment()
          </div>
          <p style="font-size: 0.8rem; color: #a1a1aa; margin-top: 10px;">Add or replace data in cache</p>
        </div>
        <div class="comparison-box modify-box">
          <h4>ğŸ”§ MODIFY</h4>
          <div style="font-family: 'Fira Code', monospace; font-size: 0.85rem; color: #fbbf24;">
            modify()<br>
            updateQuery()
          </div>
          <p style="font-size: 0.8rem; color: #a1a1aa; margin-top: 10px;">Surgically update specific fields</p>
        </div>
        <div class="comparison-box delete-box">
          <h4>ğŸ—‘ï¸ DELETE</h4>
          <div style="font-family: 'Fira Code', monospace; font-size: 0.85rem; color: #ef4444;">
            evict()<br>
            gc()
          </div>
          <p style="font-size: 0.8rem; color: #a1a1aa; margin-top: 10px;">Remove data and clean up</p>
        </div>
      </div>

      <h3>Detailed Method Reference</h3>
      <div class="code-block">
        <code><span class="comment">// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>
<span class="comment">// READ: Get data from cache</span>
<span class="comment">// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>

<span class="comment">// Read an entire query result</span>
<span class="keyword">const</span> data = client.<span class="function">readQuery</span>({
  query: GET_USERS,
  variables: { status: <span class="string">'active'</span> },
});

<span class="comment">// Read a specific object by its cache ID</span>
<span class="keyword">const</span> user = client.<span class="function">readFragment</span>({
  id: <span class="string">'User:123'</span>, <span class="comment">// __typename:id format</span>
  fragment: gql<span class="string">`
    fragment UserFields on User {
      id
      name
      email
    }
  `</span>,
});

<span class="comment">// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>
<span class="comment">// WRITE: Add/update data in cache</span>
<span class="comment">// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>

<span class="comment">// Write a complete query result</span>
client.<span class="function">writeQuery</span>({
  query: GET_USERS,
  data: {
    users: [{ __typename: <span class="string">'User'</span>, id: <span class="string">'1'</span>, name: <span class="string">'John'</span> }]
  },
});

<span class="comment">// Write/update a specific object</span>
client.<span class="function">writeFragment</span>({
  id: <span class="string">'User:123'</span>,
  fragment: USER_FRAGMENT,
  data: { name: <span class="string">'Updated Name'</span> },
});

<span class="comment">// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>
<span class="comment">// MODIFY: Surgical updates (most performant!)</span>
<span class="comment">// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>

cache.<span class="function">modify</span>({
  id: cache.<span class="function">identify</span>(user), <span class="comment">// Get cache ID safely</span>
  fields: {
    <span class="comment">// Update a simple field</span>
    <span class="function">name</span>: () => <span class="string">'New Name'</span>,
    
    <span class="comment">// Add to an array</span>
    <span class="function">posts</span>(existingPosts, { toReference }) {
      <span class="keyword">return</span> [...existingPosts, <span class="function">toReference</span>(newPost)];
    },
    
    <span class="comment">// Remove from an array</span>
    <span class="function">friends</span>(existingFriends, { readField }) {
      <span class="keyword">return</span> existingFriends.<span class="function">filter</span>(
        ref => <span class="function">readField</span>(<span class="string">'id'</span>, ref) !== deletedId
      );
    },
  },
});

<span class="comment">// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>
<span class="comment">// DELETE: Remove data from cache</span>
<span class="comment">// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>

<span class="comment">// Remove a specific object</span>
cache.<span class="function">evict</span>({ id: <span class="string">'User:123'</span> });

<span class="comment">// Remove a specific field from an object</span>
cache.<span class="function">evict</span>({ 
  id: <span class="string">'User:123'</span>, 
  fieldName: <span class="string">'posts'</span> 
});

<span class="comment">// Clean up orphaned references (ALWAYS call after evict!)</span>
cache.<span class="function">gc</span>();

<span class="comment">// Reset entire cache</span>
client.<span class="function">resetStore</span>();   <span class="comment">// Clears cache + refetches active queries</span>
client.<span class="function">clearStore</span>();   <span class="comment">// Just clears cache (no refetch)</span></code>
      </div>

      <div class="tips-grid">
        <div class="tip-card">
          <div class="tip-icon">âš¡</div>
          <div class="tip-title">Use modify() for Performance</div>
          <div class="tip-text">cache.modify() is faster than writeQuery because it doesn't need to parse and normalize data.</div>
        </div>
        <div class="tip-card">
          <div class="tip-icon">ğŸ§¹</div>
          <div class="tip-title">Always gc() After evict()</div>
          <div class="tip-text">Evicting leaves orphaned references. Call gc() to clean them up and free memory.</div>
        </div>
        <div class="tip-card">
          <div class="tip-icon">ğŸ”‘</div>
          <div class="tip-title">Use cache.identify()</div>
          <div class="tip-text">Don't hardcode cache IDs. Use cache.identify(object) to safely get the __typename:id format.</div>
        </div>
      </div>
    </div>

    <!-- Section 5: Link Chain -->
    <div class="section">
      <h2><span class="icon">ğŸ”—</span><span class="text">Apollo Link Chain</span></h2>
      
      <p>Links are middleware that process GraphQL operations. They form a chain where each link can modify requests/responses before passing to the next link. <span class="highlight">Order matters!</span></p>

      <div class="diagram">
        <div class="diagram-title">Recommended Link Chain Order</div>
        <div class="link-chain">
          <div class="link-box error">errorLink</div>
          <div class="link-arrow">â†’</div>
          <div class="link-box auth">authLink</div>
          <div class="link-arrow">â†’</div>
          <div class="link-box retry">retryLink</div>
          <div class="link-arrow">â†’</div>
          <div class="link-box batch">batchLink</div>
          <div class="link-arrow">â†’</div>
          <div class="link-box http">httpLink</div>
        </div>
        <div style="text-align: center; margin-top: 15px; color: #a1a1aa; font-size: 0.9rem;">
          For subscriptions: split between httpLink and wsLink
        </div>
      </div>

      <h3>Link Types Explained</h3>
      <table class="quick-table">
        <tr>
          <th>Link</th>
          <th>Purpose</th>
          <th>Position</th>
        </tr>
        <tr>
          <td><code>ErrorLink</code></td>
          <td>Global error handling, logging, token refresh</td>
          <td>First (catches all errors)</td>
        </tr>
        <tr>
          <td><code>AuthLink</code></td>
          <td>Add authentication headers (Bearer token)</td>
          <td>Before HTTP links</td>
        </tr>
        <tr>
          <td><code>RetryLink</code></td>
          <td>Retry failed requests with backoff</td>
          <td>Before HTTP links</td>
        </tr>
        <tr>
          <td><code>BatchHttpLink</code></td>
          <td>Combine multiple operations into one request</td>
          <td>Replace HttpLink</td>
        </tr>
        <tr>
          <td><code>HttpLink</code></td>
          <td>Send queries/mutations over HTTP</td>
          <td>Last (terminating)</td>
        </tr>
        <tr>
          <td><code>WebSocketLink</code></td>
          <td>Handle subscriptions via WebSocket</td>
          <td>Last (terminating)</td>
        </tr>
        <tr>
          <td><code>PersistedQueryLink</code></td>
          <td>Send query hash instead of full query</td>
          <td>Before HTTP links</td>
        </tr>
      </table>

      <h3>Complete Setup Example</h3>
      <div class="code-block">
        <code><span class="keyword">import</span> { 
  ApolloClient, InMemoryCache, HttpLink, 
  from, split 
} <span class="keyword">from</span> <span class="string">'@apollo/client'</span>;
<span class="keyword">import</span> { onError } <span class="keyword">from</span> <span class="string">'@apollo/client/link/error'</span>;
<span class="keyword">import</span> { setContext } <span class="keyword">from</span> <span class="string">'@apollo/client/link/context'</span>;
<span class="keyword">import</span> { RetryLink } <span class="keyword">from</span> <span class="string">'@apollo/client/link/retry'</span>;
<span class="keyword">import</span> { GraphQLWsLink } <span class="keyword">from</span> <span class="string">'@apollo/client/link/subscriptions'</span>;
<span class="keyword">import</span> { getMainDefinition } <span class="keyword">from</span> <span class="string">'@apollo/client/utilities'</span>;

<span class="comment">// 1. Error Link - Handle errors globally</span>
<span class="keyword">const</span> errorLink = <span class="function">onError</span>(({ graphQLErrors, networkError }) => {
  <span class="keyword">if</span> (graphQLErrors) {
    graphQLErrors.<span class="function">forEach</span>(({ message }) => 
      console.<span class="function">error</span>(<span class="string">`[GraphQL]: ${message}`</span>)
    );
  }
  <span class="keyword">if</span> (networkError) {
    console.<span class="function">error</span>(<span class="string">`[Network]: ${networkError}`</span>);
  }
});

<span class="comment">// 2. Auth Link - Add token to headers</span>
<span class="keyword">const</span> authLink = <span class="function">setContext</span>((_, { headers }) => ({
  headers: {
    ...headers,
    authorization: <span class="string">`Bearer ${localStorage.getItem('token')}`</span>,
  },
}));

<span class="comment">// 3. Retry Link - Retry failed requests</span>
<span class="keyword">const</span> retryLink = <span class="keyword">new</span> <span class="function">RetryLink</span>({
  delay: { initial: 300, max: 3000, jitter: <span class="keyword">true</span> },
  attempts: { max: 3 },
});

<span class="comment">// 4. HTTP Link - For queries and mutations</span>
<span class="keyword">const</span> httpLink = <span class="keyword">new</span> <span class="function">HttpLink</span>({ uri: <span class="string">'/graphql'</span> });

<span class="comment">// 5. WebSocket Link - For subscriptions</span>
<span class="keyword">const</span> wsLink = <span class="keyword">new</span> <span class="function">GraphQLWsLink</span>(<span class="function">createClient</span>({
  url: <span class="string">'ws://localhost:4000/graphql'</span>,
}));

<span class="comment">// 6. Split Link - Route to correct transport</span>
<span class="keyword">const</span> splitLink = <span class="function">split</span>(
  ({ query }) => {
    <span class="keyword">const</span> def = <span class="function">getMainDefinition</span>(query);
    <span class="keyword">return</span> def.kind === <span class="string">'OperationDefinition'</span> 
      && def.operation === <span class="string">'subscription'</span>;
  },
  wsLink,     <span class="comment">// Subscriptions â†’ WebSocket</span>
  httpLink,   <span class="comment">// Queries/Mutations â†’ HTTP</span>
);

<span class="comment">// Combine all links in order</span>
<span class="keyword">const</span> client = <span class="keyword">new</span> <span class="function">ApolloClient</span>({
  link: <span class="function">from</span>([errorLink, authLink, retryLink, splitLink]),
  cache: <span class="keyword">new</span> <span class="function">InMemoryCache</span>(),
});</code>
      </div>
    </div>

    <!-- Final Tips Section -->
    <div class="section">
      <h2><span class="icon">ğŸ¯</span><span class="text">Quick Decision Guide</span></h2>
      
      <table class="quick-table">
        <tr>
          <th>Scenario</th>
          <th>Hook</th>
          <th>Fetch Policy</th>
          <th>Error Policy</th>
        </tr>
        <tr>
          <td>Page load data</td>
          <td><code>useQuery</code></td>
          <td>cache-first</td>
          <td>all</td>
        </tr>
        <tr>
          <td>Dashboard/Feed</td>
          <td><code>useQuery</code></td>
          <td>cache-and-network</td>
          <td>all</td>
        </tr>
        <tr>
          <td>Search/Filter</td>
          <td><code>useLazyQuery</code></td>
          <td>network-only</td>
          <td>all</td>
        </tr>
        <tr>
          <td>Form submit</td>
          <td><code>useMutation</code></td>
          <td>N/A</td>
          <td>none</td>
        </tr>
        <tr>
          <td>Real-time chat</td>
          <td><code>useSubscription</code></td>
          <td>N/A</td>
          <td>all</td>
        </tr>
        <tr>
          <td>Offline mode</td>
          <td><code>useQuery</code></td>
          <td>cache-only</td>
          <td>all</td>
        </tr>
        <tr>
          <td>After mutation</td>
          <td><code>refetch()</code></td>
          <td>network-only</td>
          <td>all</td>
        </tr>
      </table>

      <div class="tips-grid" style="margin-top: 30px;">
        <div class="tip-card">
          <div class="tip-icon">ğŸ“</div>
          <div class="tip-title">Interview Tip</div>
          <div class="tip-text">Always explain WHY you chose a specific policy. Show you understand the trade-offs.</div>
        </div>
        <div class="tip-card">
          <div class="tip-icon">ğŸš€</div>
          <div class="tip-title">Performance Tip</div>
          <div class="tip-text">Use cache.modify() over writeQuery() when possible - it's more efficient for updates.</div>
        </div>
        <div class="tip-card">
          <div class="tip-icon">ğŸ›¡ï¸</div>
          <div class="tip-title">Production Tip</div>
          <div class="tip-text">Always add errorLink first in your chain to catch and log all errors globally.</div>
        </div>
      </div>
    </div>
  </div>
</body>
</html>
