<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chapter 15: Server-Side Rendering</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 100%);
      color: #e4e4e7;
      line-height: 1.7;
      padding: 40px 20px;
      min-height: 100vh;
    }
    .container { max-width: 900px; margin: 0 auto; }
    h1 {
      font-size: 2.5rem;
      background: linear-gradient(90deg, #22d3ee, #a78bfa);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 10px;
    }
    .subtitle { color: #a1a1aa; font-size: 1.1rem; margin-bottom: 40px; }
    .section {
      background: rgba(255,255,255,0.05);
      border-radius: 16px;
      padding: 30px;
      margin-bottom: 30px;
      border: 1px solid rgba(255,255,255,0.1);
    }
    h2 {
      color: #22d3ee;
      font-size: 1.5rem;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    h3 { color: #a78bfa; margin: 25px 0 15px; font-size: 1.2rem; }
    p { margin-bottom: 15px; color: #d4d4d8; }
    .code-block {
      background: #0f0f23;
      border-radius: 12px;
      padding: 20px;
      margin: 20px 0;
      overflow-x: auto;
      border-left: 4px solid #a78bfa;
    }
    .code-block code {
      font-family: 'Fira Code', 'Consolas', monospace;
      font-size: 0.9rem;
      color: #a5f3fc;
      white-space: pre;
    }
    .comment { color: #6b7280; }
    .keyword { color: #f472b6; }
    .string { color: #86efac; }
    .function { color: #fbbf24; }
    .file-name {
      background: rgba(167,139,250,0.2);
      color: #a78bfa;
      padding: 5px 12px;
      border-radius: 6px 6px 0 0;
      font-size: 0.85rem;
      display: inline-block;
      margin-bottom: -1px;
      font-family: 'Fira Code', monospace;
    }
    .comparison-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin: 25px 0;
    }
    .comparison-card {
      background: rgba(255,255,255,0.03);
      border-radius: 12px;
      padding: 20px;
      border: 1px solid rgba(255,255,255,0.1);
    }
    .comparison-card h4 {
      margin-bottom: 15px;
      font-size: 1.1rem;
    }
    .csr-card h4 { color: #f472b6; }
    .ssr-card h4 { color: #22d3ee; }
    .benefit-list {
      list-style: none;
      margin: 0;
      padding: 0;
    }
    .benefit-list li {
      padding: 8px 0;
      padding-left: 25px;
      position: relative;
      color: #d4d4d8;
    }
    .benefit-list li::before {
      content: "‚úì";
      position: absolute;
      left: 0;
      color: #22c55e;
    }
    .drawback-list li::before {
      content: "‚úó";
      color: #ef4444;
    }
    .diagram {
      background: #0f0f23;
      border-radius: 12px;
      padding: 30px;
      margin: 25px 0;
    }
    .timeline {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 0;
      position: relative;
    }
    .timeline::before {
      content: "";
      position: absolute;
      top: 50%;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, #22d3ee, #a78bfa);
    }
    .timeline-point {
      background: #0f0f23;
      padding: 15px;
      border-radius: 10px;
      text-align: center;
      z-index: 1;
      border: 2px solid #a78bfa;
      min-width: 120px;
    }
    .timeline-point .time {
      font-size: 1.5rem;
      color: #22d3ee;
      font-weight: bold;
    }
    .timeline-point .label {
      font-size: 0.8rem;
      color: #a1a1aa;
    }
    .info-box {
      background: linear-gradient(135deg, rgba(34,211,238,0.1), rgba(167,139,250,0.05));
      border: 1px solid rgba(34,211,238,0.3);
      border-radius: 12px;
      padding: 20px;
      margin: 20px 0;
    }
    .info-box h4 { color: #22d3ee; margin-bottom: 10px; }
    .warning-box {
      background: linear-gradient(135deg, rgba(251,191,36,0.1), rgba(245,158,11,0.05));
      border: 1px solid rgba(251,191,36,0.3);
      border-radius: 12px;
      padding: 20px;
      margin: 20px 0;
    }
    .warning-box h4 { color: #fbbf24; margin-bottom: 10px; }
    .folder-structure {
      background: rgba(0,0,0,0.3);
      border-radius: 8px;
      padding: 20px;
      font-family: 'Fira Code', monospace;
      font-size: 0.9rem;
    }
    .folder { color: #fbbf24; }
    .file { color: #a5f3fc; }
    ul { margin: 15px 0 15px 25px; }
    li { margin-bottom: 8px; color: #d4d4d8; }
    .highlight { color: #22d3ee; font-weight: 600; }
    .architecture-visual {
      display: flex;
      flex-direction: column;
      gap: 15px;
      padding: 20px;
    }
    .arch-row {
      display: flex;
      gap: 15px;
      justify-content: center;
      flex-wrap: wrap;
    }
    .arch-box {
      background: linear-gradient(135deg, #a78bfa, #7c3aed);
      padding: 15px 25px;
      border-radius: 10px;
      text-align: center;
      font-weight: 600;
    }
    .arch-box.server {
      background: linear-gradient(135deg, #22d3ee, #0891b2);
    }
    .arch-box.client {
      background: linear-gradient(135deg, #f472b6, #db2777);
    }
    .arch-arrow {
      color: #a78bfa;
      font-size: 1.5rem;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>‚ö° Chapter 15: Server-Side Rendering (SSR)</h1>
    <p class="subtitle">Optimizing GraphQL Applications for Performance and SEO</p>

    <div class="section">
      <h2>üåê Understanding SSR with GraphQL</h2>
      
      <p>Server-Side Rendering pre-renders your React components on the server, sending fully formed HTML to the browser. When combined with GraphQL, this means <span class="highlight">data fetching happens on the server</span> before the page reaches the client.</p>

      <div class="comparison-grid">
        <div class="comparison-card csr-card">
          <h4>‚ùå Client-Side Rendering (CSR)</h4>
          <ul class="benefit-list drawback-list">
            <li>Empty HTML sent to browser</li>
            <li>JavaScript loads, then fetches data</li>
            <li>Loading spinners visible</li>
            <li>Poor SEO for dynamic content</li>
            <li>Slower Time to First Contentful Paint</li>
          </ul>
        </div>
        <div class="comparison-card ssr-card">
          <h4>‚úÖ Server-Side Rendering (SSR)</h4>
          <ul class="benefit-list">
            <li>Full HTML with data sent</li>
            <li>Immediate content visibility</li>
            <li>Better SEO indexing</li>
            <li>Faster perceived performance</li>
            <li>Works without JavaScript</li>
          </ul>
        </div>
      </div>

      <div class="diagram">
        <h4 style="color: #a78bfa; margin-bottom: 20px; text-align: center;">SSR vs CSR Timeline Comparison</h4>
        <p style="text-align: center; color: #a1a1aa; margin-bottom: 15px;">Client-Side Rendering:</p>
        <div class="timeline">
          <div class="timeline-point">
            <div class="time">0ms</div>
            <div class="label">Request</div>
          </div>
          <div class="timeline-point">
            <div class="time">200ms</div>
            <div class="label">Empty HTML</div>
          </div>
          <div class="timeline-point">
            <div class="time">500ms</div>
            <div class="label">JS Loaded</div>
          </div>
          <div class="timeline-point">
            <div class="time">800ms</div>
            <div class="label">Data Fetched</div>
          </div>
          <div class="timeline-point" style="border-color: #22c55e;">
            <div class="time">900ms</div>
            <div class="label">Content Visible!</div>
          </div>
        </div>
        <p style="text-align: center; color: #a1a1aa; margin: 25px 0 15px;">Server-Side Rendering:</p>
        <div class="timeline">
          <div class="timeline-point">
            <div class="time">0ms</div>
            <div class="label">Request</div>
          </div>
          <div class="timeline-point" style="border-color: #22c55e;">
            <div class="time">300ms</div>
            <div class="label">Full HTML + Data!</div>
          </div>
          <div class="timeline-point">
            <div class="time">500ms</div>
            <div class="label">JS Hydration</div>
          </div>
          <div class="timeline-point">
            <div class="time">600ms</div>
            <div class="label">Interactive</div>
          </div>
        </div>
      </div>
    </div>

    <div class="section">
      <h2>‚öõÔ∏è 15.1 Next.js with Apollo Client</h2>

      <p>Next.js is the most popular React framework for SSR. Setting up Apollo Client requires special consideration for the server/client boundary.</p>

      <h3>Apollo Client Factory</h3>
      <p>Create a function that generates Apollo Client instances, handling both server and client environments:</p>

      <div class="file-name">lib/apollo-client.ts</div>
      <div class="code-block">
        <code><span class="keyword">import</span> { 
  ApolloClient, 
  InMemoryCache, 
  HttpLink,
  NormalizedCacheObject 
} <span class="keyword">from</span> <span class="string">'@apollo/client'</span>;

<span class="comment">// Determine if we're on the server</span>
<span class="keyword">const</span> isServer = <span class="keyword">typeof</span> window === <span class="string">'undefined'</span>;

<span class="comment">// Store the client instance for reuse on the client side</span>
<span class="keyword">let</span> apolloClient: ApolloClient&lt;NormalizedCacheObject&gt; | <span class="keyword">null</span> = <span class="keyword">null</span>;

<span class="keyword">function</span> <span class="function">createApolloClient</span>() {
  <span class="keyword">return new</span> <span class="function">ApolloClient</span>({
    <span class="comment">// Enable SSR mode when running on server</span>
    ssrMode: isServer,
    
    link: <span class="keyword">new</span> <span class="function">HttpLink</span>({
      uri: process.env.NEXT_PUBLIC_GRAPHQL_URL || <span class="string">'http://localhost:4000/graphql'</span>,
      <span class="comment">// Include cookies for authenticated requests</span>
      credentials: <span class="string">'same-origin'</span>,
      <span class="comment">// Add auth headers if needed</span>
      headers: {
        <span class="string">'x-api-key'</span>: process.env.API_KEY || <span class="string">''</span>,
      },
    }),
    
    cache: <span class="keyword">new</span> <span class="function">InMemoryCache</span>({
      typePolicies: {
        Query: {
          fields: {
            <span class="comment">// Add your field policies here</span>
          },
        },
      },
    }),
    
    <span class="comment">// Disable cache during SSR to ensure fresh data</span>
    defaultOptions: {
      watchQuery: {
        fetchPolicy: isServer ? <span class="string">'no-cache'</span> : <span class="string">'cache-first'</span>,
      },
    },
  });
}

<span class="keyword">export function</span> <span class="function">initializeApollo</span>(initialState = <span class="keyword">null</span>) {
  <span class="keyword">const</span> _apolloClient = apolloClient ?? <span class="function">createApolloClient</span>();

  <span class="comment">// Hydrate cache with SSR data</span>
  <span class="keyword">if</span> (initialState) {
    <span class="keyword">const</span> existingCache = _apolloClient.<span class="function">extract</span>();
    
    _apolloClient.cache.<span class="function">restore</span>({
      ...existingCache,
      ...initialState,
    });
  }

  <span class="comment">// Always create new client on server</span>
  <span class="keyword">if</span> (isServer) <span class="keyword">return</span> _apolloClient;

  <span class="comment">// Reuse client on browser</span>
  <span class="keyword">if</span> (!apolloClient) apolloClient = _apolloClient;

  <span class="keyword">return</span> _apolloClient;
}

<span class="comment">// Hook for use in components</span>
<span class="keyword">export function</span> <span class="function">useApollo</span>(initialState) {
  <span class="keyword">const</span> store = <span class="function">useMemo</span>(
    () => <span class="function">initializeApollo</span>(initialState), 
    [initialState]
  );
  <span class="keyword">return</span> store;
}</code>
      </div>

      <div class="info-box">
        <h4>üîë Key Concepts</h4>
        <ul>
          <li><strong>ssrMode: true</strong> - Disables query deduplication and certain optimizations for server rendering</li>
          <li><strong>Cache hydration</strong> - Server cache state is transferred to client via <code>initialState</code></li>
          <li><strong>Single instance</strong> - Reuse client on browser, new instance per request on server</li>
        </ul>
      </div>
    </div>

    <div class="section">
      <h2>üìÑ 15.2 getServerSideProps Pattern (Pages Router)</h2>

      <p>The traditional Next.js Pages Router uses <code>getServerSideProps</code> for server-side data fetching. Here's how to integrate Apollo:</p>

      <div class="file-name">pages/users/[id].tsx</div>
      <div class="code-block">
        <code><span class="keyword">import</span> { GetServerSideProps } <span class="keyword">from</span> <span class="string">'next'</span>;
<span class="keyword">import</span> { initializeApollo } <span class="keyword">from</span> <span class="string">'@/lib/apollo-client'</span>;
<span class="keyword">import</span> { GET_USER } <span class="keyword">from</span> <span class="string">'@/graphql/queries/user'</span>;

<span class="comment">// Define the page props interface</span>
<span class="keyword">interface</span> UserPageProps {
  user: User;
  initialApolloState: NormalizedCacheObject;
}

<span class="keyword">export const</span> getServerSideProps: GetServerSideProps = <span class="keyword">async</span> (context) => {
  <span class="comment">// Create a fresh Apollo Client for this request</span>
  <span class="keyword">const</span> apolloClient = <span class="function">initializeApollo</span>();

  <span class="keyword">try</span> {
    <span class="comment">// Fetch data on the server</span>
    <span class="keyword">const</span> { data } = <span class="keyword">await</span> apolloClient.<span class="function">query</span>({
      query: GET_USER,
      variables: { id: context.params?.id },
      <span class="comment">// Optional: pass cookies for auth</span>
      context: {
        headers: {
          cookie: context.req.headers.cookie || <span class="string">''</span>,
        },
      },
    });

    <span class="comment">// Handle not found</span>
    <span class="keyword">if</span> (!data.user) {
      <span class="keyword">return</span> { notFound: <span class="keyword">true</span> };
    }

    <span class="keyword">return</span> {
      props: {
        user: data.user,
        <span class="comment">// Extract cache for hydration on client</span>
        initialApolloState: apolloClient.cache.<span class="function">extract</span>(),
      },
    };

  } <span class="keyword">catch</span> (error) {
    console.<span class="function">error</span>(<span class="string">'Error fetching user:'</span>, error);
    
    <span class="keyword">return</span> {
      redirect: {
        destination: <span class="string">'/error'</span>,
        permanent: <span class="keyword">false</span>,
      },
    };
  }
};

<span class="comment">// The page component</span>
<span class="keyword">export default function</span> <span class="function">UserPage</span>({ user }: UserPageProps) {
  <span class="keyword">return</span> (
    &lt;div&gt;
      &lt;h1&gt;{user.name}&lt;/h1&gt;
      &lt;p&gt;{user.email}&lt;/p&gt;
      &lt;UserPosts userId={user.id} /&gt;
    &lt;/div&gt;
  );
}</code>
      </div>

      <h3>Setting Up _app.tsx</h3>
      <div class="file-name">pages/_app.tsx</div>
      <div class="code-block">
        <code><span class="keyword">import</span> { ApolloProvider } <span class="keyword">from</span> <span class="string">'@apollo/client'</span>;
<span class="keyword">import</span> { useApollo } <span class="keyword">from</span> <span class="string">'@/lib/apollo-client'</span>;
<span class="keyword">import</span> <span class="keyword">type</span> { AppProps } <span class="keyword">from</span> <span class="string">'next/app'</span>;

<span class="keyword">export default function</span> <span class="function">App</span>({ Component, pageProps }: AppProps) {
  <span class="comment">// Initialize Apollo with SSR cache state</span>
  <span class="keyword">const</span> apolloClient = <span class="function">useApollo</span>(pageProps.initialApolloState);

  <span class="keyword">return</span> (
    &lt;ApolloProvider client={apolloClient}&gt;
      &lt;Component {...pageProps} /&gt;
    &lt;/ApolloProvider&gt;
  );
}</code>
      </div>

      <div class="diagram">
        <h4 style="color: #a78bfa; margin-bottom: 20px; text-align: center;">SSR Data Flow Architecture</h4>
        <div class="architecture-visual">
          <div class="arch-row">
            <div class="arch-box server">Browser Request</div>
          </div>
          <div class="arch-arrow">‚Üì</div>
          <div class="arch-row">
            <div class="arch-box server">Next.js Server</div>
          </div>
          <div class="arch-arrow">‚Üì</div>
          <div class="arch-row">
            <div class="arch-box">getServerSideProps</div>
          </div>
          <div class="arch-arrow">‚Üì</div>
          <div class="arch-row">
            <div class="arch-box">Apollo Client Query</div>
            <div class="arch-box server">GraphQL Server</div>
          </div>
          <div class="arch-arrow">‚Üì</div>
          <div class="arch-row">
            <div class="arch-box">Render React + Cache Extract</div>
          </div>
          <div class="arch-arrow">‚Üì</div>
          <div class="arch-row">
            <div class="arch-box client">HTML + JS + Cache State</div>
          </div>
          <div class="arch-arrow">‚Üì</div>
          <div class="arch-row">
            <div class="arch-box client">Browser Hydration</div>
          </div>
        </div>
      </div>
    </div>

    <div class="section">
      <h2>üöÄ 15.3 App Router with React Server Components (Next.js 13+)</h2>

      <p>Next.js 13+ introduces the App Router with React Server Components (RSC). This changes how we approach data fetching with GraphQL:</p>

      <div class="warning-box">
        <h4>‚ö†Ô∏è Important Changes in App Router</h4>
        <ul>
          <li>Components are Server Components by default</li>
          <li>No need for <code>getServerSideProps</code></li>
          <li>Data fetching happens directly in components</li>
          <li>Need separate client for RSC (no hooks)</li>
        </ul>
      </div>

      <h3>RSC Apollo Client</h3>
      <div class="file-name">lib/apollo-rsc-client.ts</div>
      <div class="code-block">
        <code><span class="keyword">import</span> { ApolloClient, InMemoryCache, HttpLink } <span class="keyword">from</span> <span class="string">'@apollo/client'</span>;
<span class="keyword">import</span> { registerApolloClient } <span class="keyword">from</span> <span class="string">'@apollo/experimental-nextjs-app-support/rsc'</span>;

<span class="keyword">export const</span> { <span class="function">getClient</span> } = <span class="function">registerApolloClient</span>(() => {
  <span class="keyword">return new</span> <span class="function">ApolloClient</span>({
    cache: <span class="keyword">new</span> <span class="function">InMemoryCache</span>(),
    link: <span class="keyword">new</span> <span class="function">HttpLink</span>({
      uri: process.env.GRAPHQL_URL,
      <span class="comment">// Opt out of fetch caching for dynamic data</span>
      fetchOptions: { cache: <span class="string">'no-store'</span> },
    }),
  });
});</code>
      </div>

      <h3>Server Component with Data Fetching</h3>
      <div class="file-name">app/users/[id]/page.tsx</div>
      <div class="code-block">
        <code><span class="keyword">import</span> { getClient } <span class="keyword">from</span> <span class="string">'@/lib/apollo-rsc-client'</span>;
<span class="keyword">import</span> { GET_USER } <span class="keyword">from</span> <span class="string">'@/graphql/queries/user'</span>;
<span class="keyword">import</span> { notFound } <span class="keyword">from</span> <span class="string">'next/navigation'</span>;
<span class="keyword">import</span> { UserProfile } <span class="keyword">from</span> <span class="string">'@/components/UserProfile'</span>;

<span class="comment">// Generate metadata for SEO</span>
<span class="keyword">export async function</span> <span class="function">generateMetadata</span>({ params }) {
  <span class="keyword">const</span> client = <span class="function">getClient</span>();
  <span class="keyword">const</span> { data } = <span class="keyword">await</span> client.<span class="function">query</span>({
    query: GET_USER,
    variables: { id: params.id },
  });
  
  <span class="keyword">return</span> {
    title: data.user?.name || <span class="string">'User Not Found'</span>,
    description: <span class="string">`Profile for ${data.user?.name}`</span>,
  };
}

<span class="comment">// This is a Server Component - no 'use client' directive</span>
<span class="keyword">export default async function</span> <span class="function">UserPage</span>({ params }) {
  <span class="keyword">const</span> client = <span class="function">getClient</span>();
  
  <span class="keyword">const</span> { data } = <span class="keyword">await</span> client.<span class="function">query</span>({
    query: GET_USER,
    variables: { id: params.id },
  });

  <span class="keyword">if</span> (!data.user) {
    <span class="function">notFound</span>();
  }

  <span class="keyword">return</span> (
    &lt;main&gt;
      &lt;h1&gt;{data.user.name}&lt;/h1&gt;
      &lt;p&gt;{data.user.email}&lt;/p&gt;
      
      {<span class="comment">/* Client component for interactive parts */</span>}
      &lt;UserProfile user={data.user} /&gt;
    &lt;/main&gt;
  );
}</code>
      </div>

      <h3>Client Components for Interactivity</h3>
      <div class="file-name">components/UserProfile.tsx</div>
      <div class="code-block">
        <code><span class="string">'use client'</span>; <span class="comment">// Mark as Client Component</span>

<span class="keyword">import</span> { useMutation } <span class="keyword">from</span> <span class="string">'@apollo/client'</span>;
<span class="keyword">import</span> { UPDATE_USER } <span class="keyword">from</span> <span class="string">'@/graphql/mutations/user'</span>;

<span class="keyword">export function</span> <span class="function">UserProfile</span>({ user }) {
  <span class="keyword">const</span> [updateUser, { loading }] = <span class="function">useMutation</span>(UPDATE_USER);

  <span class="keyword">const</span> <span class="function">handleUpdate</span> = <span class="keyword">async</span> (formData) => {
    <span class="keyword">await</span> <span class="function">updateUser</span>({
      variables: { id: user.id, input: formData },
    });
  };

  <span class="keyword">return</span> (
    &lt;form onSubmit={handleUpdate}&gt;
      {<span class="comment">/* Interactive form elements */</span>}
      &lt;button disabled={loading}&gt;
        {loading ? <span class="string">'Saving...'</span> : <span class="string">'Save Changes'</span>}
      &lt;/button&gt;
    &lt;/form&gt;
  );
}</code>
      </div>

      <h3>App Router Folder Structure</h3>
      <div class="folder-structure">
<span class="folder">app/</span>
‚îú‚îÄ‚îÄ <span class="folder">users/</span>
‚îÇ   ‚îú‚îÄ‚îÄ <span class="file">page.tsx</span>           <span class="comment"># /users - Server Component</span>
‚îÇ   ‚îî‚îÄ‚îÄ <span class="folder">[id]/</span>
‚îÇ       ‚îú‚îÄ‚îÄ <span class="file">page.tsx</span>       <span class="comment"># /users/:id - Server Component</span>
‚îÇ       ‚îú‚îÄ‚îÄ <span class="file">loading.tsx</span>    <span class="comment"># Loading UI</span>
‚îÇ       ‚îî‚îÄ‚îÄ <span class="file">error.tsx</span>      <span class="comment"># Error boundary</span>
‚îú‚îÄ‚îÄ <span class="file">layout.tsx</span>            <span class="comment"># Root layout with providers</span>
‚îî‚îÄ‚îÄ <span class="file">providers.tsx</span>         <span class="comment"># Apollo Provider (client)</span>
      </div>

      <div class="file-name">app/providers.tsx</div>
      <div class="code-block">
        <code><span class="string">'use client'</span>;

<span class="keyword">import</span> { ApolloLink, HttpLink } <span class="keyword">from</span> <span class="string">'@apollo/client'</span>;
<span class="keyword">import</span> {
  ApolloNextAppProvider,
  NextSSRInMemoryCache,
  NextSSRApolloClient,
  SSRMultipartLink,
} <span class="keyword">from</span> <span class="string">'@apollo/experimental-nextjs-app-support/ssr'</span>;

<span class="keyword">function</span> <span class="function">makeClient</span>() {
  <span class="keyword">const</span> httpLink = <span class="keyword">new</span> <span class="function">HttpLink</span>({
    uri: process.env.NEXT_PUBLIC_GRAPHQL_URL,
  });

  <span class="keyword">return new</span> <span class="function">NextSSRApolloClient</span>({
    cache: <span class="keyword">new</span> <span class="function">NextSSRInMemoryCache</span>(),
    link:
      <span class="keyword">typeof</span> window === <span class="string">'undefined'</span>
        ? ApolloLink.<span class="function">from</span>([
            <span class="keyword">new</span> <span class="function">SSRMultipartLink</span>({ stripDefer: <span class="keyword">true</span> }),
            httpLink,
          ])
        : httpLink,
  });
}

<span class="keyword">export function</span> <span class="function">ApolloWrapper</span>({ children }) {
  <span class="keyword">return</span> (
    &lt;ApolloNextAppProvider makeClient={makeClient}&gt;
      {children}
    &lt;/ApolloNextAppProvider&gt;
  );
}</code>
      </div>
    </div>
  </div>
</body>
</html>
