<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chapter 8: Application Panel</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      color: #e4e4e7;
      line-height: 1.8;
      min-height: 100vh;
      padding: 40px 20px;
    }
    .container { max-width: 1000px; margin: 0 auto; }
    header {
      text-align: center;
      padding: 50px 40px;
      background: linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%);
      border-radius: 20px;
      margin-bottom: 40px;
      box-shadow: 0 20px 60px rgba(139, 92, 246, 0.3);
    }
    header h1 { font-size: 2.5em; margin-bottom: 10px; }
    header p { opacity: 0.9; font-size: 1.2em; }
    .badge { 
      display: inline-block; 
      background: rgba(255,255,255,0.2); 
      padding: 5px 15px; 
      border-radius: 20px; 
      font-size: 0.9em;
      margin-top: 15px;
    }
    section {
      background: rgba(255,255,255,0.05);
      border-radius: 16px;
      padding: 35px;
      margin-bottom: 30px;
      border: 1px solid rgba(255,255,255,0.1);
    }
    h2 {
      color: #a78bfa;
      font-size: 1.8em;
      margin-bottom: 25px;
      padding-bottom: 15px;
      border-bottom: 2px solid rgba(167, 139, 250, 0.3);
    }
    h3 {
      color: #c4b5fd;
      font-size: 1.3em;
      margin: 25px 0 15px 0;
    }
    h4 {
      color: #ddd6fe;
      font-size: 1.1em;
      margin: 20px 0 10px 0;
    }
    p { margin-bottom: 15px; color: #d1d5db; }
    .concept-box {
      background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(109, 40, 217, 0.1));
      border-left: 4px solid #8b5cf6;
      padding: 20px 25px;
      border-radius: 0 12px 12px 0;
      margin: 20px 0;
    }
    .code-block {
      background: #1e1e2e;
      border-radius: 12px;
      padding: 20px;
      margin: 20px 0;
      overflow-x: auto;
      border: 1px solid #333;
    }
    .code-block pre {
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 0.9em;
      color: #a6e3a1;
      white-space: pre-wrap;
    }
    .code-title {
      background: #333;
      color: #a78bfa;
      padding: 8px 15px;
      border-radius: 8px 8px 0 0;
      font-size: 0.85em;
      margin-bottom: -12px;
      display: inline-block;
    }
    .highlight { color: #a78bfa; font-weight: 600; }
    .note {
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
      color: #1a1a2e;
      padding: 18px 22px;
      border-radius: 12px;
      margin: 20px 0;
    }
    .note::before { content: "‚ö° Key Point: "; font-weight: 700; }
    .warning {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      color: white;
      padding: 18px 22px;
      border-radius: 12px;
      margin: 20px 0;
    }
    .warning::before { content: "üö® Interview Alert: "; font-weight: 700; }
    .tip {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
      padding: 18px 22px;
      border-radius: 12px;
      margin: 20px 0;
    }
    .tip::before { content: "üí° Pro Tip: "; font-weight: 700; }
    .visual-diagram {
      background: #1a1a2e;
      border-radius: 16px;
      padding: 30px;
      margin: 25px 0;
      border: 2px solid #333;
    }
    .diagram-title {
      text-align: center;
      color: #a78bfa;
      font-weight: 600;
      margin-bottom: 20px;
      font-size: 1.1em;
    }
    ul, ol { margin: 15px 0 15px 25px; }
    li { margin: 10px 0; color: #d1d5db; }
    .comparison-table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
    }
    .comparison-table th, .comparison-table td {
      padding: 15px;
      text-align: left;
      border: 1px solid #333;
    }
    .comparison-table th {
      background: #374151;
      color: #a78bfa;
    }
    .comparison-table td { background: rgba(255,255,255,0.02); }
    code {
      background: #374151;
      padding: 3px 8px;
      border-radius: 4px;
      font-family: 'Consolas', monospace;
      font-size: 0.9em;
      color: #a6e3a1;
    }
    .storage-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin: 20px 0;
    }
    .storage-card {
      background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
      border-radius: 12px;
      padding: 25px;
      border: 1px solid #374151;
    }
    .storage-card h5 {
      color: #c4b5fd;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 1.1em;
    }
    .storage-card .icon {
      font-size: 1.5em;
    }
    .attribute-list {
      background: rgba(139, 92, 246, 0.1);
      border-radius: 10px;
      padding: 15px 20px;
      margin: 15px 0;
    }
    .attribute-list h4 {
      color: #a78bfa;
      margin-bottom: 10px;
    }
    .sw-lifecycle {
      display: flex;
      justify-content: space-around;
      flex-wrap: wrap;
      gap: 15px;
      padding: 20px;
    }
    .sw-state {
      text-align: center;
      padding: 15px 20px;
      border-radius: 10px;
      min-width: 120px;
    }
    .sw-state.installing { background: #fbbf24; color: #1a1a2e; }
    .sw-state.waiting { background: #f97316; color: white; }
    .sw-state.active { background: #10b981; color: white; }
    .sw-state.redundant { background: #6b7280; color: white; }
    .arrow { color: #a78bfa; font-size: 1.5em; align-self: center; }
    .cookie-visual {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin: 20px 0;
    }
    .cookie-attr {
      background: #1f2937;
      padding: 15px;
      border-radius: 10px;
      text-align: center;
    }
    .cookie-attr .label {
      font-size: 0.8em;
      color: #9ca3af;
      margin-bottom: 5px;
    }
    .cookie-attr .value {
      color: #a78bfa;
      font-weight: 600;
    }
    .pwa-checklist {
      background: rgba(16, 185, 129, 0.1);
      border: 1px solid rgba(16, 185, 129, 0.3);
      border-radius: 12px;
      padding: 20px;
      margin: 20px 0;
    }
    .checklist-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 0;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    .checklist-item:last-child { border-bottom: none; }
    .check { color: #10b981; font-size: 1.2em; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üíæ Chapter 8: Application Panel</h1>
      <p>Storage, Service Workers, PWA & Client-Side Data Management</p>
      <span class="badge">üü° Intermediate Level</span>
    </header>

    <!-- Section 8.1 -->
    <section>
      <h2>8.1 Storage Overview - Understanding Client-Side Data</h2>
      
      <p>Modern web applications store data on the client side for offline functionality, performance, and user experience. Understanding different storage mechanisms is crucial for production-grade web development.</p>

      <div class="storage-grid">
        <div class="storage-card">
          <h5><span class="icon">üì¶</span> Local Storage</h5>
          <ul style="font-size: 0.9em;">
            <li>Persistent across sessions</li>
            <li>~5-10MB per origin</li>
            <li>Synchronous API</li>
            <li>String key-value pairs only</li>
          </ul>
        </div>
        <div class="storage-card">
          <h5><span class="icon">‚è±Ô∏è</span> Session Storage</h5>
          <ul style="font-size: 0.9em;">
            <li>Tab/window scoped</li>
            <li>Cleared when tab closes</li>
            <li>~5-10MB per origin</li>
            <li>Not shared between tabs</li>
          </ul>
        </div>
        <div class="storage-card">
          <h5><span class="icon">üóÑÔ∏è</span> IndexedDB</h5>
          <ul style="font-size: 0.9em;">
            <li>Full database with indexes</li>
            <li>Large storage (GBs)</li>
            <li>Asynchronous API</li>
            <li>Stores any JS objects</li>
          </ul>
        </div>
        <div class="storage-card">
          <h5><span class="icon">üç™</span> Cookies</h5>
          <ul style="font-size: 0.9em;">
            <li>Sent with every HTTP request</li>
            <li>~4KB per cookie</li>
            <li>Expiration dates</li>
            <li>Security attributes</li>
          </ul>
        </div>
        <div class="storage-card">
          <h5><span class="icon">üìÅ</span> Cache Storage</h5>
          <ul style="font-size: 0.9em;">
            <li>HTTP response caching</li>
            <li>Used by Service Workers</li>
            <li>Request/Response pairs</li>
            <li>Offline-first apps</li>
          </ul>
        </div>
        <div class="storage-card">
          <h5><span class="icon">üìä</span> Web SQL</h5>
          <ul style="font-size: 0.9em;">
            <li>‚ö†Ô∏è DEPRECATED</li>
            <li>SQL-based storage</li>
            <li>Only in some browsers</li>
            <li>Use IndexedDB instead</li>
          </ul>
        </div>
      </div>

      <div class="comparison-table">
        <table style="width: 100%;">
          <tr>
            <th>Storage Type</th>
            <th>Capacity</th>
            <th>Persistence</th>
            <th>Access</th>
            <th>Use Case</th>
          </tr>
          <tr>
            <td>Local Storage</td>
            <td>5-10 MB</td>
            <td>Permanent</td>
            <td>Sync</td>
            <td>User preferences, tokens</td>
          </tr>
          <tr>
            <td>Session Storage</td>
            <td>5-10 MB</td>
            <td>Tab session</td>
            <td>Sync</td>
            <td>Form data, temp state</td>
          </tr>
          <tr>
            <td>IndexedDB</td>
            <td>50MB - GBs</td>
            <td>Permanent</td>
            <td>Async</td>
            <td>Offline data, large datasets</td>
          </tr>
          <tr>
            <td>Cookies</td>
            <td>4 KB each</td>
            <td>Configurable</td>
            <td>Sync</td>
            <td>Auth, server communication</td>
          </tr>
          <tr>
            <td>Cache Storage</td>
            <td>Browser managed</td>
            <td>Permanent</td>
            <td>Async</td>
            <td>Offline resources, PWA</td>
          </tr>
        </table>
      </div>
    </section>

    <!-- Section 8.2 -->
    <section>
      <h2>8.2 Local Storage & Session Storage</h2>

      <h3>Viewing Storage in DevTools</h3>
      <ol>
        <li>Open DevTools ‚Üí Application panel</li>
        <li>Expand "Storage" in the left sidebar</li>
        <li>Click on "Local Storage" or "Session Storage"</li>
        <li>Select the origin (domain)</li>
      </ol>

      <h3>DevTools Features</h3>
      <ul>
        <li><strong>View all key-value pairs</strong> in a table format</li>
        <li><strong>Double-click</strong> to edit values inline</li>
        <li><strong>Right-click ‚Üí Delete</strong> to remove items</li>
        <li><strong>Clear All</strong> button (üö´) to wipe storage</li>
        <li><strong>Filter/Search</strong> box to find specific keys</li>
        <li><strong>Refresh</strong> button to reload data</li>
      </ul>

      <h3>JavaScript API</h3>

      <div class="code-block">
        <div class="code-title">Local Storage API</div>
        <pre>
// Setting data
localStorage.setItem('user', JSON.stringify({ name: 'John', id: 123 }));
localStorage.setItem('theme', 'dark');
localStorage.setItem('language', 'en');

// Getting data
const user = JSON.parse(localStorage.getItem('user'));
const theme = localStorage.getItem('theme');

// Check if key exists
if (localStorage.getItem('token')) {
    console.log('User is authenticated');
}

// Remove specific item
localStorage.removeItem('tempData');

// Clear ALL localStorage for this origin
localStorage.clear();

// Get number of items
console.log('Items stored:', localStorage.length);

// Iterate through all items
for (let i = 0; i < localStorage.length; i++) {
    const key = localStorage.key(i);
    const value = localStorage.getItem(key);
    console.log(`${key}: ${value}`);
}</pre>
      </div>

      <div class="code-block">
        <div class="code-title">Session Storage API (Same methods)</div>
        <pre>
// Session storage has identical API but different scope
sessionStorage.setItem('currentStep', '3');
sessionStorage.setItem('formData', JSON.stringify({
    name: 'Jane',
    email: 'jane@example.com'
}));

// Data is cleared when tab/window closes
// Not shared between tabs (even same site)

// Use case: Multi-step form wizard
function saveFormProgress(step, data) {
    sessionStorage.setItem('wizardStep', step);
    sessionStorage.setItem('wizardData', JSON.stringify(data));
}

function restoreFormProgress() {
    const step = sessionStorage.getItem('wizardStep') || '1';
    const data = JSON.parse(sessionStorage.getItem('wizardData') || '{}');
    return { step, data };
}</pre>
      </div>

      <div class="warning">localStorage and sessionStorage only store strings! Always use JSON.stringify() for objects and JSON.parse() when reading.</div>

      <h3>Storage Event (Cross-Tab Communication)</h3>

      <div class="code-block">
        <div class="code-title">Listen for Storage Changes</div>
        <pre>
// This event fires in OTHER tabs when localStorage changes
window.addEventListener('storage', (event) => {
    console.log('Storage changed!');
    console.log('Key:', event.key);
    console.log('Old Value:', event.oldValue);
    console.log('New Value:', event.newValue);
    console.log('URL:', event.url);
    
    // Use case: Logout user in all tabs
    if (event.key === 'authToken' && event.newValue === null) {
        window.location.href = '/login';
    }
    
    // Use case: Sync theme across tabs
    if (event.key === 'theme') {
        document.body.className = event.newValue;
    }
});

// Note: Event does NOT fire in the tab that made the change!</pre>
      </div>

      <div class="note">The storage event enables cross-tab communication! Use it to sync state like auth status, theme, or real-time data across browser tabs.</div>
    </section>

    <!-- Section 8.3 -->
    <section>
      <h2>8.3 IndexedDB - Client-Side Database</h2>

      <p>IndexedDB is a low-level API for storing large amounts of structured data, including files and blobs. It's the go-to solution for offline-capable applications.</p>

      <h3>Viewing IndexedDB in DevTools</h3>
      <ol>
        <li>Application panel ‚Üí Storage ‚Üí IndexedDB</li>
        <li>Expand to see databases</li>
        <li>Expand database to see object stores</li>
        <li>Click object store to view records</li>
        <li>Click record to see full object details</li>
      </ol>

      <h3>IndexedDB Concepts</h3>

      <div class="visual-diagram">
        <div class="diagram-title">IndexedDB Structure</div>
        <div style="padding: 20px; text-align: center;">
          <div style="display: inline-block; text-align: left;">
            <div style="background: #374151; padding: 15px 25px; border-radius: 10px; margin-bottom: 10px;">
              <strong style="color: #a78bfa;">Database</strong> (e.g., "MyAppDB")
            </div>
            <div style="margin-left: 30px;">
              <div style="background: #1f2937; padding: 12px 20px; border-radius: 8px; margin: 8px 0; border-left: 3px solid #a78bfa;">
                <strong>Object Store</strong> (e.g., "users") - Like a table
              </div>
              <div style="margin-left: 30px;">
                <div style="background: #111827; padding: 10px 15px; border-radius: 6px; margin: 5px 0; font-size: 0.9em;">
                  Record: { id: 1, name: "John", email: "..." }
                </div>
                <div style="background: #111827; padding: 10px 15px; border-radius: 6px; margin: 5px 0; font-size: 0.9em;">
                  Record: { id: 2, name: "Jane", email: "..." }
                </div>
              </div>
              <div style="background: #1f2937; padding: 12px 20px; border-radius: 8px; margin: 8px 0; border-left: 3px solid #a78bfa;">
                <strong>Object Store</strong> (e.g., "products")
              </div>
              <div style="background: #1f2937; padding: 12px 20px; border-radius: 8px; margin: 8px 0; border-left: 3px solid #10b981;">
                <strong>Index</strong> (e.g., "by_email") - For fast lookups
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="code-block">
        <div class="code-title">IndexedDB Basic Operations</div>
        <pre>
// Open/Create Database
const request = indexedDB.open('MyAppDB', 1);

// Called when database needs setup (first time or version upgrade)
request.onupgradeneeded = (event) => {
    const db = event.target.result;
    
    // Create object store with auto-incrementing key
    const userStore = db.createObjectStore('users', { 
        keyPath: 'id',
        autoIncrement: true 
    });
    
    // Create indexes for faster queries
    userStore.createIndex('by_email', 'email', { unique: true });
    userStore.createIndex('by_name', 'name', { unique: false });
    
    console.log('Database setup complete');
};

request.onsuccess = (event) => {
    const db = event.target.result;
    console.log('Database opened successfully');
    
    // Now you can use the database
    addUser(db, { name: 'Alice', email: 'alice@example.com' });
};

request.onerror = (event) => {
    console.error('Database error:', event.target.error);
};

// Add a record
function addUser(db, user) {
    const transaction = db.transaction(['users'], 'readwrite');
    const store = transaction.objectStore('users');
    const request = store.add(user);
    
    request.onsuccess = () => console.log('User added with id:', request.result);
    request.onerror = () => console.error('Error adding user');
}

// Read a record
function getUser(db, id) {
    const transaction = db.transaction(['users'], 'readonly');
    const store = transaction.objectStore('users');
    const request = store.get(id);
    
    request.onsuccess = () => {
        console.log('User found:', request.result);
    };
}

// Query by index
function getUserByEmail(db, email) {
    const transaction = db.transaction(['users'], 'readonly');
    const store = transaction.objectStore('users');
    const index = store.index('by_email');
    const request = index.get(email);
    
    request.onsuccess = () => {
        console.log('User found:', request.result);
    };
}

// Delete a record
function deleteUser(db, id) {
    const transaction = db.transaction(['users'], 'readwrite');
    const store = transaction.objectStore('users');
    store.delete(id);
}

// Get all records
function getAllUsers(db) {
    const transaction = db.transaction(['users'], 'readonly');
    const store = transaction.objectStore('users');
    const request = store.getAll();
    
    request.onsuccess = () => {
        console.log('All users:', request.result);
    };
}</pre>
      </div>

      <div class="tip">In DevTools, you can right-click on object stores to delete them, or refresh to see new data. Use the "Clear site data" button to wipe everything for testing.</div>
    </section>

    <!-- Section 8.4 -->
    <section>
      <h2>8.4 Cookies - Deep Dive</h2>

      <p>Cookies are small pieces of data sent by the server and stored by the browser. They're automatically included in HTTP requests to the same domain.</p>

      <h3>Viewing Cookies in DevTools</h3>
      <ol>
        <li>Application panel ‚Üí Storage ‚Üí Cookies</li>
        <li>Select the domain</li>
        <li>View all cookies in table format</li>
        <li>Double-click to edit values</li>
        <li>Right-click for delete options</li>
      </ol>

      <h3>Cookie Attributes Explained</h3>

      <div class="cookie-visual">
        <div class="cookie-attr">
          <div class="label">Name</div>
          <div class="value">session_id</div>
        </div>
        <div class="cookie-attr">
          <div class="label">Value</div>
          <div class="value">abc123xyz</div>
        </div>
        <div class="cookie-attr">
          <div class="label">Domain</div>
          <div class="value">.example.com</div>
        </div>
        <div class="cookie-attr">
          <div class="label">Path</div>
          <div class="value">/</div>
        </div>
        <div class="cookie-attr">
          <div class="label">Expires</div>
          <div class="value">2025-12-31</div>
        </div>
        <div class="cookie-attr">
          <div class="label">Size</div>
          <div class="value">45 bytes</div>
        </div>
        <div class="cookie-attr">
          <div class="label">HttpOnly</div>
          <div class="value">‚úì</div>
        </div>
        <div class="cookie-attr">
          <div class="label">Secure</div>
          <div class="value">‚úì</div>
        </div>
        <div class="cookie-attr">
          <div class="label">SameSite</div>
          <div class="value">Strict</div>
        </div>
      </div>

      <h3>Cookie Attributes in Detail</h3>

      <table class="comparison-table">
        <tr>
          <th>Attribute</th>
          <th>Description</th>
          <th>Security Impact</th>
        </tr>
        <tr>
          <td><strong>HttpOnly</strong></td>
          <td>Cookie cannot be accessed via JavaScript (document.cookie)</td>
          <td>üîí Prevents XSS from stealing cookies</td>
        </tr>
        <tr>
          <td><strong>Secure</strong></td>
          <td>Cookie only sent over HTTPS connections</td>
          <td>üîí Prevents MITM attacks</td>
        </tr>
        <tr>
          <td><strong>SameSite=Strict</strong></td>
          <td>Cookie only sent in first-party context</td>
          <td>üîí Full CSRF protection</td>
        </tr>
        <tr>
          <td><strong>SameSite=Lax</strong></td>
          <td>Sent with top-level navigations (links)</td>
          <td>üîí CSRF protection with usability</td>
        </tr>
        <tr>
          <td><strong>SameSite=None</strong></td>
          <td>Sent in all contexts (requires Secure)</td>
          <td>‚ö†Ô∏è Vulnerable to CSRF</td>
        </tr>
      </table>

      <div class="warning">SameSite cookies are a critical interview topic! Know the difference between Strict, Lax, and None, and when to use each.</div>

      <div class="code-block">
        <div class="code-title">Working with Cookies in JavaScript</div>
        <pre>
// Reading all cookies (only non-HttpOnly ones!)
console.log(document.cookie);
// Output: "theme=dark; language=en; userId=123"

// Setting a cookie
document.cookie = "username=John; expires=Thu, 31 Dec 2025 23:59:59 GMT; path=/";

// Setting a secure cookie (HTTPS only)
document.cookie = "token=abc123; Secure; SameSite=Strict; path=/";

// Setting an expiring cookie (Session cookie if no expires)
const date = new Date();
date.setTime(date.getTime() + (7 * 24 * 60 * 60 * 1000)); // 7 days
document.cookie = `preferences=${JSON.stringify({theme: 'dark'})}; expires=${date.toUTCString()}; path=/`;

// Deleting a cookie (set expires to past date)
document.cookie = "username=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/";

// Helper function to get a specific cookie
function getCookie(name) {
    const value = `; ${document.cookie}`;
    const parts = value.split(`; ${name}=`);
    if (parts.length === 2) {
        return parts.pop().split(';').shift();
    }
    return null;
}

// Helper function to set a cookie
function setCookie(name, value, days, options = {}) {
    let cookie = `${name}=${encodeURIComponent(value)}`;
    
    if (days) {
        const date = new Date();
        date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
        cookie += `; expires=${date.toUTCString()}`;
    }
    
    cookie += `; path=${options.path || '/'}`;
    
    if (options.secure) cookie += '; Secure';
    if (options.sameSite) cookie += `; SameSite=${options.sameSite}`;
    
    document.cookie = cookie;
}

// Usage
setCookie('user_pref', 'dark_mode', 30, { 
    secure: true, 
    sameSite: 'Lax' 
});</pre>
      </div>

      <div class="note">HttpOnly cookies cannot be read by JavaScript - they only appear in DevTools. This is intentional for security!</div>
    </section>

    <!-- Section 8.5 -->
    <section>
      <h2>8.5 Service Workers</h2>

      <p>Service Workers are JavaScript files that run in the background, separate from the web page. They enable offline functionality, push notifications, and background sync.</p>

      <h3>Service Worker Lifecycle</h3>

      <div class="visual-diagram">
        <div class="diagram-title">Service Worker States</div>
        <div class="sw-lifecycle">
          <div class="sw-state installing">üì• Installing</div>
          <span class="arrow">‚Üí</span>
          <div class="sw-state waiting">‚è≥ Waiting</div>
          <span class="arrow">‚Üí</span>
          <div class="sw-state active">‚úÖ Active</div>
          <span class="arrow">‚Üí</span>
          <div class="sw-state redundant">üóëÔ∏è Redundant</div>
        </div>
      </div>

      <ul>
        <li><strong>Installing:</strong> Service worker is being installed, install event fires</li>
        <li><strong>Waiting:</strong> Installed but waiting for existing SW to be released</li>
        <li><strong>Active:</strong> Controls pages, handles fetch/push/sync events</li>
        <li><strong>Redundant:</strong> Replaced by newer version or failed to install</li>
      </ul>

      <h3>DevTools Service Worker Panel</h3>
      <ol>
        <li>Application ‚Üí Service Workers</li>
        <li>See all registered service workers</li>
        <li><strong>Update:</strong> Force update check</li>
        <li><strong>Unregister:</strong> Remove the service worker</li>
        <li><strong>Skip waiting:</strong> Activate waiting worker immediately</li>
        <li><strong>Update on reload:</strong> Always get fresh SW</li>
        <li><strong>Bypass for network:</strong> Disable SW for testing</li>
      </ol>

      <div class="code-block">
        <div class="code-title">Registering a Service Worker</div>
        <pre>
// In your main JavaScript file
if ('serviceWorker' in navigator) {
    window.addEventListener('load', async () => {
        try {
            const registration = await navigator.serviceWorker.register('/sw.js', {
                scope: '/'  // Controls all pages under this path
            });
            
            console.log('SW registered:', registration.scope);
            
            // Check for updates
            registration.addEventListener('updatefound', () => {
                const newWorker = registration.installing;
                console.log('New SW installing...');
                
                newWorker.addEventListener('statechange', () => {
                    if (newWorker.state === 'installed') {
                        if (navigator.serviceWorker.controller) {
                            // New version available
                            console.log('New content available, refresh!');
                            showUpdateNotification();
                        } else {
                            // First install
                            console.log('Content cached for offline use');
                        }
                    }
                });
            });
        } catch (error) {
            console.error('SW registration failed:', error);
        }
    });
}</pre>
      </div>

      <div class="code-block">
        <div class="code-title">Service Worker File (sw.js)</div>
        <pre>
const CACHE_NAME = 'my-app-v1';
const STATIC_ASSETS = [
    '/',
    '/index.html',
    '/styles/main.css',
    '/scripts/app.js',
    '/images/logo.png'
];

// Install event - cache static assets
self.addEventListener('install', (event) => {
    console.log('SW: Installing...');
    
    event.waitUntil(
        caches.open(CACHE_NAME)
            .then(cache => {
                console.log('SW: Caching static assets');
                return cache.addAll(STATIC_ASSETS);
            })
            .then(() => {
                // Immediately activate (skip waiting)
                return self.skipWaiting();
            })
    );
});

// Activate event - clean up old caches
self.addEventListener('activate', (event) => {
    console.log('SW: Activating...');
    
    event.waitUntil(
        caches.keys().then(cacheNames => {
            return Promise.all(
                cacheNames
                    .filter(name => name !== CACHE_NAME)
                    .map(name => {
                        console.log('SW: Deleting old cache:', name);
                        return caches.delete(name);
                    })
            );
        }).then(() => {
            // Take control of all pages immediately
            return self.clients.claim();
        })
    );
});

// Fetch event - serve from cache, fallback to network
self.addEventListener('fetch', (event) => {
    event.respondWith(
        caches.match(event.request)
            .then(cachedResponse => {
                if (cachedResponse) {
                    console.log('SW: Serving from cache:', event.request.url);
                    return cachedResponse;
                }
                
                console.log('SW: Fetching from network:', event.request.url);
                return fetch(event.request)
                    .then(response => {
                        // Cache successful responses
                        if (response.status === 200) {
                            const responseClone = response.clone();
                            caches.open(CACHE_NAME)
                                .then(cache => cache.put(event.request, responseClone));
                        }
                        return response;
                    });
            })
    );
});</pre>
      </div>

      <div class="tip">Use "Update on reload" checkbox during development to always get fresh service worker code!</div>
    </section>

    <!-- Section 8.6 -->
    <section>
      <h2>8.6 Cache Storage</h2>

      <p>Cache Storage is an API for storing HTTP responses. It's primarily used by Service Workers for offline functionality.</p>

      <h3>Viewing Cache Storage in DevTools</h3>
      <ol>
        <li>Application ‚Üí Cache Storage</li>
        <li>Expand to see named caches</li>
        <li>Click on a cache to see stored responses</li>
        <li>Click on an entry to preview the cached content</li>
        <li>Right-click to delete individual entries</li>
      </ol>

      <div class="code-block">
        <div class="code-title">Cache Storage API</div>
        <pre>
// Open or create a cache
const cache = await caches.open('my-cache-v1');

// Add single request to cache
await cache.add('/api/data.json');

// Add multiple requests
await cache.addAll([
    '/styles.css',
    '/script.js',
    '/image.png'
]);

// Put a custom response in cache
await cache.put('/custom-response', new Response(
    JSON.stringify({ cached: true }),
    { headers: { 'Content-Type': 'application/json' }}
));

// Match a request
const response = await cache.match('/api/data.json');
if (response) {
    const data = await response.json();
    console.log('From cache:', data);
}

// Delete an entry
await cache.delete('/old-resource');

// Get all cached requests
const requests = await cache.keys();
requests.forEach(request => {
    console.log('Cached:', request.url);
});

// Delete entire cache
await caches.delete('my-cache-v1');

// List all caches
const cacheNames = await caches.keys();
console.log('Available caches:', cacheNames);</pre>
      </div>
    </section>

    <!-- Section 8.7 -->
    <section>
      <h2>8.7 Manifest & PWA (Progressive Web Apps)</h2>

      <p>The Web App Manifest is a JSON file that tells the browser about your PWA and how it should behave when installed.</p>

      <h3>Viewing Manifest in DevTools</h3>
      <ol>
        <li>Application ‚Üí Manifest</li>
        <li>See parsed manifest properties</li>
        <li>View app icons in different sizes</li>
        <li>Check installability status</li>
        <li>Simulate "Add to Home Screen"</li>
      </ol>

      <div class="code-block">
        <div class="code-title">manifest.json</div>
        <pre>
{
    "name": "My Awesome App",
    "short_name": "MyApp",
    "description": "An awesome progressive web application",
    "start_url": "/",
    "scope": "/",
    "display": "standalone",
    "background_color": "#1a1a2e",
    "theme_color": "#8b5cf6",
    "orientation": "portrait-primary",
    "icons": [
        {
            "src": "/icons/icon-72x72.png",
            "sizes": "72x72",
            "type": "image/png"
        },
        {
            "src": "/icons/icon-96x96.png",
            "sizes": "96x96",
            "type": "image/png"
        },
        {
            "src": "/icons/icon-128x128.png",
            "sizes": "128x128",
            "type": "image/png"
        },
        {
            "src": "/icons/icon-144x144.png",
            "sizes": "144x144",
            "type": "image/png"
        },
        {
            "src": "/icons/icon-152x152.png",
            "sizes": "152x152",
            "type": "image/png"
        },
        {
            "src": "/icons/icon-192x192.png",
            "sizes": "192x192",
            "type": "image/png",
            "purpose": "any maskable"
        },
        {
            "src": "/icons/icon-384x384.png",
            "sizes": "384x384",
            "type": "image/png"
        },
        {
            "src": "/icons/icon-512x512.png",
            "sizes": "512x512",
            "type": "image/png"
        }
    ],
    "screenshots": [
        {
            "src": "/screenshots/desktop.png",
            "sizes": "1280x720",
            "type": "image/png",
            "form_factor": "wide"
        },
        {
            "src": "/screenshots/mobile.png",
            "sizes": "750x1334",
            "type": "image/png",
            "form_factor": "narrow"
        }
    ],
    "shortcuts": [
        {
            "name": "New Document",
            "url": "/new",
            "icons": [{ "src": "/icons/new.png", "sizes": "96x96" }]
        }
    ],
    "categories": ["productivity", "utilities"]
}</pre>
      </div>

      <div class="code-block">
        <div class="code-title">Link Manifest in HTML</div>
        <pre>
&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    
    &lt;!-- Link to manifest --&gt;
    &lt;link rel="manifest" href="/manifest.json"&gt;
    
    &lt;!-- Theme color for browser chrome --&gt;
    &lt;meta name="theme-color" content="#8b5cf6"&gt;
    
    &lt;!-- iOS specific --&gt;
    &lt;meta name="apple-mobile-web-app-capable" content="yes"&gt;
    &lt;meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"&gt;
    &lt;meta name="apple-mobile-web-app-title" content="MyApp"&gt;
    &lt;link rel="apple-touch-icon" href="/icons/icon-152x152.png"&gt;
    
    &lt;title&gt;My PWA&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;!-- Your app content --&gt;
&lt;/body&gt;
&lt;/html&gt;</pre>
      </div>

      <h3>PWA Installability Criteria</h3>

      <div class="pwa-checklist">
        <div class="checklist-item">
          <span class="check">‚úì</span>
          <span>Web app is served over <strong>HTTPS</strong></span>
        </div>
        <div class="checklist-item">
          <span class="check">‚úì</span>
          <span>Has a valid <strong>Web App Manifest</strong> with required fields</span>
        </div>
        <div class="checklist-item">
          <span class="check">‚úì</span>
          <span>Manifest includes <strong>name</strong> or <strong>short_name</strong></span>
        </div>
        <div class="checklist-item">
          <span class="check">‚úì</span>
          <span>Manifest includes <strong>start_url</strong></span>
        </div>
        <div class="checklist-item">
          <span class="check">‚úì</span>
          <span>Manifest includes <strong>display</strong> (standalone, fullscreen, or minimal-ui)</span>
        </div>
        <div class="checklist-item">
          <span class="check">‚úì</span>
          <span>Has at least one icon <strong>192x192</strong> and one <strong>512x512</strong></span>
        </div>
        <div class="checklist-item">
          <span class="check">‚úì</span>
          <span>Has a registered <strong>Service Worker</strong> with fetch handler</span>
        </div>
      </div>

      <div class="tip">Check the "Installability" section in the Application panel to see exactly what's missing for your PWA to be installable!</div>
    </section>

    <!-- Section 8.8 -->
    <section>
      <h2>8.8 Clear Storage</h2>

      <p>The "Clear site data" feature lets you wipe all storage for testing fresh states.</p>

      <h3>Using Clear Storage</h3>
      <ol>
        <li>Application ‚Üí Storage ‚Üí Clear site data</li>
        <li>Select what to clear:
          <ul>
            <li>‚òê Unregister service workers</li>
            <li>‚òê Local and session storage</li>
            <li>‚òê IndexedDB</li>
            <li>‚òê Cookies</li>
            <li>‚òê Cache storage</li>
          </ul>
        </li>
        <li>Click "Clear site data" button</li>
      </ol>

      <h3>Storage Quota</h3>
      <p>The Storage section also shows quota information:</p>
      <ul>
        <li><strong>Usage:</strong> Current storage used</li>
        <li><strong>Quota:</strong> Maximum available storage</li>
        <li><strong>Breakdown:</strong> Usage by storage type</li>
      </ul>

      <div class="code-block">
        <div class="code-title">Check Storage Quota Programmatically</div>
        <pre>
if (navigator.storage && navigator.storage.estimate) {
    const estimate = await navigator.storage.estimate();
    
    console.log('Storage Usage:', formatBytes(estimate.usage));
    console.log('Storage Quota:', formatBytes(estimate.quota));
    console.log('Percent Used:', ((estimate.usage / estimate.quota) * 100).toFixed(2) + '%');
    
    // Breakdown by storage type (if available)
    if (estimate.usageDetails) {
        console.log('IndexedDB:', formatBytes(estimate.usageDetails.indexedDB));
        console.log('Cache Storage:', formatBytes(estimate.usageDetails.caches));
        console.log('Service Workers:', formatBytes(estimate.usageDetails.serviceWorkerRegistrations));
    }
}

function formatBytes(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

// Request persistent storage (prevents browser from clearing data)
if (navigator.storage && navigator.storage.persist) {
    const isPersisted = await navigator.storage.persist();
    console.log('Persistent storage granted:', isPersisted);
}</pre>
      </div>

      <div class="note">By default, browser can clear storage when under storage pressure. Request persistent storage for critical data!</div>
    </section>

    <!-- Interview Questions -->
    <section>
      <h2>üéØ Interview Questions - Application Panel</h2>

      <div class="concept-box">
        <h4>Q1: What's the difference between localStorage and sessionStorage?</h4>
        <p><strong>Answer:</strong> localStorage persists indefinitely and is shared across all tabs of the same origin. sessionStorage is scoped to a single tab and is cleared when the tab closes. Both have ~5-10MB limit and store only strings.</p>
      </div>

      <div class="concept-box">
        <h4>Q2: Explain the SameSite cookie attribute.</h4>
        <p><strong>Answer:</strong> SameSite controls when cookies are sent with cross-site requests. Strict: only same-site requests. Lax: same-site + top-level navigation (default). None: all requests (requires Secure). It's the primary defense against CSRF attacks.</p>
      </div>

      <div class="concept-box">
        <h4>Q3: What is a Service Worker and when would you use one?</h4>
        <p><strong>Answer:</strong> A Service Worker is a JavaScript file that runs in the background, separate from web pages. Use cases: offline functionality (caching), push notifications, background sync, network request interception. It's essential for PWAs.</p>
      </div>

      <div class="concept-box">
        <h4>Q4: How do you make a web app installable as a PWA?</h4>
        <p><strong>Answer:</strong> Requires: HTTPS, valid Web App Manifest (with name, start_url, display, icons 192x192 and 512x512), and a Service Worker with fetch handler. The Application panel shows exactly what's missing.</p>
      </div>

      <div class="concept-box">
        <h4>Q5: Why would you use IndexedDB over localStorage?</h4>
        <p><strong>Answer:</strong> IndexedDB for: large data (GBs vs 5-10MB), structured data with indexes, storing any JS object (not just strings), async operations (doesn't block UI), and transaction support. localStorage for: simple key-value strings, small data, sync access.</p>
      </div>
    </section>

  </div>
</body>
</html>
