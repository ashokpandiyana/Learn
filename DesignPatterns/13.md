# Chapter 13: Composite Pattern

## 13.1 Concept

### What is the Composite Pattern?

The Composite Pattern composes objects into **tree structures** to represent part-whole hierarchies. It lets clients treat **individual objects and compositions uniformly**.

Think of a file system: a folder can contain files and other folders. You can perform the same operations (copy, delete, get size) on both files and folders.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   COMPOSITE PATTERN                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚                     Component (Interface)                   â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚                    â”‚ + operation()     â”‚                    â”‚
â”‚                    â”‚ + add(component)  â”‚                    â”‚
â”‚                    â”‚ + remove(comp)    â”‚                    â”‚
â”‚                    â”‚ + getChild(index) â”‚                    â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                              â”‚                              â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚              â”‚                               â”‚              â”‚
â”‚              â–¼                               â–¼              â”‚
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚       â”‚    Leaf     â”‚               â”‚  Composite  â”‚         â”‚
â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”‚
â”‚       â”‚ operation() â”‚               â”‚ children[]  â”‚         â”‚
â”‚       â”‚ (no childrenâ”‚               â”‚ operation() â”‚         â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚ add()       â”‚         â”‚
â”‚                                     â”‚ remove()    â”‚         â”‚
â”‚                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                           â”‚                 â”‚
â”‚   TREE STRUCTURE:                         â”‚                 â”‚
â”‚                                           â–¼                 â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[Root Composite]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚              â”‚                    â”‚                   â”‚     â”‚
â”‚              â–¼                    â–¼                   â–¼     â”‚
â”‚           [Leaf]            [Composite]           [Leaf]    â”‚
â”‚                             /    |    \                     â”‚
â”‚                         [Leaf] [Leaf] [Composite]           â”‚
â”‚                                        /    \               â”‚
â”‚                                    [Leaf]  [Leaf]           â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Key Characteristics

| Concept | Description |
|---------|-------------|
| **Component** | Common interface for all objects |
| **Leaf** | Objects with no children (end nodes) |
| **Composite** | Objects that contain children |
| **Uniform Treatment** | Clients use same interface for both |
| **Recursive Structure** | Composites contain components (including other composites) |

---

## 13.2 Implementation

### File System Example

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// COMPONENT: Common interface
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
class FileSystemComponent {
  constructor(name) {
    this.name = name;
    this.parent = null;
  }
  
  getSize() {
    throw new Error('Must implement getSize()');
  }
  
  display(indent = '') {
    throw new Error('Must implement display()');
  }
  
  getPath() {
    if (!this.parent) return this.name;
    return this.parent.getPath() + '/' + this.name;
  }
  
  // Default implementations for leaf nodes
  add(component) {
    throw new Error('Cannot add to a leaf node');
  }
  
  remove(component) {
    throw new Error('Cannot remove from a leaf node');
  }
  
  getChildren() {
    return [];
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LEAF: File (no children)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
class File extends FileSystemComponent {
  constructor(name, size) {
    super(name);
    this.size = size;
  }
  
  getSize() {
    return this.size;
  }
  
  display(indent = '') {
    console.log(`${indent}ğŸ“„ ${this.name} (${this.formatSize(this.size)})`);
  }
  
  formatSize(bytes) {
    if (bytes < 1024) return bytes + ' B';
    if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
    return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
  }
  
  // Search within file (for interface compatibility)
  search(query) {
    if (this.name.toLowerCase().includes(query.toLowerCase())) {
      return [this];
    }
    return [];
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// COMPOSITE: Folder (contains children)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
class Folder extends FileSystemComponent {
  constructor(name) {
    super(name);
    this.children = [];
  }
  
  add(component) {
    component.parent = this;
    this.children.push(component);
    return this;
  }
  
  remove(component) {
    const index = this.children.indexOf(component);
    if (index !== -1) {
      component.parent = null;
      this.children.splice(index, 1);
    }
    return this;
  }
  
  getChildren() {
    return [...this.children];
  }
  
  // Recursively calculate size of all contents
  getSize() {
    return this.children.reduce((total, child) => {
      return total + child.getSize();
    }, 0);
  }
  
  // Recursively display tree structure
  display(indent = '') {
    console.log(`${indent}ğŸ“ ${this.name}/ (${this.formatSize(this.getSize())})`);
    
    this.children.forEach((child, index) => {
      const isLast = index === this.children.length - 1;
      const newIndent = indent + (isLast ? '    ' : 'â”‚   ');
      const prefix = isLast ? 'â””â”€â”€ ' : 'â”œâ”€â”€ ';
      
      if (child instanceof Folder) {
        console.log(`${indent}${prefix}ğŸ“ ${child.name}/`);
        child.children.forEach((grandChild, i) => {
          grandChild.display(newIndent);
        });
      } else {
        child.display(indent + prefix.replace(/[â”œâ””]/, '').replace('â”€â”€ ', ''));
      }
    });
  }
  
  // Recursive search
  search(query) {
    let results = [];
    
    // Check this folder's name
    if (this.name.toLowerCase().includes(query.toLowerCase())) {
      results.push(this);
    }
    
    // Search children
    this.children.forEach(child => {
      results = results.concat(child.search(query));
    });
    
    return results;
  }
  
  // Get count of all files recursively
  getFileCount() {
    return this.children.reduce((count, child) => {
      if (child instanceof File) {
        return count + 1;
      }
      return count + child.getFileCount();
    }, 0);
  }
  
  // Get count of all folders recursively
  getFolderCount() {
    return this.children.reduce((count, child) => {
      if (child instanceof Folder) {
        return count + 1 + child.getFolderCount();
      }
      return count;
    }, 0);
  }
  
  formatSize(bytes) {
    if (bytes < 1024) return bytes + ' B';
    if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
    if (bytes < 1024 * 1024 * 1024) return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
    return (bytes / (1024 * 1024 * 1024)).toFixed(1) + ' GB';
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// USAGE: Build and traverse tree
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Build file system tree
const root = new Folder('root');

const documents = new Folder('documents');
documents.add(new File('resume.pdf', 102400));
documents.add(new File('cover-letter.docx', 51200));

const photos = new Folder('photos');
const vacation = new Folder('vacation');
vacation.add(new File('beach.jpg', 2048000));
vacation.add(new File('sunset.jpg', 1843200));
photos.add(vacation);
photos.add(new File('profile.png', 512000));

const projects = new Folder('projects');
const webapp = new Folder('webapp');
webapp.add(new File('index.html', 4096));
webapp.add(new File('style.css', 8192));
webapp.add(new File('app.js', 16384));
projects.add(webapp);

root.add(documents);
root.add(photos);
root.add(projects);
root.add(new File('notes.txt', 1024));

// Display tree
console.log('\n=== File System Tree ===\n');
root.display();

// Get total size (works same way on files and folders)
console.log('\n=== Sizes ===');
console.log(`Total size: ${root.formatSize(root.getSize())}`);
console.log(`Photos size: ${photos.formatSize(photos.getSize())}`);
console.log(`Single file size: ${documents.getChildren()[0].formatSize(documents.getChildren()[0].getSize())}`);

// Statistics
console.log('\n=== Statistics ===');
console.log(`Total files: ${root.getFileCount()}`);
console.log(`Total folders: ${root.getFolderCount()}`);

// Search
console.log('\n=== Search Results for "jpg" ===');
const results = root.search('jpg');
results.forEach(item => console.log(item.getPath()));
```

### Menu System Example

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Menu Component Interface
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
class MenuComponent {
  constructor(name, description = '') {
    this.name = name;
    this.description = description;
  }
  
  getName() { return this.name; }
  getDescription() { return this.description; }
  
  getPrice() { throw new Error('Not implemented'); }
  isVegetarian() { throw new Error('Not implemented'); }
  print(indent) { throw new Error('Not implemented'); }
  
  // Composite operations (default for leaves)
  add(component) { throw new Error('Cannot add to leaf'); }
  remove(component) { throw new Error('Cannot remove from leaf'); }
  getChild(index) { return null; }
  
  // Iterator support
  *[Symbol.iterator]() {
    yield this;
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Leaf: Menu Item
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
class MenuItem extends MenuComponent {
  constructor(name, description, vegetarian, price) {
    super(name, description);
    this.vegetarian = vegetarian;
    this.price = price;
  }
  
  getPrice() {
    return this.price;
  }
  
  isVegetarian() {
    return this.vegetarian;
  }
  
  print(indent = '') {
    const vegIcon = this.vegetarian ? 'ğŸŒ±' : 'ğŸ–';
    console.log(`${indent}${vegIcon} ${this.name} - $${this.price.toFixed(2)}`);
    console.log(`${indent}   ${this.description}`);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Composite: Menu (contains items and sub-menus)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
class Menu extends MenuComponent {
  constructor(name, description) {
    super(name, description);
    this.menuComponents = [];
  }
  
  add(component) {
    this.menuComponents.push(component);
    return this;
  }
  
  remove(component) {
    const index = this.menuComponents.indexOf(component);
    if (index !== -1) {
      this.menuComponents.splice(index, 1);
    }
    return this;
  }
  
  getChild(index) {
    return this.menuComponents[index];
  }
  
  // Aggregate price of all items
  getPrice() {
    return this.menuComponents.reduce((total, item) => {
      return total + item.getPrice();
    }, 0);
  }
  
  // Check if all items are vegetarian
  isVegetarian() {
    return this.menuComponents.every(item => item.isVegetarian());
  }
  
  print(indent = '') {
    console.log(`\n${indent}ğŸ“‹ ${this.name.toUpperCase()}`);
    console.log(`${indent}${'-'.repeat(this.name.length + 3)}`);
    if (this.description) {
      console.log(`${indent}${this.description}`);
    }
    console.log('');
    
    this.menuComponents.forEach(component => {
      component.print(indent + '  ');
    });
  }
  
  // Get only vegetarian items
  getVegetarianItems() {
    const items = [];
    for (const component of this) {
      if (component instanceof MenuItem && component.isVegetarian()) {
        items.push(component);
      }
    }
    return items;
  }
  
  // Iterator for all items (flattened)
  *[Symbol.iterator]() {
    for (const component of this.menuComponents) {
      yield* component;
    }
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Build Menu Tree
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const allMenus = new Menu('ALL MENUS', 'Everything we offer');

// Breakfast Menu
const breakfastMenu = new Menu('Breakfast', 'Start your day right');
breakfastMenu
  .add(new MenuItem('Pancakes', 'Fluffy buttermilk pancakes with maple syrup', true, 8.99))
  .add(new MenuItem('Bacon & Eggs', 'Three eggs any style with crispy bacon', false, 10.99))
  .add(new MenuItem('Veggie Omelette', 'Three egg omelette with seasonal vegetables', true, 9.99))
  .add(new MenuItem('Avocado Toast', 'Sourdough with smashed avocado', true, 7.99));

// Lunch Menu with sub-menus
const lunchMenu = new Menu('Lunch', 'Midday meals');

const sandwiches = new Menu('Sandwiches', '');
sandwiches
  .add(new MenuItem('BLT', 'Bacon, lettuce, tomato on toasted bread', false, 9.99))
  .add(new MenuItem('Veggie Wrap', 'Grilled vegetables in a spinach wrap', true, 8.99))
  .add(new MenuItem('Turkey Club', 'Triple-decker with turkey and bacon', false, 11.99));

const salads = new Menu('Salads', '');
salads
  .add(new MenuItem('Caesar Salad', 'Romaine, croutons, parmesan', true, 8.99))
  .add(new MenuItem('Chicken Caesar', 'Caesar salad with grilled chicken', false, 12.99))
  .add(new MenuItem('Garden Salad', 'Mixed greens with house vinaigrette', true, 6.99));

lunchMenu.add(sandwiches).add(salads);

// Dinner Menu
const dinnerMenu = new Menu('Dinner', 'Evening specialties');
dinnerMenu
  .add(new MenuItem('Grilled Salmon', 'Atlantic salmon with herb butter', false, 24.99))
  .add(new MenuItem('Ribeye Steak', '12oz USDA choice with garlic butter', false, 32.99))
  .add(new MenuItem('Vegetable Risotto', 'Creamy arborio rice with seasonal vegetables', true, 18.99))
  .add(new MenuItem('Mushroom Pasta', 'Fettuccine with wild mushroom cream sauce', true, 16.99));

// Dessert Menu
const dessertMenu = new Menu('Desserts', 'Sweet endings');
dessertMenu
  .add(new MenuItem('Chocolate Cake', 'Rich dark chocolate layer cake', true, 7.99))
  .add(new MenuItem('Cheesecake', 'New York style with berry compote', true, 8.99))
  .add(new MenuItem('Ice Cream', 'Three scoops, your choice of flavors', true, 5.99));

// Build complete menu
allMenus
  .add(breakfastMenu)
  .add(lunchMenu)
  .add(dinnerMenu)
  .add(dessertMenu);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Usage
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Print entire menu tree
allMenus.print();

// Get vegetarian options
console.log('\n=== VEGETARIAN OPTIONS ===');
const vegItems = allMenus.getVegetarianItems();
vegItems.forEach(item => {
  console.log(`ğŸŒ± ${item.getName()} - $${item.getPrice().toFixed(2)}`);
});

// Iterate through all items
console.log('\n=== ALL ITEMS (Flattened) ===');
for (const item of allMenus) {
  if (item instanceof MenuItem) {
    console.log(`- ${item.getName()}`);
  }
}
```

---

## 13.3 UI Component Tree

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Component Base Class
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
class UIComponent {
  constructor(id) {
    this.id = id;
    this.parent = null;
    this.styles = {};
    this.classes = [];
    this.visible = true;
  }
  
  setStyle(property, value) {
    this.styles[property] = value;
    return this;
  }
  
  addClass(className) {
    if (!this.classes.includes(className)) {
      this.classes.push(className);
    }
    return this;
  }
  
  removeClass(className) {
    this.classes = this.classes.filter(c => c !== className);
    return this;
  }
  
  show() { this.visible = true; return this; }
  hide() { this.visible = false; return this; }
  
  render() { throw new Error('Must implement render()'); }
  
  // For composite operations
  add(component) { throw new Error('Cannot add children'); }
  remove(component) { throw new Error('Cannot remove children'); }
  find(id) { return this.id === id ? this : null; }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Leaf Components
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
class Button extends UIComponent {
  constructor(id, text, onClick) {
    super(id);
    this.text = text;
    this.onClick = onClick;
  }
  
  render() {
    if (!this.visible) return '';
    const styleStr = Object.entries(this.styles)
      .map(([k, v]) => `${k}: ${v}`).join('; ');
    const classStr = this.classes.join(' ');
    
    return `<button id="${this.id}" class="${classStr}" style="${styleStr}">${this.text}</button>`;
  }
}

class TextInput extends UIComponent {
  constructor(id, placeholder = '', value = '') {
    super(id);
    this.placeholder = placeholder;
    this.value = value;
  }
  
  render() {
    if (!this.visible) return '';
    return `<input type="text" id="${this.id}" placeholder="${this.placeholder}" value="${this.value}" />`;
  }
}

class Label extends UIComponent {
  constructor(id, text) {
    super(id);
    this.text = text;
  }
  
  render() {
    if (!this.visible) return '';
    return `<label id="${this.id}">${this.text}</label>`;
  }
}

class Image extends UIComponent {
  constructor(id, src, alt = '') {
    super(id);
    this.src = src;
    this.alt = alt;
  }
  
  render() {
    if (!this.visible) return '';
    return `<img id="${this.id}" src="${this.src}" alt="${this.alt}" />`;
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Composite Components (Containers)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
class Container extends UIComponent {
  constructor(id, tagName = 'div') {
    super(id);
    this.tagName = tagName;
    this.children = [];
  }
  
  add(component) {
    component.parent = this;
    this.children.push(component);
    return this;
  }
  
  remove(component) {
    const index = this.children.indexOf(component);
    if (index !== -1) {
      component.parent = null;
      this.children.splice(index, 1);
    }
    return this;
  }
  
  find(id) {
    if (this.id === id) return this;
    
    for (const child of this.children) {
      const found = child.find(id);
      if (found) return found;
    }
    
    return null;
  }
  
  render() {
    if (!this.visible) return '';
    
    const childrenHTML = this.children
      .map(child => child.render())
      .join('\n');
    
    const styleStr = Object.entries(this.styles)
      .map(([k, v]) => `${k}: ${v}`).join('; ');
    const classStr = this.classes.join(' ');
    
    return `<${this.tagName} id="${this.id}" class="${classStr}" style="${styleStr}">
${childrenHTML}
</${this.tagName}>`;
  }
}

class Form extends Container {
  constructor(id, onSubmit) {
    super(id, 'form');
    this.onSubmit = onSubmit;
  }
  
  render() {
    if (!this.visible) return '';
    
    const childrenHTML = this.children
      .map(child => child.render())
      .join('\n');
    
    return `<form id="${this.id}" class="${this.classes.join(' ')}">
${childrenHTML}
</form>`;
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Build UI Tree
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const app = new Container('app');
app.setStyle('max-width', '800px').setStyle('margin', '0 auto');

// Header
const header = new Container('header', 'header');
header.addClass('header');
header.add(new Image('logo', '/logo.png', 'Logo'));
header.add(new Label('title', 'My Application'));

// Login Form
const loginForm = new Form('loginForm');
loginForm.addClass('login-form');

const usernameGroup = new Container('usernameGroup');
usernameGroup.addClass('form-group');
usernameGroup.add(new Label('usernameLabel', 'Username'));
usernameGroup.add(new TextInput('username', 'Enter username'));

const passwordGroup = new Container('passwordGroup');
passwordGroup.addClass('form-group');
passwordGroup.add(new Label('passwordLabel', 'Password'));
passwordGroup.add(new TextInput('password', 'Enter password'));

loginForm.add(usernameGroup);
loginForm.add(passwordGroup);
loginForm.add(new Button('submitBtn', 'Login', () => {}));

// Footer
const footer = new Container('footer', 'footer');
footer.addClass('footer');
footer.add(new Label('copyright', 'Â© 2024 My App'));

// Assemble
app.add(header);
app.add(loginForm);
app.add(footer);

// Render entire tree
console.log(app.render());

// Find and modify component
const submitBtn = app.find('submitBtn');
submitBtn.addClass('btn-primary').setStyle('background', 'blue');

// Hide password group
app.find('passwordGroup').hide();

console.log('\n=== After modifications ===\n');
console.log(app.render());
```

---

## 13.4 When to Use Composite

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              WHEN TO USE COMPOSITE                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  âœ… USE WHEN:                                               â”‚
â”‚  â€¢ Part-whole hierarchies (tree structures)                 â”‚
â”‚  â€¢ Clients should treat parts and wholes uniformly          â”‚
â”‚  â€¢ Recursive structures (folders, menus, UI components)     â”‚
â”‚  â€¢ Need to aggregate operations (total size, render all)    â”‚
â”‚                                                             â”‚
â”‚  âŒ AVOID WHEN:                                             â”‚
â”‚  â€¢ Structure isn't hierarchical                             â”‚
â”‚  â€¢ Leaf and composite behaviors differ significantly        â”‚
â”‚  â€¢ Performance is critical (tree traversal overhead)        â”‚
â”‚                                                             â”‚
â”‚  REAL-WORLD EXAMPLES:                                       â”‚
â”‚  â€¢ File systems                                             â”‚
â”‚  â€¢ DOM (Document Object Model)                              â”‚
â”‚  â€¢ Organization charts                                      â”‚
â”‚  â€¢ GUI component libraries (React, Vue)                     â”‚
â”‚  â€¢ Menu systems                                             â”‚
â”‚  â€¢ Bill of materials                                        â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Key Takeaways

1. **Composite = Tree Structure** - Part-whole hierarchies
2. **Uniform Interface** - Treat leaves and composites the same
3. **Recursive Operations** - Operations propagate through tree
4. **Component Interface** - Common methods for all nodes
5. **Leaf vs Composite** - Leaves have no children, composites do
6. **Real-world use** - DOM, file systems, UI libraries, menus

> ğŸ’¡ **Interview Tip:** Explain Composite with the file system analogy. Both files and folders can have getSize(), but folders calculate recursively.

> ğŸ­ **Production Note:** React and Vue component trees are classic Composite pattern implementations. Each component can contain other components.
